var qe=Object.defineProperty;var Be=(e,t,r)=>t in e?qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var oe=(e,t,r)=>(Be(e,typeof t!="symbol"?t+"":t,r),r),re=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var z=(e,t,r)=>(re(e,t,"read from private field"),r?r.call(e):t.get(e)),se=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},le=(e,t,r,s)=>(re(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);import"regular-table";var U='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';function Ve(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function J(e,t,r){let s=Array.from(e.children[0].children[0].children),o=s.length,l=t.hasAttribute("settings");if(o<=1?s[0]?.removeAttribute("id"):s.forEach((i,n)=>{let a=l?1:0,c=n===o-(a+1)?"psp-column-titles":n===o-a?"psp-column-edit-buttons":null;c?i.setAttribute("id",c):i.removeAttribute("id")}),t.classList.toggle("psp-menu-open",!!r),l&&o>=2){let i=Array.from(s[o-2].children),n=Array.from(s[o-1].children);if(i&&n){s.slice(0,o-2).forEach(a=>{Array.from(a.children).forEach(c=>{c.classList.toggle("psp-menu-open",!1)})});for(let a=0;a<i.length;a++){let c=i[a],d=n[a],p=c.textContent===r;if(c.classList.toggle("psp-menu-open",p),d.classList.toggle("psp-menu-open",p),this._config.columns.length>1)for(let g of e.querySelectorAll("td")){let u=e.getMeta(g),_=u.column_header[u.column_header.length-2]===r;g.classList.toggle("psp-menu-open",_)}}}}}function ne(e,t){let r=Array.from(e.children[0].children[0].children);if(r.length>0){J.call(this,e,t,this._column_settings_selected_column);let[s]=r.splice(this._config.split_by.length,1);ie.call(this,e,s,!1);let[o]=r.splice(this._config.split_by.length,1);o&&ie.call(this,e,o,!0)}}function ie(e,t,r){let s=e._view_cache.config.row_pivots.length-1;for(let o of t?.children){let l=e.getMeta(o),i=l.column_header?.[this._config.split_by.length],n=this._config.sort.find(h=>h[0]===i),a=l.row_header_x===s,c=typeof l.x>"u";a=a||(l.x+1)%this._config.columns.length===0,o.classList.toggle("psp-header-border",a),o.classList.toggle("psp-header-group",!1),o.classList.toggle("psp-header-leaf",!0),o.classList.toggle("psp-is-top",!1),o.classList.toggle("psp-header-corner",c),o.classList.toggle("psp-header-sort-asc",!r&&!!n&&n[1]==="asc"),o.classList.toggle("psp-header-sort-desc",!r&&!!n&&n[1]==="desc"),o.classList.toggle("psp-header-sort-col-asc",!r&&!!n&&n[1]==="col asc"),o.classList.toggle("psp-header-sort-col-desc",!r&&!!n&&n[1]==="col desc");let d=Ve.call(this,l),p=d==="integer"||d==="float",g=d==="string",u=d==="date",_=d==="datetime";o.classList.toggle("psp-align-right",p),o.classList.toggle("psp-align-left",!p),o.classList.toggle("psp-menu-enabled",(g||p||u||_)&&!c&&l.column_header_y==this._config.split_by.length+1),o.classList.toggle("psp-sort-enabled",(g||p||u||_)&&!c&&l.column_header_y===this._config.split_by.length),o.classList.toggle("psp-is-width-override",e._column_sizes?.override[l.size_key]!==void 0)}}function ae(e){let t=e._view_cache.config.row_pivots.length-1,r=Array.from(e.children[0].children[0].children),s=[],o=new Set,l=e.children[0];for(let i=0;i<r.length;i++){let n=l.rows[i],a=new Set;for(let c=0;c<n.cells.length;c++){let d=n.cells[c];d.style.backgroundColor="";let p=e.getMeta(d),g=p.row_header_x===t||p.x>=0;d.classList.toggle("psp-align-right",!1),d.classList.toggle("psp-align-left",!1),d.classList.toggle("psp-header-group",!0),d.classList.toggle("psp-header-leaf",!1),d.classList.toggle("psp-header-border",g),d.classList.toggle("psp-header-group-corner",typeof p.x>"u"),d.classList.toggle("psp-color-mode-bar",!1),d.classList.toggle("psp-header-sort-asc",!1),d.classList.toggle("psp-header-sort-desc",!1),d.classList.toggle("psp-header-sort-col-asc",!1),d.classList.toggle("psp-header-sort-col-desc",!1),d.classList.toggle("psp-sort-enabled",!1);let u=n.cells[c],_=c,h,b;for(;s[i]&&s[i][_];++_);for(a.add(_),h=_;h<_+u.colSpan;++h)for(b=i;b<i+u.rowSpan;++b)s[b]||(s[b]=[]),s[b][h]=!0;u.classList.toggle("psp-is-top",i===0||!o.has(h))}o=a}}var k=Symbol("Plugin Symbol");function ce(e,t,[,,,,,r,s],[,,,,,o,l],i){let n=this._ids?.[e.dy]?.join("|"),a=(i?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(a)&&this.last_reverse_ids?.has(n)){let c=this.last_reverse_ids?.get(n),d=this.last_reverse_columns.get(a);this._is_old_viewport?this.last_meta?.[d]?.[c]>e.user?(t.style.setProperty("--pulse--background-color-start",o),t.style.setProperty("--pulse--background-color-end",l),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[d]?.[c]<e.user?(t.style.setProperty("--pulse--background-color-start",r),t.style.setProperty("--pulse--background-color-end",s),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):c!==e.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}import de from"chroma-js";function V(e,t){return de.mix(e,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function L([e,t,r,s],o=[255,255,255]){function l(i,n){return((1-s)*(o[i]/255)+s*(n/255))*255}return[l(0,e),l(1,t),l(2,r)]}function S([e,t,r]){return Math.sqrt(e*e*.299+t*t*.587+r*r*.114)>130?"#161616":"#ffffff"}function Ke(e){let[t,r,s]=e.rgb(),[o,l,i]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[n,a,c]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${o},${l},${i}),rgb(${t},${r},${s}) 50%,rgb(${n},${a},${c}))`}function w(e){let t=de(e),r=Ke(t),s=t.rgb();return[e,...s,r,`rgba(${s[0]},${s[1]},${s[2]},1)`,`rgba(${s[0]},${s[1]},${s[2]},0)`]}function pe(e,t,r,s){let o=r.user>0,l=r.user<0,i;e?.pos_bg_color!==void 0?i=e.pos_bg_color:i=this._pos_bg_color;let n;e?.neg_bg_color!==void 0?n=e.neg_bg_color:n=this._neg_bg_color;let a=o?i:l?n:["",...this._plugin_background,""];{let[_,h,b,f,v]=a;if(t.style.position="",e?.number_bg_mode==="color")t.style.animation="",t.style.backgroundColor=_;else if(e?.number_bg_mode==="gradient"){let m=Math.max(0,Math.min(1,Math.abs(r.user/e.bg_gradient))),x=this._plugin_background,y=S(L([h,b,f,m],x));t.style.animation="",t.style.color=y,t.style.backgroundColor=`rgba(${h},${b},${f},${m})`}else e?.number_bg_mode==="pulse"?(ce.call(this,r,t,i,n,s),t.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,t.style.animation="",t.style.backgroundColor="")}let[c,d,p,g,u]=(()=>e?.pos_fg_color!==void 0?o?e.pos_fg_color:l?e.neg_fg_color:["",...this._plugin_background,""]:o?this._pos_fg_color:l?this._neg_fg_color:["",...this._plugin_background,""])();if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let _=this._plugin_background,h=S(L([a[1],a[2],a[3],1],_));t.style.color=h}else e?.number_bg_mode==="gradient"||(t.style.color="");else e?.number_fg_mode==="bar"?(t.style.color="",t.style.position="relative",u!==""&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=u)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(t.style.color=c)}import _e from"chroma-js";function ue(e,t,r){let s=r.column_header?.[this._config.split_by.length],[o,l,i,n,a]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.string_color_mode==="foreground"&&r.user!==null)t.style.color=o,t.style.backgroundColor="",e?.format==="link"&&(t.children[0].style.color=o);else if(e?.string_color_mode==="background"&&r.user!==null){let c=this._plugin_background,d=S(L([l,i,n,1],c));t.style.color=d,t.style.backgroundColor=o}else if(e?.string_color_mode==="series"&&r.user!==null){this._series_color_map.has(s)||(this._series_color_map.set(s,new Map),this._series_color_seed.set(s,0));let c=this._series_color_map.get(s);if(!c.has(r.user)){let y=this._series_color_seed.get(s);c.set(r.user,y),this._series_color_seed.set(s,y+1)}let d=c.get(r.user),[p,g,u]=_e(o).hsl();p=p+d*150%360;let _=_e(p,g,u,"hsl"),[h,b,f]=_.rgb(),v=_.hex(),m=this._plugin_background,x=S(L([h,b,f,1],m));t.style.color=x,t.style.backgroundColor=v}else t.style.backgroundColor="",t.style.color=""}import"chroma-js";function he(e,t,r){let s=r.column_header?.[this._config.split_by.length],[o,l,i,n,a]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.datetime_color_mode==="foreground"&&r.user!==null)t.style.color=o,t.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&r.user!==null){let c=this._plugin_background,d=S(L([l,i,n,1],c));t.style.color=d,t.style.backgroundColor=o}else t.style.backgroundColor="",t.style.color=""}function ge(e,t,r){let[s]=r.user===!0?this._pos_fg_color:r.user===!1?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=s}function me(e,t,r){let s=typeof r.value!=null&&typeof r.value!=null&&r.value?.toString()?.trim().length>0,o=r.row_header_x>=this._config.group_by.length,l=e.getMeta({dx:0,dy:r.y-r.y0+1}),i=l&&l.row_header&&typeof l.row_header[r.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",s&&!o),t.classList.toggle("psp-tree-label-expand",s&&!o&&!i),t.classList.toggle("psp-tree-label-collapse",s&&!o&&i),t.classList.toggle("psp-tree-leaf",s&&o)}function Ze(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function be(e,t){let r=e[k]||{},s=t.hasAttribute("settings");for(let o of e.children[0].children[1].children)for(let l of o.children){let i=e.getMeta(l),n=i.column_header?.[this._config.split_by.length],a=Ze.call(this,i),c=r[n],d=a==="integer"||a==="float";d?pe.call(this,c,l,i,s):a==="boolean"?ge.call(this,c,l,i):a==="string"?ue.call(this,c,l,i):a==="date"||a==="datetime"?he.call(this,c,l,i):(l.style.backgroundColor="",l.style.color=""),l.classList.toggle("psp-bool-type",a==="boolean"&&i.user!==null);let p=l.tagName==="TH";p&&me.call(this,e,l,i),l.classList.toggle("psp-align-right",!p&&d),l.classList.toggle("psp-align-left",p||!d),l.classList.toggle("psp-color-mode-bar",c?.number_fg_mode==="bar"&&d)}}async function fe(e,t,r,s){let l=e.getMeta(s).column_header[this._config.split_by.length],n=(r.shiftKey?Xe:Qe).call(this,l);this._preserve_focus_state=!0,await t.restore({sort:n})}function Xe(e){let t=[],r=!1;for(let s of this._config.sort){let[o,l]=s;if(o===e){r=!0;let i=xe.call(this,e,l);i&&t.push(i)}else t.push(s)}return r||t.push([e,"desc"]),t}function Qe(e){for(let[t,r]of this._config.sort)if(t===e){let s=xe.call(this,e,r);return s?[s]:[]}return[[e,"desc"]]}function xe(e,t){let s=this._config.split_by.length>0?tt:et,o=t?s[t]:"desc";if(o)return[e,o]}var et={desc:"asc",asc:void 0},tt={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function ye(e,t){let r=e.getMeta(t.target),s=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&s?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-2):t.shiftKey?this._view.set_depth(r.row_header.filter(o=>o!==void 0).length-1):s?this._view.collapse(r.y):this._view.expand(r.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function ve(e,t,r){if(r.which!==1)return;let s=r.target;if(s.tagName!=="A"){for(;s.tagName!=="TD"&&s.tagName!=="TH";)if(s=s.parentElement,!e.contains(s))return;if(s.classList.contains("psp-tree-label")){ye.call(this,e,r),r.stopImmediatePropagation();return}if(s.classList.contains("psp-menu-enabled")){let l=e.getMeta(s).column_header?.[this._config.split_by.length];await t.toggleColumnSettings(l),r.preventDefault(),r.stopImmediatePropagation()}else s.classList.contains("psp-sort-enabled")&&(fe.call(this,e,t,r,s),r.stopImmediatePropagation())}}function we(e,t){if(t.which!==1)return;let r=t.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!e.contains(r))return;(r.classList.contains("psp-tree-label")&&t.offsetX<26||r.classList.contains("psp-header-leaf")&&!r.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function ke(e,t=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,s=e.hasAttribute("selectable"),o=t||e.children[0].dataset.editMode==="EDIT";return r&&!s&&o}function Ee(e,t,r){let s=e[k]||{},o=ke.call(this,t);r.classList.toggle("edit-mode-allowed",ke.call(this,t,!0));for(let l of e.querySelectorAll("td")){let i=e.getMeta(l),n=this.get_psp_type(i);if(o&&this._is_editable[i.x]){let a=i.column_header[this._config.split_by.length];n==="string"&&s[a]?.format==="link"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)):n==="boolean"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",i.user!==null)):(o!==l.hasAttribute("contenteditable")&&l.toggleAttribute("contenteditable",o),l.classList.toggle("boolean-editable",!1))}else l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)}}var W=(e,t,r)=>{let s=e.querySelectorAll("td"),o=r.get(e),l=e.getRootNode();if(o){for(let i of s){let n=e.getMeta(i);if(n.x===o.x&&n.y===o.y)return l.activeElement!==i&&i.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(l.activeElement)&&l.activeElement.blur()}};function K(e,t,r){let s=e.getMeta(r),o=t._schema[t._column_paths[s.x]];if(s){let l=r.textContent,i=t._ids[s.y-s.y0][0];if(o==="float"||o==="integer"){if(l=parseFloat(l.replace(/,/g,"")),isNaN(l))return!1}else if(o==="date"||o==="datetime"){if(l=Date.parse(l),isNaN(l))return!1}else o==="boolean"&&(l=l==="true"?!1:l==="false"?!0:null);let n={__INDEX__:i,[t._column_paths[s.x]]:l};return t._table.update([n],{port_id:t._edit_port}),!0}}function Le(e,t,r){let s=e.getMeta(r.target);if(typeof s?.x<"u"){let o=this._is_editable[s.x],l=this.get_psp_type(s)==="boolean",i=r.target.textContent==="-";o&&l&&!i&&K(e,this,r.target)}}function rt(e){let t;return async function(...r){if(!!t&&await t&&!!t)return;let s;t=new Promise(o=>s=o),await e.apply(this,r),t=void 0,s()}}function Se(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this),t.setEnd(e.endContainer,e.endOffset),t.toString().length}else return this.target.selectionStart}var C=rt(async function(e,t,r,s,o){let l=e.getMeta(r),i=this._column_paths.length,n=this._num_rows,a=t.get(e);if(!a)return;l.x+s<i&&0<=l.x+s&&(a.x=l.x+s),l.y+o<n&&0<=l.y+o&&(a.y=l.y+o);let c=Math.max(l.x0-10,0),d=Math.min(l.x0+10,i),p=Math.max(l.y0-5,0),g=Math.min(l.y0+10,n),u=l.x0+s,_=l.y0+o;for(;!W(e,void 0,t)&&u>=c&&u<d&&_>=p&&_<g;)await e.scrollToCell(u,_,i,n),t.set(e,a),u+=s,_+=o});function st(e,t,r){return t.getMeta(r).y===e._num_rows-1}function Oe(e,t,r,s){let o=e.getRootNode().activeElement;switch(s.target.classList.remove("psp-error"),s.key){case"Enter":s.preventDefault(),st(this,e,o)?(o.blur(),r.delete(e)):s.shiftKey?C.call(this,e,r,o,0,-1):C.call(this,e,r,o,0,1);break;case"ArrowLeft":Se.call(o)==0&&(s.preventDefault(),C.call(this,e,r,o,-1,0));break;case"ArrowUp":s.preventDefault(),C.call(this,e,r,o,0,-1);break;case"ArrowRight":Se.call(o)==o.textContent.length&&(s.preventDefault(),C.call(this,e,r,o,1,0));break;case"ArrowDown":s.preventDefault(),C.call(this,e,r,o,0,1);break;default:}}function P(e,t=!1){let r=this._config.group_by.length===0&&this._config.split_by.length===0,s=e.hasAttribute("selectable"),o=t||e.children[0]._edit_mode==="EDIT";return r&&!s&&o}function Ce(e,t,r,s){if(this._edit_mode==="EDIT"){if(!P.call(this,t))return;Oe.call(this,e,t,r,s)}else console.log(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function Re(e,t,r){if(this._edit_mode==="EDIT"){if(!P.call(this,t))return;Le.call(this,e,t,r)}else this._edit_mode==="READ_ONLY"||this._edit_mode==="SELECT_COLUMN"||this._edit_mode==="SELECT_ROW"||this._edit_mode==="SELECT_REGION"||console.log(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function Me(e,t,r,s){if(P.call(this,t)&&r.has(e)){s.target.classList.remove("psp-error");let o=r.get(e);r.delete(e),o.content!==s.target.textContent&&(K(e,this,s.target)||(s.target.textContent=o.content,s.target.classList.add("psp-error"),s.target.focus()))}}function Ne(e,t,r,s){let o=e.getMeta(s.target);if(o){let l={x:o.x,y:o.y,content:s.target.textContent};r.set(e,l)}}async function N({_view:e,_config:t},r,s){let o=t.group_by,l=t.split_by,i=r>=0?r:0,n=i+1,a=await e.to_json({start_row:i,end_row:n}),d=a.map(f=>f.__ROW_PATH__)[0]||[],p=o.map((f,v)=>{let m=d[v];return m?[f,"==",m]:void 0}).filter(f=>f),g=o.length>0?s+1:s,u=Object.keys(a[0])[g],_={row:a[0]},h=[];if(u){let f=u.split("|");_.column_names=[f[l.length]],h=l.map((v,m)=>{let x=f[m];return x?[v,"==",x]:void 0}).filter(v=>v).filter(([,,v])=>v!=="__ROW_PATH__")}let b=t.filter.concat(p).concat(h);return _.config={filter:b},_}async function Ae(e,t,r,s){let o=e.getMeta(s.target);if(!t.hasAttribute("selectable")||s.handled||s.which!==1||!o)return;let l=this._ids[o.y-o.y0];if(o&&o.y>=0){let i=r.get(e),n=!!i&&i.reduce((u,_,h)=>u&&_===l[h],!0),a=!!i&&l.length===i.length&&n,c={selected:!a},{row:d,column_names:p,config:g}=await N(this,o.y,o.x);a?(r.delete(e),c={...c,row:d,config:{filter:structuredClone(this._config.filter)}}):(r.set(e,l),c={...c,row:d,column_names:p,config:g}),await e.draw({preserve_width:!0}),s.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:c}))}}function Te(e,t,r){if(!t.hasAttribute("selectable"))return;let s=r.has(e),o=r.get(e);for(let l of e.querySelectorAll("td"))if(!s)l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let i=e.getMeta(l),n=this._ids[i.y-i.y0],a=o.reduce((c,d,p)=>c&&d===n[p],!0);l.classList.toggle("psp-row-selected",n.length===o.length&&a),l.classList.toggle("psp-row-subselected",n.length!==o.length&&a)}for(let l of e.querySelectorAll("tbody th")){let i=e.getMeta(l),n=this._ids[i.y-i.y0];if(!s||!!n[i.row_header_x])l.classList.toggle("psp-row-selected",!1),l.classList.toggle("psp-row-subselected",!1);else{let a=o.reduce((c,d,p)=>c&&d===n[p],!0);l.classList.toggle("psp-row-selected",n.length===o.length&&a),l.classList.toggle("psp-row-subselected",n.length!==o.length&&a)}}}async function De(e,t,r){r.delete(e);for(let s of e.querySelectorAll("td,th"))s.classList.toggle("psp-row-selected",!1),s.classList.toggle("psp-row-subselected",!1)}import at from"chroma-js";var Ie={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},it={types:{float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}}},$=class{constructor(){this._formatters=new Map}create_datetime_formatter(t,r){let s={dateStyle:"short",timeStyle:"medium"};if(t==="datetime")if(r.date_format?.format!=="custom"){let o={...s,timeZone:r.date_format?.timeZone,dateStyle:r.date_format?.dateStyle,timeStyle:r.date_format?.timeStyle};return o.dateStyle==="disabled"?o.dateStyle=void 0:o.dateStyle===void 0&&(o.dateStyle="short"),o.timeStyle==="disabled"?o.timeStyle=void 0:o.timeStyle===void 0&&(o.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,o)}else{let o={timeZone:r.date_format?.timeZone,second:r.date_format?.second,minute:r.date_format?.minute,hour:r.date_format?.hour,day:r.date_format?.day,weekday:r.date_format?.weekday,month:r.date_format?.month,year:r.date_format?.year,hour12:r.date_format?.hour12,fractionalSecondDigits:r.date_format?.fractionalSecondDigits};return o.year==="disabled"?o.year=void 0:o.year===void 0&&(o.year="2-digit"),o.month==="disabled"?o.month=void 0:o.month===void 0&&(o.month="numeric"),o.day==="disabled"?o.day=void 0:o.day===void 0&&(o.day="numeric"),o.weekday==="disabled"&&(o.weekday=void 0),o.hour==="disabled"?o.hour=void 0:o.hour===void 0&&(o.hour="numeric"),o.minute==="disabled"?o.minute=void 0:o.minute===void 0&&(o.minute="numeric"),o.second==="disabled"?o.second=void 0:o.second===void 0&&(o.second="numeric"),o.hour12===void 0&&(o.hour12=!0),new Intl.DateTimeFormat(navigator.languages,o)}else{let o={...s.format,dateStyle:r.date_format?.dateStyle};return o.dateStyle==="disabled"?o.dateStyle=void 0:o.dateStyle===void 0&&(o.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,o)}}create_number_formatter(t,r){let s=it.types[t]?.format;return r.number_format!==void 0&&(s=r.number_format),new Ie[t](navigator.languages,s)}create_boolean_formatter(t,r){return new Ie[t](navigator.languages,{})}get(t,r){let s=[t,...Object.values(r.date_format??{}),...Object.values(r.number_format??{})].join("-");return this._formatters.has(s)||(t==="date"||t==="datetime"?this._formatters.set(s,this.create_datetime_formatter(t,r)):t==="integer"||t==="float"?this._formatters.set(s,this.create_number_formatter(t,r)):t==="boolean"?this._formatters.set(s,this.create_boolean_formatter(t,r)):this._formatters.set(s,!1)),this._formatters.get(s)}};var nt=new $,ze=1;function F(e,t,r={},s=!1){if(t===null)return"-";let o=s&&this._table_schema[e]||this._schema[e]||"string",l=r[e]||{};if((o==="integer"||o==="float")&&l?.number_fg_mode==="bar"){let n=Math.max(0,Math.min(ze,Math.abs(t/l.fg_gradient)*ze)),a=this._div_factory.get(),c=t>=0?"left":"right",d=(n*100).toFixed(2);return a.setAttribute("style",`width:calc(${d}% - 4px);position:absolute;${c}:2px;height:80%;top:10%;pointer-events:none;`),a}else if(l?.format==="link"&&o==="string"){let n=document.createElement("a");return n.setAttribute("href",t),n.setAttribute("target","_blank"),n.textContent=t,n}else if(l?.format==="bold"&&o==="string"){let n=document.createElement("b");return n.textContent=t,n}else if(l?.format==="italics"&&o==="string"){let n=document.createElement("i");return n.textContent=t,n}else{let n=nt.get(o,l);return n?n.format(t):t}}function*Ue(e=[],t,r){let s=r[k];for(let o of e){o=["TOTAL",...o];let l=o[o.length-1];o=o.slice(0,o.length-1).fill("");let i=F.call(this,t[o.length-1],l,s,!0);i instanceof HTMLElement?o=o.concat(i):o=o.concat({toString:()=>i}),o.length=t.length+1,yield o}}function We(e){let t,r,s,o,l;return async function(n,a,c,d,p){let g={},u;d-a>0&&p-c>0?(this._is_old_viewport=this._last_window?.start_row===c&&this._last_window?.end_row===p&&this._last_window?.start_col===a&&this._last_window?.end_col===d,u={start_row:c,start_col:a,end_row:p,end_col:d,id:!0},g=JSON.parse(await this._view.to_columns_string(u)),this._last_window=u,this._ids=g.__ID__,this._reverse_columns=this._column_paths.slice(a,d).reduce((m,x,y)=>(m.set(x,y),m),new Map),this._reverse_ids=this._ids.reduce((m,x,y)=>(m.set(x?.join("|"),y),m),new Map)):this._div_factory.clear();let _=[],h=[],b=[],f=[],v=e.hasAttribute("settings");for(let m=a;m<Math.min(d,this._column_paths.length);++m){let x=this._column_paths[m],y=x.split("|"),M=g[x]||new Array(p-c).fill(null);_.push(M.map(D=>F.call(this,y[this._config.split_by.length],D,n[k]))),h.push(M),v&&y.push(""),b.push(y),f.push(x)}return d-a>0&&p-c>0&&(this.last_column_paths=r,this.last_meta=t,this.last_ids=s,this.last_reverse_ids=o,this.last_reverse_columns=l,r=f,t=h,s=this._ids,o=this._reverse_ids,l=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(Ue.call(this,g.__ROW_PATH__,this._config.group_by,n)),column_headers:b,data:_,metadata:h,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function G(e,t,r){let s=window.getComputedStyle(e).getPropertyValue(t).trim();return s.length>0?s:r}var Z=class{constructor(t){this._name=t,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}};function ct(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function X(e,t,r,s={}){let o=await r.get_config(),l=Array.isArray(o.expressions)?Object.fromEntries(o.expressions.map(E=>[E[0],E[1]])):o.expressions,[i,n,a,c,d,p,g]=await Promise.all([t.schema(),t.validate_expressions(l),r.num_rows(),r.schema(),r.expression_schema(),r.column_paths(),this.parentElement.getEditPort()]),u=at(G(e,"--plugin--background","#FFFFFF")).rgb(),_=w(G(e,"--rt-pos-cell--color","#338DCD")),h=w(G(e,"--rt-neg-cell--color","#FF5942")),b=w(V(_[0],u)),f=w(V(h[0],u)),v=w(G(e,"--active--color","#ff0000")),m={...c,...d},x={...i,...n.expression_schema},y=p.filter(E=>E!=="__ROW_PATH__"&&E!=="__ID__"),M=[],D=[];for(let E of y){let te=E.split("|")[o.split_by.length];D.push(m[te]),M.push(!!i[te])}let I=Object.assign(s,{_edit_port:g,_view:r,_table:t,_table_schema:x,_config:o,_num_rows:a,_schema:m,_ids:[],_plugin_background:u,_color:v,_pos_fg_color:_,_neg_fg_color:h,_pos_bg_color:b,_neg_bg_color:f,_column_paths:y,_column_types:D,_is_editable:M,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:o.group_by.map(E=>x[E]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:ct});return I._div_factory=I._div_factory||new Z("div"),e.setDataListener(We(this.parentElement).bind(I,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),I}async function Pe(e,t,r){let s=e.getMeta(r.target);if(!s)return;let{x:o,y:l}=s,{row:i,column_names:n,config:a}=await N(this,l,o);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:i,column_names:n,config:a}}))}var dt="mouse-selected-area",$e=(e,t,{className:r=dt,selected:s=[]}={})=>(e.model._selection_state={selected_areas:s,dirty:!0},t.addEventListener("mousedown",pt(e,t,r)),t.addEventListener("mouseover",_t(e,t,r)),t.addEventListener("mouseup",ut(e,t,r)),t.addStyleListener(()=>A(e,t,r)),t),pt=(e,t,r)=>s=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let o=t.getMeta(s.target);if(o&&o.x!==void 0&&o.y!==void 0){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:o.x,y:o.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let l={x0:o.x,x1:o.x,y0:o.y,y1:o.y};e.model._selection_state.potential_selection=l,A(e,t,r,e.model._selection_state.selected_areas.concat([l]));return}}e.model._selection_state.selected_areas=[]},_t=(e,t,r)=>s=>{if((e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0){let o=t.getMeta(s.target);if(o&&o.x!==void 0&&o.y!==void 0){let l={x0:Math.min(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=l,A(e,t,r,e.model._selection_state.selected_areas.concat([l]))}}},ut=(e,t,r)=>s=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){let o=t.getMeta(s.target);if(console.log("A"),e.model._selection_state.old_selected_areas.length>0){let l=e.model._selection_state.old_selected_areas[0];if(l.x0===l.x1&&l.y0===l.y1&&l.x0===o.x&&l.y0===o.y){e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,A(e,t,r,[]);return}}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0&&o.x!==void 0&&o.y!==void 0){let l={x0:Math.min(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(o.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(o.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(l),A(e,t,r)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};function ht(e,t,{x0:r,x1:s,y0:o,y1:l}){let i={},n=t.model._edit_mode;r!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(n)>-1&&(i.start_col=r),s!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(n)>-1&&(i.end_col=s+1),o!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(n)>-1&&(i.start_row=o),l!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(n)>-1&&(i.end_row=l+1),e.setSelection(i)}var A=(e,t,r,s)=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){s=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&s.push(e.model._selection_state.potential_selection);let o=t.querySelectorAll("tbody td");if(s.length>0)ht(e.parentElement,e,s[0]),gt(e,t,s,r);else{e.parentElement.setSelection();for(let l of o)l.classList.remove(r)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let o=t.querySelectorAll("tbody td");for(let l of o)l.classList.remove(r)}},gt=(e,t,r,s)=>{if(e.model._edit_mode==="SELECT_REGION"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let l of o){let i=t.getMeta(l),n=!1;for(let{x0:a,x1:c,y0:d,y1:p}of r)a!==void 0&&d!==void 0&&c!==void 0&&p!==void 0&&a<=i.x&&i.x<=c&&d<=i.y&&i.y<=p&&(n=!0,e.model._selection_state.dirty=!0,l.classList.add(s));n||l.classList.remove(s)}}else if(e.model._edit_mode==="SELECT_ROW"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let l of o){let i=t.getMeta(l),n=!1;for(let{x0:a,x1:c,y0:d,y1:p}of r)a!==void 0&&d!==void 0&&c!==void 0&&p!==void 0&&d<=i.y&&i.y<=p&&(e.model._selection_state.dirty=!0,n=!0,l.classList.add(s));n||l.classList.remove(s)}}else if(e.model._edit_mode==="SELECT_COLUMN"&&r.length>0){let o=t.querySelectorAll("tbody td");for(let l of o){let i=t.getMeta(l),n=!1;for(let{x0:a,x1:c,y0:d,y1:p}of r)a!==void 0&&d!==void 0&&c!==void 0&&p!==void 0&&a<=i.x&&i.x<=c&&(e.model._selection_state.dirty=!0,n=!0,l.classList.add(s));n||l.classList.remove(s)}}};async function Fe(e){let t=this.parentElement,r=await t.getTable(!0);if(this._initialized)await X.call(this,this.regular_table,r,e,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await X.call(this,this.regular_table,r,e),$e(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(be.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(ae.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(ne.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("click",we.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",ve.bind(this.model,this.regular_table,t));let s=new WeakMap;this.regular_table.addStyleListener(Te.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("mousedown",Ae.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("psp-deselect-all",De.bind(this.model,this.regular_table,t,s)),this.regular_table.addEventListener("click",Pe.bind(this.model,this.regular_table,t));let o=new WeakMap;this.regular_table.addStyleListener(Ee.bind(this.model,this.regular_table,t,this)),this.regular_table.addStyleListener(W.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("click",Re.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",Ne.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("focusout",Me.bind(this.model,this.regular_table,t,o)),this.regular_table.addEventListener("keydown",Ce.bind(this.model,this.regular_table,t,o)),t.addEventListener("perspective-toggle-column-settings",l=>{if(this.isConnected){if(J.call(this.model,this.regular_table,t,l.detail.column_name),!l.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=l.detail.column_name}}),this._initialized=!0}}function H(e,t=!1){if(!this._initialized)return;t&&(this._cached_column_sizes=e);let r={},{group_by:s,columns:o}=this.model._config,l=s?.length>0?s.length+1:0;for(let i of Object.keys(e))if(i==="__ROW_PATH__")r[l-1]=e[i];else{let n=this.model._column_paths.indexOf(i);r[n+l]=e[i]}this.regular_table._column_sizes.override=r}function j(){if(!this._initialized)return[];if(this._cached_column_sizes){let l=this._cached_column_sizes;return this._cached_column_sizes=void 0,l}let e=this.regular_table._column_sizes.override,{group_by:t,columns:r}=this.model._config,s=t?.length>0?t.length+1:0,o={};for(let l of Object.keys(e))if(e[l]!==void 0){let i=l-s;i>-1?o[this.model._column_paths[i]]=e[l]:i===-1&&(o.__ROW_PATH__=e[l])}return o}var T=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];function Y(e=void 0){typeof e>"u"&&(e=T[(T.indexOf(this._edit_mode)+1)%T.length]),this.model._edit_mode=e,this.parentElement.setSelection(),this.model._selection_state={selected_areas:[],dirty:!0},this._edit_mode=e,this.dataset.editMode=e,this._edit_button!==void 0&&(this._edit_button.dataset.editMode=e)}function q(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",e)}function Ge(e,t){e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));let r={};if(e.columns)for(let[l,i]of Object.entries(e.columns))i.column_size_override!==void 0&&(r[l]=i.column_size_override,delete i.column_size_override);let s={};if(t)for(let[l,i]of Object.entries(t))s[l]={...i,pos_fg_color:i.pos_fg_color?w(i.pos_fg_color):void 0,neg_fg_color:i.neg_fg_color?w(i.neg_fg_color):void 0,pos_bg_color:i.pos_bg_color?w(i.pos_bg_color):void 0,neg_bg_color:i.neg_bg_color?w(i.neg_bg_color):void 0,color:i.color?w(i.color):void 0};"edit_mode"in e&&(T.indexOf(e.edit_mode)!==-1?Y.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&q.call(this,e.scroll_lock);let o=this.regular_table;H.call(this,r,!0),o[k]=s}function He(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},t=j.call(this);for(let r of Object.keys(t||{}))e.columns[r]||(e.columns[r]={}),e.columns[r].column_size_override=t[r];return JSON.parse(JSON.stringify(e))}return{}}async function je(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null)return;let t=j.call(this),r=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),H.call(this,t),await r,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function Q(e,t){return e==="integer"||e==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:e==="date"||e==="datetime"||e==="string"?{[e==="date"||e==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var O,ee=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let t=ee;t.renderTarget=="shadow"&&(z(t,O)||(le(t,O,new CSSStyleSheet),z(t,O).replaceSync(U)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(z(t,O)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let t=this.parentElement;t&&t.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(t){return await Fe.call(this,t)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(t,r){return t!=="boolean"}column_style_controls(t,r){return Q.call(this,t,r)}async draw(t){return await je.call(this,t)}async update(t){this.model._num_rows=await t.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return He.call(this)}restore(t,r){return Ge.call(this,t,r)}async restyle(t){await this.draw(t)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},R=ee;O=new WeakMap,oe(R,"renderTarget",window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light"),se(R,O,void 0);var Ye=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;height:48px;cursor:pointer;}:host #toolbar .hover-target:hover{outline:4px solid var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color,#ccc);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}';var B=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${Ye}
            </style>
            <div id="toolbar">
                <span class="hover-target">
                    <span id="scroll_lock" class="button">
                        <span></span>
                    </span>
                </span>
                <span class="hover-target">
                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">
                        <span></span>
                    </span>
                </span>
            </div>
        `;let t=this.parentElement,r=t.querySelector("perspective-viewer-datagrid");r._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),r._scroll_lock.addEventListener("click",()=>q.call(r)),r._edit_button=this.shadowRoot.querySelector("#edit_mode"),r._edit_button.addEventListener("click",()=>{Y.call(r),r.regular_table.draw(),t.dispatchEvent(new Event("perspective-config-update"))})}};function bt(){let e=document.createElement("style");e.textContent=U,document.head.insertBefore(e,document.head.firstChild)}async function ft(){customElements.define("perspective-viewer-datagrid-toolbar",B),customElements.define("perspective-viewer-datagrid",R),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}ft();bt();
//# sourceMappingURL=perspective-viewer-datagrid.js.map
