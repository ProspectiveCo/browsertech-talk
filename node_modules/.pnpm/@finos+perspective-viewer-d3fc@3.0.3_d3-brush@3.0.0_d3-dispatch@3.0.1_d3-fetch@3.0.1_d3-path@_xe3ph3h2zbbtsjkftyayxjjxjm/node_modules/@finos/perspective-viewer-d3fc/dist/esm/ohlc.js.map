{
  "version": 3,
  "sources": ["../../src/ts/plugin/polyfills/matches.ts", "../../src/ts/plugin/polyfills/closest.ts", "../../src/ts/charts/bar.ts", "../../src/ts/axis/axisFactory.ts", "../../src/ts/axis/axisType.ts", "../../src/ts/axis/noAxis.ts", "../../src/ts/axis/flatten.ts", "../../src/ts/axis/minBandwidth.ts", "../../src/ts/axis/withoutTicks.ts", "../../src/ts/axis/linearAxis.ts", "../../src/ts/d3fc/extent/extentLinear.ts", "../../src/ts/d3fc/padding/default.ts", "../../src/ts/axis/valueFormatter.ts", "../../src/ts/plugin/root.ts", "../../src/ts/axis/timeAxis.ts", "../../src/ts/axis/ordinalAxis.ts", "../../src/ts/d3fc/axis/multi-axis.ts", "../../src/ts/d3fc/axis/store.ts", "../../src/ts/axis/chartFactory.ts", "../../src/ts/series/barSeries.ts", "../../src/ts/tooltip/tooltip.ts", "../../src/ts/utils/utils.ts", "../../src/ts/tooltip/generateHTML.ts", "../../src/ts/tooltip/selectionData.ts", "../../src/ts/tooltip/selectionEvent.ts", "../../src/ts/series/seriesColors.ts", "../../src/ts/series/seriesKey.ts", "../../src/ts/data/utils.ts", "../../src/ts/axis/axisLabel.ts", "../../src/ts/data/splitIntoMultiSeries.ts", "../../src/ts/data/groupData.ts", "../../src/ts/legend/legend.ts", "../../src/ts/legend/scrollableLegend.ts", "../../src/ts/legend/styling/cropCellContents.ts", "../../src/ts/legend/styling/draggableComponent.ts", "../../src/ts/legend/styling/enforceContainerBoundaries.ts", "../../src/ts/legend/styling/resizableComponent.ts", "../../src/ts/legend/filter.ts", "../../src/ts/gridlines/gridlines.ts", "../../src/ts/d3fc/padding/hardLimitZero.ts", "../../src/ts/zoom/zoomableChart.ts", "../../src/ts/charts/column.ts", "../../src/ts/axis/domainMatchOrigins.ts", "../../src/ts/axis/splitterLabels.ts", "../../src/ts/axis/axisSplitter.ts", "../../src/ts/charts/line.ts", "../../src/ts/series/lineSeries.ts", "../../src/ts/data/splitData.ts", "../../src/ts/data/transposeData.ts", "../../src/ts/tooltip/nearbyTip.ts", "../../src/ts/data/findBest.ts", "../../src/ts/charts/xy-line.ts", "../../src/ts/series/pointSeriesCanvas.ts", "../../src/ts/series/seriesSymbols.ts", "../../src/ts/data/xySplitData.ts", "../../src/ts/charts/area.ts", "../../src/ts/series/areaSeries.ts", "../../src/ts/data/splitAndBaseData.ts", "../../src/ts/charts/y-scatter.ts", "../../src/ts/series/categoryPointSeries.ts", "../../src/ts/charts/xy-scatter.ts", "../../src/ts/data/pointData.ts", "../../src/ts/series/seriesRange.ts", "../../src/ts/legend/colorRangeLegend.ts", "../../src/ts/layout/gridLayoutMultiChart.ts", "../../src/ts/series/xy-scatter/xyScatterSeries.ts", "../../src/ts/series/heatmapSeries.ts", "../../src/ts/data/heatmapData.ts", "../../src/ts/charts/heatmap.ts", "../../src/ts/charts/ohlc.ts", "../../src/ts/charts/ohlcCandle.ts", "../../src/ts/data/ohlcData.ts", "../../src/ts/series/ohlcCandleSeries.ts", "../../src/ts/charts/candlestick.ts", "../../src/ts/charts/sunburst.ts", "../../src/ts/series/sunburst/sunburstColor.ts", "../../src/ts/data/treeData.ts", "../../src/ts/series/sunburst/sunburstArc.ts", "../../src/ts/series/sunburst/sunburstLabel.ts", "../../src/ts/series/sunburst/sunburstClick.ts", "../../src/ts/series/sunburst/sunburstSeries.ts", "../../src/ts/charts/treemap.ts", "../../src/ts/series/treemap/treemapColor.ts", "../../src/ts/series/treemap/treemapLabel.ts", "../../src/ts/series/treemap/treemapLayout.ts", "../../src/ts/series/treemap/treemapTransitions.ts", "../../src/ts/series/treemap/treemapLevelCalculation.ts", "../../src/ts/series/treemap/treemapControls.ts", "../../src/ts/series/treemap/treemapSeries.ts", "../../src/ts/charts/charts.ts", "../../src/ts/series/colorStyles.ts", "../../src/ts/plugin/plugin.ts", "../../src/ts/index/ohlc.ts"],
  "sourcesContent": ["// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nif (!Element.prototype.matches) {\n    Element.prototype.matches =\n        Element.prototype.msMatchesSelector ||\n        Element.prototype.webkitMatchesSelector;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nif (!Element.prototype.matches) {\n    Element.prototype.matches =\n        Element.prototype.msMatchesSelector ||\n        Element.prototype.webkitMatchesSelector;\n}\n\nif (!Element.prototype.closest) {\n    Element.prototype.closest = function <\n        K extends keyof HTMLElementTagNameMap\n    >(s: K): HTMLElementTagNameMap[K] {\n        var el = this;\n\n        do {\n            if (el.matches(s)) return el;\n            el = el.parentElement || el.parentNode;\n        } while (el !== null && el.nodeType === 1);\n        return null;\n    };\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { axisFactory } from \"../axis/axisFactory\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { barSeries } from \"../series/barSeries\";\nimport { seriesColors } from \"../series/seriesColors\";\nimport { groupAndStackData } from \"../data/groupData\";\nimport { colorLegend } from \"../legend/legend\";\nimport { filterData } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction barChart(container: HTMLSelection, settings: Settings) {\n    const data = groupAndStackData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend().settings(settings).scale(color);\n\n    const bars = barSeries(settings, color).orient(\"horizontal\");\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(() => bars));\n\n    const xAxis = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .memoValue(settings.axisMemo[0])\n        .excludeType(AXIS_TYPES.ordinal)\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding())(data);\n    const yAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")\n        .orient(\"vertical\")(data);\n\n    const chart = chartSvgFactory(xAxis, yAxis).plotArea(\n        withGridLines(series, settings).orient(\"horizontal\")\n    );\n\n    if (chart.yPaddingInner) {\n        chart.yPaddingInner(0.5);\n        chart.yPaddingOuter(0.25);\n        bars.align(\"left\");\n    }\n    chart.xNice && chart.xNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .yScale(yAxis.scale);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(legend);\n}\n\nbarChart.plugin = {\n    name: \"X Bar\",\n    category: \"X Chart\",\n    max_cells: 1000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        names: [\"X Axis\"],\n    },\n};\n\nexport default barChart;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { AxisTypeValues, axisType } from \"./axisType\";\nimport * as none from \"./noAxis\";\nimport * as linear from \"./linearAxis\";\nimport * as time from \"./timeAxis\";\nimport * as ordinal from \"./ordinalAxis\";\n\nimport {\n    Axis,\n    D3Scale,\n    Domain,\n    DomainTuple,\n    Orientation,\n    SettingNameValues,\n    Settings,\n    ValueName,\n} from \"../types\";\n\nexport type AxisComponent = (scale) => Axis;\n\nexport interface AxisFactoryContent {\n    scale: D3Scale;\n    domain: DomainTuple;\n    domainFunction: Function;\n    labelFunction: (valueName: any) => (d: any) => string | Date;\n    component: {\n        bottom: AxisComponent;\n        left: AxisComponent;\n        top: AxisComponent;\n        right: AxisComponent;\n    };\n    size: number | undefined;\n    decorate: Function; // (s, data, index) => unknown\n    label: string;\n    tickFormatFunction: Function;\n}\n\ninterface AxisFactory {\n    (data: any[]): any;\n    memoValue(): Axis;\n    memoValue(a: Axis): AxisFactory;\n\n    excludeType(): () => AxisTypeValues;\n    excludeType(nextExcludeType?: AxisTypeValues): this;\n\n    orient(): () => Orientation;\n    orient(nextOrient?: Orientation): this;\n\n    settingName(): () => SettingNameValues;\n    settingName(nextSettingName?: SettingNameValues): this;\n\n    settingValue(): () => string | null;\n    settingValue(nextSettingValue?: string | null): this;\n\n    valueName(): () => ValueName;\n    valueName(nextValueName?: ValueName): this;\n\n    valueNames(): () => ValueName[];\n    valueNames(nextValueNames?: ValueName[]): this;\n\n    modifyDomain(): () => ModifyDomainFunc;\n    modifyDomain(nextModifyDomain?: ModifyDomainFunc): this;\n\n    // optional params, no idea yet if these are right or not.\n    include?: (nextInclude?: number[]) => any;\n    paddingStrategy?: (nextPaddingStrategy?: any) => any;\n    pad?: (nextPad?: [number, number]) => any;\n}\n\nexport type ModifyDomainFunc = (domain: any[]) => any[];\n\nconst axisTypes = {\n    none,\n    ordinal,\n    time,\n    linear,\n};\n\nexport const axisFactory = (settings: Settings): AxisFactory => {\n    let excludeType: AxisTypeValues | null = null;\n    let orient: Orientation = \"horizontal\";\n    let settingName: SettingNameValues = \"crossValues\";\n    let settingValue: string | undefined = undefined;\n    let valueNames: ValueName[] = [\"crossValue\"];\n    let modifyDomain = null;\n    let memoValue = null;\n\n    const optionalParams = [\"include\", \"paddingStrategy\", \"pad\"];\n    const optional = {};\n\n    const _factory: Partial<AxisFactory> = (data): AxisFactoryContent => {\n        const useType = axisType(settings)\n            .excludeType(excludeType)\n            .settingName(settingName)\n            .settingValue(settingValue)();\n\n        const axis = axisTypes[useType];\n        const domainFunction = (axis.domain() as Domain).valueNames(valueNames);\n\n        optionalParams.forEach((p) => {\n            if (optional[p] && domainFunction[p])\n                domainFunction[p](optional[p]);\n        });\n        if (domainFunction.orient) domainFunction.orient(orient);\n\n        let domain = domainFunction(data);\n        if (modifyDomain !== null) {\n            domain = modifyDomain(domain);\n        }\n\n        if (memoValue && typeof domain[0] === \"number\") {\n            memoValue[0] = domain[0] = Math.min(domain[0], memoValue[0]);\n            memoValue[1] = domain[1] = Math.max(domain[1], memoValue[1]);\n        }\n\n        const component = axis.hasOwnProperty(\"component\")\n            ? createComponent(axis, domain, data)\n            : defaultComponent();\n\n        const tickFormatFunction =\n            axis == linear\n                ? linear.tickFormatFunction(domain[0], domain[1])\n                : undefined;\n\n        return {\n            scale: axis.scale(),\n            domain,\n            domainFunction,\n            labelFunction: axis.labelFunction,\n            component: {\n                bottom: component.bottom,\n                left: component.left,\n                top: component.top,\n                right: component.right,\n            },\n            size: component.size,\n            decorate: component.decorate,\n            label: settings[settingName].map((v) => v.name).join(\", \"),\n            tickFormatFunction,\n        };\n    };\n\n    const createComponent = (axis, domain, data) =>\n        axis\n            .component(settings)\n            .orient(orient)\n            .settingName(settingName)\n            .domain(domain)(data);\n\n    const defaultComponent = () => ({\n        bottom: fc.axisBottom,\n        left: fc.axisLeft,\n        top: fc.axisTop,\n        right: fc.axisRight,\n        decorate: () => {},\n    });\n\n    _factory.memoValue = (...args: Axis[]): any => {\n        if (!args.length) {\n            return memoValue;\n        }\n\n        memoValue = args[0];\n        return _factory;\n    };\n\n    _factory.excludeType = (...args: AxisTypeValues[]): any => {\n        if (!args.length) {\n            return excludeType;\n        }\n\n        excludeType = args[0];\n        return _factory;\n    };\n\n    _factory.orient = (...args: Orientation[]): any => {\n        if (!args.length) {\n            return orient;\n        }\n\n        orient = args[0];\n        return _factory;\n    };\n\n    _factory.settingName = (...args: SettingNameValues[]): any => {\n        if (!args.length) {\n            return settingName;\n        }\n\n        settingName = args[0];\n        return _factory;\n    };\n\n    _factory.settingValue = (...args: (string | null)[]): any => {\n        if (!args.length) {\n            return settingValue;\n        }\n\n        settingValue = args[0];\n        return _factory;\n    };\n\n    _factory.valueName = (...args: ValueName[]): any => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n\n        valueNames = [args[0]];\n        return _factory;\n    };\n\n    _factory.valueNames = (...args: ValueName[][]): any => {\n        if (!args.length) {\n            return valueNames;\n        }\n\n        valueNames = args[0];\n        return _factory;\n    };\n\n    _factory.modifyDomain = (nextModifyDomain?: ModifyDomainFunc) => {\n        if (!nextModifyDomain) {\n            return modifyDomain;\n        }\n\n        modifyDomain = nextModifyDomain;\n        return _factory;\n    };\n\n    optionalParams.forEach((p) => {\n        _factory[p] = (...args) => {\n            if (!args.length) {\n                return optional[p];\n            }\n            optional[p] = args[0];\n            return _factory;\n        };\n    });\n\n    return _factory as AxisFactory;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Settings, SettingNameValues } from \"../types\";\n\nexport const AXIS_TYPES = {\n    none: \"none\",\n    ordinal: \"ordinal\",\n    time: \"time\",\n    linear: \"linear\",\n} as const;\n\nexport type AxisTypeValues = (typeof AXIS_TYPES)[keyof typeof AXIS_TYPES];\n\nexport interface AxisType {\n    (): AxisTypeValues;\n\n    settingName(): SettingNameValues;\n    settingName(nextSettingName: SettingNameValues): this;\n\n    settingValue(): string;\n    settingValue(nextSettingValue: string): this;\n\n    excludeType(): AxisTypeValues;\n    excludeType(nextExcludeType: AxisTypeValues): this;\n}\n\nexport const axisType = (settings: Settings): AxisType => {\n    let settingName = \"crossValues\";\n    let settingValue = null;\n    let excludeType = null;\n\n    const getType: Partial<AxisType> = (): AxisTypeValues | boolean => {\n        const checkTypes = (types) => {\n            const list = settingValue\n                ? settings[settingName].filter((s) => settingValue == s.name)\n                : settings[settingName];\n\n            if (settingName == \"crossValues\" && list.length > 1) {\n                // TODO: the return value of this function is used as an index, but \"false\" can't be used as an index.\n                // can't do multiple values on non-ordinal cross-axis\n                return false; // can this be \"none\"?\n            }\n\n            return list.some((s) => types.includes(s.type));\n        };\n\n        if (settings[settingName].length === 0) {\n            return AXIS_TYPES.none;\n        } else if (\n            excludeType != AXIS_TYPES.time &&\n            checkTypes([\"datetime\", \"date\"])\n        ) {\n            return AXIS_TYPES.time;\n        } else if (\n            excludeType != AXIS_TYPES.linear &&\n            checkTypes([\"integer\", \"float\"])\n        ) {\n            return AXIS_TYPES.linear;\n        }\n\n        if (excludeType == AXIS_TYPES.ordinal) {\n            return AXIS_TYPES.linear;\n        }\n        return AXIS_TYPES.ordinal;\n    };\n\n    getType.settingName = (...args: SettingNameValues[]): any => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return getType;\n    };\n\n    getType.settingValue = (...args: (string | undefined)[]): any => {\n        if (!args.length) {\n            return settingValue;\n        }\n\n        settingValue = args[0];\n        return getType;\n    };\n\n    getType.excludeType = (...args: AxisTypeValues[]): any => {\n        if (!args.length) {\n            return excludeType;\n        }\n        excludeType = args[0];\n        return getType;\n    };\n\n    return getType as AxisType;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { flattenArray } from \"./flatten\";\nimport minBandwidth from \"./minBandwidth\";\nimport withoutTicks from \"./withoutTicks\";\nimport { Domain, Orientation, ValueName } from \"../types\";\n\nexport const scale = () => withoutTicks(minBandwidth(d3.scaleBand()));\n\nexport const domain = (): Domain => {\n    let valueNames = [\"crossValue\"];\n    let orient = \"horizontal\";\n\n    const _domain: Partial<Domain> = (data: any[]) => {\n        const flattenedData = flattenArray(data);\n        return transformDomain([\n            ...new Set(flattenedData.map((d) => d[valueNames[0]])),\n        ]);\n    };\n\n    const transformDomain = (d) => (orient == \"vertical\" ? d.reverse() : d);\n\n    _domain.valueName = (...args: ValueName[]): any => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n\n    _domain.valueNames = (...args: ValueName[][]): any => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    _domain.orient = (...args: Orientation[]): any => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _domain;\n    };\n\n    return _domain as Domain;\n};\n\nexport const labelFunction = (valueName) => (d) => d[valueName].join(\"|\");\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport const flattenExtent = (array: any[]): [number, number] => {\n    const withUndefined = (fn) => (a, b) => {\n        if (a === undefined) return b;\n        if (b === undefined) return a;\n        return fn(a, b);\n    };\n    return array.reduce(\n        (r, v) => [\n            withUndefined(Math.min)(r[0], v[0]),\n            withUndefined(Math.max)(r[1], v[1]),\n        ],\n        [undefined, undefined]\n    );\n};\n\nexport const flattenArray = (array: any): any[] => {\n    if (Array.isArray(array)) {\n        return array.flat(Infinity);\n    } else {\n        return [array];\n    }\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { rebindAll } from \"d3fc\";\n\nconst MIN_BANDWIDTH = 1;\n\nexport interface MinBandwidth {\n    (arg: any): any;\n    bandwidth(): number;\n    bandwidth(...args: any[]): any;\n}\n\n// NOTE: Can the minBandwidth in barSeries.ts be merged with this?\n\nexport default (adaptee: d3.ScaleBand<string>): MinBandwidth => {\n    const minBandwidth: Partial<MinBandwidth> = (arg) => {\n        return adaptee(arg);\n    };\n\n    rebindAll(minBandwidth, adaptee);\n\n    minBandwidth.bandwidth = (...args: any[]): any => {\n        if (!args.length) {\n            return Math.max(adaptee.bandwidth(), MIN_BANDWIDTH);\n        }\n        // NOTE: d3.ScaleBand only has a getter for .bandwidth? (no args...);\n        //       I'm not sure this can be set.\n        // @ts-ignore\n        adaptee.bandwidth(...args);\n        return minBandwidth;\n    };\n\n    return minBandwidth as MinBandwidth;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { rebindAll } from \"d3fc\";\n\nexport default (adaptee) => {\n    const withoutTicks = (arg) => {\n        return adaptee(arg);\n    };\n\n    rebindAll(withoutTicks, adaptee);\n\n    withoutTicks.ticks = function () {\n        return [];\n    };\n\n    return withoutTicks;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport { flattenArray } from \"./flatten\";\nimport { extentLinear as customExtent } from \"../d3fc/extent/extentLinear\";\nimport { getValueFormatterForRange } from \"./valueFormatter\";\nimport { getChartContainer } from \"../plugin/root\";\nimport {\n    Component,\n    ComponentData,\n    Domain,\n    PaddingStrategy,\n    Settings,\n    ValueName,\n} from \"../types\";\n\nexport const scale = () => d3.scaleLinear();\n\nexport const domain = (): Domain => {\n    const base = customExtent().pad([0, 0.1]).padUnit(\"percent\");\n\n    let valueNames: ValueName[] = [\"crossValue\"];\n\n    const _domain: any = (data) => {\n        base.accessors(valueNames.map((v) => (d) => parseFloat(d[v])));\n\n        return getDataExtent(flattenArray(data));\n    };\n\n    fc.rebindAll(_domain, base);\n\n    const getMinimumGap = (data) => {\n        const gaps = valueNames.map((valueName) =>\n            data\n                .map((d) => d[valueName])\n                .sort((a, b) => a - b)\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\n                .reduce((acc, d, i, src) =>\n                    i === 0 || acc <= d - src[i - 1]\n                        ? acc\n                        : Math.abs(d - src[i - 1])\n                )\n        );\n\n        return Math.min(...gaps);\n    };\n\n    const getDataExtent = (data: any[]): PaddingStrategy => {\n        if (base.padUnit() == \"domain\") {\n            const dataWidth = getMinimumGap(data);\n            return base.pad([dataWidth / 2, dataWidth / 2])(data);\n        } else {\n            return base(data);\n        }\n    };\n\n    _domain.valueName = (...args: ValueName[]): any => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n\n    _domain.valueNames = (...args: ValueName[][]): any => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    return _domain;\n};\n\nexport const labelFunction =\n    (valueName) =>\n    (d): string =>\n        d[valueName][0];\n\nexport const tickFormatFunction = getValueFormatterForRange;\n\nexport const component = (_settings: Settings): Component => {\n    let domain = null;\n    let orient = \"horizontal\";\n    let settingName = null;\n\n    const getAxis = (s, data) => {\n        try {\n            const container = getChartContainer(s.node());\n            const chart = container.querySelector(\".cartesian-chart\");\n            const axis = chart.querySelector(`.${data}-axis`);\n            return axis;\n        } catch (e) {\n            return null;\n        }\n    };\n\n    // shrinks a given tick label\n    const shrinkTickLabel = (node) => {\n        const text = d3.select(node).select(\"text\").node();\n        (text as HTMLElement).style.fontSize = \"80%\";\n    };\n\n    // resizes ticks if they overflow the axis box\n    const shrinkTicks = (axis, s) => {\n        const axisBox = axis.getBoundingClientRect();\n        s.each((d, i, nodes) => {\n            const tickBox = d3.select(nodes[i]).node().getBoundingClientRect();\n\n            // if the tick is bigger than the axis, resize it\n            if (orient == \"vertical\" && axisBox.width < tickBox.width) {\n                shrinkTickLabel(nodes[i]);\n            } else if (\n                orient == \"horizontal\" &&\n                axisBox.height < tickBox.height\n            ) {\n                shrinkTickLabel(nodes[i]);\n            }\n        });\n    };\n\n    const decorate = (s, data, _index) => {\n        const axis = getAxis(s, data);\n        if (axis) {\n            shrinkTicks(axis, s);\n        }\n    };\n\n    const getComponent: any = (): ComponentData => {\n        const components = {\n            bottom: fc.axisBottom,\n            left: fc.axisLeft,\n            top: fc.axisTop,\n            right: fc.axisRight,\n            // size: \"100px\", // works, but can't measure here\n            decorate,\n        };\n        return components;\n    };\n\n    getComponent.domain = (...args) => {\n        if (!args.length) {\n            return domain;\n        }\n        domain = args[0];\n        return getComponent;\n    };\n\n    getComponent.orient = (...args) => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return getComponent;\n    };\n\n    getComponent.settingName = (...args) => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return getComponent;\n    };\n\n    return getComponent;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3Array from \"d3-array\";\nimport { defaultPadding } from \"../padding/default\";\nimport { Pad, PadUnit, PaddingStrategy } from \"../../types\";\n\nexport type SymmetricalAbout = number | null;\n\nexport interface ExtentLinear {\n    (data: any[]): PaddingStrategy;\n    accessors: (nextAccessors?: any[]) => any;\n\n    pad(): Pad;\n    pad(nextPad: Pad): ExtentLinear;\n\n    padUnit(): PadUnit;\n    padUnit(nextPadUnit: PadUnit): ExtentLinear;\n\n    include(): number[];\n    include(nextInclude?: number[]): ExtentLinear;\n\n    symmetricalAbout(): number | null;\n    symmetricalAbout(nextSymmetricalAbout?: number | null): ExtentLinear;\n\n    paddingStrategy(): PaddingStrategy;\n    paddingStrategy(nextPaddingStrategy?: any): ExtentLinear;\n}\n\nexport const extentLinear = function (): ExtentLinear {\n    let accessors = [\n        function (d) {\n            return d;\n        },\n    ];\n    let symmetricalAbout: number | null = null;\n    let include: number[] = [];\n    let paddingStrategy = defaultPadding();\n\n    const instance: Partial<ExtentLinear> = function instance(\n        data\n    ): PaddingStrategy {\n        let values = new Array(data.length);\n        let _iteratorNormalCompletion = true;\n        let _didIteratorError = false;\n        let _iteratorError = undefined;\n\n        let _iterator = accessors[Symbol.iterator]();\n        try {\n            for (\n                let _step;\n                !(_iteratorNormalCompletion = (_step = _iterator.next()).done);\n                _iteratorNormalCompletion = true\n            ) {\n                let accessor = _step.value;\n\n                for (let i = 0; i < data.length; i++) {\n                    let value = accessor(data[i], i);\n                    if (Array.isArray(value)) {\n                        values.push.apply(values, toConsumableArray(value));\n                    } else {\n                        values.push(value);\n                    }\n                }\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        let extent$$1 = [d3Array.min(values), d3Array.max(values)];\n\n        extent$$1[0] =\n            extent$$1[0] == null\n                ? d3Array.min(include)\n                : d3Array.min(\n                      [extent$$1[0]].concat(toConsumableArray(include))\n                  );\n        extent$$1[1] =\n            extent$$1[1] == null\n                ? d3Array.max(include)\n                : d3Array.max(\n                      [extent$$1[1]].concat(toConsumableArray(include))\n                  );\n\n        if (symmetricalAbout != null) {\n            let halfRange = Math.max(\n                Math.abs(extent$$1[1] - symmetricalAbout),\n                Math.abs(extent$$1[0] - symmetricalAbout)\n            );\n            extent$$1[0] = symmetricalAbout - halfRange;\n            extent$$1[1] = symmetricalAbout + halfRange;\n        }\n\n        return paddingStrategy(extent$$1);\n    };\n\n    instance.accessors = function () {\n        if (!arguments.length) {\n            return accessors;\n        }\n        accessors = arguments.length <= 0 ? undefined : arguments[0];\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.pad = function (...args: Pad[]): any {\n        if (!args.length) {\n            return paddingStrategy.pad;\n        }\n\n        paddingStrategy.pad(args[0]);\n\n        return instance;\n    };\n\n    //This function points directly at the paddingStrategy child object's\n    //properties for backwards-compatibility. DEPRECATED.\n    instance.padUnit = function (...args: PadUnit[]): any {\n        if (!args.length) {\n            return paddingStrategy.padUnit;\n        }\n\n        paddingStrategy.padUnit(args[0]);\n\n        return instance;\n    };\n\n    instance.include = function (...args: number[][]): any {\n        if (!args.length) {\n            return include;\n        }\n\n        include = args[0];\n\n        return instance;\n    };\n\n    instance.symmetricalAbout = function (...args: SymmetricalAbout[]): any {\n        if (!args.length) {\n            return symmetricalAbout;\n        }\n\n        symmetricalAbout = args[0];\n\n        return instance;\n    };\n\n    instance.paddingStrategy = function (...args: PaddingStrategy[]): any {\n        if (!args.length) {\n            return paddingStrategy;\n        }\n\n        paddingStrategy = args[0];\n\n        return instance;\n    };\n\n    return instance as ExtentLinear;\n};\n\nlet toConsumableArray = function (arr) {\n    if (Array.isArray(arr)) {\n        let arr2 = Array(arr.length);\n        for (let i = 0; i < arr.length; i++) {\n            arr2[i] = arr[i];\n        }\n        return arr2;\n    } else {\n        return Array.from(arr);\n    }\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Pad, PadUnit, PaddingStrategy } from \"../../types\";\n\nexport const defaultPadding = (): PaddingStrategy => {\n    let pad = [0, 0];\n    let padUnit: PadUnit = \"percent\" as const;\n\n    const padding: Partial<PaddingStrategy> = (extent) => {\n        switch (padUnit) {\n            case \"domain\": {\n                extent[0] -= pad[0];\n                extent[1] += pad[1];\n                break;\n            }\n            case \"percent\": {\n                let delta = extent[1] - extent[0];\n                extent[0] -= pad[0] * delta;\n                extent[1] += pad[1] * delta;\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n        return extent;\n    };\n\n    padding.pad = function (...args: Pad[]): any {\n        if (!args.length) {\n            return pad;\n        }\n\n        pad = args[0];\n\n        return padding;\n    };\n\n    padding.padUnit = function (...args: PadUnit[]): any {\n        if (!args.length) {\n            return padUnit;\n        }\n\n        padUnit = args[0];\n\n        return padding;\n    };\n\n    return padding as PaddingStrategy;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\n\nconst SI_MIN = 10000000;\n\nexport const getValueFormatterForRange = (min: number, max: number) => {\n    let precision = Math.ceil(Math.abs(Math.log10(max - min))) + 1;\n\n    return (d: number) => {\n        return Math.abs(d) >= SI_MIN\n            ? d3.format(\".3s\")(d)\n            : Number.isInteger(d)\n            ? d3.format(\",.0f\")(d)\n            : d3.format(`,.${precision}f`)(d);\n    };\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { ChartElement } from \"../types\";\n\nexport function getChartElement(element): ChartElement {\n    return element.getRootNode().host;\n}\n\nexport function getChartContainer(element): HTMLElement {\n    return element.closest(\"#container.chart\");\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport { flattenArray } from \"./flatten\";\nimport { Domain, ValueName } from \"../types\";\n\nexport const scale = () => d3.scaleTime();\n\nexport const domain = (): Domain => {\n    const base = fc.extentTime();\n\n    let valueNames = [\"crossValue\"];\n\n    const _domain: Partial<Domain> = (data) => {\n        base.accessors(valueNames.map((v) => (d) => new Date(d[v])));\n\n        return getDataExtent(flattenArray(data));\n    };\n\n    fc.rebindAll(_domain, base, fc.exclude(\"include\", \"paddingStrategy\"));\n\n    const getMinimumGap = (data) => {\n        const gaps = valueNames.map((valueName) =>\n            data\n                .map((d) => new Date(d[valueName]).getTime())\n                .sort((a, b) => a - b)\n                .filter((d, i, a) => i === 0 || d !== a[i - 1])\n                .reduce((acc, d, i, src) =>\n                    i === 0 || Math.abs(acc) <= Math.abs(d - src[i - 1])\n                        ? Math.abs(acc)\n                        : Math.abs(d - src[i - 1])\n                )\n        );\n\n        return Math.min(...gaps);\n    };\n\n    const getDataExtent = (data) => {\n        const dataWidth = Math.abs(getMinimumGap(data));\n        return base.padUnit(\"domain\").pad([dataWidth / 2, dataWidth / 2])(data);\n    };\n\n    _domain.valueName = (...args: ValueName[]): any => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n\n    _domain.valueNames = (...args: ValueName[][]): any => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    return _domain as Domain;\n};\n\nexport const labelFunction = (valueName) => (d) => new Date(d[valueName][0]);\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport minBandwidth from \"./minBandwidth\";\nimport { flattenArray } from \"./flatten\";\nimport {\n    multiAxisBottom,\n    multiAxisLeft,\n    multiAxisTop,\n    multiAxisRight,\n} from \"../d3fc/axis/multi-axis\";\nimport { getChartContainer } from \"../plugin/root\";\nimport {\n    Component,\n    ComponentData,\n    Domain,\n    Orientation,\n    SettingNameValues,\n    Settings,\n    ValueName,\n} from \"../types\";\n\n// NOTE: Where is this used? Is it?\n// MinBandwidth doesn't have a padding() method, so what is going on here?\n// @ts-ignore\nexport const scale = () => minBandwidth(d3.scaleBand()).padding(0.5);\n\ninterface OrdinalAxisDomain {\n    (data: any): any;\n\n    valueName(): ValueName;\n    valueName(nextValueName: ValueName): this;\n\n    valueNames(): ValueName[];\n    valueNames(nextValueNames: ValueName[]): this;\n\n    orient(): Orientation;\n    orient(nextOrient: Orientation): this;\n}\n\nexport const domain = (): OrdinalAxisDomain => {\n    let valueNames = [\"crossValue\"];\n    let orient = \"horizontal\";\n\n    const _domain: Partial<Domain> = (data) => {\n        const flattenedData = flattenArray(data);\n        return transformDomain([\n            ...Array.from(new Set(flattenedData.map((d) => d[valueNames[0]]))),\n        ]);\n    };\n\n    const transformDomain = (d) => (orient == \"vertical\" ? d.reverse() : d);\n\n    _domain.valueName = (...args: ValueName[]): any => {\n        if (!args.length) {\n            return valueNames[0];\n        }\n        valueNames = [args[0]];\n        return _domain;\n    };\n\n    _domain.valueNames = (...args: ValueName[][]): any => {\n        if (!args.length) {\n            return valueNames;\n        }\n        valueNames = args[0];\n        return _domain;\n    };\n\n    _domain.orient = (...args: Orientation[]): any => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _domain;\n    };\n\n    return _domain as Domain;\n};\n\nexport const labelFunction =\n    (valueName) =>\n    (d): string =>\n        d[valueName].join(\"|\");\n\nexport const component = (settings: Settings): Component => {\n    let orient = \"horizontal\";\n    let settingName = \"crossValues\";\n    let domain = null;\n\n    const getComponent: any = (): ComponentData => {\n        const multiLevel = settings[settingName].length > 1;\n\n        // Calculate the label groups and corresponding group sizes\n        const levelGroups = axisGroups(domain);\n        const groupTickLayout = levelGroups.map(getGroupTickLayout);\n\n        const tickSizeInner = multiLevel\n            ? groupTickLayout.map((l) => l.size)\n            : groupTickLayout[0].size;\n        const tickSizeOuter = groupTickLayout.reduce((s, v) => s + v.size, 0);\n\n        const createAxis = (base) => (scale) => {\n            const axis = base(scale);\n\n            if (multiLevel) {\n                axis.groups(levelGroups)\n                    .tickSizeInner(tickSizeInner)\n                    .tickSizeOuter(tickSizeOuter);\n            }\n            if (orient !== \"horizontal\") axis.tickPadding(10);\n            return axis;\n        };\n\n        const decorate = (s, data, index) => {\n            const rotation = groupTickLayout[index].rotation;\n            if (orient === \"horizontal\") applyLabelRotation(s, rotation);\n            hideOverlappingLabels(s, rotation);\n        };\n\n        const axisSet = getAxisSet(multiLevel);\n        return {\n            bottom: createAxis(axisSet.bottom),\n            left: createAxis(axisSet.left),\n            right: createAxis(axisSet.right),\n            top: createAxis(axisSet.top),\n            size: `${tickSizeOuter + 10}px`,\n            decorate,\n        };\n    };\n\n    // const pickAxis = multiLevel => {\n    //     if (multiLevel) {\n    //         return orient === \"horizontal\" ?\n    //                multiAxisBottom : multiAxisLeft;\n    //     }\n    //     return orient === \"horizontal\" ?\n    //                 fc.axisOrdinalBottom : fc.axisOrdinalLeft;\n    // };\n\n    const getAxisSet = (multiLevel) => {\n        if (multiLevel) {\n            return {\n                bottom: multiAxisBottom,\n                left: multiAxisLeft,\n                top: multiAxisTop,\n                right: multiAxisRight,\n            };\n        } else {\n            return {\n                bottom: fc.axisOrdinalBottom,\n                left: fc.axisOrdinalLeft,\n                top: fc.axisOrdinalTop,\n                right: fc.axisOrdinalRight,\n            };\n        }\n    };\n\n    const axisGroups = (domain) => {\n        const groups = [];\n        domain.forEach((tick) => {\n            const split = tick && tick.split ? tick.split(\"|\") : [tick];\n            split.forEach((s, i) => {\n                while (groups.length <= i) groups.push([]);\n\n                const group = groups[i];\n                if (group.length > 0 && group[group.length - 1].text === s) {\n                    group[group.length - 1].domain.push(tick);\n                } else {\n                    group.push({ text: s, domain: [tick] });\n                }\n            });\n        });\n        return groups.reverse();\n    };\n\n    const getGroupTickLayout = (group) => {\n        const width = settings.size.width;\n        const maxLength = Math.max(\n            ...group.map((g) => (g.text ? g.text.length : 0))\n        );\n\n        if (orient === \"horizontal\") {\n            // x-axis may rotate labels and expand the available height\n            if (group && group.length * 16 > width - 100) {\n                return {\n                    size: maxLength * 5 + 10,\n                    rotation: 90,\n                };\n            } else if (\n                group &&\n                group.length * (maxLength * 6 + 10) > width - 100\n            ) {\n                return {\n                    size: maxLength * 3 + 20,\n                    rotation: 45,\n                };\n            }\n            return {\n                size: 25,\n                rotation: 0,\n            };\n        } else {\n            // y-axis size always based on label size\n            return {\n                size: maxLength * 5 + 10,\n                rotation: 0,\n            };\n        }\n    };\n\n    const hideOverlappingLabels = (s, rotated) => {\n        const getTransformCoords = (transform) => {\n            const splitOn = transform.indexOf(\",\") !== -1 ? \",\" : \" \";\n            const coords = transform\n                .substring(transform.indexOf(\"(\") + 1, transform.indexOf(\")\"))\n                .split(splitOn)\n                .map((c) => parseInt(c));\n            while (coords.length < 2) coords.push(0);\n            return coords;\n        };\n\n        const rectanglesOverlap = (r1, r2) =>\n            r1.x <= r2.x + r2.width &&\n            r2.x <= r1.x + r1.width &&\n            r1.y <= r2.y + r2.height &&\n            r2.y <= r1.y + r1.height;\n        const rotatedLabelsOverlap = (r1, r2) =>\n            r1.x + r1.width + 14 > r2.x + r2.width;\n        const isOverlap = rotated ? rotatedLabelsOverlap : rectanglesOverlap;\n\n        const rectangleContained = (r1, r2) =>\n            r1.x >= r2.x &&\n            r1.x + r1.width <= r2.x + r2.width &&\n            r1.y >= r2.y &&\n            r1.y + r1.height <= r2.y + r2.height;\n        // The bounds rect is the available screen space a label can fit into\n        const boundsRect =\n            orient == \"horizontal\" ? getXAxisBoundsRect(s) : null;\n\n        const previousRectangles = [];\n        s.each((d, i, nodes) => {\n            const tick = d3.select(nodes[i]);\n\n            // How the \"tick\" element is transformed (x/y)\n            const transformCoords = getTransformCoords(tick.attr(\"transform\"));\n\n            // Work out the actual rectanble the label occupies\n            const tickRect = tick.node().getBBox();\n            const rect = {\n                x: tickRect.x + transformCoords[0],\n                y: tickRect.y + transformCoords[1],\n                width: tickRect.width,\n                height: tickRect.height,\n            };\n\n            const overlap = previousRectangles.some((r) => isOverlap(r, rect));\n\n            // Test that it also fits into the screen space\n            const hidden =\n                overlap ||\n                (boundsRect && !rectangleContained(rect, boundsRect));\n\n            tick.attr(\"visibility\", hidden ? \"hidden\" : \"\");\n            if (!hidden) {\n                previousRectangles.push(rect);\n            }\n        });\n    };\n\n    const getXAxisBoundsRect = (s) => {\n        const container = getChartContainer(s.node());\n        if (container === null) {\n            return;\n        }\n        const chart = container.querySelector(\".cartesian-chart\");\n        const axis = chart.querySelector(\".x-axis\");\n\n        const chartRect = chart.getBoundingClientRect();\n        const axisRect = axis.getBoundingClientRect();\n        return {\n            x: chartRect.left - axisRect.left,\n            width: chartRect.width,\n            y: chartRect.top - axisRect.top,\n            height: chartRect.height,\n        };\n    };\n\n    const getLabelTransform = (rotation) => {\n        if (!rotation) {\n            return \"translate(0, 8)\";\n        }\n        if (rotation < 60) {\n            return `rotate(-${rotation} 5 5)`;\n        }\n        return `rotate(-${rotation} 3 7)`;\n    };\n\n    const applyLabelRotation = (s, rotation) => {\n        const transform = getLabelTransform(rotation);\n        const anchor = rotation ? \"end\" : \"\";\n        s.each((d, i, nodes) => {\n            const tick = d3.select(nodes[i]);\n            const text = tick.select(\"text\");\n\n            text.attr(\"transform\", transform).style(\"text-anchor\", anchor);\n        });\n    };\n\n    getComponent.orient = (...args: Orientation[]): any => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return getComponent;\n    };\n\n    getComponent.settingName = (...args: SettingNameValues[]): any => {\n        if (!args.length) {\n            return settingName;\n        }\n        settingName = args[0];\n        return getComponent;\n    };\n\n    getComponent.domain = (...args: string[][]): any => {\n        if (!args.length) {\n            return domain;\n        }\n        domain = args[0];\n        return getComponent;\n    };\n\n    return getComponent;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { select, line } from \"d3\";\nimport {\n    axisOrdinalTop,\n    axisOrdinalBottom,\n    axisOrdinalLeft,\n    axisOrdinalRight,\n    dataJoin,\n    rebindAll,\n    exclude,\n} from \"d3fc\";\nimport store from \"./store\";\nimport { Orient } from \"../../types\";\n\nexport interface MultiAxis {\n    (selection: any): void;\n\n    tickSize(): number;\n    tickSize(nextTickSize: number): MultiAxis;\n\n    tickSizeInner(): number | number[];\n    tickSizeInner(nextTickSize: number | number[]): MultiAxis;\n\n    tickSizeOuter(): number;\n    tickSizeOuter(nextTickSize: number): MultiAxis;\n\n    decorate(): any;\n    decorate(nextDecorator: any): MultiAxis;\n\n    groups(): any;\n    groups(nextGroups: any): MultiAxis;\n}\n\nconst multiAxis = (orient: Orient, baseAxis, scale): MultiAxis => {\n    let tickSizeOuter = 6;\n    let tickSizeInner: number | number[] = 6;\n    let axisStore = store(\n        \"tickFormat\",\n        \"ticks\",\n        \"tickArguments\",\n        \"tickValues\",\n        \"tickPadding\"\n    );\n    let decorate = (...args) => {};\n\n    let groups = null;\n\n    const groupDataJoin = dataJoin(\"g\", \"group\");\n    const domainPathDataJoin = dataJoin(\"path\", \"domain\");\n\n    const translate = (x, y) =>\n        isVertical() ? `translate(${y}, ${x})` : `translate(${x}, ${y})`;\n\n    const pathTranspose = (arr) =>\n        isVertical() ? arr.map((d) => [d[1], d[0]]) : arr;\n\n    const isVertical = () => orient === \"left\" || orient === \"right\";\n\n    const multiAxis: Partial<MultiAxis> = (selection) => {\n        if (!groups) {\n            axisStore(baseAxis(scale).decorate(decorate))(selection);\n            return;\n        }\n\n        // if (selection.selection) {\n        //     groupDataJoin.call(selection);\n        //     domainPathDataJoin.call(selection);\n        // }\n\n        selection.each((data, index, group) => {\n            const element = group[index];\n\n            const container = select(element);\n\n            const sign = orient === \"bottom\" || orient === \"right\" ? 1 : -1;\n\n            // add the domain line\n            const range = scale.range();\n            const domainPathData = pathTranspose([\n                [range[0], sign * tickSizeOuter],\n                [range[0], 0],\n                [range[1], 0],\n                [range[1], sign * tickSizeOuter],\n            ]);\n\n            const domainLine = domainPathDataJoin(container, [data]);\n            domainLine\n                .attr(\"d\", line()(domainPathData))\n                .attr(\"stroke\", \"#000\")\n                .attr(\"fill\", \"none\");\n\n            const g = groupDataJoin(container, groups);\n\n            const getAxisSize = (i) =>\n                Array.isArray(tickSizeInner) ? tickSizeInner[i] : tickSizeInner;\n            const getAxisOffset = (i) => {\n                let sum = 0;\n                for (let n = 0; n < i; n++) {\n                    sum += getAxisSize(n);\n                }\n                return sum;\n            };\n\n            g.attr(\"transform\", (d, i) =>\n                translate(0, sign * getAxisOffset(i))\n            ).each((group, i, nodes) => {\n                const groupElement = select(nodes[i]);\n                const groupScale = scaleFromGroup(scale, group);\n                const useAxis = axisStore(baseAxis(groupScale))\n                    .decorate((s, data) => decorate(s, data, i))\n                    .tickSizeInner(getAxisSize(i))\n                    .tickOffset((d) => groupScale.step(d) / 2);\n                useAxis(groupElement);\n\n                groupElement.select(\"path.domain\").attr(\"visibility\", \"hidden\");\n            });\n\n            // exit\n            g.exit().attr(\"transform\", (d, i) =>\n                translate(0, sign * getAxisOffset(i))\n            );\n        });\n    };\n\n    const scaleFromGroup = (scale, group) => {\n        function customScale(value) {\n            const values = value.domain;\n            return values.reduce((sum, d) => sum + scale(d), 0) / values.length;\n        }\n\n        customScale.ticks = () => {\n            return group;\n        };\n        customScale.tickFormat = () => (d) => {\n            return d.text;\n        };\n        customScale.copy = () => scaleFromGroup(scale, group);\n\n        customScale.step = (value) => value.domain.length * scale.step();\n\n        rebindAll(customScale, scale, exclude(\"ticks\", \"step\", \"copy\"));\n        return customScale;\n    };\n\n    multiAxis.tickSize = (...args): any => {\n        if (!args.length) {\n            return tickSizeInner;\n        }\n        tickSizeInner = tickSizeOuter = Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.tickSizeInner = (...args: (number | number[])[]): any => {\n        if (!args.length) {\n            return tickSizeInner;\n        }\n        tickSizeInner = Array.isArray(args[0]) ? args[0] : Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.tickSizeOuter = (...args: number[]): any => {\n        if (!args.length) {\n            return tickSizeOuter;\n        }\n        tickSizeOuter = Number(args[0]);\n        return multiAxis;\n    };\n\n    multiAxis.decorate = (...args): any => {\n        if (!args.length) {\n            return decorate;\n        }\n        decorate = args[0];\n        return multiAxis;\n    };\n\n    multiAxis.groups = (...args) => {\n        if (!args.length) {\n            return groups;\n        }\n        groups = args[0];\n        return multiAxis;\n    };\n\n    rebindAll(multiAxis, axisStore);\n\n    return multiAxis as MultiAxis;\n};\n\nexport const multiAxisTop = (scale) => multiAxis(\"top\", axisOrdinalTop, scale);\n\nexport const multiAxisBottom = (scale) =>\n    multiAxis(\"bottom\", axisOrdinalBottom, scale);\n\nexport const multiAxisLeft = (scale) =>\n    multiAxis(\"left\", axisOrdinalLeft, scale);\n\nexport const multiAxisRight = (scale) =>\n    multiAxis(\"right\", axisOrdinalRight, scale);\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport default (...names) => {\n    const data = {};\n\n    const store = (target) => {\n        for (const key of Object.keys(data)) {\n            target[key](data[key]);\n        }\n        return target;\n    };\n\n    for (const name of names) {\n        store[name] = (...args) => {\n            if (!args.length) {\n                return data[name];\n            }\n            data[name] = args[0];\n            return store;\n        };\n    }\n\n    return store;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\n\nexport const chartSvgFactory = (xAxis, yAxis) =>\n    chartFactory(xAxis, yAxis, (x, y) => x.svgPlotArea(y), false);\nexport const chartCanvasFactory = (xAxis, yAxis) =>\n    chartFactory(\n        xAxis,\n        yAxis,\n        (x, y) => {\n            return x.canvasPlotArea(y).svgPlotArea(fc.seriesSvgPoint());\n        },\n        true\n    );\n\nconst chartFactory = (xAxis, yAxis, cartesian, canvas) => {\n    let axisSplitter = null;\n    let altAxis = null;\n\n    const chart = fc\n        .chartCartesian({\n            xScale: xAxis.scale,\n            yScale: yAxis.scale,\n            xAxis: xAxis.component,\n            yAxis: yAxis.component,\n        })\n        .xDomain(xAxis.domain)\n        .xLabel(xAxis.label)\n        .xAxisHeight(xAxis.size)\n        .xDecorate(xAxis.decorate)\n        .xTickFormat(xAxis.tickFormatFunction)\n        .yDomain(yAxis.domain)\n        .yLabel(yAxis.label)\n        .yAxisWidth(yAxis.size)\n        .yDecorate(yAxis.decorate)\n        .yOrient(\"left\")\n        .yTickFormat(yAxis.tickFormatFunction);\n\n    if (xAxis.decorate) chart.xDecorate(xAxis.decorate);\n    if (yAxis.decorate) chart.yDecorate(yAxis.decorate);\n\n    // Padding defaults can be overridden\n    chart.xPaddingInner && chart.xPaddingInner(1);\n    chart.xPaddingOuter && chart.xPaddingOuter(0.5);\n    chart.yPaddingInner && chart.yPaddingInner(1);\n    chart.yPaddingOuter && chart.yPaddingOuter(0.5);\n\n    chart.axisSplitter = (...args) => {\n        if (!args.length) {\n            return axisSplitter;\n        }\n        axisSplitter = args[0];\n        return chart;\n    };\n\n    chart.altAxis = (...args) => {\n        if (!args.length) {\n            return altAxis;\n        }\n        altAxis = args[0];\n        return chart;\n    };\n\n    /**\n     * Mimics the previous D3FC API and returns the main plot area selection.\n     * Both chart types will have both layers, so this should be determined\n     * by the constructor's `canvas` property.\n     *\n     * @param  {...any} args If provided, this function will act as a setter.\n     * @returns\n     */\n    chart.plotArea = function (...args) {\n        if (args.length == 0) {\n            if (canvas) {\n                return this.canvasPlotArea();\n            } else {\n                return this.svgPlotArea();\n            }\n        } else {\n            return cartesian(this, ...args);\n        }\n    };\n\n    const oldDecorate = chart.decorate();\n    chart.decorate((container, data) => {\n        const plotArea = container.select(\"d3fc-svg.plot-area\");\n        const node = plotArea.select(\"svg\").node();\n        node.setAttribute(\n            \"viewBox\",\n            `0 0 ${plotArea.node().clientWidth} ${plotArea.node().clientHeight}`\n        );\n        node.setAttribute(\"preserveAspectRatio\", \"none\");\n\n        for (const axis of [\"x-axis\", \"y-axis\"]) {\n            container\n                .select(`d3fc-svg.${axis} svg`)\n                .node()\n                .setAttribute(\"preserveAspectRatio\", \"none\");\n        }\n\n        oldDecorate(container, data);\n\n        // Not sure why these are out of order ...\n        // https://github.com/d3fc/d3fc/blob/master/packages/d3fc-chart/README.md#changing-the-z-order-of-plot-areas\n        if (canvas) {\n            const svgPlotArea = container.select(\".svg-plot-area\").node();\n            const canvasPlotArea = container.select(\".canvas-plot-area\").node();\n            d3.selectAll([svgPlotArea, canvasPlotArea]).order();\n        }\n\n        if (!axisSplitter) return;\n\n        if (axisSplitter.haveSplit()) {\n            // Render a second axis on the right of the chart\n            const altData = axisSplitter.altData();\n\n            const y2AxisDataJoin = fc\n                .dataJoin(\"d3fc-svg\", \"y2-axis\")\n                .key((d) => d);\n            const ySeriesDataJoin = fc.dataJoin(\"g\", \"y-series\").key((d) => d);\n\n            // Column 5 of the grid\n            container\n                // .enter()\n                .append(\"div\")\n                .attr(\"class\", \"y-label right-label\")\n                .style(\"grid-column\", 5)\n                .style(\"-ms-grid-column\", 5)\n                .style(\"grid-row\", 3)\n                .style(\"-ms-grid-row\", 3)\n                .style(\"width\", altAxis.size || \"1em\")\n                .style(\"display\", \"flex\")\n                .style(\"align-items\", \"center\")\n                .style(\"justify-content\", \"center\")\n                .append(\"span\")\n                .attr(\"class\", \"y-label splitter-label\")\n                .style(\"transform\", \"rotate(-90deg)\");\n\n            const y2Scale = altAxis.scale.domain(altAxis.domain);\n            const yAxisComponent = altAxis.component.right(y2Scale);\n            yAxisComponent.tickFormat(altAxis.tickFormatFunction);\n            if (altAxis.decorate) yAxisComponent.decorate(altAxis.decorate);\n\n            // Render the axis\n            y2AxisDataJoin(container, [\"right\"])\n                .attr(\"class\", (d) => `y-axis ${d}-axis`)\n                .on(\"measure\", function (event, d) {\n                    const { width, height } = event.detail;\n                    if (d === \"left\") {\n                        d3.select(event.currentTarget)\n                            .select(\"svg\")\n                            .attr(\"viewBox\", `${-width} 0 ${width} ${height}`)\n                            .attr(\"preserveAspectRatio\", \"none\");\n                    }\n                    y2Scale.range([height, 0]);\n                })\n                .on(\"draw\", function (event, d) {\n                    d3.select(event.currentTarget)\n                        .select(\"svg\")\n                        .call(yAxisComponent);\n                });\n\n            // Render all the series using either the primary or alternate\n            // y-scales\n            if (canvas) {\n                const drawMultiCanvasSeries = (selection) => {\n                    const canvasPlotArea = chart.plotArea();\n                    canvasPlotArea\n                        .context(selection.node().getContext(\"2d\"))\n                        .xScale(xAxis.scale);\n\n                    const yScales = [yAxis.scale, y2Scale];\n                    [data, altData].forEach((d, i) => {\n                        canvasPlotArea.yScale(yScales[i]);\n                        canvasPlotArea(d);\n                    });\n                };\n\n                container\n                    .select(\"d3fc-canvas.plot-area\")\n                    .on(\"draw\", function (event, d) {\n                        drawMultiCanvasSeries(\n                            d3.select(event.currentTarget).select(\"canvas\")\n                        );\n                    });\n            } else {\n                const drawMultiSvgSeries = function (selection) {\n                    const svgPlotArea = chart.plotArea();\n                    svgPlotArea.xScale(xAxis.scale);\n\n                    const yScales = [yAxis.scale, y2Scale];\n                    ySeriesDataJoin(selection, [data, altData]).each(\n                        (d, i, nodes) => {\n                            svgPlotArea.yScale(yScales[i]);\n                            d3.select(nodes[i]).datum(d).call(svgPlotArea);\n                        }\n                    );\n                };\n\n                container\n                    .select(\"d3fc-svg.plot-area\")\n                    .on(\"draw\", function (event, d) {\n                        drawMultiSvgSeries(\n                            d3.select(event.currentTarget).select(\"svg\")\n                        );\n                    });\n            }\n        }\n\n        // Render any UI elements the splitter component requires\n        axisSplitter(container);\n    });\n\n    return chart;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { tooltip } from \"../tooltip/tooltip\";\nimport { ScaleSequential, Settings } from \"../types\";\n\nexport function barSeries(\n    settings: Settings,\n    color: d3.ScaleOrdinal<string, unknown> | ScaleSequential\n) {\n    let series =\n        settings.mainValues.length > 1\n            ? fc.seriesSvgGrouped(fc.seriesSvgBar())\n            : fc.seriesSvgBar();\n\n    series = series.decorate((selection) => {\n        tooltip().settings(settings)(selection);\n        selection.style(\"fill\", (d) => color(d.key));\n    });\n\n    return fc\n        .autoBandwidth(minBandwidth(series))\n        .crossValue((d) => d.crossValue)\n        .mainValue((d) => (d.mainValue ? d.mainValue : 0))\n        .baseValue((d) => d.baseValue);\n}\n\nconst minBandwidth = (adaptee) => {\n    const min = (arg) => {\n        return adaptee(arg);\n    };\n\n    fc.rebindAll(min, adaptee);\n\n    min.bandwidth = (...args) => {\n        if (!args.length) {\n            return adaptee.bandwidth();\n        }\n        adaptee.bandwidth(Math.max(args[0], 1));\n        return min;\n    };\n\n    return min;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { select } from \"d3\";\nimport { getChartContainer } from \"../plugin/root\";\nimport { getOrCreateElement, isElementOverflowing } from \"../utils/utils\";\nimport tooltipTemplate from \"../../html/tooltip.html\";\nimport { generateHtml } from \"./generateHTML\";\nimport { selectionEvent } from \"./selectionEvent\";\nimport { Settings } from \"../types\";\n\nexport interface ToolTip {\n    (selection: any): void; // double check the return value is void.\n\n    alwaysShow(): boolean;\n    alwaysShow(alwaysShow: boolean): ToolTip;\n\n    centered(): boolean;\n    centered(centered: boolean): ToolTip;\n\n    settings(): Settings;\n    settings(settings: Settings): ToolTip;\n}\n\nexport const tooltip = (): ToolTip => {\n    let alwaysShow = false;\n    let tooltipDiv = null;\n    let settings: Settings | null = null;\n    let centered = false;\n\n    const _tooltip: any = (selection) => {\n        const node = selection.node();\n\n        if (!node || !node.isConnected) {\n            hideTooltip(tooltipDiv);\n            return;\n        }\n\n        const container = select(getChartContainer(node));\n        tooltipDiv = getTooltipDiv(container);\n\n        const showTip = function (_event, data) {\n            generateHtml(tooltipDiv, data, settings);\n            const nodes = selection.nodes();\n            const i = nodes.indexOf(this);\n            showTooltip(container.node(), nodes[i], tooltipDiv, centered);\n            select(nodes[i]).style(\"opacity\", \"0.7\");\n        };\n\n        const hideTip = function (_event, _data) {\n            hideTooltip(tooltipDiv);\n            const nodes = selection.nodes();\n            const i = nodes.indexOf(this);\n            if (nodes) select(nodes[i]).style(\"opacity\", \"1\");\n        };\n\n        if (alwaysShow) {\n            selection.each(function (data) {\n                return showTip.call(this, undefined, data);\n            });\n        } else {\n            selection.on(\"mouseover\", showTip).on(\"mouseout\", hideTip);\n            selectionEvent().settings(settings)(selection);\n        }\n    };\n\n    _tooltip.alwaysShow = (...args: boolean[]): any => {\n        if (!args.length) {\n            return alwaysShow;\n        }\n        alwaysShow = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.centered = (...args: boolean[]): any => {\n        if (!args.length) {\n            return centered;\n        }\n        centered = args[0];\n        return _tooltip;\n    };\n\n    _tooltip.settings = (...args: Settings[]): any => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _tooltip;\n    };\n\n    return _tooltip;\n};\n\nfunction getTooltipDiv(container) {\n    return getOrCreateElement(container, \"div.tooltip\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"z-index\", 3)\n            .style(\"opacity\", 0)\n            .html(tooltipTemplate)\n    );\n}\n\nfunction showTooltip(containerNode, node, tooltipDiv, centered) {\n    const containerRect = containerNode.getBoundingClientRect();\n    const rect = node.getBoundingClientRect();\n\n    let left = rect.left + rect.width / 2 - containerRect.left;\n    let top = rect.top - containerRect.top + containerNode.scrollTop;\n\n    if (centered)\n        top =\n            rect.top +\n            rect.height / 2 -\n            containerRect.top +\n            containerNode.scrollTop;\n\n    tooltipDiv\n        .style(\"left\", `${left}px`)\n        .style(\"top\", `${top}px`)\n        // .transition()\n        // .duration(200)\n        .style(\"opacity\", 0.9);\n\n    if (centered) [left, top] = centerTip(tooltipDiv, containerRect);\n\n    shiftIfOverflowingChartArea(tooltipDiv, containerRect, left, top, centered);\n}\n\nfunction centerTip(tooltipDiv, containerRect) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    const leftAdjust = tooltipDivRect.width / 2;\n    const newLeft = tooltipDivRect.left - leftAdjust - containerRect.left;\n    tooltipDiv.style(\"left\", `${newLeft}px`);\n\n    const topAdjust = tooltipDivRect.height / 2;\n    const newTop = tooltipDivRect.top - topAdjust - containerRect.top;\n    tooltipDiv.style(\"top\", `${newTop}px`);\n    return [newLeft, newTop];\n}\n\nfunction shiftIfOverflowingChartArea(\n    tooltipDiv,\n    containerRect,\n    left,\n    top,\n    centered = false\n) {\n    const tooltipDivRect = tooltipDiv.node().getBoundingClientRect();\n\n    if (isElementOverflowing(containerRect, tooltipDivRect)) {\n        const leftAdjust = tooltipDivRect.right - containerRect.right;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"bottom\")) {\n        const topAdjust = tooltipDivRect.bottom - containerRect.bottom;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n\n    if (!centered) return;\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"left\")) {\n        const leftAdjust = tooltipDivRect.left - containerRect.left;\n        tooltipDiv.style(\"left\", `${left - leftAdjust}px`);\n    }\n\n    if (isElementOverflowing(containerRect, tooltipDivRect, \"top\")) {\n        const topAdjust = tooltipDivRect.top - containerRect.top;\n        tooltipDiv.style(\"top\", `${top - topAdjust}px`);\n    }\n}\n\nfunction hideTooltip(tooltipDiv) {\n    if (tooltipDiv) {\n        tooltipDiv\n            // .transition()\n            // .duration(500)\n            .style(\"opacity\", 0);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { NodeRect, Orient } from \"../types\";\n\nexport function getOrCreateElement(container, selector, createCallback) {\n    let element = container.select(selector);\n    return element.size() > 0 ? element : createCallback();\n}\n\nexport function isElementOverflowing(\n    containerRect: DOMRect,\n    innerElementRect: NodeRect,\n    direction: Orient = \"right\"\n) {\n    if (direction === \"right\" || direction === \"bottom\") {\n        return containerRect[direction] < innerElementRect[direction]\n            ? true\n            : false;\n    }\n\n    if (direction === \"left\" || direction === \"top\") {\n        return containerRect[direction] > innerElementRect[direction]\n            ? true\n            : false;\n    }\n\n    throw `Direction being checked for overflow is invalid: ${direction}`;\n}\n\nexport function isElementOverlapping(\n    axis: \"x\" | \"y\",\n    immovableRect: DOMRect,\n    elementRect: DOMRect,\n    fuzz = 0\n) {\n    const dimension = axis === \"x\" ? \"width\" : \"height\";\n\n    const immovableInnerPoint = immovableRect[axis];\n    const immovableOuterPoint = immovableRect[axis] + immovableRect[dimension];\n\n    const elementInnerPoint = elementRect[axis];\n    const elementOuterPoint = elementRect[axis] + elementRect[dimension];\n\n    const innerPointInside =\n        elementInnerPoint + fuzz > immovableInnerPoint &&\n        elementInnerPoint - fuzz < immovableOuterPoint;\n    const outerPointInside =\n        elementOuterPoint + fuzz > immovableInnerPoint &&\n        elementOuterPoint - fuzz < immovableOuterPoint;\n    const pointsEitherSide =\n        elementInnerPoint + fuzz < immovableInnerPoint &&\n        elementOuterPoint - fuzz > immovableOuterPoint;\n\n    return innerPointInside || outerPointInside || pointsEitherSide;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { select } from \"d3\";\nimport { getGroupValues, getSplitValues, getDataValues } from \"./selectionData\";\nimport { Settings } from \"../types\";\n\nexport function generateHtml(tooltipDiv, data, settings: Settings) {\n    const tooltipValues = getGroupValues(data, settings)\n        .concat(getSplitValues(data, settings))\n        .concat(getDataValues(data, settings));\n    addDataValues(tooltipDiv, tooltipValues);\n}\n\nfunction addDataValues(tooltipDiv, values) {\n    tooltipDiv\n        .select(\"#tooltip-values\")\n        .selectAll(\"li\")\n        .data(values)\n        .join(\"li\")\n        .each(function (d) {\n            select(this)\n                .text(`${d.name}: `)\n                .append(\"b\")\n                .text(formatNumber(d.value));\n        });\n}\n\nconst formatNumber = (value) =>\n    value === null || value === undefined\n        ? \"-\"\n        : value.toLocaleString(undefined, {\n              style: \"decimal\",\n              minimumFractionDigits: 2,\n              maximumFractionDigits: 2,\n          });\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Settings } from \"../types\";\n\nexport function toValue(type, value) {\n    switch (type) {\n        case \"date\":\n        case \"datetime\":\n            return value instanceof Date\n                ? value\n                : new Date(parseInt(value)).toLocaleString([], {\n                      dateStyle: \"short\",\n                      timeStyle: \"medium\",\n                  });\n        case \"integer\":\n            return parseInt(value, 10);\n        case \"float\":\n            return parseFloat(value);\n    }\n    return value;\n}\n\nexport function getGroupValues(data, settings) {\n    if (settings.crossValues.length === 0) return [];\n    if (data.crossValue.length === 0) return [];\n    const groupValues = (data.crossValue.split\n        ? data.crossValue.split(\"|\")\n        : Array.isArray(data.crossValue)\n        ? data.crossValue\n        : [data.crossValue]) || [data.key];\n    return groupValues.map((cross, i) => ({\n        name: settings.crossValues[i].name,\n        value: toValue(settings.crossValues[i].type, cross),\n    }));\n}\n\nexport function getSplitValues(data, settings: Settings) {\n    if (settings.splitValues.length === 0) return [];\n    let splitValues = [data.mainValue];\n\n    if (data.key) {\n        splitValues = data.key.split(\"|\");\n    } else if (data.mainValue?.split) {\n        splitValues = data.mainValue.split(\"|\");\n    }\n\n    return settings.splitValues.map((split, i) => ({\n        name: split.name,\n        value: toValue(split.type, splitValues[i]),\n    }));\n}\n\nexport function getDataValues(data, settings) {\n    if (settings.mainValues.length > 1) {\n        if (data.mainValues) {\n            return settings.mainValues.map((main, i) => ({\n                name: main.name,\n                value: toValue(main.type, data.mainValues[i]),\n            }));\n        }\n        return settings.mainValues.map((main) => ({\n            name: main.name,\n            value: toValue(main.type, data.row[main.name]),\n        }));\n    }\n    return [\n        {\n            name: settings.mainValues[0].name,\n            value: toValue(\n                settings.mainValues[0].type,\n                data.colorValue ||\n                    data.mainValue - data.baseValue ||\n                    data.mainValue ||\n                    data.mainValues\n            ),\n        },\n    ];\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { getGroupValues, getSplitValues, getDataValues } from \"./selectionData\";\n\nconst mapToFilter = (d) => [d.name, \"==\", d.value];\n\nexport const raiseEvent = (node, data, settings) => {\n    const column_names = getDataValues(data, settings).map((d) => d.name);\n    const groupFilters = getGroupValues(data, settings).map(mapToFilter);\n    const splitFilters = getSplitValues(data, settings).map(mapToFilter);\n\n    const filter = settings.filter.concat(groupFilters).concat(splitFilters);\n\n    node.dispatchEvent(\n        new CustomEvent(\"perspective-click\", {\n            bubbles: true,\n            composed: true,\n            detail: {\n                column_names,\n                config: { filter },\n                row: data.row,\n            },\n        })\n    );\n};\n\nexport const selectionEvent = () => {\n    let settings = null;\n\n    const _event = (selection) => {\n        const node = selection.node();\n        selection.on(\"click\", (_event, data) =>\n            raiseEvent(node, data, settings)\n        );\n    };\n\n    _event.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _event;\n    };\n\n    return _event;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { groupFromKey } from \"./seriesKey\";\nimport { getValuesByColumn } from \"../data/utils\";\nimport { Settings } from \"../types\";\n\nexport function seriesColors(\n    settings: Settings\n): d3.ScaleOrdinal<string, unknown> | null {\n    const col =\n        settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter((k) => k !== \"__ROW_PATH__\");\n    return colorScale().settings(settings).domain(domain)();\n}\n\nexport function seriesColorsFromColumn(\n    settings: Settings,\n    column\n): d3.ScaleOrdinal<string, unknown> | null {\n    const data = getValuesByColumn(settings, column);\n    const domain = [...new Set(data)].sort();\n    return colorScale().settings(settings).domain(domain)();\n}\n\nexport function seriesColorsFromDistinct(\n    settings: Settings,\n    data\n): d3.ScaleOrdinal<string, unknown> | null {\n    let domain = [...new Set(data)];\n    return colorScale().settings(settings).domain(domain)();\n}\n\nexport function seriesColorsFromGroups(\n    settings: Settings\n): d3.ScaleOrdinal<string, unknown> | null {\n    const col = settings.data[0] ?? {};\n    const inner = Object.keys(col)\n        .filter((k) => k !== \"__ROW_PATH__\")\n        .map((k) => groupFromKey(k));\n    const domain = [...new Set(inner)];\n    return colorScale().settings(settings).domain(domain)();\n}\n\ntype ColorScaleSettings = {\n    colorStyles?: any;\n};\n\ntype ColorScaleMapFunc = (d: any) => string;\n\ninterface ColorScale {\n    (): d3.ScaleOrdinal<string, unknown> | null;\n\n    settings(): Settings;\n    settings(nextSettings: Settings): ColorScale;\n\n    domain(): any[];\n    domain(nextDomain: any[]): ColorScale;\n\n    defaultColors(): string[];\n    defaultColors(nextDefaultColors: string[]): ColorScale;\n\n    mapFunction(): ColorScaleMapFunc;\n    mapFunction(nextMapFunction: ColorScaleMapFunc): ColorScale;\n}\n\nexport function colorScale(): ColorScale {\n    let domain = null;\n    let defaultColors: string[] | null = null;\n    let settings: ColorScaleSettings = {};\n    let mapFunction = (d) =>\n        withOpacity(d, settings.colorStyles && settings.colorStyles.opacity);\n\n    const colors: ColorScale = (): d3.ScaleOrdinal<string, unknown> | null => {\n        const styles = settings.colorStyles;\n        const defaults = defaultColors || [styles.series];\n        if (defaults || domain.length > 1) {\n            const range = domain.length > 1 ? styles.scheme : defaults;\n            return d3.scaleOrdinal(range.map(mapFunction)).domain(domain); // ordinal.js\n        }\n        return null;\n    };\n\n    colors.domain = (...args: any[][]): any => {\n        if (args.length === 0) {\n            return domain;\n        }\n        domain = args[0];\n        return colors;\n    };\n\n    colors.defaultColors = (...args: string[][]): any => {\n        if (!args.length) {\n            return defaultColors;\n        }\n        defaultColors = args[0];\n        return colors;\n    };\n\n    colors.mapFunction = (...args: ColorScaleMapFunc[]): any => {\n        if (!args.length) {\n            return mapFunction;\n        }\n        mapFunction = args[0];\n        return colors;\n    };\n\n    colors.settings = (...args: Settings[]): any => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n\n        return colors;\n    };\n\n    return colors as ColorScale;\n}\n\nexport function withoutOpacity(color) {\n    return setOpacity(1)(color);\n}\n\nexport function withOpacity(color, opacity = 0.5) {\n    return setOpacity(opacity)(color);\n}\n\nexport function setOpacity(opacity) {\n    return (color) => {\n        const decoded = d3.color(color);\n        if (decoded !== null && decoded !== undefined) {\n            decoded.opacity = opacity;\n        }\n        return decoded + \"\";\n    };\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport function groupFromKey(key: string): string {\n    return key.split(\"|\").slice(0, -1).join(\"|\");\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Settings } from \"../types\";\n\n/**\n *  This function filters settings.data to get values corresponding to an input column.\n * It accomodates for split-by.\n * @param {*} settings\n * @param {string} column\n */\nexport function getValuesByColumn(\n    settings: Settings,\n    column: string | null\n): any[] {\n    return settings.data\n        .map((row) =>\n            Object.entries(row)\n                .filter(([k, v]) => k.split(\"|\").at(-1) === column && !!v)\n                .map(([_, v]) => v)\n        )\n        .flat();\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { rebindAll } from \"d3fc\";\nimport { axisType } from \"./axisType\";\nimport { labelFunction as noLabel } from \"./noAxis\";\nimport { labelFunction as timeLabel } from \"./timeAxis\";\nimport { labelFunction as linearLabel } from \"./linearAxis\";\nimport { labelFunction as ordinalLabel } from \"./ordinalAxis\";\nimport { Settings } from \"../types\";\n\nconst labelFunctions = {\n    none: noLabel,\n    ordinal: ordinalLabel,\n    time: timeLabel,\n    linear: linearLabel,\n};\n\nexport interface LabelFunction {\n    // NOTE: this \"i\" is not used...\n    (d, i?: any): string;\n    valueName(): string;\n    valueName(nextValueName: string): this;\n}\n\nexport const labelFunction = (settings: Settings): LabelFunction => {\n    const base = axisType(settings);\n    let valueName = \"__ROW_PATH__\";\n\n    const label: Partial<LabelFunction> = (d, _i) => {\n        return labelFunctions[base()](valueName)(d);\n    };\n\n    rebindAll(label, base);\n\n    label.valueName = (...args: string[]): any => {\n        if (!args.length) {\n            return valueName;\n        }\n\n        valueName = args[0];\n        return label;\n    };\n\n    return label as LabelFunction;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Settings } from \"../types\";\n\nexport function splitIntoMultiSeries(\n    settings: Settings,\n    data,\n    { stack = false, excludeEmpty = false } = {}\n) {\n    const useData = data || settings.data;\n\n    if (settings.splitValues.length > 0) {\n        return splitByValuesIntoMultiSeries(settings, useData, {\n            stack,\n            excludeEmpty,\n        });\n    }\n    return [useData];\n}\n\nfunction splitByValuesIntoMultiSeries(\n    settings,\n    data,\n    { stack = false, excludeEmpty = false }\n) {\n    // Create a series for each \"split\" value, each one containing all the\n    // \"aggregate\" values, and \"base\" values to offset it from the previous\n    // series\n    const multiSeries = {};\n\n    data.forEach((col) => {\n        // Split this column by \"split\", including multiple aggregates for each\n        const baseValues = {};\n        const split = {};\n\n        // Keys are of the form \"split1|split2|aggregate\"\n        Object.keys(col)\n            .filter((key) => key !== \"__ROW_PATH__\")\n            .filter(\n                (key) =>\n                    !excludeEmpty || (col[key] != null && col[key] != undefined)\n            )\n            .forEach((key) => {\n                const labels = key.split(\"|\");\n                // label=\"aggregate\"\n                const label = labels[labels.length - 1];\n                const value = col[key] || 0;\n                const baseKey = `${label}${value >= 0 ? \"+ve\" : \"-ve\"}`;\n                // splitName=\"split1|split2\"\n                const splitName = labels.slice(0, labels.length - 1).join(\"|\");\n\n                // Combine aggregate values for the same split in a single\n                // object\n                const splitValues = (split[splitName] = split[splitName] || {\n                    __ROW_PATH__: col.__ROW_PATH__,\n                });\n                const baseValue = baseValues[baseKey] || 0;\n\n                splitValues.__KEY__ = splitName;\n\n                // Assign the values for this split/aggregate\n                if (stack) {\n                    splitValues[label] = baseValue + value;\n                    splitValues[`__BASE_VALUE__${label}`] = baseValue;\n                    baseValues[baseKey] = splitValues[label];\n                } else {\n                    splitValues[label] = value;\n                }\n                splitValues.row = col;\n            });\n\n        // Push each object onto the correct series\n        Object.keys(split).forEach((splitName) => {\n            const series = (multiSeries[splitName] =\n                multiSeries[splitName] || []);\n            series.push(split[splitName]);\n        });\n    });\n\n    return Object.keys(multiSeries).map((k) => {\n        const series = multiSeries[k];\n        series.key = k;\n        return series;\n    });\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { Settings } from \"../types\";\nimport { splitIntoMultiSeries } from \"./splitIntoMultiSeries\";\n\nexport function groupData(settings: Settings, data: any[]): any[] {\n    const stack = { stack: false };\n    const groupedSeries = splitIntoMultiSeries(settings, data, stack).map(\n        (data) => groupPointDataByMainValue(settings, data, stack)\n    );\n\n    if (settings.mainValues.length > 1) {\n        const flattenedSeries: any[] = groupedSeries.reduce((a, b) =>\n            a.concat(b)\n        );\n        return flattenedSeries;\n    }\n\n    return groupedSeries;\n}\n\nexport function groupAndStackData(settings: Settings, data) {\n    const stack = { stack: true };\n    return splitIntoMultiSeries(settings, data, stack).map((data) =>\n        groupPointDataByMainValue(settings, data, stack)\n    );\n}\n\nfunction seriesDataFn(settings: Settings, data, { stack = false }) {\n    const labelfn = labelFunction(settings);\n\n    return (mainValue) => {\n        const baseValue = (col) =>\n            stack ? col[`__BASE_VALUE__${mainValue.name}`] || 0 : 0;\n        const series = data.map((col, i) => ({\n            crossValue: labelfn(col, i),\n            mainValue: !!col[mainValue.name] ? col[mainValue.name] : null,\n            baseValue: baseValue(col),\n            key: col.__KEY__\n                ? `${col.__KEY__}|${mainValue.name}`\n                : mainValue.name,\n            row: col.row || col,\n        }));\n        series.key = series[0].key;\n        return series;\n    };\n}\n\nfunction groupPointDataByMainValue(\n    settings: Settings,\n    data,\n    { stack = false }\n) {\n    // Split data into a group for each aggregate (mainValue)\n    const seriesFn = seriesDataFn(settings, data, { stack });\n\n    if (settings.mainValues.length > 1) {\n        return settings.mainValues.map(seriesFn);\n    } else {\n        return seriesFn(settings.mainValues[0]);\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as d3Legend from \"d3-svg-legend\";\nimport scrollableLegend from \"./scrollableLegend\";\nimport { withoutOpacity } from \"../series/seriesColors\";\nimport { getChartElement } from \"../plugin/root\";\nimport { getOrCreateElement } from \"../utils/utils\";\nimport { D3Scale } from \"../types\";\n\nexport type LegendComponentSettings = {\n    hideKeys?: any[];\n    mainValues?: any[];\n};\n\nconst scrollColorLegend = (settings) =>\n    scrollableLegend(\n        d3Legend.legendColor().shape(\"circle\").shapeRadius(6),\n        settings\n    );\n\nconst scrollSymbolLegend = (settings) =>\n    scrollableLegend(\n        d3Legend.legendSymbol().shapePadding(1).labelOffset(3),\n        settings\n    );\n\nexport const colorLegend = () => legendComponent(scrollColorLegend);\nexport const symbolLegend = () =>\n    legendComponent(scrollSymbolLegend, symbolScale);\nexport const colorGroupLegend = () =>\n    legendComponent(scrollColorLegend, symbolScale);\n\nfunction symbolScale(fromScale) {\n    if (!fromScale) return null;\n\n    const domain = fromScale.domain();\n    const range = fromScale.range().map((r) => d3.symbol().type(r)());\n\n    return d3.scaleOrdinal().domain(domain).range(range);\n}\n\ninterface LegendComponent {\n    (container): void;\n\n    settings(): LegendComponentSettings;\n    settings(nextSettings: LegendComponentSettings): LegendComponent;\n\n    scale(): D3Scale | null;\n    scale(nextScale: D3Scale | null): LegendComponent;\n\n    color(): d3.ScaleOrdinal<string, unknown>;\n    color(nextColor: d3.ScaleOrdinal<string, unknown>): LegendComponent;\n}\n\nfunction legendComponent(\n    scrollLegendComponent,\n    scaleModifier = undefined\n): LegendComponent {\n    let settings: LegendComponentSettings = {};\n    let scale = null; // type?\n    let color: D3Scale | null = null;\n\n    const legend: Partial<LegendComponent> = (container) => {\n        if (scale && scale.range().length > 1) {\n            const scrollLegend = scrollLegendComponent(settings);\n            scrollLegend\n                .scale(scale)\n                .orient(\"vertical\")\n                .on(\"cellclick\", function (_d) {\n                    // d3-svg-legend is very outdated and incompat with d3 6.x\n                    const d = this.__data__;\n                    settings.hideKeys = settings.hideKeys || [];\n                    if (settings.hideKeys.includes(d)) {\n                        settings.hideKeys = settings.hideKeys.filter(\n                            (k) => k !== d\n                        );\n                    } else {\n                        settings.hideKeys.push(d);\n                    }\n\n                    getChartElement(this)._draw();\n                });\n\n            scrollLegend.labels((options) => {\n                const parts = String(options.domain[options.i]).split(\"|\");\n                return settings.mainValues.length <= 1 && parts.length > 1\n                    ? parts.slice(0, parts.length - 1).join(\"|\")\n                    : options.domain[options.i];\n            });\n\n            const legendSelection = getOrCreateElement(\n                container,\n                \"div.legend-container\",\n                () => container.append(\"div\")\n            );\n\n            scrollLegend.decorate((selection) => {\n                const isHidden = (data) =>\n                    settings.hideKeys && settings.hideKeys.includes(data);\n\n                const cells = selection\n                    .select(\"g.legendCells\")\n                    .attr(\"transform\", \"translate(20,20)\")\n                    .selectAll(\"g.cell\");\n\n                cells.classed(\"hidden\", isHidden);\n                cells.append(\"title\").html((d) => d);\n\n                if (color) {\n                    cells\n                        .select(\"circle, path\")\n                        .style(\"fill\", (d) => (isHidden(d) ? null : color(d)))\n                        .style(\"stroke\", (d) =>\n                            isHidden(d) ? null : withoutOpacity(color(d))\n                        );\n                }\n            });\n\n            // render the legend\n            legendSelection\n                .attr(\"class\", \"legend-container\")\n                .attr(\"borderbox-on-hover\", true)\n                .style(\"z-index\", \"2\")\n                .call(scrollLegend);\n        }\n    };\n\n    legend.settings = (...args: LegendComponentSettings[]): any => {\n        if (args.length === 0) {\n            return settings;\n        }\n        settings = args[0];\n\n        return legend;\n    };\n\n    legend.scale = (...args: (D3Scale | null)[]): any => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = scaleModifier ? scaleModifier(args[0]) : args[0];\n        return legend;\n    };\n\n    legend.color = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return legend;\n    };\n\n    return legend as LegendComponent;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3Legend from \"d3-svg-legend\";\nimport { rebindAll } from \"d3fc\";\nimport { getOrCreateElement } from \"../utils/utils\";\nimport legendControlsTemplate from \"../../html/legend-controls.html\";\nimport { cropCellContents } from \"./styling/cropCellContents\";\nimport { draggableComponent } from \"./styling/draggableComponent\";\nimport { resizableComponent } from \"./styling/resizableComponent\";\n\nconst averageCellHeightPx = 16;\nconst controlsHeightPx = 20;\n\nexport default (fromLegend, settings) => {\n    const legend = fromLegend || d3Legend.legendColor();\n\n    let domain = [];\n    let pageCount = 1;\n    let pageSize;\n    let pageIndex =\n        settings.legend && settings.legend.pageIndex\n            ? settings.legend.pageIndex\n            : 0;\n    let decorate: (...args: any[]) => void = () => {};\n    let draggable = draggableComponent().settings(settings);\n    let resizable;\n\n    const scrollableLegend = (selection) => {\n        domain = legend.scale().domain();\n\n        resizable = resizableComponent()\n            .settings(settings)\n            .maxHeight(domain.length * averageCellHeightPx + controlsHeightPx)\n            .on(\"resize\", () => render(selection));\n\n        resizable(selection);\n        draggable(selection);\n        render(selection);\n    };\n\n    const render = (selection) => {\n        calculatePageSize(selection);\n        renderControls(selection);\n        renderLegend(selection);\n        cropCellContents(selection);\n    };\n\n    const renderControls = (selection) => {\n        const controls = getLegendControls(selection);\n        controls.style(\"display\", pageCount <= 1 ? \"none\" : \"block\");\n\n        controls.select(\"#page-text\").text(`${pageIndex + 1}/${pageCount}`);\n\n        controls\n            .select(\"#up-arrow\")\n            .attr(\"class\", pageIndex === 0 ? \"disabled\" : \"\")\n            .on(\"click\", () => {\n                if (pageIndex > 0) {\n                    setPage(pageIndex - 1);\n                    render(selection);\n                }\n            });\n\n        controls\n            .select(\"#down-arrow\")\n            .attr(\"class\", pageIndex >= pageCount - 1 ? \"disabled\" : \"\")\n            .on(\"click\", () => {\n                if (pageIndex < pageCount - 1) {\n                    setPage(pageIndex + 1);\n                    render(selection);\n                }\n            });\n    };\n\n    const renderLegend = (selection) => {\n        if (pageCount > 1) legend.cellFilter(cellFilter());\n        selection.select(\"g.legendCells\").remove();\n\n        const legendElement = getLegendElement(selection);\n        legendElement.call(legend);\n\n        const cellContainerSize = selection\n            .select(\"g.legendCells\")\n            .node()\n            .getBBox();\n        legendElement.attr(\n            \"height\",\n            cellContainerSize.height + controlsHeightPx\n        );\n\n        decorate(selection);\n    };\n\n    const setPage = (index) => {\n        pageIndex = index;\n        settings.legend = { ...settings.legend, pageIndex };\n    };\n\n    const cellFilter = () => (_, i) =>\n        i >= pageSize * pageIndex && i < pageSize * pageIndex + pageSize;\n\n    const calculatePageSize = (selection) => {\n        const legendContainerRect = selection.node().getBoundingClientRect();\n        let proposedPageSize =\n            Math.floor(legendContainerRect.height / averageCellHeightPx) - 1;\n\n        // if page size is less than all legend items, leave space for the\n        // legend controls\n        pageSize =\n            proposedPageSize < domain.length\n                ? proposedPageSize - 1\n                : proposedPageSize;\n        pageCount = calculatePageCount(proposedPageSize);\n        pageIndex = Math.min(pageIndex, pageCount - 1);\n    };\n\n    const calculatePageCount = (pageSize) =>\n        Math.ceil(domain.length / pageSize);\n\n    const getLegendControls = (container) =>\n        getOrCreateElement(container, \".legend-controls\", () =>\n            container\n                .append(\"g\")\n                .attr(\"class\", \"legend-controls\")\n                .html(legendControlsTemplate)\n        );\n\n    const getLegendElement = (container) =>\n        getOrCreateElement(container, \".legend\", () =>\n            container.append(\"svg\").attr(\"class\", \"legend\")\n        );\n\n    scrollableLegend.decorate = (...args) => {\n        if (!args.length) {\n            return decorate;\n        }\n        decorate = args[0];\n        return scrollableLegend;\n    };\n\n    rebindAll(scrollableLegend, legend);\n\n    return scrollableLegend;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { isElementOverflowing } from \"../../utils/utils\";\n\nexport function cropCellContents(legendDiv) {\n    const legendCells = legendDiv.select(\"g.legendCells\");\n    const legendDivRect = legendDiv.node().getBoundingClientRect();\n\n    if (\n        !isElementOverflowing(\n            legendDivRect,\n            legendCells.node().getBoundingClientRect()\n        )\n    ) {\n        return;\n    }\n\n    const svg = legendDiv.select(\".legend\");\n\n    legendCells.selectAll(\".label\").text((d, i, nodes) => {\n        const cell = nodes[i];\n        if (isElementOverflowing(legendDivRect, cell.getBoundingClientRect())) {\n            const cutoffCharIndex = getCutoffCharacterIndex(\n                cell,\n                svg,\n                legendDivRect\n            );\n            return `${d.substring(0, cutoffCharIndex - 3)}...`;\n        } else {\n            return d;\n        }\n    });\n}\n\nfunction getCutoffCharacterIndex(cell, svg, legendDivRect) {\n    const cellRect = cell.getBoundingClientRect();\n    const cutoffCoord = svg.node().createSVGPoint();\n    // Sometimes the svg point can _just_ miss a character, so we fuzz it.\n    const fuzzyFactor = 3;\n    cutoffCoord.x = legendDivRect.right - cellRect.left - fuzzyFactor;\n    cutoffCoord.y = 0;\n    return cell.getCharNumAtPosition(cutoffCoord);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { getChartContainer } from \"../../plugin/root\";\nimport {\n    enforceContainerBoundaries,\n    margin,\n} from \"./enforceContainerBoundaries\";\n\nconst resizeForDraggingEvent = \"resize.for-dragging\";\n\nexport function draggableComponent() {\n    let pinned = true;\n    let settings = null;\n\n    const draggable = (element) => {\n        const node = element.node();\n        const viewer = node.getRootNode().host.closest(\"perspective-viewer\");\n        node.style.cursor = \"move\";\n        if (settings.legend) {\n            node.style.left = settings.legend.left;\n            node.style.top = settings.legend.top;\n        }\n\n        const drag = d3\n            .drag<HTMLElement, unknown>()\n            .on(\"drag\", function (event) {\n                const offsets = enforceContainerBoundaries(\n                    this,\n                    event.dx,\n                    event.dy\n                );\n\n                this.style.left = `${this.offsetLeft + offsets.x}px`;\n                this.style.top = `${this.offsetTop + offsets.y}px`;\n                const position = {\n                    left: this.style.left,\n                    top: this.style.top,\n                };\n                settings.legend = { ...settings.legend, ...position };\n\n                pinned = isNodeInTopRight(node)\n                    ? pinNodeToTopRight(node)\n                    : unpinNodeFromTopRight(node, pinned);\n            });\n\n        drag.on(\"end\", function (event) {\n            d3.select(window).on(resizeForDraggingEvent, null);\n            viewer?.dispatchEvent(new Event(\"perspective-config-update\"));\n        });\n\n        element.call(drag);\n    };\n\n    draggable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return draggable;\n    };\n\n    return draggable;\n}\n\nfunction unpinNodeFromTopRight(node, pinned) {\n    if (pinned !== false) {\n        // Default behaviour for the legend is to remain pinned to the top right\n        // hand corner with a specific margin. Once the legend has moved we\n        // cannot continue to use that css based approach.\n        d3.select(window).on(resizeForDraggingEvent, function () {\n            const offsets = enforceContainerBoundaries(node, 0, 0);\n            node.style.left = `${node.offsetLeft + offsets.x}px`;\n            node.style.top = `${node.offsetTop + offsets.y}px`;\n        });\n    }\n    return false;\n}\n\nfunction pinNodeToTopRight(node) {\n    d3.select(window).on(resizeForDraggingEvent, null);\n    node.style.left = \"auto\";\n    return true;\n}\n\nfunction isNodeInTopRight(node) {\n    const nodeRect = node.getBoundingClientRect();\n    const containerRect = d3\n        .select(getChartContainer(node))\n        .node()\n        .getBoundingClientRect();\n\n    const fuzz = 5;\n\n    return (\n        nodeRect.right + margin + fuzz >= containerRect.right &&\n        nodeRect.top - margin - fuzz <= containerRect.top\n    );\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { isElementOverflowing } from \"../../utils/utils\";\nimport { getChartElement } from \"../../plugin/root\";\nimport { NodeRect, Orient } from \"../../types\";\n\nexport const margin = 10;\n\nexport type AdjustedOffsets = {\n    x: number;\n    y: number;\n};\n\nexport function enforceContainerBoundaries(\n    innerNode: Element,\n    offsetX: number,\n    offsetY: number\n): AdjustedOffsets {\n    const chartNodeRect: DOMRect = d3\n        .select(getChartElement(innerNode).getContainer())\n        .node()\n        .getBoundingClientRect();\n\n    const innerNodeRect: NodeRect = innerNode.getBoundingClientRect();\n\n    const draggedInnerNodeRect: NodeRect = {\n        top: innerNodeRect.top + offsetY - margin,\n        right: innerNodeRect.right + offsetX + margin,\n        bottom: innerNodeRect.bottom + offsetY + margin,\n        left: innerNodeRect.left + offsetX - margin,\n    };\n\n    const adjustedOffsets: AdjustedOffsets = { x: offsetX, y: offsetY };\n    const boundaries: { edge: Orient; dimension: \"x\" | \"y\" }[] = [\n        { edge: \"right\", dimension: \"x\" },\n        { edge: \"left\", dimension: \"x\" },\n        { edge: \"top\", dimension: \"y\" },\n        { edge: \"bottom\", dimension: \"y\" },\n    ];\n\n    boundaries.forEach((bound) => {\n        if (\n            isElementOverflowing(\n                chartNodeRect,\n                draggedInnerNodeRect,\n                bound.edge\n            )\n        ) {\n            const adjustment =\n                draggedInnerNodeRect[bound.edge] - chartNodeRect[bound.edge];\n            adjustedOffsets[bound.dimension] =\n                adjustedOffsets[bound.dimension] - adjustment;\n        }\n    });\n\n    return adjustedOffsets;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { enforceContainerBoundaries } from \"./enforceContainerBoundaries\";\n\nconst horizontalHandleClass = \"horizontal-drag-handle\";\nconst verticalHandleClass = \"vertical-drag-handle\";\nconst cornerHandleClass = \"corner-drag-handle\";\n\nconst handlesContainerId = \"dragHandles\";\n\nconst fillOpacity = 0.0;\nconst resizeEvent = \"resize\";\n\nexport function resizableComponent() {\n    let handleWidthPx = 9;\n    let zIndex = 3;\n    let settings = null;\n    const minDimensionsPx = { height: 100, width: 100 };\n    const maxDimensionsPx = { height: null, width: null };\n\n    const callbacks: { event: any; execute: Function }[] = [];\n    const executeCallbacks = (event, direction) =>\n        callbacks\n            .filter((callback) => callback.event === event)\n            .forEach((callback) => callback.execute(direction));\n\n    const resizable = (container) => {\n        if (handlesContainerExists(container)) {\n            return;\n        }\n\n        const dragHelper = {\n            left: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragLeft(event),\n                    vertical: false,\n                }),\n            top: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: false,\n                    vertical: dragTop(event),\n                }),\n            right: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragRight(event),\n                    vertical: false,\n                }),\n            bottom: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: false,\n                    vertical: dragBottom(event),\n                }),\n            topleft: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragLeft(event),\n                    vertical: dragTop(event),\n                }),\n            topright: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragRight(event),\n                    vertical: dragTop(event),\n                }),\n            bottomright: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragRight(event),\n                    vertical: dragBottom(event),\n                }),\n            bottomleft: (event) =>\n                executeCallbacks(resizeEvent, {\n                    horizontal: dragLeft(event),\n                    vertical: dragBottom(event),\n                }),\n        };\n\n        const containerNode = container.node();\n        if (settings.legend) {\n            containerNode.style.height = settings.legend.height;\n            containerNode.style.width = settings.legend.width;\n        }\n\n        const containerRect: DOMRect = containerNode.getBoundingClientRect();\n        const handles: d3.Selection<SVGElement, unknown, undefined, unknown> =\n            container\n                .append(\"svg\")\n                .attr(\"id\", handlesContainerId)\n                .attr(\"width\", containerRect.width)\n                .attr(\"height\", containerRect.height);\n\n        const handlesGroup = handles.append(\"g\");\n\n        const isVertical = (d) => d === \"left\" || d === \"right\";\n        const xCoordHelper = {\n            left: 0,\n            top: handleWidthPx,\n            right: containerRect.width - handleWidthPx,\n            bottom: handleWidthPx,\n        };\n        const yCoordHelper = {\n            left: handleWidthPx,\n            top: 0,\n            right: handleWidthPx,\n            bottom: containerRect.height - handleWidthPx,\n        };\n        const edgeHandles = [\"left\", \"top\", \"right\", \"bottom\"];\n        const [leftHandle, topHandle, rightHandle, bottomHandle] =\n            edgeHandles.map((edge) =>\n                handlesGroup\n                    .append(\"rect\")\n                    .attr(\"id\", `drag${edge}`)\n                    .attr(\n                        \"class\",\n                        isVertical(edge)\n                            ? verticalHandleClass\n                            : horizontalHandleClass\n                    )\n                    .attr(\"y\", yCoordHelper[edge])\n                    .attr(\"x\", xCoordHelper[edge])\n                    .attr(\n                        \"height\",\n                        isVertical(edge)\n                            ? containerRect.height - handleWidthPx * 2\n                            : handleWidthPx\n                    )\n                    .attr(\n                        \"width\",\n                        isVertical(edge)\n                            ? handleWidthPx\n                            : containerRect.width - handleWidthPx * 2\n                    )\n                    .attr(\"fill\", isVertical(edge) ? \"lightgreen\" : \"lightblue\")\n                    .attr(\"fill-opacity\", fillOpacity)\n                    .style(\"z-index\", zIndex)\n                    .attr(\n                        \"cursor\",\n                        isVertical(edge) ? \"ew-resize\" : \"ns-resize\"\n                    )\n                    .call(d3.drag().on(\"drag\", dragHelper[edge]))\n            );\n\n        const concatCornerEdges = (corner) => `${corner[0]}${corner[1]}`;\n        const cornerCursorHelper = {\n            topleft: \"nwse\",\n            topright: \"nesw\",\n            bottomright: \"nwse\",\n            bottomleft: \"nesw\",\n        };\n        const cornerHandles = [\n            [\"top\", \"left\"],\n            [\"top\", \"right\"],\n            [\"bottom\", \"right\"],\n            [\"bottom\", \"left\"],\n        ];\n        const [\n            topLeftHandle,\n            topRightHandle,\n            bottomRightHandle,\n            bottomLeftHandle,\n        ] = cornerHandles.map((corner) =>\n            handlesGroup\n                .append(\"rect\")\n                .attr(\"id\", `drag${concatCornerEdges(corner)}`)\n                .attr(\"class\", `${cornerHandleClass} ${corner[0]} ${corner[1]}`)\n                .attr(\"height\", handleWidthPx)\n                .attr(\"width\", handleWidthPx)\n                .attr(\"fill\", \"red\")\n                .attr(\"fill-opacity\", fillOpacity)\n                .style(\"z-index\", zIndex)\n                .attr(\n                    \"cursor\",\n                    `${cornerCursorHelper[concatCornerEdges(corner)]}-resize`\n                )\n                .call(\n                    d3.drag().on(\"drag\", dragHelper[concatCornerEdges(corner)])\n                )\n        );\n\n        enforceMaxDimensions(\"height\", \"y\", bottomHandle);\n        enforceMaxDimensions(\"width\", \"x\", rightHandle);\n        pinCorners(handles);\n\n        function dragLeft(event) {\n            const offset = enforceDistToParallelBarConstraints(\n                enforceContainerBoundaries(leftHandle.node(), event.x, 0).x,\n                handles,\n                \"width\",\n                (x, y) => x - y\n            );\n            containerNode.style.left = `${containerNode.offsetLeft + offset}px`;\n            containerNode.style.width = `${\n                containerNode.offsetWidth - offset\n            }px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragRight(event) {\n            const offset = -enforceDistToParallelBarConstraints(\n                enforceContainerBoundaries(rightHandle.node(), event.dx, 0).x,\n                handles,\n                \"width\",\n                (x, y) => x + y\n            );\n            if (\n                pointerFallenBehindAbsoluteCoordinates(\n                    offset,\n                    \"x\",\n                    rightHandle,\n                    event\n                )\n            )\n                return false;\n            containerNode.style.width = `${\n                containerNode.offsetWidth - offset\n            }px`;\n            updateSettings();\n            return resizeAndRelocateHandles(rightHandle, offset, \"width\", \"x\");\n        }\n\n        function dragTop(event) {\n            const offset = enforceDistToParallelBarConstraints(\n                enforceContainerBoundaries(topHandle.node(), 0, event.y).y,\n                handles,\n                \"height\",\n                (x, y) => x - y\n            );\n            containerNode.style.top = `${containerNode.offsetTop + offset}px`;\n            containerNode.style.height = `${\n                containerNode.offsetHeight - offset\n            }px`;\n            updateSettings();\n            return resizeAndRelocateHandles(\n                bottomHandle,\n                offset,\n                \"height\",\n                \"y\"\n            );\n        }\n\n        function dragBottom(event) {\n            const offset = -enforceDistToParallelBarConstraints(\n                enforceContainerBoundaries(bottomHandle.node(), 0, event.dy).y,\n                handles,\n                \"height\",\n                (x, y) => x + y\n            );\n            if (\n                pointerFallenBehindAbsoluteCoordinates(\n                    offset,\n                    \"y\",\n                    bottomHandle,\n                    event\n                )\n            )\n                return false;\n            containerNode.style.height = `${\n                containerNode.offsetHeight - offset\n            }px`;\n            updateSettings();\n            return resizeAndRelocateHandles(\n                bottomHandle,\n                offset,\n                \"height\",\n                \"y\"\n            );\n        }\n\n        function updateSettings() {\n            const dimensions = {\n                top: containerNode.style.top,\n                left: containerNode.style.left,\n                height: containerNode.style.height,\n                width: containerNode.style.width,\n            };\n            settings.legend = { ...settings.legend, ...dimensions };\n        }\n\n        function resizeAndRelocateHandles(handle, offset, dimension, axis) {\n            extendHandlesBox(handles, dimension, offset);\n            pinHandleToHandleBoxEdge(handle, axis, offset);\n            extendPerpendicularHandles(\n                handles,\n                offset,\n                dimension,\n                dimension === \"height\"\n                    ? verticalHandleClass\n                    : horizontalHandleClass\n            );\n            pinCorners(handles);\n            return offset != 0;\n        }\n\n        function pinCorners(handles) {\n            topLeftHandle.attr(\"y\", 0);\n            topRightHandle\n                .attr(\"y\", 0)\n                .attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomRightHandle\n                .attr(\"y\", handles.attr(\"height\") - handleWidthPx)\n                .attr(\"x\", handles.attr(\"width\") - handleWidthPx);\n            bottomLeftHandle\n                .attr(\"y\", handles.attr(\"height\") - handleWidthPx)\n                .attr(\"x\", 0);\n        }\n\n        function enforceMaxDimensions(dimension, axis, relativeHandle) {\n            if (\n                !!maxDimensionsPx[dimension] &&\n                maxDimensionsPx[dimension] < containerRect[dimension]\n            ) {\n                containerNode.style[\n                    dimension\n                ] = `${maxDimensionsPx[dimension]}px`;\n                resizeAndRelocateHandles(\n                    relativeHandle,\n                    containerRect[dimension] - maxDimensionsPx[dimension],\n                    dimension,\n                    axis\n                );\n            }\n        }\n    };\n\n    resizable.on = (event, callback) => {\n        callbacks.push({ event: event, execute: callback });\n        return resizable;\n    };\n\n    resizable.zIndex = (input) => {\n        zIndex = input;\n        return resizable;\n    };\n\n    resizable.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return resizable;\n    };\n\n    resizable.minWidth = (input) => {\n        minDimensionsPx.width = input;\n        if (!!maxDimensionsPx.width)\n            maxDimensionsPx.width = Math.max(\n                minDimensionsPx.width,\n                maxDimensionsPx.width\n            );\n        return resizable;\n    };\n\n    resizable.minHeight = (input) => {\n        minDimensionsPx.height = input;\n        if (!!maxDimensionsPx.height)\n            maxDimensionsPx.height = Math.max(\n                minDimensionsPx.height,\n                maxDimensionsPx.height\n            );\n        return resizable;\n    };\n\n    resizable.handleWidth = (input) => {\n        handleWidthPx = input;\n        return resizable;\n    };\n\n    resizable.maxWidth = (input) => {\n        maxDimensionsPx.width = input;\n        minDimensionsPx.width = Math.min(\n            minDimensionsPx.width,\n            maxDimensionsPx.width\n        );\n        return resizable;\n    };\n\n    resizable.maxHeight = (input) => {\n        maxDimensionsPx.height = input;\n        minDimensionsPx.height = Math.min(\n            minDimensionsPx.height,\n            maxDimensionsPx.height\n        );\n        return resizable;\n    };\n\n    function pointerFallenBehindAbsoluteCoordinates(\n        offset,\n        axis,\n        handle,\n        event\n    ) {\n        const becauseCrossedMinSize = (offset, axis, handle, event) =>\n            offset < 0 && event[axis] < Number(handle.attr(axis));\n        const becauseExitedCoordinateSpace = (offset, axis, handle, event) =>\n            offset > 0 && event[axis] > Number(handle.attr(axis));\n        return (\n            becauseCrossedMinSize(offset, axis, handle, event) ||\n            becauseExitedCoordinateSpace(offset, axis, handle, event)\n        );\n    }\n\n    function enforceDistToParallelBarConstraints(\n        offset,\n        dragHandleContainer,\n        dimension,\n        operatorFunction\n    ) {\n        const anticipatedDimension = operatorFunction(\n            Number(dragHandleContainer.attr(dimension)),\n            offset\n        );\n        if (anticipatedDimension < minDimensionsPx[dimension]) {\n            const difference =\n                minDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        if (\n            !!maxDimensionsPx[dimension] &&\n            anticipatedDimension > maxDimensionsPx[dimension]\n        ) {\n            const difference =\n                maxDimensionsPx[dimension] - anticipatedDimension;\n            return operatorFunction(offset, difference);\n        }\n        return offset;\n    }\n\n    return resizable;\n}\n\n// \"dimension\" referring to width or height\nconst extendPerpendicularHandles = (\n    handles,\n    offset,\n    dimension,\n    orientationClass\n) => {\n    const perpendicularHandles = handles.selectAll(`.${orientationClass}`);\n    perpendicularHandles.each((_, i, nodes) => {\n        const handleNode = nodes[i];\n        const handleElement = d3.select(handleNode);\n        handleElement.attr(\n            dimension,\n            handleNode.getBoundingClientRect()[dimension] - offset\n        );\n    });\n};\n\nconst handlesContainerExists = (container) =>\n    container.select(`#${handlesContainerId}`).size() > 0;\n\nconst pinHandleToHandleBoxEdge = (handle, axis, offset) =>\n    handle.attr(axis, Number(handle.attr(axis)) - offset);\n\nconst extendHandlesBox = (handles, dimension, offset) =>\n    handles.attr(\n        dimension,\n        handles.node().getBoundingClientRect()[dimension] - offset\n    );\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { groupFromKey } from \"../series/seriesKey\";\nimport { DataRowsWithKey, Settings } from \"../types\";\n\nexport function filterData(\n    settings: Settings,\n    data: any[] | undefined = undefined\n) {\n    const useData = data || settings.data;\n    const len = settings.hideKeys?.length ?? 0;\n    return len > 0\n        ? useData.map((col) => {\n              const clone = { ...col };\n              settings.hideKeys.forEach((k) => {\n                  delete clone[k];\n              });\n              return clone;\n          })\n        : useData;\n}\n\nexport function filterDataByGroup(settings: Settings): DataRowsWithKey {\n    const newData = settings.data;\n    const hideKeysLen = settings.hideKeys?.length ?? 0;\n    const splitValsLen = settings.splitValues.length;\n    return hideKeysLen > 0\n        ? splitValsLen === 0\n            ? newData.filter((row) => {\n                  return Object.values(row).reduce(\n                      (res, val) => res && !settings.hideKeys.includes(val),\n                      true\n                  );\n              })\n            : newData.map((row) => {\n                  const entries = Object.entries(row).filter(\n                      ([key, _val]) =>\n                          !settings.hideKeys.includes(groupFromKey(key))\n                  );\n                  return Object.fromEntries(entries);\n              })\n        : newData;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { D3Scale, Orientation } from \"../types\";\n\nconst mainGridSvg = (settings) => (x, xTick) =>\n    x\n        .style(\"stroke-width\", (xTick) => \"1.0\")\n        .style(\"stroke\", (xTick) => axis_color(xTick, settings));\n\nfunction axis_color(xTick, settings) {\n    if (xTick === 0) {\n        if (settings) {\n            return settings.textStyles.color;\n        } else {\n            return \"#666\";\n        }\n    } else if (settings) {\n        return settings.colorStyles.grid.gridLineColor;\n    } else {\n        return \"#bbb\";\n    }\n}\n\nconst mainGridCanvas = (settings) => (c, xTick) => {\n    c.strokeStyle = axis_color(xTick, settings);\n    c.lineWidth = 1;\n};\n\nconst crossGridSvg = (x, _) => x.style(\"display\", \"none\");\nconst crossGridCanvas = (settings) => (c, xTick) => {\n    c.lineWidth = 1;\n    c.strokeStyle = axis_color(xTick, settings);\n};\n\nexport interface WithGridLines {\n    (...args): any;\n\n    orient(): Orientation;\n    orient(nextOrient: Orientation): WithGridLines;\n\n    canvas(): boolean;\n    canvas(nextCanvas: boolean): WithGridLines;\n\n    xScale(): D3Scale;\n    xScale(xScale: D3Scale): WithGridLines;\n\n    yScale(): D3Scale;\n    yScale(yScale: D3Scale): WithGridLines;\n\n    context(): any;\n    context(context: any): WithGridLines;\n}\n\nexport default (series, settings): WithGridLines => {\n    let orient = \"both\";\n    let canvas = false;\n    let xScale = null;\n    let yScale = null;\n    let context = null;\n\n    let seriesMulti = fc.seriesSvgMulti();\n    let annotationGridline = fc.annotationSvgGridline();\n    let mainGrid = mainGridSvg(settings);\n    let crossGrid = crossGridSvg;\n\n    const _withGridLines: Partial<WithGridLines> = function (...args) {\n        if (canvas) {\n            seriesMulti = fc.seriesCanvasMulti().context(context);\n            annotationGridline = fc.annotationCanvasGridline();\n            mainGrid = mainGridCanvas(settings);\n            crossGrid = crossGridCanvas(settings);\n        }\n\n        const multi = seriesMulti.xScale(xScale).yScale(yScale);\n\n        const xStyle = orient === \"vertical\" ? crossGrid : mainGrid;\n        const yStyle = orient === \"horizontal\" ? crossGrid : mainGrid;\n\n        const gridlines = annotationGridline\n            .xDecorate(xStyle)\n            .yDecorate(yStyle);\n\n        return multi.series([gridlines, series])(...args);\n    };\n\n    _withGridLines.orient = (...args: Orientation[]): any => {\n        if (!args.length) {\n            return orient;\n        }\n        orient = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.canvas = (...args: boolean[]): any => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.xScale = (...args): any => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.yScale = (...args): any => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = args[0];\n        return _withGridLines;\n    };\n\n    _withGridLines.context = (...args): any => {\n        if (!args.length) {\n            return context;\n        }\n        context = args[0];\n        return _withGridLines;\n    };\n\n    return _withGridLines as WithGridLines;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Pad, PadUnit, PaddingStrategy } from \"../../types\";\nimport { defaultPadding } from \"./default\";\nimport * as fc from \"d3fc\";\n\nexport const hardLimitZeroPadding = (): PaddingStrategy => {\n    const _defaultPadding = defaultPadding();\n\n    const padding: Partial<PaddingStrategy> = (extent) => {\n        let pad = _defaultPadding.pad();\n        let padUnit = _defaultPadding.padUnit();\n\n        let delta = 1;\n        switch (padUnit) {\n            case \"domain\": {\n                break;\n            }\n            case \"percent\": {\n                delta = extent[1] - extent[0];\n                break;\n            }\n            default:\n                throw new Error(\"Unknown padUnit: \" + padUnit);\n        }\n\n        let paddedLowerExtent = extent[0] - pad[0] * delta;\n        let paddedUpperExtent = extent[1] + pad[1] * delta;\n\n        // If datapoints are exclusively negative or exclusively positive hard\n        // limit extent to 0.\n        extent[0] =\n            extent[0] >= 0 && paddedLowerExtent < 0 ? 0 : paddedLowerExtent;\n        extent[1] =\n            extent[1] <= 0 && paddedUpperExtent > 0 ? 0 : paddedUpperExtent;\n        return extent;\n    };\n\n    padding.pad = function (..._args: Pad[]): any {\n        return _defaultPadding.pad();\n    };\n\n    padding.padUnit = function (..._args: PadUnit[]): any {\n        return _defaultPadding.padUnit();\n    };\n\n    fc.rebindAll(padding, _defaultPadding);\n\n    return padding as PaddingStrategy;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { getOrCreateElement } from \"../utils/utils\";\nimport template from \"../../html/zoom-controls.html\";\n\nexport default () => {\n    let chart = null;\n    let settings = null;\n    let xScale = null;\n    let xCopy = null;\n    let yScale = null;\n    let yCopy = null;\n    let bound = false;\n    let canvas = false;\n    let onChange: (args: any) => void = () => {};\n\n    function zoomableChart(selection) {\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\n        if (xScale || yScale) {\n            const dateAxis = xCopy && xCopy.domain()[0] instanceof Date;\n            const zoom = d3.zoom().on(\"zoom\", (event) => {\n                const { transform } = event;\n                settings.zoom = {\n                    k: transform.k,\n                    x: transform.x,\n                    y: transform.y,\n                };\n\n                applyTransform(transform);\n\n                selection.call(chart);\n\n                const noZoom =\n                    transform.k === 1 && transform.x === 0 && transform.y === 0;\n\n                const zoomControls = getZoomControls(selection).style(\n                    \"display\",\n                    noZoom ? \"none\" : \"\"\n                );\n                zoomControls\n                    .select(\"#zoom-reset\")\n                    .on(\"click\", () =>\n                        selection\n                            .select(chartPlotArea)\n                            .call(zoom.transform, d3.zoomIdentity)\n                    );\n\n                const oneYear = zoomControls\n                    .select(\"#one-year\")\n                    .style(\"display\", dateAxis ? \"\" : \"none\");\n                const sixMonths = zoomControls\n                    .select(\"#six-months\")\n                    .style(\"display\", dateAxis ? \"\" : \"none\");\n                const oneMonth = zoomControls\n                    .select(\"#one-month\")\n                    .style(\"display\", dateAxis ? \"\" : \"none\");\n                if (dateAxis) {\n                    const dateClick = (endCalculation) => () => {\n                        const start = new Date(xScale.domain()[0]);\n                        const end = new Date(start);\n                        endCalculation(start, end);\n\n                        const xRange = xCopy.range();\n                        const k =\n                            (xRange[1] - xRange[0]) /\n                            (xCopy(end) - xCopy(start));\n                        const x = -xCopy(start) * k;\n                        let y = 0;\n                        if (yScale) {\n                            const yMiddle =\n                                yScale.domain().reduce((a, b) => a + b) / 2;\n                            y = -yCopy(yMiddle) * k + yScale(yMiddle);\n                        }\n                        selection\n                            .select(chartPlotArea)\n                            .call(\n                                zoom.transform,\n                                d3.zoomIdentity.translate(x, y).scale(k)\n                            );\n                    };\n\n                    oneYear.on(\n                        \"click\",\n                        dateClick((start, end) =>\n                            end.setYear(start.getFullYear() + 1)\n                        )\n                    );\n                    sixMonths.on(\n                        \"click\",\n                        dateClick((start, end) =>\n                            end.setMonth(start.getMonth() + 6)\n                        )\n                    );\n                    oneMonth.on(\n                        \"click\",\n                        dateClick((start, end) =>\n                            end.setMonth(start.getMonth() + 1)\n                        )\n                    );\n                }\n            });\n\n            const oldDecorate = chart.decorate();\n            chart.decorate((sel, data) => {\n                oldDecorate(sel, data);\n                if (!bound) {\n                    bound = true;\n                    // add the zoom interaction on the enter selection\n                    const plotArea = sel.select(chartPlotArea);\n                    const device_pixel_factor = canvas\n                        ? window.devicePixelRatio\n                        : 1;\n\n                    plotArea\n                        .on(\"measure.zoom-range\", (event) => {\n                            if (xCopy)\n                                xCopy.range([\n                                    0,\n                                    event.detail.width / device_pixel_factor,\n                                ]);\n                            if (yCopy)\n                                yCopy.range([\n                                    0,\n                                    event.detail.height / device_pixel_factor,\n                                ]);\n\n                            if (settings.zoom) {\n                                const initialTransform = d3.zoomIdentity\n                                    .translate(settings.zoom.x, settings.zoom.y)\n                                    .scale(settings.zoom.k);\n                                plotArea.call(zoom.transform, initialTransform);\n                            }\n                        })\n                        .call(zoom);\n                }\n            });\n        }\n\n        selection.call(chart);\n    }\n\n    zoomableChart.chart = (...args) => {\n        if (!args.length) {\n            return chart;\n        }\n        chart = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.xScale = (...args) => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = zoomableScale(args[0]);\n        xCopy = xScale ? xScale.copy() : null;\n        return zoomableChart;\n    };\n\n    zoomableChart.yScale = (...args) => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = zoomableScale(args[0]);\n        yCopy = yScale ? yScale.copy() : null;\n        if (yCopy) {\n            const yDomain = yCopy.domain();\n            yCopy.domain([yDomain[1], yDomain[0]]);\n        }\n        return zoomableChart;\n    };\n\n    zoomableChart.canvas = (...args) => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return zoomableChart;\n    };\n\n    zoomableChart.onChange = (...args) => {\n        if (!args.length) {\n            return onChange;\n        }\n        onChange = args[0];\n        return zoomableChart;\n    };\n\n    const applyTransform = (transform) => {\n        const changeArgs = { ...transform };\n        if (xScale) {\n            xScale.domain(transform.rescaleX(xCopy).domain());\n            changeArgs.xDomain = xScale.domain();\n        }\n\n        if (yScale) {\n            const yZoomDomain = transform.rescaleY(yCopy).domain();\n            yScale.domain([yZoomDomain[1], yZoomDomain[0]]);\n            changeArgs.yDomain = yScale.domain();\n        }\n\n        onChange(changeArgs);\n    };\n\n    const getZoomControls = (container) =>\n        getOrCreateElement(container, \".zoom-controls\", () =>\n            container\n                .append(\"div\")\n                .attr(\"class\", \"zoom-controls\")\n                .style(\"display\", \"none\")\n                .html(template)\n        );\n\n    const zoomableScale = (scale) => {\n        if (scale && scale.nice) {\n            return scale;\n        }\n        return null;\n    };\n\n    return zoomableChart;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { axisFactory } from \"../axis/axisFactory\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport domainMatchOrigins from \"../axis/domainMatchOrigins\";\nimport {\n    axisSplitter,\n    dataBlankFunction,\n    groupedBlankFunction,\n} from \"../axis/axisSplitter\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { barSeries } from \"../series/barSeries\";\nimport { seriesColors } from \"../series/seriesColors\";\nimport { groupAndStackData } from \"../data/groupData\";\nimport { colorLegend } from \"../legend/legend\";\nimport { filterData } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction columnChart(container: HTMLSelection, settings: Settings) {\n    const data = groupAndStackData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend().settings(settings).scale(color);\n\n    const bars = barSeries(settings, color).orient(\"vertical\");\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(data.map(() => bars));\n\n    const xAxis = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .memoValue(settings.axisMemo[1])\n        .excludeType(AXIS_TYPES.ordinal)\n        .orient(\"vertical\")\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding());\n\n    // Check whether we've split some values into a second y-axis\n    const blankFunction =\n        settings.mainValues.length > 1\n            ? groupedBlankFunction\n            : dataBlankFunction;\n    const splitter = axisSplitter(settings, data, blankFunction).color(color);\n\n    const yAxis1 = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit()\n        ? series\n        : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    if (chart.xPaddingInner) {\n        chart.xPaddingInner(0.5);\n        chart.xPaddingOuter(0.25);\n        bars.align(\"left\");\n    }\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n\n        domainMatchOrigins(yAxis1.domain, yAxis2.domain);\n        chart.yDomain(yAxis1.domain).altAxis(yAxis2);\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(legend);\n}\ncolumnChart.plugin = {\n    name: \"Y Bar\",\n    category: \"Y Chart\",\n    max_cells: 1000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        names: [\"Y Axis\"],\n    },\n};\n\nexport default columnChart;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { DomainTuple } from \"../types\";\n\nexport default (domain1: DomainTuple, domain2: DomainTuple) => {\n    if (!isMatchable(domain1) || !isMatchable(domain2)) return;\n\n    const ratio1 = originRatio(domain1);\n    const ratio2 = originRatio(domain2);\n\n    if (ratio1 > ratio2) {\n        domain2[0] = adjustLowerBound(domain2, ratio1);\n    } else {\n        domain1[0] = adjustLowerBound(domain1, ratio2);\n    }\n};\n\nconst isMatchable = (domain: DomainTuple) =>\n    domain.length === 2 &&\n    !isNaN(domain[0]) &&\n    !isNaN(domain[1]) &&\n    domain[0] !== domain[1];\nconst originRatio = (domain: DomainTuple) =>\n    (0 - domain[0]) / (domain[1] - domain[0]);\nconst adjustLowerBound = (domain: DomainTuple, ratio: number) =>\n    (ratio * domain[1]) / (ratio - 1);\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { getChartElement } from \"../plugin/root\";\nimport { withoutOpacity } from \"../series/seriesColors.js\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nexport type SplitterLabel = {\n    index: number;\n    name: string;\n};\n\nexport interface SplitterLabels {\n    (selection: any): void;\n\n    labels(): SplitterLabel[];\n    labels(labels: SplitterLabel[]): SplitterLabels;\n\n    color(): d3.ScaleOrdinal<string, unknown>;\n    color(nextColor: d3.ScaleOrdinal<string, unknown>): SplitterLabels;\n\n    alt(): boolean;\n    alt(nextAlt: boolean): SplitterLabels;\n}\n\n// Render a set of labels with the little left/right arrows for moving\n// between axes\nexport const splitterLabels = (settings: Settings): SplitterLabels => {\n    let labels: SplitterLabel[] = [];\n    let alt = false;\n    let color;\n\n    const _render: Partial<SplitterLabels> = (selection: HTMLSelection) => {\n        selection.text(\"\");\n\n        const labelDataJoin = fc\n            .dataJoin(\"span\", \"splitter-label\")\n            .key((d) => d);\n\n        const disabled = !alt && labels.length === 1;\n        const coloured = color && settings.splitValues.length === 0;\n        labelDataJoin(selection, labels)\n            .classed(\"disabled\", disabled)\n            .text((d) => d.name)\n            .style(\"color\", (d) =>\n                coloured ? withoutOpacity(color(d.name)) : undefined\n            )\n            .on(\"click\", (event, d) => {\n                if (disabled) return;\n\n                if (alt) {\n                    settings.splitMainValues = settings.splitMainValues.filter(\n                        (v) => v != d.name\n                    );\n                } else {\n                    settings.splitMainValues = [d.name].concat(\n                        settings.splitMainValues || []\n                    );\n                }\n\n                event.target\n                    .getRootNode()\n                    .host.closest(\"perspective-viewer\")\n                    ?.dispatchEvent(new Event(\"perspective-config-update\"));\n\n                redrawChart(selection);\n            });\n    };\n\n    const redrawChart = (selection: HTMLSelection) => {\n        const chartElement = getChartElement(selection.node());\n        chartElement._container.innerHTML = \"\";\n        chartElement._draw();\n    };\n\n    _render.labels = (...args: SplitterLabel[][]): any => {\n        if (!args.length) {\n            return labels;\n        }\n        labels = args[0];\n        return _render;\n    };\n    _render.alt = (...args: boolean[]): any => {\n        if (!args.length) {\n            return alt;\n        }\n        alt = args[0];\n        return _render;\n    };\n\n    _render.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _render;\n    };\n\n    return _render as SplitterLabels;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { Settings } from \"../types\";\nimport { splitterLabels } from \"./splitterLabels\";\n\nexport interface AxisSplitter {\n    (selection: any): void;\n\n    color(): d3.ScaleOrdinal<string, unknown>;\n    color(nextColor: d3.ScaleOrdinal<string, unknown>): AxisSplitter;\n\n    haveSplit: () => boolean;\n\n    data(): any[];\n    data(nextData: any[]): AxisSplitter;\n\n    altData(): any[];\n    altData(nextData: any[]): AxisSplitter;\n}\n\nexport const axisSplitter = (\n    settings: Settings,\n    sourceData,\n    splitFn = dataSplitFunction\n): AxisSplitter => {\n    let color: d3.ScaleOrdinal<string, unknown> | undefined = undefined;\n    let data;\n    let altData;\n\n    // splitMainValues is an array of main-value names to put into the alt-axis\n    const splitMainValues = settings.splitMainValues || [];\n    const altValue = (name) => {\n        const split = name.split(\"|\");\n        return splitMainValues.includes(split[split.length - 1]);\n    };\n\n    const haveSplit: boolean = settings[\"mainValues\"].some((m) =>\n        altValue(m.name)\n    );\n\n    // Split the data into main and alt displays\n    data = haveSplit\n        ? splitFn(sourceData, (key) => !altValue(key))\n        : sourceData;\n    altData = haveSplit ? splitFn(sourceData, altValue) : null;\n\n    // Renderer to show the special controls for moving between axes\n    const splitter: any = (selection) => {\n        if (settings[\"mainValues\"].length === 1) return;\n\n        const labelsInfo = settings[\"mainValues\"].map((v, i) => ({\n            index: i,\n            name: v.name,\n        }));\n        const mainLabels = labelsInfo.filter((v) => !altValue(v.name));\n        const altLabels = labelsInfo.filter((v) => altValue(v.name));\n\n        const labeller = () => splitterLabels(settings).color(color);\n\n        selection\n            .select(\".y-label.left-label\")\n            .call(labeller().labels(mainLabels));\n        selection\n            .select(\".y-label.right-label\")\n            .call(labeller().labels(altLabels).alt(true));\n    };\n\n    splitter.color = (...args: d3.ScaleOrdinal<string, unknown>[]): any => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return splitter;\n    };\n\n    splitter.haveSplit = (): boolean => haveSplit;\n\n    splitter.data = (...args: any[][]): any => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return splitter;\n    };\n\n    splitter.altData = (...args: any[][]): any => {\n        if (!args.length) {\n            return altData;\n        }\n        altData = args[0];\n        return splitter;\n    };\n\n    return splitter;\n};\n\nexport const dataSplitFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map((d) => d.filter((v) => isIncludedFn(v.key)));\n};\n\nexport const dataBlankFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map((series) => {\n        if (!isIncludedFn(series.key)) {\n            // Blank this data\n            return series.map((v) => Object.assign({}, v, { mainValue: null }));\n        }\n        return series;\n    });\n};\n\nexport const groupedBlankFunction = (sourceData, isIncludedFn) => {\n    return sourceData.map((group) => dataBlankFunction(group, isIncludedFn));\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport { axisSplitter } from \"../axis/axisSplitter\";\nimport { seriesColors } from \"../series/seriesColors\";\nimport { lineSeries } from \"../series/lineSeries\";\nimport { splitData } from \"../data/splitData\";\nimport { colorLegend } from \"../legend/legend\";\nimport { filterData } from \"../legend/filter\";\nimport { transposeData } from \"../data/transposeData\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { Settings } from \"../types\";\n\nfunction lineChart(container, settings: Settings) {\n    const data = splitData(settings, filterData(settings));\n    const color = seriesColors(settings);\n\n    const legend = colorLegend().settings(settings).scale(color);\n\n    const series = fc\n        .seriesSvgRepeat()\n        .series(lineSeries(settings, color))\n        .orient(\"horizontal\");\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.1, 0.1])\n        .padUnit(\"percent\");\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, transposeData(data)).color(color);\n\n    const xAxis: AxisFactoryContent = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .memoValue(splitter.haveSplit() ? null : settings.axisMemo[0])\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    const yAxis1: AxisFactoryContent = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit()\n        ? series\n        : withGridLines(series, settings).orient(\"vertical\");\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({\n            yScale: yAxis2.scale,\n            data: splitter.altData(),\n        });\n    }\n\n    const transposed_data = splitter.data();\n\n    // render\n    container.datum(transposed_data).call(zoomChart);\n    container.call(toolTip);\n    container.call(legend);\n}\n\nlineChart.plugin = {\n    name: \"Y Line\",\n    category: \"Y Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        names: [\"Y Axis\"],\n    },\n};\n\nexport default lineChart;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { withoutOpacity } from \"./seriesColors.js\";\nimport { D3Scale, Settings } from \"../types.js\";\n\nexport function lineSeries(settings: Settings, color: D3Scale) {\n    let series = fc.seriesSvgLine();\n\n    const estimated_size =\n        settings.data.length *\n        (settings.data?.length > 0\n            ? Object.keys(settings.data[0]).length -\n              (settings.crossValues?.length > 0 ? 1 : 0)\n            : 0);\n    const stroke_width = Math.max(\n        1,\n        Math.min(3, Math.floor(settings.size.width / estimated_size / 2))\n    );\n\n    series = series.decorate((selection) => {\n        selection\n            .style(\"stroke\", (d) => withoutOpacity(color(d[0] && d[0].key)))\n            .style(\"stroke-width\", stroke_width);\n    });\n\n    return series.crossValue((d) => d.crossValue).mainValue((d) => d.mainValue);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { Settings } from \"../types\";\n\nexport type SplitData = {\n    key: string;\n    crossValue: string;\n    mainValue: string | number | boolean | Date;\n    row: any;\n};\n\nexport function splitData(settings: Settings, data: any[]): SplitData[][] {\n    const labelfn = labelFunction(settings);\n\n    return data.map((col, i) => {\n        return Object.keys(col)\n            .filter((key) => key !== \"__ROW_PATH__\")\n            .map((key) => ({\n                key,\n                crossValue: labelfn(col, i),\n                mainValue: col[key],\n                row: col,\n            }));\n    });\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport const transposeData = function (x) {\n    const columns = [];\n    for (const row of x) {\n        for (let col = 0; col < row.length; col++) {\n            if (row[col].mainValue !== null) {\n                columns[col] = columns[col] || [];\n                columns[col].push(row[col]);\n            }\n        }\n    }\n    return columns;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { tooltip } from \"./tooltip\";\nimport { withOpacity } from \"../series/seriesColors.js\";\nimport { findBestFromData } from \"../data/findBest\";\nimport { raiseEvent } from \"./selectionEvent\";\nimport { SplitData } from \"../data/splitData\";\nimport { D3Scale, Settings } from \"../types\";\n\nexport type AltDataWithScale = {\n    data: SplitData[][];\n    yScale: D3Scale;\n};\n\nexport interface SizeArg {\n    (arg: any): any;\n    copy: () => any;\n}\n\ninterface NearbyTip {\n    (selection: any): void;\n\n    scaleFactor(): number;\n    scaleFactor(scaleFactor: number): NearbyTip;\n\n    settings(): Settings;\n    settings(settings: Settings): NearbyTip;\n\n    xScale(): D3Scale;\n    xScale(xScale: D3Scale): NearbyTip;\n\n    yScale(): D3Scale;\n    yScale(yScale: D3Scale): NearbyTip;\n\n    color(): D3Scale;\n    color(color: D3Scale): NearbyTip;\n\n    size(): SizeArg;\n    size(size: SizeArg): NearbyTip;\n\n    canvas(): boolean;\n    canvas(canvas: boolean): NearbyTip;\n\n    data(): Record<string, any>[][];\n    data(data: Record<string, any>[][]): NearbyTip;\n\n    xValueName(): string;\n    xValueName(xValueName: string): NearbyTip;\n\n    yValueName(): string;\n    yValueName(yValueName: string): NearbyTip;\n\n    altDataWithScale(): AltDataWithScale;\n    altDataWithScale(altDataWithScale: AltDataWithScale): NearbyTip;\n}\n\nexport default (): NearbyTip => {\n    const base = tooltip().alwaysShow(true);\n\n    let xScale: D3Scale | null = null;\n    let yScale: D3Scale | null = null;\n    let color: D3Scale | null = null;\n    let size = null;\n    let canvas = false;\n    let data = null;\n    let xValueName = \"crossValue\";\n    let yValueName = \"mainValue\";\n    let altDataWithScale = null;\n    let scale_factor = 1;\n\n    const nearbyTip: Partial<NearbyTip> = (selection) => {\n        const chartPlotArea = `d3fc-${canvas ? \"canvas\" : \"svg\"}.plot-area`;\n        if (xScale || yScale) {\n            let tooltipData = null;\n            const pointer = fc.pointer().on(\"point\", (event) => {\n                const closest = event.length\n                    ? getClosestDataPoint(event[0])\n                    : null;\n                tooltipData = closest ? [closest.data] : [];\n                const useYScale = closest ? closest.scale : yScale;\n\n                renderTip(selection, tooltipData, useYScale);\n            });\n\n            selection\n                .select(chartPlotArea)\n                .on(\"measure.nearbyTip\", () => renderTip(selection, []))\n                .on(\"click\", () => {\n                    if (tooltipData.length) {\n                        raiseEvent(\n                            selection.node(),\n                            tooltipData[0],\n                            base.settings()\n                        );\n                    }\n                })\n                .call(pointer);\n        }\n    };\n\n    const renderTip = (selection, tipData, useYScale = yScale) => {\n        const tips = selection\n            .select(\"d3fc-svg.plot-area svg\")\n            .selectAll(\"circle.nearbyTip\")\n            .data(tipData);\n        tips.exit().remove();\n\n        tips.enter()\n            .append(\"circle\")\n            .attr(\"class\", \"nearbyTip\")\n            .merge(tips)\n            .attr(\"r\", (d) =>\n                size ? scale_factor * Math.sqrt(size(d.size)) : 10\n            )\n            .attr(\n                \"transform\",\n                (d) =>\n                    `translate(${xScale(d[xValueName])},${useYScale(\n                        d[yValueName]\n                    )})`\n            )\n            .style(\"stroke\", \"none\")\n            .style(\"fill\", (d) => color && d.key && withOpacity(color(d.key)));\n\n        base(tips);\n    };\n\n    const getClosestDataPoint = (pos) => {\n        const distFn = (scale) => {\n            return (v) => {\n                if (\n                    v[yValueName] === undefined ||\n                    v[yValueName] === null ||\n                    v[xValueName] === undefined ||\n                    v[xValueName] === null\n                )\n                    return null;\n\n                return Math.sqrt(\n                    Math.pow((xScale(v[xValueName]) as number) - pos.x, 2) +\n                        Math.pow(scale(v[yValueName]) - pos.y, 2)\n                );\n            };\n        };\n\n        // Check the main data\n        const dist1 = distFn(yScale);\n        const best1 = findBestFromData(data, dist1, Math.min);\n\n        if (altDataWithScale) {\n            // Check the alt data with its scale, to see if any are closer\n            const dist2 = distFn(altDataWithScale.yScale);\n            const best2 = findBestFromData(\n                altDataWithScale.data,\n                dist2,\n                Math.min\n            );\n            return dist1(best1) <= dist2(best2)\n                ? { data: best1, scale: yScale }\n                : { data: best2, scale: altDataWithScale.yScale };\n        }\n        return { data: best1, scale: yScale };\n    };\n\n    nearbyTip.scaleFactor = (...args: number[]): any => {\n        if (!args.length) {\n            return scale_factor;\n        }\n        scale_factor = args[0];\n        return nearbyTip;\n    };\n    nearbyTip.xScale = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return xScale;\n        }\n        xScale = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.yScale = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return yScale;\n        }\n        yScale = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.color = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.size = (...args: SizeArg[]): any => {\n        if (!args.length) {\n            return size;\n        }\n        size = args[0] ? args[0].copy().range([40, 4000]) : null;\n        return nearbyTip;\n    };\n\n    nearbyTip.canvas = (...args: boolean[]): any => {\n        if (!args.length) {\n            return canvas;\n        }\n        canvas = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.data = (...args: Record<string, any>[][][]): any => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.xValueName = (...args: string[]): any => {\n        if (!args.length) {\n            return xValueName;\n        }\n        xValueName = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.yValueName = (...args: string[]): any => {\n        if (!args.length) {\n            return yValueName;\n        }\n        yValueName = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.altDataWithScale = (...args: AltDataWithScale[]): any => {\n        if (!args.length) {\n            return altDataWithScale;\n        }\n        altDataWithScale = args[0];\n        return nearbyTip;\n    };\n\n    nearbyTip.settings = (...args: Settings[]): any => {\n        if (!args.length) {\n            return base.settings();\n        }\n        base.settings(args[0]);\n        return nearbyTip;\n    };\n\n    fc.rebindAll(nearbyTip, base);\n    return nearbyTip as NearbyTip;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nexport const findBestFromData = (array, valueFn, compareFn = Math.min) => {\n    const findBestFromArray = (array) => {\n        return array.reduce((best, v) => {\n            const thisValue = findBestFromItem(v);\n            return thisValue &&\n                (!best ||\n                    compareFn(best.value, thisValue.value) === thisValue.value)\n                ? thisValue\n                : best;\n        }, null);\n    };\n    const findBestFromItem = (item) => {\n        if (Array.isArray(item)) {\n            return findBestFromArray(item);\n        }\n        const value = valueFn(item);\n        return value !== null\n            ? {\n                  item,\n                  value,\n              }\n            : null;\n    };\n\n    const bestItem = findBestFromArray(array);\n    return bestItem ? bestItem.item : null;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { transposeData } from \"../data/transposeData\";\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport { symbolTypeFromGroups } from \"../series/pointSeriesCanvas\";\nimport { lineSeries } from \"../series/lineSeries\";\nimport { xySplitData } from \"../data/xySplitData\";\nimport { seriesColorsFromGroups } from \"../series/seriesColors\";\nimport { colorGroupLegend } from \"../legend/legend\";\nimport { filterDataByGroup } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction xyLine(container: HTMLSelection, settings: Settings) {\n    const data = transposeData(\n        xySplitData(settings, filterDataByGroup(settings))\n    );\n\n    const color = seriesColorsFromGroups(settings);\n    const symbols = symbolTypeFromGroups(settings);\n\n    let legend = null;\n    if (color.domain().length >= 2) {\n        legend = colorGroupLegend()\n            .settings(settings)\n            .scale(symbols)\n            .color(color);\n    }\n\n    const series = fc\n        .seriesSvgRepeat()\n        .series(lineSeries(settings, color))\n        .orient(\"horizontal\");\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.1, 0.1])\n        .padUnit(\"percent\");\n\n    const xAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .settingValue(settings.mainValues[0].name)\n        .valueName(\"crossValue\")\n        .memoValue(settings.axisMemo[0])\n        .paddingStrategy(paddingStrategy);\n\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .settingValue(settings.mainValues[1].name)\n        .valueName(\"mainValue\")\n        .memoValue(settings.axisMemo[1])\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    const yAxis: AxisFactoryContent = yAxisFactory(data);\n    const xAxis: AxisFactoryContent = xAxisFactory(data);\n\n    const plotSeries = withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis)\n        .xLabel(settings.mainValues[0].name)\n        .yLabel(settings.mainValues[1].name)\n        .plotArea(plotSeries);\n\n    chart.xNice && chart.xNice();\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale)\n        .color(color)\n        .data(data);\n\n    container.datum(data).call(zoomChart);\n    container.call(toolTip);\n    if (legend) {\n        container.call(legend);\n    }\n}\n\nxyLine.plugin = {\n    name: \"X/Y Line\",\n    category: \"X/Y Chart\",\n    max_cells: 50000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 2,\n        names: [\"X Axis\", \"Y Axis\", \"Tooltip\"],\n    },\n    selectMode: \"toggle\",\n};\n\nexport default xyLine;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { seriesCanvasPoint } from \"d3fc\";\nimport { withOpacity, withoutOpacity } from \"./seriesColors\";\nimport { groupFromKey } from \"./seriesKey\";\nimport { fromDomain } from \"./seriesSymbols\";\nimport { toValue } from \"../tooltip/selectionData\";\nimport { getValuesByColumn } from \"../data/utils\";\nimport { D3Scale, Settings } from \"../types\";\n\nconst LABEL_PADDING = 8;\nconst LABEL_COSINE = 1;\n\n/**\n *\n * @param {any} settings\n * @param {string} seriesKey\n * @param {d3.ScaleLinear} size\n * @param {d3.ScaleOrdinal} color\n * @param {string} label\n * @param {d3.ScaleOrdinal} symbols\n * @param {number?} scale_factor\n * @returns  {d3fc.seriesCanvasPoint}\n */\nexport function pointSeriesCanvas(\n    settings,\n    symbolKey,\n    size,\n    color,\n    label,\n    symbols,\n    scale_factor = 1\n) {\n    let series = seriesCanvasPoint()\n        .crossValue((d) => d.x)\n        .mainValue((d) => d.y);\n\n    if (symbols) {\n        series.type((data) => symbols(data.row[symbolKey]));\n    }\n\n    if (size) {\n        series.size((d) => Math.round(scale_factor * size(d.size)));\n    }\n\n    series.decorate((context, data) => {\n        const colorValue = color(data.colorValue);\n        const opacity = settings.colorStyles?.opacity;\n        if (label) {\n            const { type } = settings.mainValues.find((x) => x.name === label);\n            const value = toValue(type, data.row[label]);\n            if (value !== null) {\n                context.fillStyle = settings.textStyles.color;\n                context.font = settings.textStyles.font;\n                let magnitude = 0;\n                if (size) {\n                    // A = pi * r^2\n                    // r = sqrt(A / pi)\n                    const radius = Math.sqrt(\n                        (scale_factor * size(data.size)) / Math.PI\n                    );\n\n                    magnitude = radius * LABEL_COSINE;\n                }\n\n                const mag_with_padding = magnitude + LABEL_PADDING;\n                context.fillText(value, mag_with_padding, 4);\n            }\n        }\n\n        context.strokeStyle = withoutOpacity(colorValue);\n        context.fillStyle = withOpacity(colorValue, opacity);\n    });\n\n    return series;\n}\n\nexport function symbolTypeFromColumn(\n    settings: Settings,\n    column: string | null\n): D3Scale {\n    let rows = [...new Set(getValuesByColumn(settings, column))];\n    return fromDomain(rows);\n}\n\nexport function symbolTypeFromGroups(settings: Settings) {\n    const col =\n        settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain: string[] = [];\n    Object.keys(col).forEach((key) => {\n        if (key !== \"__ROW_PATH__\") {\n            const group = groupFromKey(key);\n            if (!domain.includes(group)) {\n                domain.push(group);\n            }\n        }\n    });\n    return fromDomain(domain);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\n\nconst sqrt3 = Math.sqrt(3);\n\nconst nabla = {\n    draw: function (context, size) {\n        const y = Math.sqrt(size / (sqrt3 * 3));\n        context.moveTo(0, y * 2);\n        context.lineTo(-sqrt3 * y, -y);\n        context.lineTo(sqrt3 * y, -y);\n        context.closePath();\n    },\n};\n\nexport const symbols = [\n    d3.symbolCircle,\n    d3.symbolCross,\n    d3.symbolDiamond,\n    d3.symbolSquare,\n    d3.symbolStar,\n    d3.symbolTriangle,\n    d3.symbolWye,\n];\nexport const symbolsObj = {\n    circle: d3.symbolCircle,\n    square: d3.symbolSquare,\n    cross: d3.symbolCross,\n    diamond: d3.symbolDiamond,\n    star: d3.symbolStar,\n    triangle: d3.symbolTriangle,\n    wye: d3.symbolWye,\n    nabla,\n};\n\nexport function fromDomain(domain: string[]) {\n    return domain.length > 1\n        ? d3.scaleOrdinal().domain(domain).range(symbols)\n        : null;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { groupFromKey } from \"../series/seriesKey\";\n\nexport function xySplitData(settings, data) {\n    const n_cols = settings.mainValues.length;\n\n    return data.map((col) => {\n        const cols = Object.keys(col).filter((key) => key !== \"__ROW_PATH__\");\n        const row = new Array(cols.length / n_cols);\n        for (let i = 0; i < cols.length / n_cols; i++) {\n            row[i] = {\n                key: groupFromKey(cols[i * n_cols]),\n                crossValue: col[cols[i * n_cols]],\n                mainValue: col[cols[i * n_cols + 1]],\n                row: col,\n            };\n        }\n        return row;\n    });\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport { axisSplitter } from \"../axis/axisSplitter\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { areaSeries } from \"../series/areaSeries\";\nimport { lineSeries } from \"../series/lineSeries\";\nimport { seriesColors } from \"../series/seriesColors\";\nimport { splitAndBaseData } from \"../data/splitAndBaseData\";\nimport { colorLegend } from \"../legend/legend\";\nimport { filterData } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction areaChart(container: HTMLSelection, settings: Settings) {\n    const data: any[] = splitAndBaseData(settings, filterData(settings));\n\n    const color = seriesColors(settings);\n    const legend = colorLegend().settings(settings).scale(color);\n\n    const area_series = fc\n        .seriesSvgRepeat()\n        .series(areaSeries(settings, color).orient(\"vertical\"));\n\n    const line_series = fc\n        .seriesSvgRepeat()\n        .series(lineSeries(settings, color))\n        .orient(\"vertical\");\n\n    const series = fc.seriesSvgMulti().series([area_series, line_series]);\n\n    const xAxis: AxisFactoryContent = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .memoValue(settings.axisMemo[1])\n        .excludeType(AXIS_TYPES.ordinal)\n        .orient(\"vertical\")\n        .include([0])\n        .paddingStrategy(hardLimitZeroPadding());\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, data).color(color);\n\n    const yAxis1: AxisFactoryContent = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit()\n        ? series\n        : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({\n            yScale: yAxis2.scale,\n            data: splitter.altData(),\n        });\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(toolTip);\n    container.call(legend);\n}\nareaChart.plugin = {\n    name: \"Y Area\",\n    category: \"Y Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        names: [\"Y Axis\"],\n    },\n};\n\nexport default areaChart;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { D3Scale, Settings } from \"../types\";\n\nexport function areaSeries(_settings: Settings, color: D3Scale) {\n    let series = fc.seriesSvgArea();\n\n    series = series.decorate((selection) => {\n        selection.style(\"fill\", (d) => color(d[0].key)).style(\"opacity\", 0.5);\n    });\n\n    return series\n        .crossValue((d) => d.crossValue)\n        .mainValue((d) => d.mainValue)\n        .baseValue((d) => d.baseValue);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { Settings } from \"../types\";\n\nexport interface SplitAndBasedData {\n    key: string;\n    crossValue: string;\n    mainValue: number;\n    baseValue: number;\n    row: any;\n}\n\nexport function splitAndBaseData(\n    settings: Settings,\n    data\n): SplitAndBasedData[][] {\n    const labelfn = labelFunction(settings);\n\n    return data.map((col, i): SplitAndBasedData[] => {\n        const baseValues = {};\n\n        return Object.keys(col)\n            .filter((key) => key !== \"__ROW_PATH__\")\n            .map((key) => {\n                // Keys are of the form \"split1|split2|aggregate\"\n                const labels = key.split(\"|\");\n                // label=\"aggregate\"\n                const label = labels[labels.length - 1];\n                const baseValue = baseValues[label] || 0;\n                const value = baseValue + col[key];\n                baseValues[label] = value;\n\n                return {\n                    key,\n                    crossValue: labelfn(col, i),\n                    mainValue: value,\n                    baseValue: baseValue,\n                    row: col,\n                };\n            });\n    });\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { chartSvgFactory } from \"../axis/chartFactory\";\nimport { axisSplitter } from \"../axis/axisSplitter\";\nimport { seriesColors } from \"../series/seriesColors\";\nimport { categoryPointSeries, symbolType } from \"../series/categoryPointSeries\";\nimport { groupData } from \"../data/groupData\";\nimport { symbolLegend } from \"../legend/legend\";\nimport { filterData } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction yScatter(container: HTMLSelection, settings: Settings) {\n    const data = groupData(settings, filterData(settings));\n    const symbols = symbolType(settings);\n    const color = seriesColors(settings);\n\n    const legend = symbolLegend()\n        .settings(settings)\n        .scale(symbols)\n        .color(color);\n\n    const series = fc\n        .seriesSvgMulti()\n        .mapping((data, index) => data[index])\n        .series(\n            data.map((series) =>\n                categoryPointSeries(settings, series.key, color, symbols)\n            )\n        );\n\n    const paddingStrategy = hardLimitZeroPadding()\n        .pad([0.05, 0.05])\n        .padUnit(\"percent\");\n\n    const xAxis: AxisFactoryContent = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n    const yAxisFactory = axisFactory(settings)\n        .settingName(\"mainValues\")\n        .valueName(\"mainValue\")\n        .memoValue(settings.axisMemo[1])\n        .orient(\"vertical\")\n        .paddingStrategy(paddingStrategy);\n\n    // Check whether we've split some values into a second y-axis\n    const splitter = axisSplitter(settings, data).color(color);\n\n    const yAxis1: AxisFactoryContent = yAxisFactory(splitter.data());\n\n    // No grid lines if splitting y-axis\n    const plotSeries = splitter.haveSplit()\n        ? series\n        : withGridLines(series, settings).orient(\"vertical\");\n\n    const chart = chartSvgFactory(xAxis, yAxis1)\n        .axisSplitter(splitter)\n        .plotArea(plotSeries);\n\n    chart.yNice && chart.yNice();\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale);\n\n    const toolTip = nearbyTip()\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis1.scale)\n        .color(color)\n        .data(data);\n\n    if (splitter.haveSplit()) {\n        // Create the y-axis data for the alt-axis\n        const yAxis2 = yAxisFactory(splitter.altData());\n        chart.altAxis(yAxis2);\n        // Give the tooltip the information (i.e. 2 datasets with different\n        // scales)\n        toolTip.data(splitter.data()).altDataWithScale({\n            yScale: yAxis2.scale,\n            data: splitter.altData(),\n        });\n    }\n\n    // render\n    container.datum(splitter.data()).call(zoomChart);\n    container.call(toolTip);\n    if (legend) {\n        container.call(legend);\n    }\n}\n\nyScatter.plugin = {\n    name: \"Y Scatter\",\n    category: \"Y Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        names: [\"Y Axis\"],\n    },\n};\n\nexport default yScatter;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { withOpacity, withoutOpacity } from \"./seriesColors\";\nimport { fromDomain } from \"./seriesSymbols\";\nimport { D3Scale, Settings } from \"../types\";\n\nexport function categoryPointSeries(\n    settings: Settings,\n    seriesKey: string,\n    color: D3Scale,\n    symbols: D3Scale\n) {\n    let series = fc.seriesSvgPoint().size(100);\n    const opacity = settings.colorStyles && settings.colorStyles.opacity;\n\n    if (symbols) {\n        series.type(symbols(seriesKey));\n    }\n\n    series.decorate((selection) => {\n        selection\n            .style(\"stroke\", (d) =>\n                withoutOpacity(color(d.colorValue || seriesKey))\n            )\n            .style(\"fill\", (d) =>\n                withOpacity(color(d.colorValue || seriesKey), opacity)\n            );\n    });\n\n    return series.crossValue((d) => d.crossValue).mainValue((d) => d.mainValue);\n}\n\nexport function symbolType(settings: Settings) {\n    const col =\n        settings.data && settings.data.length > 0 ? settings.data[0] : {};\n    const domain = Object.keys(col).filter((k) => k !== \"__ROW_PATH__\");\n    return fromDomain(domain);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { symbolTypeFromColumn } from \"../series/pointSeriesCanvas\";\nimport { pointData } from \"../data/pointData\";\nimport {\n    seriesColorsFromColumn,\n    seriesColorsFromDistinct,\n    colorScale,\n} from \"../series/seriesColors\";\nimport { seriesColorRange } from \"../series/seriesRange\";\nimport { symbolLegend, colorLegend } from \"../legend/legend\";\nimport { colorRangeLegend } from \"../legend/colorRangeLegend\";\nimport { filterDataByGroup } from \"../legend/filter\";\nimport { symbolsObj } from \"../series/seriesSymbols\";\nimport { gridLayoutMultiChart } from \"../layout/gridLayoutMultiChart\";\nimport xyScatterSeries from \"../series/xy-scatter/xyScatterSeries\";\nimport { D3Scale, HTMLSelection, Settings, Type } from \"../types\";\n\n/**\n * Overrides specific symbols based on plugin settings. This modifies in-place _and_ returns the value.\n * @param {any} settings\n * @param {d3.ScaleOrdinal} symbols\n */\nfunction overrideSymbols(settings: Settings, symbols): D3Scale {\n    if (!symbols) {\n        return;\n    }\n    const symbolCol = settings.realValues[4];\n    const columnType = settings.mainValues.find(\n        (val) => val.name === symbolCol\n    )?.type;\n    let domain: string[] = symbols.domain();\n    let range = symbols.range();\n    let len = range.length;\n    for (let [i, _] of domain.entries()) {\n        range[i] = range[(i as number) % len];\n    }\n    let maybeSymbols = (settings.columns_config?.[symbolCol]?.[\"symbols\"] ??\n        {}) as Record<string, string>;\n    Object.entries(maybeSymbols).forEach(([key, value]) => {\n        // TODO: Define custom symbol types based on the values passed in here.\n        // https://d3js.org/d3-shape/symbol#custom-symbols\n        let symbolType = symbolsObj[value] ?? d3.symbolCircle;\n\n        let i = domain.findIndex((val) => {\n            switch (columnType) {\n                case \"date\":\n                case \"datetime\":\n                    return new Date(val).valueOf() === new Date(key).valueOf();\n                default:\n                    return String(val) === String(key);\n            }\n        });\n\n        range[i] = symbolType;\n    });\n    symbols.range(range);\n    return symbols;\n}\n\nfunction xyScatter(container: HTMLSelection, settings: Settings) {\n    const colorBy = settings.realValues[2];\n    let hasColorBy = !!colorBy;\n    let isColoredByString =\n        settings.mainValues.find((x) => x.name === colorBy)?.type === \"string\";\n\n    let color = null;\n    let legend = null;\n\n    const symbolCol = settings.realValues[4];\n    const temp = symbolTypeFromColumn(settings, symbolCol);\n\n    const symbols = overrideSymbols(settings, temp);\n\n    const data = pointData(settings, filterDataByGroup(settings));\n\n    if (hasColorBy && isColoredByString) {\n        if (!!symbolCol) {\n            // TODO: Legend should have cartesian product labels (ColorBy|SplitBy)\n            // For now, just use monocolor legends.\n            if (settings.splitValues.length > 0) {\n                color = seriesColorsFromDistinct(settings, data);\n            } else {\n                color = seriesColorsFromDistinct(settings, data[0]);\n            }\n            legend = symbolLegend().settings(settings).scale(symbols);\n        } else {\n            color = seriesColorsFromColumn(settings, colorBy);\n            legend = colorLegend().settings(settings).scale(color);\n        }\n    } else if (hasColorBy) {\n        color = seriesColorRange(settings, data, \"colorValue\");\n        legend = colorRangeLegend().scale(color);\n    } else {\n        // always use default color\n        color = colorScale().settings(settings).domain([\"\"])();\n        legend = symbolLegend().settings(settings).scale(symbols);\n    }\n\n    if (settings.splitValues.length !== 0) {\n        let xyGrid = gridLayoutMultiChart()\n            .svg(false)\n            .elementsPrefix(\"xy-scatter\");\n        xyGrid = xyGrid.padding(\"2.5em\");\n\n        const xLabel = container.append(\"div\").attr(\"class\", \"multi-xlabel\");\n        xLabel.append(\"p\").text(settings.mainValues[0].name);\n\n        const yLabel = container.append(\"div\").attr(\"class\", \"multi-ylabel\");\n        yLabel\n            .append(\"p\")\n            .text(settings.mainValues[1].name)\n            .style(\"transform\", \"rotate(-90deg)\")\n            .style(\"text-wrap\", \"nowrap\");\n\n        container = container.datum(data);\n        container.call(xyGrid);\n        const xyContainer = xyGrid.chartContainer();\n        const xyEnter = xyGrid.chartEnter();\n        const xyDiv = xyGrid.chartDiv();\n        const xyTitle = xyGrid.chartTitle();\n        const containerSize = xyGrid.containerSize();\n\n        xyTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.key));\n        xyEnter\n            .merge(xyDiv)\n            .attr(\n                \"transform\",\n                `translate(${containerSize.width / 2}, ${\n                    containerSize.height / 2\n                })`\n            )\n            .each(function (data) {\n                const xyElement = d3.select(this);\n                xyScatterSeries()\n                    .settings(settings)\n                    .data([data])\n                    .color(color as D3Scale)\n                    .symbols(symbols)(xyElement);\n            });\n    } else {\n        xyScatterSeries()\n            .settings(settings)\n            .data(data)\n            .color(color as D3Scale)\n            .symbols(symbols)(container);\n    }\n\n    if (legend) container.call(legend);\n}\n\nxyScatter.plugin = {\n    name: \"X/Y Scatter\",\n    category: \"X/Y Chart\",\n    max_cells: 50000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 2,\n        names: [\n            \"X Axis\",\n            \"Y Axis\",\n            \"Color\",\n            \"Size\",\n            \"Symbol\",\n            \"Label\",\n            \"Tooltip\",\n        ],\n    },\n    selectMode: \"toggle\",\n};\n\nxyScatter.can_render_column_styles = (type: Type, group?: string) => {\n    return type === \"string\" && group === \"Symbol\";\n};\nxyScatter.column_style_controls = (type: Type, group?: string) => {\n    if (type === \"string\" && group === \"Symbol\") {\n        return {\n            symbols: {\n                keys: \"row\",\n                values: Object.keys(symbolsObj),\n            },\n        };\n    } else {\n        return null;\n    }\n};\n\nexport default xyScatter;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { Settings } from \"../types\";\nimport { splitIntoMultiSeries } from \"./splitIntoMultiSeries\";\n\nexport function pointData(settings: Settings, data) {\n    return splitIntoMultiSeries(settings, data, { excludeEmpty: true }).map(\n        (data) => seriesToPoints(settings, data)\n    );\n}\n\nfunction seriesToPoints(settings: Settings, data) {\n    const labelfn = labelFunction(settings);\n\n    const mappedSeries = data.map((col, i) => ({\n        crossValue: labelfn(col, i),\n        mainValues: settings.mainValues.map((v) => col[v.name]),\n        x: col[settings.mainValues[0].name],\n        y: col[settings.mainValues[1].name],\n        colorValue: settings.realValues[2]\n            ? col[settings.realValues[2]]\n            : undefined,\n        size: settings.realValues[3] ? col[settings.realValues[3]] : undefined,\n        key: data.key,\n        row: col,\n    }));\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { domain } from \"../axis/linearAxis\";\nimport { Settings, ValueName } from \"../types\";\n\nexport function seriesLinearRange(\n    _settings,\n    data,\n    valueName,\n    customExtent?: any\n) {\n    return d3.scaleLinear().domain(getExtent(data, valueName, customExtent));\n}\n\nexport function seriesColorRange(\n    settings: Settings,\n    data: any[],\n    valueName: ValueName,\n    customExtent = null\n): d3.ScaleSequential<string> {\n    let extent = getExtent(data, valueName, customExtent);\n    let gradient = settings.colorStyles.gradient.full;\n\n    if (extent[0] >= 0) {\n        gradient = settings.colorStyles.gradient.positive;\n    } else if (extent[1] <= 0) {\n        gradient = settings.colorStyles.gradient.negative;\n    } else {\n        const maxVal = Math.max(-extent[0], extent[1]);\n        extent = [-maxVal, maxVal];\n    }\n\n    const interpolator = multiInterpolator(gradient);\n    return d3.scaleSequential(interpolator).domain(extent);\n}\n\nconst getExtent = (data: any[], valueName: ValueName, customExtent?: any) => {\n    return customExtent || domain().valueName(valueName).pad([0, 0])(data);\n};\n\nconst multiInterpolator = (gradientPairs) => {\n    // A new interpolator that calls through to a set of\n    // interpolators between each value/color pair\n    const interpolators = gradientPairs\n        .slice(1)\n        .map((p, i) => d3.interpolate(gradientPairs[i][1], p[1]));\n    return (value) => {\n        const index = gradientPairs.findIndex(\n            (p, i) =>\n                i < gradientPairs.length - 1 &&\n                value <= gradientPairs[i + 1][0] &&\n                value > p[0]\n        );\n        if (index === -1) {\n            if (value <= gradientPairs[0][0]) {\n                return gradientPairs[0][1];\n            }\n            return gradientPairs[gradientPairs.length - 1][1];\n        }\n\n        const interpolator = interpolators[index];\n        const [value1] = gradientPairs[index];\n        const [value2] = gradientPairs[index + 1];\n\n        return interpolator((value - value1) / (value2 - value1));\n    };\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as fc from \"d3fc\";\nimport { getOrCreateElement } from \"../utils/utils\";\nimport { getValueFormatterForRange as getValueFormatter } from \"../axis/valueFormatter\";\n\nexport function colorRangeLegend() {\n    let scale = null;\n\n    function legend(container) {\n        const legendSelection = getOrCreateElement(\n            container,\n            \"div.legend-container\",\n            () =>\n                container\n                    .append(\"div\")\n                    .attr(\"class\", \"legend-container legend-color\")\n                    .style(\"z-index\", \"2\")\n        );\n        const { width, height } = legendSelection\n            .node()\n            .getBoundingClientRect();\n\n        const xScale = d3.scaleBand<number>().domain([0, 1]).range([0, width]);\n\n        const domain = scale.copy().nice().domain();\n        const paddedDomain = fc\n            .extentLinear()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\")(domain);\n        const [min, max] = paddedDomain;\n        const expandedDomain = d3.range(min, max, (max - min) / height);\n\n        const yScale = d3.scaleLinear().domain(paddedDomain).range([height, 0]);\n\n        const svgBar = fc\n            .autoBandwidth(fc.seriesSvgBar())\n            .xScale(xScale)\n            .yScale(yScale)\n            .crossValue(0)\n            .baseValue((_, i) => expandedDomain[Math.max(0, i - 1)])\n            .mainValue((d) => d)\n            .decorate((selection) => {\n                selection.selectAll(\"path\").style(\"fill\", (d) => scale(d));\n            });\n\n        const middle =\n            domain[0] < 0 && domain[1] > 0\n                ? 0\n                : Math.round((domain[1] + domain[0]) / 2);\n        const tickValues = [...domain, middle];\n\n        let valueformatter = getValueFormatter(min, max);\n        const axisLabel = fc\n            .axisRight(yScale)\n            .tickValues(tickValues)\n            .tickSizeOuter(0)\n            .tickFormat((d) => valueformatter(d));\n\n        const legendSvg = getOrCreateElement(legendSelection, \"svg\", () =>\n            legendSelection.append(\"svg\")\n        )\n            .style(\"width\", width)\n            .style(\"height\", height);\n        const legendBar = getOrCreateElement(legendSvg, \"g\", () =>\n            legendSvg.append(\"g\")\n        )\n            .datum(expandedDomain)\n            .call(svgBar);\n\n        const barWidth = Math.abs(legendBar.node().getBBox().x);\n        getOrCreateElement(legendSvg, \"#legend-axis\", () =>\n            legendSvg.append(\"g\").attr(\"id\", \"legend-axis\")\n        )\n            .attr(\"transform\", `translate(${barWidth})`)\n            .datum(expandedDomain)\n            .call(axisLabel)\n            .select(\".domain\")\n            .attr(\"visibility\", \"hidden\");\n    }\n\n    legend.scale = (...args) => {\n        if (!args.length) {\n            return scale;\n        }\n        scale = args[0];\n        return legend;\n    };\n\n    return legend;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { getOrCreateElement } from \"../utils/utils\";\n\nexport interface GridLayoutMultiChart {\n    (container: any): any;\n\n    elementsPrefix(): string;\n    elementsPrefix(nextPrefix: string): GridLayoutMultiChart;\n\n    padding(): string;\n    padding(nextPadding: string): GridLayoutMultiChart;\n\n    svg(): boolean;\n    svg(nextSvg: boolean): GridLayoutMultiChart;\n\n    chartContainer: () => any;\n    chartEnter: () => any;\n    chartDiv: () => any;\n    chartTitle: () => any;\n    containerSize: () => any;\n}\n\nexport function gridLayoutMultiChart(): GridLayoutMultiChart {\n    let elementsPrefix = \"element-prefix-unset\";\n\n    let chartContainer = null;\n    let chartEnter = null;\n    let chartDiv = null;\n    let chartTitle = null;\n    let color = null;\n    let containerSize = null;\n    let svg = true;\n    let padding = null;\n\n    const _gridLayoutMultiChart: Partial<GridLayoutMultiChart> = (\n        container\n    ) => {\n        const outerContainer = getOrCreateElement(\n            container,\n            \"div.outer-container\",\n            () =>\n                container\n                    .append(\"div\")\n                    .attr(\"class\", \"outer-container\")\n                    .style(\"width\", `calc(100% - ${padding ?? 0})`)\n                    .style(\"height\", `calc(100% - ${padding ?? 0})`)\n                    .style(\"padding-left\", padding ?? 0)\n        );\n\n        const scrollContainer = getOrCreateElement(\n            outerContainer,\n            \"div.inner-container\",\n            () => outerContainer.append(\"div\").attr(\"class\", \"inner-container\")\n        );\n\n        const innerRect = outerContainer.node().getBoundingClientRect();\n        const containerHeight = innerRect.height;\n        const containerWidth = innerRect.width - (color ? 70 : 0);\n\n        const minSize = 300;\n        const data = container.datum();\n\n        const cols = Math.max(\n            1,\n            Math.min(data.length, Math.floor(containerWidth / minSize))\n        );\n        const rows = Math.ceil(data.length / cols);\n\n        containerSize = {\n            width: containerWidth / Math.max(cols, 1),\n            height: Math.min(\n                containerHeight,\n                Math.max(\n                    containerHeight / rows,\n                    containerWidth / Math.max(cols, 1)\n                )\n            ),\n        };\n\n        if (containerHeight / rows > containerSize.height * 0.75) {\n            containerSize.height = containerHeight / rows;\n        }\n\n        if (data.length > 1) {\n            scrollContainer.style(\n                \"grid-template-columns\",\n                `repeat(${cols}, ${100 / cols}%)`\n            );\n            scrollContainer.style(\n                \"grid-template-rows\",\n                `repeat(${rows}, ${containerSize.height}px)`\n            );\n        } else {\n            scrollContainer.style(\"grid-template-columns\", `repeat(1, 100%)`);\n            scrollContainer.style(\"grid-template-rows\", `repeat(1, 100%)`);\n        }\n\n        chartDiv = scrollContainer\n            .selectAll(`div.${elementsPrefix}-container`)\n            .data(data, (d) => d.split);\n        chartDiv.exit().remove();\n\n        chartEnter = chartDiv\n            .enter()\n            .append(\"div\")\n            .attr(\"class\", `${elementsPrefix}-container`);\n\n        chartTitle = chartEnter\n            .append(\"div\")\n            .attr(\"class\", \"title-container\")\n            .style(\"text-align\", \"center\")\n            .attr(\"display\", \"inline-block\")\n            .append(\"text\")\n            .attr(\"class\", \"title\")\n            .style(\"text-align\", \"left\");\n\n        if (svg) {\n            chartContainer = chartEnter\n                .append(\"svg\")\n                .append(\"g\")\n                .attr(\"class\", elementsPrefix);\n        } else {\n            chartContainer = chartEnter\n                .append(\"div\")\n                .attr(\"class\", elementsPrefix);\n        }\n    };\n\n    _gridLayoutMultiChart.padding = (...args: string[]): any => {\n        if (!args.length) {\n            return padding;\n        }\n        padding = args[0];\n        return _gridLayoutMultiChart;\n    };\n    _gridLayoutMultiChart.svg = (...args: boolean[]): any => {\n        if (!args.length) {\n            return svg;\n        }\n        svg = args[0];\n        return _gridLayoutMultiChart;\n    };\n\n    _gridLayoutMultiChart.elementsPrefix = (...args: string[]): any => {\n        if (!args.length) {\n            return elementsPrefix;\n        }\n        elementsPrefix = args[0];\n        return _gridLayoutMultiChart;\n    };\n\n    _gridLayoutMultiChart.chartContainer = () => chartContainer;\n\n    _gridLayoutMultiChart.chartEnter = () => chartEnter;\n\n    _gridLayoutMultiChart.chartDiv = () => chartDiv;\n\n    _gridLayoutMultiChart.chartTitle = () => chartTitle;\n\n    _gridLayoutMultiChart.containerSize = () => containerSize;\n\n    return _gridLayoutMultiChart as GridLayoutMultiChart;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { axisFactory } from \"../../axis/axisFactory\";\nimport { chartCanvasFactory } from \"../../axis/chartFactory\";\nimport { pointSeriesCanvas, symbolTypeFromColumn } from \"../pointSeriesCanvas\";\nimport { seriesLinearRange } from \"../seriesRange\";\nimport withGridLines from \"../../gridlines/gridlines\";\nimport { hardLimitZeroPadding } from \"../../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../../zoom/zoomableChart\";\nimport nearbyTip from \"../../tooltip/nearbyTip\";\nimport { symbolsObj } from \"../seriesSymbols\";\nimport { D3Scale, Settings } from \"../../types\";\n\n/**\n * Define a clamped scaling factor based on the container size for bubble plots.\n *\n * @param {Array} p1 a point as a tuple of `Number`\n * @param {Array} p2 a second point as a tuple of `Number`\n * @returns a function `container -> integer` which calculates a scaling factor\n * from the linear function (clamped) defgined by the input points\n */\nfunction interpolate_scale([x1, y1], [x2, y2]) {\n    const m = (y2 - y1) / (x2 - x1);\n    const b = y2 - m * x2;\n    return function (container) {\n        const node = container.node();\n        const shortest_axis = Math.min(node.clientWidth, node.clientHeight);\n        return Math.min(y2, Math.max(y1, m * shortest_axis + b));\n    };\n}\n\nexport interface XYScatterSeries {\n    (container: any): void;\n\n    settings(): Settings;\n    settings(settings: Settings): XYScatterSeries;\n\n    data(): Record<string, any>[][];\n    data(data: Record<string, any>[][]): XYScatterSeries;\n\n    color(): D3Scale;\n    color(color: D3Scale): XYScatterSeries;\n\n    symbols(): D3Scale;\n    symbols(symbols: D3Scale): XYScatterSeries;\n}\n\n/**\n * @param {d3.Selection} container - d3.Selection of the outer div\n * @param {any} settings - settings as defined in the Update method in plugin.js\n */\nexport default function xyScatterSeries(): XYScatterSeries {\n    let settings: Settings | null = null;\n    let data = null;\n    let color = null;\n    let symbols = null;\n\n    const _xyScatterSeries: Partial<XYScatterSeries> = (container) => {\n        const colorBy = settings.realValues[2];\n        let hasColorBy = !!colorBy;\n        const symbolCol = settings.realValues[4];\n\n        const size = settings.realValues[3]\n            ? seriesLinearRange(settings, data, \"size\").range([10, 10000])\n            : null;\n\n        const label = settings.realValues[5];\n\n        const scale_factor = interpolate_scale(\n            [600, 0.1],\n            [1600, 1]\n        )(container);\n        const series = fc\n            .seriesCanvasMulti()\n            .mapping((data, index) => data[index])\n            .series(\n                data.map(() =>\n                    pointSeriesCanvas(\n                        settings,\n                        symbolCol,\n                        size,\n                        color,\n                        label,\n                        symbols,\n                        scale_factor\n                    )\n                )\n            );\n\n        const axisDefault = () =>\n            axisFactory(settings)\n                .settingName(\"mainValues\")\n                .paddingStrategy(hardLimitZeroPadding())\n                .pad([0.1, 0.1]);\n\n        const xAxis = axisDefault()\n            .settingValue(settings.mainValues[0].name)\n            .memoValue(settings.axisMemo[0])\n            .valueName(\"x\")(data);\n\n        const yAxis = axisDefault()\n            .orient(\"vertical\")\n            .settingValue(settings.mainValues[1].name)\n            .memoValue(settings.axisMemo[1])\n            .valueName(\"y\")(data);\n\n        const [xLabel, yLabel] =\n            settings.splitValues.length === 0\n                ? [settings.mainValues[0].name, settings.mainValues[1].name]\n                : [\"\", \"\"];\n\n        const chart = chartCanvasFactory(xAxis, yAxis)\n            .xLabel(xLabel)\n            .yLabel(yLabel)\n            .plotArea(withGridLines(series, settings).canvas(true));\n\n        chart.xNice && chart.xNice();\n        chart.yNice && chart.yNice();\n\n        // TODO: This make scrolling the grid tricky. Maybe require modifier key to zoom?\n        // Also, reset zoom button is now at the top of the page and overlaps any other items.\n        const zoomChart = zoomableChart()\n            .chart(chart)\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .yScale(yAxis.scale)\n            .canvas(true);\n\n        const toolTip = nearbyTip()\n            .scaleFactor(scale_factor)\n            .settings(settings)\n            .canvas(true)\n            .xScale(xAxis.scale as D3Scale)\n            .xValueName(\"x\")\n            .yValueName(\"y\")\n            .yScale(yAxis.scale as D3Scale)\n            .color((!hasColorBy && color) as D3Scale)\n            .size(size)\n            .data(data);\n\n        // render\n        container.datum(data).call(zoomChart);\n        container.call(toolTip);\n    };\n\n    _xyScatterSeries.settings = (...args: Settings[]): any => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _xyScatterSeries;\n    };\n    _xyScatterSeries.data = (...args: any[][]): any => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _xyScatterSeries;\n    };\n    _xyScatterSeries.color = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _xyScatterSeries;\n    };\n    _xyScatterSeries.symbols = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return symbols;\n        }\n        symbols = args[0];\n        return _xyScatterSeries;\n    };\n\n    return _xyScatterSeries as XYScatterSeries;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { tooltip } from \"../tooltip/tooltip\";\nimport { Settings } from \"../types\";\n\nexport function heatmapSeries(\n    _settings: Settings,\n    color: d3.ScaleSequential<string>\n) {\n    let series = fc.seriesCanvasHeatmap();\n\n    series.decorate((ctx, d) => {\n        ctx.fillStyle = color(d.colorValue);\n        // tooltip().settings(settings)(selection);\n        // selection.select(\"path\").attr(\"fill\", (d) => color(d.colorValue));\n    });\n\n    return fc\n        .autoBandwidth(series)\n        .xValue((d) => d.crossValue)\n        .yValue((d) => d.mainValue)\n        .colorValue((d) => d.colorValue)\n        .colorInterpolate(color.interpolator())\n        .widthFraction(1.0);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { axisType } from \"../axis/axisType\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { Settings } from \"../types\";\n\nexport function heatmapData(settings: Settings, data) {\n    const labelfn = labelFunction(settings);\n    const mainType = axisType(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")();\n\n    const heatmapData = [];\n\n    data.forEach((col, i) => {\n        const crossValue = labelfn(col, i);\n        Object.keys(col)\n            .filter((key) => key !== \"__ROW_PATH__\")\n            .forEach((key) => {\n                const mainValue = getMainValues(key);\n                heatmapData.push({\n                    crossValue: crossValue,\n                    mainValue:\n                        mainType === AXIS_TYPES.time\n                            ? new Date(mainValue)\n                            : mainValue,\n                    colorValue: col[key],\n                    row: col,\n                });\n            });\n    });\n\n    return heatmapData;\n}\n\nfunction getMainValues(key) {\n    // Key format is based on \"Split By\" values plus the value label at the end\n    // val1|val2|....|label\n    const labels = key.split(\"|\");\n    labels.pop();\n    return labels.join(\"|\");\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { AXIS_TYPES } from \"../axis/axisType\";\nimport { chartCanvasFactory } from \"../axis/chartFactory\";\nimport { heatmapSeries } from \"../series/heatmapSeries\";\nimport { seriesColorRange } from \"../series/seriesRange\";\nimport { heatmapData } from \"../data/heatmapData\";\nimport { filterData } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\nimport { colorRangeLegend } from \"../legend/colorRangeLegend\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction heatmapChart(container: HTMLSelection, settings: Settings) {\n    const data = heatmapData(settings, filterData(settings));\n\n    const color = seriesColorRange(settings, data, \"colorValue\");\n    const series = heatmapSeries(settings, color);\n\n    const legend = colorRangeLegend().scale(color);\n\n    const xAxis: AxisFactoryContent = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"crossValues\")\n        .valueName(\"crossValue\")(data);\n\n    const yAxis: AxisFactoryContent = axisFactory(settings)\n        .excludeType(AXIS_TYPES.linear)\n        .settingName(\"splitValues\")\n        .valueName(\"mainValue\")\n        .modifyDomain((d: any[]): any[] => {\n            let is_number = !isNaN(d[0]);\n            return is_number ? d.reverse() : d;\n        })\n        .orient(\"vertical\")(data);\n\n    const chart = chartCanvasFactory(xAxis, yAxis).plotArea(\n        withGridLines(series, settings).canvas(true)\n    );\n\n    if (chart.xPaddingInner) {\n        chart.xPaddingInner(0);\n        chart.xPaddingOuter(0);\n        series.xAlign(\"right\");\n    }\n    if (chart.yPaddingInner) {\n        chart.yPaddingInner(0);\n        chart.yPaddingOuter(0);\n        series.yAlign(\"top\");\n    }\n\n    const zoomChart = zoomableChart()\n        .chart(chart)\n        .settings(settings)\n        .xScale(xAxis.scale)\n        .yScale(yAxis.scale)\n        .canvas(true);\n\n    // const tp = tooltip().settings(settings);\n\n    const toolTip = nearbyTip()\n        // .scaleFactor(scale_factor)\n        .settings(settings)\n        .canvas(true)\n        .xScale(xAxis.scale)\n        // .xValueName(\"x\")\n        // .yValueName(\"y\")\n        .yScale(yAxis.scale)\n        .color(color)\n        // .size(size)\n        .data(data);\n\n    // // render\n    // container.datum(data).call(zoomChart);\n\n    // render\n    container.datum(data).call(zoomChart);\n    container.call(legend);\n    container.call(toolTip);\n}\nheatmapChart.plugin = {\n    name: \"Heatmap\",\n    category: \"Hierarchial Chart\",\n    max_cells: 50000,\n    max_columns: 500,\n    render_warning: true,\n    initial: {\n        names: [\"Color\"],\n    },\n};\n\nexport default heatmapChart;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { seriesCanvasOhlc } from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nconst ohlc = ohlcCandle(seriesCanvasOhlc);\nohlc.plugin = {\n    name: \"OHLC\",\n    category: \"Y Chart\",\n    max_cells: 3500,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Open\", \"Close\", \"High\", \"Low\", \"Tooltip\"],\n    },\n    selectMode: \"toggle\",\n};\n\nexport default ohlc;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { AxisFactoryContent, axisFactory } from \"../axis/axisFactory\";\nimport { chartCanvasFactory } from \"../axis/chartFactory\";\nimport { ohlcData } from \"../data/ohlcData\";\nimport { filterDataByGroup } from \"../legend/filter\";\nimport withGridLines from \"../gridlines/gridlines\";\n\nimport { hardLimitZeroPadding } from \"../d3fc/padding/hardLimitZero\";\nimport zoomableChart from \"../zoom/zoomableChart\";\nimport nearbyTip from \"../tooltip/nearbyTip\";\nimport { ohlcCandleSeries } from \"../series/ohlcCandleSeries\";\nimport { colorScale, setOpacity } from \"../series/seriesColors\";\nimport { colorLegend } from \"../legend/legend\";\nimport { Chart, HTMLSelection, Settings } from \"../types\";\n\nfunction ohlcCandle(seriesCanvas): Chart {\n    return function (container: HTMLSelection, settings: Settings) {\n        const srcData = ohlcData(settings, filterDataByGroup(settings));\n\n        const bollinger = fc\n            .indicatorBollingerBands()\n            .value((d) => d.openValue);\n        const data = srcData.map((seriesData) => {\n            const bollingerData = bollinger(seriesData);\n            return seriesData.map((d, i) =>\n                Object.assign({ bollinger: bollingerData[i] }, d)\n            );\n        });\n\n        const keys = srcData\n            .map((k) => k.key)\n            .concat(settings.hideKeys ? settings.hideKeys : [])\n            .sort();\n\n        const upColor = colorScale()\n            .domain(keys)\n            .settings(settings)\n            .mapFunction(setOpacity(1))();\n\n        const legend = colorLegend()\n            .settings(settings)\n            .scale(\n                keys.length > 1\n                    ? (upColor as unknown as d3.ScaleOrdinal<string, unknown>)\n                    : null\n            );\n\n        const series = ohlcCandleSeries(settings, seriesCanvas, upColor);\n\n        const multi = fc\n            .seriesCanvasMulti()\n            .mapping((data, index) => data[index])\n            .series(data.map(() => series));\n\n        const paddingStrategy = hardLimitZeroPadding()\n            .pad([0.1, 0.1])\n            .padUnit(\"percent\");\n\n        const xAxis: AxisFactoryContent = axisFactory(settings)\n            .settingName(\"crossValues\")\n            .valueName(\"crossValue\")(data);\n        const yAxis: AxisFactoryContent = axisFactory(settings)\n            .settingName(\"mainValues\")\n            .valueNames([\"lowValue\", \"highValue\"])\n            .memoValue(settings.axisMemo[1])\n            .orient(\"vertical\")\n            .paddingStrategy(paddingStrategy)(data);\n\n        const chart = chartCanvasFactory(xAxis, yAxis).plotArea(\n            withGridLines(multi, settings).orient(\"vertical\").canvas(true)\n        );\n\n        chart.yNice && chart.yNice();\n\n        const zoomChart = zoomableChart()\n            .chart(chart)\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .onChange((zoom) => {\n                const zoomedData = data.map((series) =>\n                    series.filter(\n                        (d) =>\n                            d.crossValue >= zoom.xDomain[0] &&\n                            d.crossValue <= zoom.xDomain[1]\n                    )\n                );\n                chart.yDomain(yAxis.domainFunction(zoomedData));\n            })\n            .canvas(true);\n\n        const toolTip = nearbyTip()\n            .settings(settings)\n            .xScale(xAxis.scale)\n            .yScale(yAxis.scale)\n            .yValueName(\"closeValue\")\n            .color(upColor)\n            .data(data)\n            .canvas(true);\n\n        // render\n        container.datum(data).call(zoomChart);\n        container.call(toolTip);\n        container.call(legend);\n    };\n}\n\nexport default ohlcCandle;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { labelFunction } from \"../axis/axisLabel\";\nimport { DataRowsWithKey, Settings } from \"../types\";\nimport { splitIntoMultiSeries } from \"./splitIntoMultiSeries\";\n\ntype MappedSeries = {\n    crossValue: any;\n    mainValues: any[];\n    openValue: any;\n    closeValue: any;\n    highValue: any;\n    lowValue: any;\n    key: string;\n    row: any;\n};\n\ninterface MappedSeriesArray extends Array<MappedSeries> {\n    key: string;\n}\n\nexport function ohlcData(settings: Settings, data: DataRowsWithKey) {\n    return splitIntoMultiSeries(settings, data, { excludeEmpty: true }).map(\n        (data) => seriesToOHLC(settings, data)\n    );\n}\n\nfunction seriesToOHLC(\n    settings: Settings,\n    data: DataRowsWithKey\n): MappedSeriesArray {\n    const labelfn = labelFunction(settings);\n    const getNextOpen = (i) =>\n        data[i < data.length - 1 ? i + 1 : i][settings.realValues[0]];\n    const mappedSeries: any = data.map((col, i) => {\n        const openValue = !!settings.realValues[0]\n            ? col[settings.realValues[0]]\n            : undefined;\n        const closeValue = !!settings.realValues[1]\n            ? col[settings.realValues[1]]\n            : getNextOpen(i);\n\n        return {\n            crossValue: labelfn(col, i),\n            mainValues: settings.mainValues.map((v) => col[v.name]),\n            openValue: openValue,\n            closeValue: closeValue,\n            highValue: !!settings.realValues[2]\n                ? col[settings.realValues[2]]\n                : Math.max(openValue as number, closeValue as number),\n            lowValue: !!settings.realValues[3]\n                ? col[settings.realValues[3]]\n                : Math.min(openValue as number, closeValue as number),\n            key: data.key,\n            row: col,\n        };\n    });\n\n    mappedSeries.key = data.key;\n    return mappedSeries;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as fc from \"d3fc\";\nimport { colorScale, setOpacity } from \"./seriesColors\";\nimport { D3Scale, Settings } from \"../types\";\n\nconst isUp = (d) => d.closeValue >= d.openValue;\n\nexport function ohlcCandleSeries(\n    settings: Settings,\n    seriesCanvas,\n    upColor: D3Scale\n) {\n    const domain = upColor.domain();\n    const downColor = colorScale()\n        .domain(domain)\n        .settings(settings)\n        .defaultColors([settings.colorStyles[\"series-2\"]])\n        .mapFunction(setOpacity(0.5))();\n    const avgColor = colorScale().settings(settings).domain(domain)();\n\n    const series = seriesCanvas()\n        .crossValue((d) => d.crossValue)\n        .openValue((d) => d.openValue)\n        .highValue((d) => d.highValue)\n        .lowValue((d) => d.lowValue)\n        .closeValue((d) => d.closeValue)\n        .decorate((context, d) => {\n            const color = isUp(d) ? upColor(d.key) : downColor(d.key);\n            context.fillStyle = color;\n            context.strokeStyle = color;\n        });\n\n    const bollingerAverageSeries = fc\n        .seriesCanvasLine()\n        .mainValue((d) => d.bollinger.average)\n        .crossValue((d) => d.crossValue)\n        .decorate((context, d) => {\n            context.strokeStyle = avgColor(d[0].key);\n        });\n\n    const bollingerAreaSeries = fc\n        .seriesCanvasArea()\n        .mainValue((d) => d.bollinger.upper)\n        .baseValue((d) => d.bollinger.lower)\n        .crossValue((d) => d.crossValue)\n        .decorate((context, d) => {\n            context.fillStyle = setOpacity(0.25)(avgColor(d[0].key));\n        });\n\n    return fc\n        .seriesCanvasMulti()\n        .series([bollingerAreaSeries, series, bollingerAverageSeries]);\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { seriesCanvasCandlestick } from \"d3fc\";\nimport ohlcCandle from \"./ohlcCandle\";\n\nlet candlestick = ohlcCandle(seriesCanvasCandlestick);\n\ncandlestick.plugin = {\n    name: \"Candlestick\",\n    category: \"Y Chart\",\n    max_cells: 4000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Open\", \"Close\", \"High\", \"Low\", \"Tooltip\"],\n    },\n    selectMode: \"toggle\",\n};\n\nexport default candlestick;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { treeColor } from \"../series/sunburst/sunburstColor\";\nimport { treeData } from \"../data/treeData\";\nimport {\n    SunburstData,\n    sunburstSeries,\n} from \"../series/sunburst/sunburstSeries\";\nimport { tooltip } from \"../tooltip/tooltip\";\nimport { gridLayoutMultiChart } from \"../layout/gridLayoutMultiChart\";\nimport { colorRangeLegend } from \"../legend/colorRangeLegend\";\nimport { colorLegend } from \"../legend/legend\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction sunburst(container: HTMLSelection, settings: Settings) {\n    const data = treeData(settings);\n    const color = treeColor(settings, data);\n    const sunburstGrid = gridLayoutMultiChart().elementsPrefix(\"sunburst\");\n\n    container.datum(data).call(sunburstGrid);\n\n    if (color) {\n        const color_column = settings.realValues[1];\n        if (\n            settings.mainValues.find((x) => x.name === color_column)?.type ===\n            \"string\"\n        ) {\n            const legend = colorLegend().settings(settings).scale(color);\n            container.call(legend);\n        } else {\n            const legend = colorRangeLegend().scale(color);\n            container.call(legend);\n        }\n    }\n\n    const sunburstContainer = sunburstGrid.chartContainer();\n    const sunburstEnter = sunburstGrid.chartEnter();\n    const sunburstDiv = sunburstGrid.chartDiv();\n    const sunburstTitle = sunburstGrid.chartTitle();\n    const containerSize = sunburstGrid.containerSize();\n\n    sunburstTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.split));\n\n    sunburstContainer\n        .append(\"circle\")\n        .attr(\"fill\", \"none\")\n        .style(\"pointer-events\", \"all\");\n\n    sunburstContainer.append(\"text\").attr(\"class\", \"parent\");\n    sunburstEnter\n        .merge(sunburstDiv)\n        .select(\"svg\")\n        .select(\"g.sunburst\")\n        .attr(\n            \"transform\",\n            `translate(${containerSize.width / 2}, ${containerSize.height / 2})`\n        )\n        .each(function ({\n            split,\n            data,\n        }: {\n            split: string;\n            data: SunburstData;\n        }) {\n            const sunburstElement = d3.select(this);\n            const svgNode: SVGElement = this.parentNode;\n            const { width, height } = svgNode.getBoundingClientRect();\n\n            const radius =\n                (Math.min(width, height) - 24) /\n                Math.max(2, settings.crossValues.length * 2);\n            sunburstSeries()\n                .settings(settings)\n                .split(split)\n                .data(data)\n                .color(color)\n                .radius(radius)(sunburstElement);\n\n            tooltip().settings(settings)(\n                sunburstElement.selectAll(\"g.segment\")\n            );\n        });\n}\n\nsunburst.plugin = {\n    name: \"Sunburst\",\n    category: \"Hierarchial Chart\",\n    max_cells: 7500,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"],\n    },\n};\n\nexport default sunburst;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { flattenExtent } from \"../../axis/flatten\";\nimport { seriesColorRange } from \"../seriesRange\";\nimport { seriesColorsFromDistinct } from \"../seriesColors\";\n\nexport function treeColor(settings, data) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        const color_column = settings.realValues[1];\n        if (\n            settings.mainValues.find((x) => x.name === color_column)?.type ===\n            \"string\"\n        ) {\n            const colors = data\n                .map((d) => d.data)\n                .filter((x) => x.height > 0)\n                .map((x) => getColors(x))\n                .reduce((a, b) => a.concat(b));\n            return seriesColorsFromDistinct(settings, colors);\n        } else {\n            return seriesColorRange(\n                settings,\n                null,\n                null,\n                flattenExtent(data.map((d) => d.extents))\n            );\n        }\n    }\n}\n\n// only get the colors from the bottom level (e.g. nodes with no children)\nfunction getColors(nodes, colors = []) {\n    nodes.children && nodes.children.length > 0\n        ? nodes.children.forEach((child) =>\n              colors.concat(getColors(child, colors))\n          )\n        : nodes.data.color && colors.push(nodes.data.color);\n    return colors;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { toValue } from \"../tooltip/selectionData\";\nimport { Settings } from \"../types\";\n\nexport type TreeData = {\n    name: string;\n    children: unknown;\n    size?: number;\n    color?: number;\n    tooltip?: unknown[];\n};\n\nexport function treeData(settings: Settings) {\n    const sets = {};\n    const real_aggs = settings.realValues.map((x) =>\n        x === null ? null : settings.mainValues.find((y) => y.name === x)\n    );\n    settings.data.forEach((d, j) => {\n        const groups = Array.isArray(d.__ROW_PATH__)\n            ? (d.__ROW_PATH__ as string[])\n            : [];\n\n        const splits = getSplitNames(d);\n        splits.forEach((split) => {\n            let currentLevel;\n            if (!sets[split]) {\n                sets[split] = [];\n            }\n            currentLevel = sets[split];\n            groups.forEach((group, i) => {\n                let element = currentLevel.find((e) => e.name === group);\n                if (!element) {\n                    element = { name: group, children: [] };\n                    currentLevel.push(element);\n                }\n                if (\n                    settings.realValues.length > 1 &&\n                    settings.realValues[1] !== null\n                ) {\n                    const is_leaf = i === groups.length - 1;\n                    const colorValue = is_leaf\n                        ? getDataValue(d, settings.mainValues[1], split)\n                        : getDataValue(\n                              settings.agg_paths[j][i + 1] || d,\n                              settings.mainValues[1],\n                              split\n                          );\n                    if (colorValue !== undefined) {\n                        element.color = colorValue;\n                    }\n                }\n                if (\n                    settings.realValues.length > 2 &&\n                    settings.realValues[2] !== null\n                ) {\n                    element.tooltip = [];\n                    for (let i = 2; i < settings.realValues.length; ++i) {\n                        element.tooltip.push(\n                            getDataValue(d, real_aggs[i], split)\n                        );\n                    }\n                }\n                if (i === groups.length - 1) {\n                    element.name = groups.slice(-1)[0];\n                    if (settings.crossValues.length === 0) {\n                        element.size = getDataValue(\n                            d,\n                            settings.mainValues[0],\n                            \"\"\n                        );\n                    } else if (groups.length === settings.crossValues.length) {\n                        const size = getDataValue(\n                            d,\n                            settings.mainValues[0],\n                            split\n                        );\n                        element.size = size > 0 ? size : 0;\n                    }\n                }\n                currentLevel = element.children;\n            });\n        });\n    });\n\n    const data = Object.entries(sets).map((set) => {\n        const tree: TreeData = {\n            name: \"root\",\n            children: set[1],\n        };\n\n        const root = d3.hierarchy(tree).sum((d) => d.size); // adds a `value` field to each node\n        const chartData: d3.HierarchyNode<TreeData> = d3\n            .partition<TreeData>()\n            .size([2 * Math.PI, root.height + 1])(root);\n\n        // \"d\" is a Node, but chartData is a HierarchyNode, and there is a couple of\n        // fields that are missing from the Node type.\n        // What is the best way to handle this? What is the actual type here??\n        (chartData as any).each((d) => {\n            d.current = d;\n            d.mainValues =\n                settings.realValues.length === 1 ||\n                (settings.realValues[1] === null &&\n                    settings.realValues[2] === null)\n                    ? d.value\n                    : [d.value, d.data.color]\n                          .concat(d.data.tooltip || [])\n                          .filter((x) => x !== undefined);\n\n            d.crossValue = d\n                .ancestors()\n                .slice(0, -1)\n                .reverse()\n                .map((cross) => cross.data.name);\n\n            d.key = set[0];\n            d.label = toValue(\n                settings.crossValues[d.depth - 1 < 0 ? 0 : d.depth - 1]?.type ||\n                    settings.mainValues[0].type,\n                d.data.name\n            );\n        });\n\n        return {\n            split: set[0],\n            data: chartData,\n            extents: getExtents(settings, set),\n        };\n    });\n\n    return data;\n}\n\nexport const getDataValue = (d, aggregate, split) =>\n    split.length ? d[`${split}|${aggregate.name}`] : d[aggregate.name];\n\nfunction getExtents(settings, [split, data]) {\n    if (settings.realValues.length > 1 && settings.realValues[1] !== null) {\n        const min = Math.min(\n            ...settings.data.map((d) =>\n                getDataValue(d, settings.mainValues[1], split)\n            )\n        );\n        const max = Math.max(...data.map((d) => d.color));\n        return [min, max];\n    }\n}\n\nfunction getSplitNames(d) {\n    const splits = [];\n    Object.keys(d).forEach((key) => {\n        if (key !== \"__ROW_PATH__\") {\n            const splitValue = key.split(\"|\").slice(0, -1).join(\"|\");\n            if (!splits.includes(splitValue)) {\n                splits.push(splitValue);\n            }\n        }\n    });\n    return splits;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { arc } from \"d3\";\nimport { SunburstData } from \"./sunburstSeries\";\n\nexport const drawArc = <D extends SunburstData>(radius) =>\n    arc<any, D>()\n        .startAngle((d) => d.x0)\n        .endAngle((d) => d.x1)\n        .padAngle((d) => Math.min((d.x1 - d.x0) / 2, 0.005))\n        .padRadius(radius)\n        .innerRadius((d) => Math.max(1, (d.y0 - 1) * radius))\n        .outerRadius((d) =>\n            Math.max((d.y0 - 1) * radius, (d.y1 - 1) * radius - 1)\n        );\n\nexport const arcVisible = (d) => d.y0 >= 1 && d.x1 > d.x0;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { select } from \"d3\";\n\nexport const labelVisible = (d) =>\n    d.y1 <= 3 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.06;\n\nexport function labelTransform(d, radius) {\n    const x = (((d.x0 + d.x1) / 2) * 180) / Math.PI;\n    const y = ((d.y0 - 1 + (d.y1 - 1)) / 2) * radius;\n    return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\n}\n\nexport function cropLabel(d, targetWidth) {\n    let actualWidth = this.getBBox().width;\n    if (actualWidth > targetWidth) {\n        let labelText = d.label;\n        const textSelection = select(this);\n        while (actualWidth > targetWidth) {\n            labelText = labelText.substring(0, labelText.length - 1);\n            textSelection.text(() => labelText);\n            actualWidth = this.getBBox().width;\n        }\n        textSelection.text(\n            () =>\n                `${labelText\n                    .substring(0, labelText.length - 3)\n                    .replace(/\\s+$/, \"\")}...`\n        );\n    }\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { interpolate } from \"d3\";\nimport { drawArc, arcVisible } from \"./sunburstArc\";\nimport { labelVisible, labelTransform } from \"./sunburstLabel\";\n\nexport const clickHandler =\n    (data, g, parent, parentTitle, path, label, radius, split, settings) =>\n    (p, skipTransition) => {\n        settings.sunburstLevel[split] = p.data.name;\n        if (p.parent) {\n            parent.datum(p.parent);\n            parent.style(\"cursor\", \"pointer\");\n            parentTitle.html(`&#8682; ${p.label}`);\n        } else {\n            parent.datum(data);\n            parent.style(\"cursor\", \"default\");\n            parentTitle.html(\"\");\n        }\n        data.each(\n            (d) =>\n                (d.target = {\n                    x0:\n                        Math.max(\n                            0,\n                            Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))\n                        ) *\n                        2 *\n                        Math.PI,\n                    x1:\n                        Math.max(\n                            0,\n                            Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))\n                        ) *\n                        2 *\n                        Math.PI,\n                    y0: Math.max(0, d.y0 - p.depth),\n                    y1: Math.max(0, d.y1 - p.depth),\n                })\n        );\n\n        const t = g.transition().duration(skipTransition ? 0 : 750);\n        path.transition(t)\n            .tween(\"data\", (d) => {\n                const i = interpolate(d.current, d.target);\n                return (t) => (d.current = i(t));\n            })\n            .filter(function (d) {\n                return (\n                    +this.getAttribute(\"fill-opacity\") || arcVisible(d.target)\n                );\n            })\n            .attr(\"fill-opacity\", (d) => (arcVisible(d.target) ? 1 : 0))\n            .attr(\"user-select\", (d) =>\n                arcVisible(d.target) ? \"initial\" : \"none\"\n            )\n            .style(\"pointer-events\", (d) =>\n                arcVisible(d.target) ? \"initial\" : \"none\"\n            )\n            .attrTween(\"d\", (d) => () => drawArc(radius)(d.current));\n\n        label\n            .filter(function (d) {\n                return (\n                    +this.getAttribute(\"fill-opacity\") || labelVisible(d.target)\n                );\n            })\n            .transition(t)\n            .attr(\"fill-opacity\", (d) => +labelVisible(d.target))\n            .attrTween(\n                \"transform\",\n                (d) => () => labelTransform(d.current, radius)\n            );\n    };\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { drawArc, arcVisible } from \"./sunburstArc\";\nimport { labelVisible, labelTransform, cropLabel } from \"./sunburstLabel\";\nimport { clickHandler } from \"./sunburstClick\";\nimport { D3Scale, Settings } from \"../../types\";\n\nexport interface SunburstData extends d3.HierarchyNode<any> {\n    children: this[];\n    crossValue: string[];\n    current: this;\n    data: {\n        name: string;\n        children: d3.HierarchyNode<any>[];\n    };\n    depth: number;\n    height: number;\n    key: string;\n    label: any; // is NaN, but should this be string?\n    mainValues: number;\n    parent: any;\n    value: number;\n    x0: number;\n    x1: number;\n    y0: number;\n    y1: number;\n}\n\nexport interface SunburstSeries {\n    (sunburstElement: any): void;\n\n    settings(): Settings;\n    settings(settings: Settings): SunburstSeries;\n\n    split(): string;\n    split(split: string): SunburstSeries;\n\n    data(): SunburstData;\n    data(data: SunburstData): SunburstSeries;\n\n    color(): D3Scale;\n    color(color: D3Scale): SunburstSeries;\n\n    radius(): number;\n    radius(radius: number): SunburstSeries;\n}\n\nexport function sunburstSeries(): SunburstSeries {\n    let settings: Settings | null = null;\n    let split: string | null = null;\n    let data: SunburstData | null = null;\n    let color: D3Scale | null = null;\n    let radius = null;\n\n    const _sunburstSeries: Partial<SunburstSeries> = (sunburstElement) => {\n        const segment = sunburstElement\n            .selectAll(\"g.segment\")\n            .data(data.descendants().slice(1));\n        const segmentEnter = segment\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"segment\");\n\n        segmentEnter.append(\"path\");\n        segmentEnter\n            .append(\"text\")\n            .attr(\"class\", \"segment\")\n            .attr(\"dy\", \"0.35em\");\n        const segmentMerge = segmentEnter.merge(segment);\n\n        const path = segmentMerge\n            .select(\"path\")\n            .attr(\"fill-opacity\", (d) => (arcVisible(d.current) ? 1 : 0))\n            .attr(\"user-select\", (d) =>\n                arcVisible(d.current) ? \"initial\" : \"none\"\n            )\n            .style(\"pointer-events\", (d) =>\n                arcVisible(d.current) ? \"initial\" : \"none\"\n            )\n            .attr(\"d\", (d) => drawArc(radius)(d.current));\n        color && path.style(\"fill\", (d) => color(d.data.color));\n\n        const label = segmentMerge\n            .select(\"text\")\n            .attr(\"fill-opacity\", (d) => +labelVisible(d.current))\n            .attr(\"transform\", (d) => labelTransform(d.current, radius))\n            .text((d) => d.label)\n            .each(function (d) {\n                cropLabel.call(this, d, radius);\n            });\n\n        const parentTitle = sunburstElement.select(\"text.parent\");\n        const parent = sunburstElement\n            .select(\"circle\")\n            .attr(\"r\", radius)\n            .datum(data);\n\n        const onClick = clickHandler(\n            data,\n            sunburstElement,\n            parent,\n            parentTitle,\n            path,\n            label,\n            radius,\n            split,\n            settings\n        );\n        // NOTE: Double check to make sure that settings.sunburstLevel is a thing.\n        if (settings.sunburstLevel) {\n            const currentLevel = data\n                .descendants()\n                .find((d) => d.data.name === settings.sunburstLevel[split]);\n            currentLevel && onClick(currentLevel, true);\n        } else {\n            settings.sunburstLevel = {};\n        }\n        parent.on(\"click\", (d) => onClick(d, false));\n        path.filter((d) => d.children)\n            .style(\"cursor\", \"pointer\")\n            .on(\"click\", (d) => onClick(d, false));\n    };\n\n    _sunburstSeries.settings = (...args: Settings[]): any => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.split = (...args: string[]): any => {\n        if (!args.length) {\n            return split;\n        }\n        split = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.data = (...args: SunburstData[]): any => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.color = (...args: D3Scale[]): any => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _sunburstSeries;\n    };\n\n    _sunburstSeries.radius = (...args: number[]): any => {\n        if (!args.length) {\n            return radius;\n        }\n        radius = args[0];\n        return _sunburstSeries;\n    };\n\n    return _sunburstSeries as SunburstSeries;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { treeColor } from \"../series/treemap/treemapColor\";\nimport { treeData } from \"../data/treeData\";\nimport { treemapSeries } from \"../series/treemap/treemapSeries\";\nimport { tooltip } from \"../tooltip/tooltip\";\nimport { gridLayoutMultiChart } from \"../layout/gridLayoutMultiChart\";\nimport { colorRangeLegend } from \"../legend/colorRangeLegend\";\nimport { colorLegend } from \"../legend/legend\";\nimport { HTMLSelection, Settings } from \"../types\";\n\nfunction treemap(container: HTMLSelection, settings: Settings) {\n    if (!settings.treemaps) settings.treemaps = {};\n\n    const data = treeData(settings);\n    const color = treeColor(\n        settings,\n        data.map((d) => d.data)\n    );\n\n    if (color) {\n        this._container.classList.add(\"has-legend\");\n    }\n\n    const treemapGrid = gridLayoutMultiChart().elementsPrefix(\"treemap\");\n    container.datum(data).call(treemapGrid);\n    if (color) {\n        const color_column = settings.realValues[1];\n        if (\n            settings.mainValues.find((x) => x.name === color_column)?.type ===\n            \"string\"\n        ) {\n            const legend = colorLegend().settings(settings).scale(color);\n            container.call(legend);\n        } else {\n            const legend = colorRangeLegend().scale(color);\n            container.call(legend);\n        }\n    }\n\n    const treemapEnter = treemapGrid.chartEnter();\n    const treemapDiv = treemapGrid.chartDiv();\n    const treemapTitle = treemapGrid.chartTitle();\n\n    treemapTitle.each((d, i, nodes) => d3.select(nodes[i]).text(d.split));\n    treemapEnter\n        .merge(treemapDiv)\n        .select(\"svg\")\n        .select(\"g.treemap\")\n        .each(function ({ split, data }: { split: string; data: any[] }) {\n            const treemapSvg = d3.select(this);\n\n            // Can't tell if TreemapValue type should have optional properties, which means\n            // that this setting of `{}` should have some default values on it.\n            if (!settings.treemaps[split]) settings.treemaps[split] = {};\n\n            treemapSeries()\n                .settings(settings.treemaps[split], settings)\n                .data(data)\n                .container(\n                    d3.select(d3.select(this.parentNode).node().parentNode)\n                )\n                .color(color)(treemapSvg);\n\n            tooltip().settings(settings).centered(true)(\n                treemapSvg.selectAll(\"g\")\n            );\n        });\n}\n\ntreemap.plugin = {\n    type: \"Treemap\",\n    name: \"Treemap\",\n    category: \"Hierarchial Chart\",\n    max_cells: 3000,\n    max_columns: 50,\n    render_warning: true,\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [\"Size\", \"Color\", \"Tooltip\"],\n    },\n};\nexport default treemap;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { seriesColorRange } from \"../seriesRange\";\nimport { seriesColorsFromDistinct } from \"../seriesColors\";\nimport { Settings } from \"../../types\";\nimport { TreeData } from \"../../data/treeData\";\n\nexport function treeColor(\n    settings: Settings,\n    data: d3.HierarchyNode<TreeData>[]\n) {\n    if (\n        settings.realValues.length < 1 ||\n        settings.realValues[1] === null ||\n        settings.realValues[1] === undefined\n    )\n        return;\n    const color_column = settings.realValues[1];\n    const colors = data\n        .filter((x) => x.height > 0)\n        .map((x) => getColors(x))\n        .reduce((a, b) => a.concat(b));\n    if (\n        settings.mainValues.find((x) => x.name === color_column)?.type ===\n        \"string\"\n    ) {\n        return seriesColorsFromDistinct(settings, colors);\n    } else {\n        let min = Math.min(...colors);\n        let max = Math.max(...colors);\n        return seriesColorRange(settings, null, null, [min, max]);\n    }\n}\n\n// only get the colors from the bottom level (e.g. nodes with no children)\nfunction getColors(nodes, colors = []) {\n    nodes.children && nodes.children.length > 0\n        ? nodes.children.forEach((child) =>\n              colors.concat(getColors(child, colors))\n          )\n        : nodes.data.color && colors.push(nodes.data.color);\n    return colors;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { select } from \"d3\";\nimport { isElementOverlapping, isElementOverflowing } from \"../../utils/utils\";\n\nconst minTextSize = 7;\n\nexport const labelMapExists = (d) =>\n    d.target && d.target.textAttributes ? true : false;\n\nexport const toggleLabels = (nodes, treemapLevel, crossValues) => {\n    nodes.selectAll(\"text\").each(function (d, i) {\n        const help = textLevelHelper(d, treemapLevel, crossValues);\n        this.style = help;\n    });\n\n    const visibleNodes = selectVisibleNodes(nodes);\n    centerLabels(visibleNodes);\n    preventTextCollisions(visibleNodes);\n};\n\nexport const restoreLabels = (nodes) => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        label\n            .attr(\"dx\", d.target.textAttributes.dx)\n            .attr(\"dy\", d.target.textAttributes.dy)\n            .attr(\"style\", d.target.textAttributes.style);\n    });\n};\n\nexport const preventTextCollisions = (nodes) => {\n    const textCollisionFuzzFactorPx = -2;\n    const textAdjustPx = 14; // This should remain the same as the css value for .top => font-size in the chart.less\n    const rect = (element): DOMRect => element.getBoundingClientRect();\n\n    const topNodes = [];\n    nodes\n        .selectAll(\"text\")\n        .filter(\n            (_, i, nodes) =>\n                select(nodes[i]).attr(\"style\") === textVisibility.high\n        )\n        .each((_, i, nodes) => topNodes.push(nodes[i]));\n\n    nodes\n        .selectAll(\"text\")\n        .filter(\n            (_, i, nodes) =>\n                select(nodes[i]).attr(\"style\") === textVisibility.low\n        )\n        .each((_, i, nodes) => {\n            const lowerNode = nodes[i];\n            topNodes\n                .filter(\n                    (topNode) =>\n                        isElementOverlapping(\n                            \"x\",\n                            rect(topNode),\n                            rect(lowerNode)\n                        ) &&\n                        isElementOverlapping(\n                            \"y\",\n                            rect(topNode),\n                            rect(lowerNode),\n                            textCollisionFuzzFactorPx\n                        )\n                )\n                .forEach(() =>\n                    select(lowerNode).attr(\n                        \"dy\",\n                        Number(select(lowerNode).attr(\"dy\")) + textAdjustPx\n                    )\n                );\n        });\n};\n\nexport const lockTextOpacity = (d) =>\n    select(d).style(\"opacity\", textOpacity[select(d).attr(\"class\")]);\n\nexport const unlockTextOpacity = (d) => select(d).style(\"opacity\", null);\n\nexport const textOpacity = { top: 1, mid: 0.7, lower: 0 };\n\nexport const selectVisibleNodes = (nodes) =>\n    nodes.filter(\n        (_, i, nodes) =>\n            select(nodes[i]).selectAll(\"text\").attr(\"style\") !==\n            textVisibility.zero\n    );\n\nexport const adjustLabelsThatOverflow = (nodes) =>\n    nodes.selectAll(\"text\").each((_, i, nodes) => shrinkOrHideText(nodes[i]));\n\nconst centerLabels = (nodes) =>\n    nodes.selectAll(\"text\").each((_, i, nodes) => centerText(nodes[i]));\n\nconst centerText = (d) => {\n    const nodeSelect = select(d);\n    const rect = d.getBoundingClientRect();\n    nodeSelect.attr(\"dx\", 0 - rect.width / 2).attr(\"dy\", 0 + rect.height / 4);\n};\n\n// WOuld be ideal to use IntersectionObserver here, but it does not support SVG\nconst shrinkOrHideText = (d) => {\n    const parent = d.parentNode;\n    const rect = parent.childNodes[0];\n\n    const textRect = d.getBBox();\n    const rectRect = rect.getBBox();\n\n    if (!needsToShrinkOrHide(d, rectRect, textRect)) {\n        select(d).attr(\"style\", select(d).attr(\"style\"));\n    }\n};\n\nconst needsToShrinkOrHide = (d, rectRect, textRect) => {\n    const resize_factor = Math.min(\n        rectRect.height / textRect.height,\n        rectRect.width / textRect.width\n    );\n\n    if (resize_factor < 1) {\n        const fontSize = parseInt(select(d).style(\"font-size\"));\n        const newFontSize = Math.floor(fontSize * resize_factor);\n        if (fontSize > minTextSize && newFontSize > minTextSize) {\n            select(d).style(\"font-size\", `${newFontSize}px`);\n            centerText(d);\n        } else {\n            select(d).style(\"font-size\", null);\n            select(d).style(\"opacity\", \"0\");\n        }\n        return true;\n    }\n    return false;\n};\n\nconst textLevelHelper = (d, treemapLevel, crossValues) => {\n    if (\n        !crossValues\n            .filter((x) => x !== \"\")\n            .every((x) => d.crossValue.includes(x))\n    )\n        return textVisibility.zero;\n    switch (d.depth) {\n        case treemapLevel + 1:\n            return textVisibility.high;\n        case treemapLevel + 2:\n            return textVisibility.low;\n        default:\n            return textVisibility.zero;\n    }\n};\n\nconst textVisibility = {\n    high: \"font-size:14px;z-index:5;pointer-events: none;\",\n    low: \"font-size:8px;opacity:0.7;z-index:4;\",\n    zero: \"font-size:0px;opacity:0;z-index:4;\",\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\n\nexport default (width: number, height: number): d3.TreemapLayout<unknown> => {\n    const treemapLayout = d3\n        .treemap()\n        .size([width, height])\n        .paddingInner((d) => 1 + 2 * (d.height - 1));\n\n    treemapLayout.tile(d3.treemapBinary);\n\n    return treemapLayout;\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport { calcWidth, calcHeight } from \"./treemapSeries\";\nimport {\n    labelMapExists,\n    toggleLabels,\n    preventTextCollisions,\n    lockTextOpacity,\n    unlockTextOpacity,\n    textOpacity,\n    selectVisibleNodes,\n    adjustLabelsThatOverflow,\n    restoreLabels,\n} from \"./treemapLabel\";\nimport { calculateSubTreeMap, saveLabelMap } from \"./treemapLevelCalculation\";\nimport { raiseEvent } from \"../../tooltip/selectionEvent\";\n\nexport function returnToLevel(\n    rects,\n    nodesMerge,\n    labels,\n    settings,\n    treemapDiv,\n    treemapSvg,\n    rootNode,\n    parentCtrls,\n    root_settings\n) {\n    if (settings.treemapLevel > 0) {\n        const crossValues = rootNode.crossValue;\n        executeTransition(\n            rootNode,\n            rects,\n            nodesMerge,\n            labels,\n            settings,\n            treemapDiv,\n            treemapSvg,\n            rootNode,\n            0,\n            crossValues,\n            parentCtrls,\n            root_settings,\n            1,\n            false\n        );\n\n        settings.treemapRoute\n            .slice(1, settings.treemapRoute.length)\n            .forEach((cv) => {\n                const d = nodesMerge.filter((d) => d.crossValue === cv).datum();\n                const crossValues = d.crossValue;\n                calculateSubTreeMap(\n                    d,\n                    crossValues,\n                    nodesMerge,\n                    d.depth,\n                    rootNode,\n                    treemapDiv\n                );\n                executeTransition(\n                    d,\n                    rects,\n                    nodesMerge,\n                    labels,\n                    settings,\n                    treemapDiv,\n                    treemapSvg,\n                    rootNode,\n                    d.depth,\n                    crossValues,\n                    parentCtrls,\n                    root_settings,\n                    1,\n                    false\n                );\n            });\n    }\n}\n\nexport function changeLevel(\n    d,\n    rects,\n    nodesMerge,\n    labels,\n    settings,\n    treemapDiv,\n    treemapSvg,\n    rootNode,\n    parentCtrls,\n    root_settings\n) {\n    if (!d.children) return;\n\n    if (settings.treemapLevel < d.depth) {\n        settings.treemapRoute.push(d.crossValue);\n    } else {\n        settings.treemapRoute.pop();\n    }\n\n    settings.treemapLevel = d.depth;\n\n    const crossValues = d.crossValue;\n\n    if (\n        !d.mapLevel[settings.treemapLevel] ||\n        !d.mapLevel[settings.treemapLevel].levelRoot\n    ) {\n        calculateSubTreeMap(\n            d,\n            crossValues,\n            nodesMerge,\n            settings.treemapLevel,\n            rootNode,\n            treemapDiv\n        );\n    }\n\n    executeTransition(\n        d,\n        rects,\n        nodesMerge,\n        labels,\n        settings,\n        treemapDiv,\n        treemapSvg,\n        rootNode,\n        settings.treemapLevel,\n        crossValues,\n        parentCtrls,\n        root_settings\n    );\n}\n\nfunction executeTransition(\n    d,\n    rects,\n    nodesMerge,\n    labels,\n    settings,\n    treemapDiv,\n    treemapSvg,\n    rootNode,\n    treemapLevel,\n    crossValues,\n    parentCtrls,\n    root_settings,\n    duration = 500,\n    recordLabelMap = true\n) {\n    const parent = d.parent;\n\n    const t = treemapSvg\n        .transition(\"main transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    nodesMerge.each((d) => (d.target = d.mapLevel[treemapLevel]));\n\n    if (!labelMapExists(d)) preventUserInteraction(nodesMerge, parentCtrls);\n\n    // hide hidden svgs\n    nodesMerge\n        .transition(t)\n        .tween(\"data\", (d) => {\n            const i = d3.interpolate(d.current, d.target);\n            return (t) => (d.current = i(t));\n        })\n        .styleTween(\"opacity\", (d) => () => d.current.opacity)\n        .attrTween(\n            \"pointer-events\",\n            (d) => () => d.target.visible ? \"all\" : \"none\"\n        );\n\n    rects\n        .transition(t)\n        .filter((d) => d.target.visible)\n        .styleTween(\"x\", (d) => () => `${d.current.x0}px`)\n        .styleTween(\"y\", (d) => () => `${d.current.y0}px`)\n        .styleTween(\"width\", (d) => () => `${d.current.x1 - d.current.x0}px`)\n        .styleTween(\"height\", (d) => () => `${d.current.y1 - d.current.y0}px`);\n\n    labels\n        .transition(t)\n        .filter((d) => d.target.visible)\n        .attrTween(\"x\", (d) => () => d.current.x0 + calcWidth(d.current) / 2)\n        .attrTween(\"y\", (d) => () => d.current.y0 + calcHeight(d.current) / 2)\n        .end()\n        .catch(() => enableUserInteraction(nodesMerge))\n        .then(() => {\n            if (!labelMapExists(d)) {\n                preventTextCollisions(visibleLabelNodes);\n                adjustLabelsThatOverflow(visibleLabelNodes);\n                fadeTextTransition(labels, treemapSvg, duration);\n                if (recordLabelMap) saveLabelMap(nodesMerge, treemapLevel);\n                enableUserInteraction(nodesMerge, parentCtrls);\n            }\n        })\n        .catch((ex) => {\n            console.error(\n                \"Exception completing promises after main transition\",\n                ex\n            );\n            enableUserInteraction(nodesMerge, parentCtrls);\n        });\n\n    if (!labelMapExists(d)) {\n        labels.each((_, i, labels) => lockTextOpacity(labels[i]));\n        toggleLabels(nodesMerge, treemapLevel, crossValues);\n    } else {\n        restoreLabels(nodesMerge);\n    }\n\n    const visibleLabelNodes = selectVisibleNodes(nodesMerge);\n\n    if (parent) {\n        parentCtrls\n            .hide(false)\n            .text(d.label)\n            .onClick(() => {\n                changeLevel(\n                    parent,\n                    rects,\n                    nodesMerge,\n                    labels,\n                    settings,\n                    treemapDiv,\n                    treemapSvg,\n                    rootNode,\n                    parentCtrls,\n                    root_settings\n                    // duration\n                );\n                const viewer = treemapDiv.node().getRootNode()\n                    .host.parentElement;\n                raiseEvent(viewer, parent, root_settings);\n            })();\n    } else {\n        parentCtrls.hide(true)();\n    }\n}\n\nasync function fadeTextTransition(labels, treemapSvg, duration = 400) {\n    const t = treemapSvg\n        .transition(\"text fade transition\")\n        .duration(duration)\n        .ease(d3.easeCubicOut);\n\n    await labels\n        .transition(t)\n        .filter((d) => d.target.visible)\n        .tween(\"data\", (d, i, labels) => {\n            const label = labels[i];\n            const interpolation = d3.interpolate(\n                lockedOpacity(d),\n                targetOpacity(label)\n            );\n            return (t) => (d.current.opacity = interpolation(t));\n        })\n        .styleTween(\"opacity\", (d) => () => d.current.opacity)\n        .end()\n        .catch((ex) => console.error(\"Exception in text fade transition\", ex))\n        .then(() =>\n            labels.each((_, i, labels) => unlockTextOpacity(labels[i]))\n        );\n}\n\nconst lockedOpacity = (d) => d.target.textLockedAt.opacity;\nconst targetOpacity = (d) => textOpacity[d3.select(d).attr(\"class\")];\n\nconst preventUserInteraction = (nodes, parentCtrls) => {\n    parentCtrls.deactivate(true);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.style(\"pointer-events\", \"none\");\n    });\n};\n\nconst enableUserInteraction = (nodes, parentCtrls = undefined) => {\n    if (parentCtrls) parentCtrls.deactivate(false);\n\n    nodes.each((_, i, nodes) => {\n        const rect = d3.select(nodes[i]).selectAll(\"rect\");\n        rect.style(\"pointer-events\", null);\n    });\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { calcWidth, calcHeight } from \"./treemapSeries\";\nimport { hierarchy, select } from \"d3\";\nimport treemapLayout from \"./treemapLayout\";\nimport { textOpacity } from \"./treemapLabel\";\n\nconst includesAllCrossValues = (d, crossValues) =>\n    crossValues.every((val) => d.crossValue.includes(val));\n\nexport function calculateSubTreeMap(\n    d,\n    crossValues,\n    nodesMerge,\n    treemapLevel,\n    rootNode,\n    treemapDiv\n) {\n    // We can approximate coordinates for most of the tree which will be shunted\n    // beyond the viewable area. This approach alone results in excessive\n    // margins as one goes deeper into the treemap.\n    approximateAttributesForAllNodes(\n        d,\n        crossValues,\n        nodesMerge,\n        treemapLevel,\n        rootNode\n    );\n    d.mapLevel[treemapLevel].levelRoot = true;\n    // Use the pre-existing d3 mechanism to calculate the subtree for the\n    // viewable area.\n    recalculateVisibleSubTreeCoordinates(\n        d,\n        treemapDiv.node().getBoundingClientRect().width,\n        treemapDiv.node().getBoundingClientRect().height,\n        treemapLevel\n    );\n\n    calculateTextOpacities(nodesMerge, treemapLevel);\n}\n\nexport function calculateRootLevelMap(nodesMerge, rootNode) {\n    nodesMerge.each((d) => {\n        d.mapLevel = [];\n        d.mapLevel[0] = {\n            x0: d.x0,\n            x1: calcWidth(d) + d.x0,\n            y0: d.y0,\n            y1: calcHeight(d) + d.y0,\n            visible: true,\n            opacity: 1,\n        };\n    });\n    rootNode.mapLevel[0].levelRoot = true;\n    calculateTextOpacities(nodesMerge, 0);\n}\n\nexport const saveLabelMap = (nodes, treemapLevel) => {\n    nodes.each((d, i, nodes) => {\n        const label = select(nodes[i]).selectAll(\"text\");\n        d.mapLevel[treemapLevel].textAttributes = {\n            dx: label.attr(\"dx\"),\n            dy: label.attr(\"dy\"),\n            class: label.attr(\"class\"),\n            \"font-size\": label.style(\"font-size\"),\n        };\n    });\n};\n\nfunction approximateAttributesForAllNodes(\n    d,\n    crossValues,\n    nodesMerge,\n    treemapLevel,\n    rootNode\n) {\n    const oldDimensions = {\n        x: d.x0,\n        y: d.y0,\n        width: d.x1 - d.x0,\n        height: d.y1 - d.y0,\n    };\n    const newDimensions = {\n        width: rootNode.x1 - rootNode.x0,\n        height: rootNode.y1 - rootNode.y0,\n    };\n    const dimensionMultiplier = {\n        width: newDimensions.width / oldDimensions.width,\n        height: newDimensions.height / oldDimensions.height,\n    };\n\n    nodesMerge.each((d) => {\n        const x0 = (d.x0 - oldDimensions.x) * dimensionMultiplier.width;\n        const y0 = (d.y0 - oldDimensions.y) * dimensionMultiplier.height;\n        const width = calcWidth(d) * dimensionMultiplier.width;\n        const height = calcHeight(d) * dimensionMultiplier.height;\n        const visible =\n            includesAllCrossValues(d, crossValues) &&\n            d.data.name !== crossValues[treemapLevel - 1];\n\n        d.mapLevel[treemapLevel] = {\n            x0,\n            x1: width + x0,\n            y0,\n            y1: height + y0,\n            visible,\n            opacity: visible ? 1 : 0,\n        };\n    });\n    d.mapLevel[treemapLevel].levelRoot = true;\n}\n\nfunction recalculateVisibleSubTreeCoordinates(\n    subTreeRoot,\n    treeRootWidth,\n    treeRootHeight,\n    treemapLevel\n) {\n    const treemapBlueprinter = treemapLayout(treeRootWidth, treeRootHeight);\n    const treemapBlueprint = treemapBlueprinter(\n        hierarchy(subTreeRoot.data).sum((d) => d.size)\n    );\n\n    const dummiedDescendants = treemapBlueprint.descendants();\n    const descendants = subTreeRoot.descendants();\n\n    dummiedDescendants.forEach((_, i) => {\n        descendants[i].mapLevel[treemapLevel].x0 = dummiedDescendants[i].x0;\n        descendants[i].mapLevel[treemapLevel].x1 = dummiedDescendants[i].x1;\n        descendants[i].mapLevel[treemapLevel].y0 = dummiedDescendants[i].y0;\n        descendants[i].mapLevel[treemapLevel].y1 = dummiedDescendants[i].y1;\n    });\n}\n\nfunction calculateTextOpacities(nodesMerge, treemapLevel) {\n    nodesMerge.selectAll(\"text\").each((_, i, nodes) => {\n        const text = select(nodes[i]);\n        const d: any = select(nodes[i]).datum();\n        const textVis = text.attr(\"class\");\n        d.mapLevel[treemapLevel].textLockedAt = {\n            opacity: textOpacity[textVis],\n        };\n    });\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { getOrCreateElement } from \"../../utils/utils\";\nimport template from \"../../../html/parent-controls.html\";\n\nexport function parentControls(container) {\n    let onClick = null;\n    let text = null;\n    let hide = true;\n    let deactivated = false;\n\n    const parent = getOrCreateElement(container, \".parent-controls\", () =>\n        container\n            .append(\"div\")\n            .attr(\"class\", \"parent-controls\")\n            .style(\"display\", hide ? \"none\" : \"\")\n            .html(template)\n    );\n\n    const controls = () => {\n        parent\n            .style(\"display\", hide ? \"none\" : \"\")\n            .select(\"#goto-parent\")\n            .style(\"pointer-events\", deactivated ? \"none\" : null)\n            .html(`\u21EA ${text}`)\n            .on(\"click\", () => onClick());\n    };\n\n    controls.deactivate = (...args) => {\n        if (!args.length) {\n            return deactivated;\n        }\n        deactivated = args[0];\n\n        const button = parent.select(\"#goto-parent\");\n        if (deactivated) {\n            button.style(\"pointer-events\", \"none\");\n        } else {\n            button.style(\"pointer-events\", null);\n        }\n\n        return controls;\n    };\n\n    controls.hide = (...args) => {\n        if (!args.length) {\n            return hide;\n        }\n        hide = args[0];\n        return controls;\n    };\n\n    controls.text = (...args) => {\n        if (!args.length) {\n            return text;\n        }\n        text = args[0];\n        return controls;\n    };\n\n    controls.onClick = (...args) => {\n        if (!args.length) {\n            return onClick;\n        }\n        onClick = args[0];\n        return controls;\n    };\n\n    return controls;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport {\n    toggleLabels,\n    adjustLabelsThatOverflow,\n    selectVisibleNodes,\n} from \"./treemapLabel\";\nimport treemapLayout from \"./treemapLayout\";\nimport { changeLevel, returnToLevel } from \"./treemapTransitions\";\nimport { parentControls } from \"./treemapControls\";\nimport { calculateRootLevelMap, saveLabelMap } from \"./treemapLevelCalculation\";\n\nexport const nodeLevel = {\n    leaf: \"leafnode\",\n    branch: \"branchnode\",\n    root: \"rootnode\",\n};\nexport const calcWidth = (d) => d.x1 - d.x0;\nexport const calcHeight = (d) => d.y1 - d.y0;\nconst isLeafNode = (maxDepth, d) => d.depth === maxDepth;\nconst nodeLevelHelper = (maxDepth, d) =>\n    d.depth === 0\n        ? nodeLevel.root\n        : isLeafNode(maxDepth, d)\n        ? nodeLevel.leaf\n        : nodeLevel.branch;\n\nexport function treemapSeries() {\n    let settings = null;\n    let root_settings = null;\n    let data = null;\n    let color = null;\n    let treemapDiv = null;\n    let parentCtrls = null;\n\n    const _treemapSeries = (treemapSvg) => {\n        parentCtrls = parentControls(treemapDiv);\n        parentCtrls();\n\n        const maxDepth = data.height;\n        if (!settings.treemapLevel) settings.treemapLevel = 0;\n        if (!settings.treemapRoute) settings.treemapRoute = [];\n        const treemap = treemapLayout(\n            treemapDiv.node().getBoundingClientRect().width,\n            treemapDiv.node().getBoundingClientRect().height\n        );\n        treemap(data);\n\n        const nodes = treemapSvg.selectAll(\"g\").data(data.descendants());\n        const nodesEnter = nodes.enter().append(\"g\");\n\n        nodesEnter.append(\"rect\");\n        nodesEnter.append(\"text\");\n\n        // Draw child nodes first\n        const nodesMerge = nodesEnter\n            .merge(nodes)\n            .sort((a, b) => b.depth - a.depth);\n\n        const rects = nodesMerge\n            .select(\"rect\")\n            .attr(\"class\", (d) => `treerect ${nodeLevelHelper(maxDepth, d)}`)\n            .style(\"x\", (d) => d.x0)\n            .style(\"y\", (d) => d.y0)\n            .style(\"width\", (d) => calcWidth(d))\n            .style(\"height\", (d) => calcHeight(d));\n\n        rects.style(\"fill\", (d) => {\n            if (nodeLevelHelper(maxDepth, d) === nodeLevel.leaf) {\n                if (d.data.color) {\n                    return color(d.data.color);\n                } else {\n                    return root_settings.colorStyles.series;\n                }\n            } else {\n                return \"transparent\";\n            }\n        });\n\n        const labels = nodesMerge\n            .filter((d) => d.value !== 0)\n            .select(\"text\")\n            .attr(\"x\", (d) => d.x0 + calcWidth(d) / 2)\n            .attr(\"y\", (d) => d.y0 + calcHeight(d) / 2)\n            .text((d) => d.label);\n\n        const rootNode = rects.filter((d) => d.crossValue.length === 0).datum();\n        calculateRootLevelMap(nodesMerge, rootNode);\n\n        toggleLabels(nodesMerge, 0, []);\n        adjustLabelsThatOverflow(selectVisibleNodes(nodesMerge));\n        saveLabelMap(nodesMerge, 0);\n\n        if (settings.treemapRoute.length === 0)\n            settings.treemapRoute.push(rootNode.crossValue);\n        rects\n            .filter((d) => d.children)\n            .on(\"click\", (_event, d) =>\n                changeLevel(\n                    d,\n                    rects,\n                    nodesMerge,\n                    labels,\n                    settings,\n                    treemapDiv,\n                    treemapSvg,\n                    rootNode,\n                    parentCtrls,\n                    root_settings\n                )\n            );\n\n        returnToLevel(\n            rects,\n            nodesMerge,\n            labels,\n            settings,\n            treemapDiv,\n            treemapSvg,\n            rootNode,\n            parentCtrls,\n            root_settings\n        );\n    };\n\n    _treemapSeries.settings = (...args) => {\n        if (!args.length) {\n            return settings;\n        }\n        settings = args[0];\n        root_settings = args[1];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.data = (...args) => {\n        if (!args.length) {\n            return data;\n        }\n        data = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.color = (...args) => {\n        if (!args.length) {\n            return color;\n        }\n        color = args[0];\n        return _treemapSeries;\n    };\n\n    _treemapSeries.container = (...args) => {\n        if (!args.length) {\n            return treemapDiv;\n        }\n        treemapDiv = args[0];\n        return _treemapSeries;\n    };\n\n    return _treemapSeries;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport barChart from \"./bar\";\nimport columnChart from \"./column\";\nimport lineChart from \"./line\";\nimport xyLine from \"./xy-line\";\nimport areaChart from \"./area\";\nimport yScatter from \"./y-scatter\";\nimport xyScatter from \"./xy-scatter\";\nimport heatmap from \"./heatmap\";\nimport ohlc from \"./ohlc\";\nimport candlestick from \"./candlestick\";\nimport sunburst from \"./sunburst\";\nimport treemap from \"./treemap\";\n\nimport { Chart } from \"../types\";\n\nconst chartClasses: Chart[] = [\n    barChart,\n    columnChart,\n    lineChart,\n    xyLine,\n    areaChart,\n    yScatter,\n    xyScatter,\n    ohlc,\n    candlestick,\n    treemap,\n    sunburst,\n    heatmap,\n];\n\nexport default chartClasses;\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as d3 from \"d3\";\nimport * as gparser from \"gradient-parser\";\nimport { ColorStyles, Settings } from \"../types\";\n\nexport const initialiseStyles = (\n    container: HTMLElement,\n    settings: Settings\n) => {\n    if (!settings.colorStyles) {\n        const styles: ColorStyles = {\n            scheme: [],\n            gradient: {},\n            interpolator: {},\n            grid: {},\n        };\n\n        const computed = computedStyle(container);\n        styles[\"series\"] = computed(`--d3fc-local-series`);\n        for (let i = 1; ; i++) {\n            const key = `series-${i}`;\n            const color = computed(`--d3fc-local-${key}`);\n            if (!color) {\n                break;\n            }\n\n            styles[key] = color;\n            styles.scheme.push(color);\n        }\n\n        styles.opacity = getOpacityFromColor(styles.series);\n        styles.grid.gridLineColor = computed`--d3fc-gridline--color`;\n\n        const gradients = [\"full\", \"positive\", \"negative\"];\n        gradients.forEach((g) => {\n            const gradient = computed(`--d3fc-local-${g}--gradient`);\n            styles.gradient[g] = parseGradient(gradient, styles.opacity);\n        });\n\n        settings.colorStyles = styles;\n    }\n\n    if (!settings.textStyles) {\n        const css = window.getComputedStyle(container);\n        const color = css.getPropertyValue(\"color\");\n        const font = `12px ${css.getPropertyValue(\"font-family\")}`;\n        settings.textStyles = { color, font };\n    }\n};\n\nconst getOpacityFromColor = (color) => {\n    return d3.color(color).opacity;\n};\n\nconst stepAsColor = (value, opacity) => {\n    const color = d3.color(`#${value}`);\n    color.opacity = opacity;\n    return color + \"\";\n};\n\nconst computedStyle = (container) => {\n    const containerStyles = getComputedStyle(container);\n    return (d) => containerStyles?.getPropertyValue(d);\n};\n\nconst parseGradient = (gradient, opacity) => {\n    const parsed = gparser.parse(gradient)[0].colorStops;\n    return parsed\n        .map((g, i) => [\n            g.length ? g.length.value / 100 : i / (parsed.length - 1),\n            stepAsColor(g.value, opacity),\n        ])\n        .sort((a, b) => a[0] - b[0]);\n};\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport \"./polyfills/index\";\nimport charts from \"../charts/charts\";\nimport { initialiseStyles } from \"../series/colorStyles\";\nimport style from \"../../../dist/css/perspective-viewer-d3fc.css\";\nimport { HTMLPerspectiveViewerElement } from \"@finos/perspective-viewer\";\nimport type * as psp_types from \"@finos/perspective-viewer\";\n\nimport * as d3 from \"d3\";\nimport { symbolsObj } from \"../series/seriesSymbols\";\nimport { Chart, Settings, Type } from \"../types\";\n\nconst DEFAULT_PLUGIN_SETTINGS = {\n    initial: {\n        type: \"number\",\n        count: 1,\n        names: [],\n    },\n    selectMode: \"select\",\n};\n\nconst styleWithD3FC = `${style}${getD3FCStyles()}`;\nconst EXCLUDED_SETTINGS = [\n    \"crossValues\",\n    \"mainValues\",\n    \"realValues\",\n    \"splitValues\",\n    \"filter\",\n    \"data\",\n    \"size\",\n    \"colorStyles\",\n    \"textStyles\",\n    \"agg_paths\",\n    \"treemaps\",\n    \"axisMemo\",\n    \"columns_config\",\n];\n\nfunction getD3FCStyles(): string {\n    const headerStyles = document\n        .querySelector(\"head\")\n        .querySelectorAll(\"style\");\n    const d3fcStyles = [];\n    headerStyles.forEach((s) => {\n        if (s.innerText.indexOf(\"d3fc-\") !== -1) {\n            d3fcStyles.push(s.innerText);\n        }\n    });\n    return d3fcStyles.join(\"\");\n}\n\nasync function register_element(plugin_name: string) {\n    const perspectiveViewerClass = customElements.get(\"perspective-viewer\");\n\n    await perspectiveViewerClass.registerPlugin(plugin_name);\n}\n\nexport function register(...plugin_names: string[]) {\n    const plugins = new Set(\n        plugin_names.length > 0\n            ? plugin_names\n            : charts.map((chart) => chart.plugin.name)\n    );\n    charts.forEach((chart) => {\n        if (plugins.has(chart.plugin.name)) {\n            const name = chart.plugin.name\n                .toLowerCase()\n                .replace(/[ \\t\\r\\n\\/]*/g, \"\");\n            const plugin_name = `perspective-viewer-d3fc-${name}`;\n            customElements.define(\n                plugin_name,\n                class extends HTMLElement {\n                    _chart: Chart | null;\n                    _settings: Settings | null;\n                    render_warning: boolean;\n                    _initialized: boolean;\n                    _container: HTMLElement;\n                    _staged_view;\n                    config;\n\n                    constructor() {\n                        super();\n                        this._chart = null;\n                        this._settings = null;\n                        this.render_warning = true;\n                    }\n\n                    connectedCallback() {\n                        if (!this._initialized) {\n                            this.attachShadow({ mode: \"open\" });\n                            this.shadowRoot.innerHTML = `<style>${styleWithD3FC}</style>`;\n                            this.shadowRoot.innerHTML += `<div id=\"container\" class=\"chart\"></div>`;\n                            this._container =\n                                this.shadowRoot.querySelector(\".chart\");\n                            this._initialized = true;\n                        }\n                    }\n\n                    get name() {\n                        return chart.plugin.name;\n                    }\n\n                    get category() {\n                        return chart.plugin.category;\n                    }\n\n                    get select_mode() {\n                        return chart.plugin.selectMode || \"select\";\n                    }\n\n                    get min_config_columns() {\n                        return (\n                            chart.plugin.initial?.count ||\n                            DEFAULT_PLUGIN_SETTINGS.initial.count\n                        );\n                    }\n\n                    get config_column_names() {\n                        return (\n                            chart.plugin.initial?.names ||\n                            DEFAULT_PLUGIN_SETTINGS.initial.names\n                        );\n                    }\n\n                    // get initial() {\n                    //     return chart.plugin.initial\n                    //        || DEFAULT_PLUGIN_SETTINGS.initial;\n                    // }\n\n                    get max_cells() {\n                        return chart.plugin.max_cells || 4000;\n                    }\n\n                    set max_cells(x) {\n                        chart.plugin.max_cells = x;\n                    }\n\n                    get max_columns() {\n                        return chart.plugin.max_columns || 50;\n                    }\n\n                    set max_columns(x) {\n                        chart.plugin.max_columns = x;\n                    }\n\n                    can_render_column_styles(type: Type, group: string) {\n                        return chart.can_render_column_styles?.call(\n                            this,\n                            type,\n                            group\n                        );\n                    }\n\n                    column_style_controls(type: Type, group: string) {\n                        return chart.column_style_controls?.call(\n                            this,\n                            type,\n                            group\n                        );\n                    }\n\n                    async render() {\n                        var canvas = document.createElement(\"canvas\");\n                        var container: HTMLElement =\n                            this.shadowRoot.querySelector(\"#container\");\n                        canvas.width = container.offsetWidth;\n                        canvas.height = container.offsetHeight;\n\n                        const context = canvas.getContext(\"2d\");\n                        context.fillStyle =\n                            window\n                                .getComputedStyle(this)\n                                .getPropertyValue(\"--plugin--background\") ||\n                            \"white\";\n                        context.fillRect(0, 0, canvas.width, canvas.height);\n                        const text_color = window\n                            .getComputedStyle(this)\n                            .getPropertyValue(\"color\");\n\n                        const svgs = Array.from(\n                            this.shadowRoot.querySelectorAll<SVGElement>(\n                                \"svg:not(#dragHandles)\"\n                            )\n                        );\n\n                        for (const svg of svgs.reverse()) {\n                            var img = document.createElement(\"img\");\n\n                            const defaultOffset = 0;\n                            img.width = svg.parentElement\n                                ? svg.parentElement.offsetWidth\n                                : defaultOffset;\n                            img.height = svg.parentElement\n                                ? svg.parentElement.offsetHeight\n                                : defaultOffset;\n\n                            // Pretty sure this is a chrome bug - `drawImage()` call\n                            // without this scales incorrectly.\n                            const new_svg = svg.cloneNode(true) as SVGElement;\n                            if (!new_svg.hasAttribute(\"viewBox\")) {\n                                new_svg.setAttribute(\n                                    \"viewBox\",\n                                    `0 0 ${img.width} ${img.height}`\n                                );\n                            }\n\n                            new_svg.setAttribute(\n                                \"xmlns\",\n                                \"http://www.w3.org/2000/svg\"\n                            );\n\n                            for (const text of new_svg.querySelectorAll(\n                                \"text\"\n                            )) {\n                                text.setAttribute(\"fill\", text_color);\n                            }\n\n                            var xml = new XMLSerializer().serializeToString(\n                                new_svg\n                            );\n\n                            xml = xml.replace(/[^\\x00-\\x7F]/g, \"\");\n\n                            const done = new Promise((x, y) => {\n                                img.onload = x;\n                                img.onerror = y;\n                            });\n\n                            try {\n                                img.src = `data:image/svg+xml;base64,${btoa(\n                                    xml\n                                )}`;\n                                await done;\n                            } catch (e) {\n                                const done = new Promise((x, y) => {\n                                    img.onload = x;\n                                    img.onerror = y;\n                                });\n                                img.src = `data:image/svg+xml;utf8,${xml}`;\n                                await done;\n                            }\n\n                            context.drawImage(\n                                img,\n                                (svg.parentNode as HTMLElement).offsetLeft,\n                                (svg.parentNode as HTMLElement).offsetTop,\n                                img.width,\n                                img.height\n                            );\n                        }\n\n                        const canvases = Array.from(\n                            this.shadowRoot.querySelectorAll(\"canvas\")\n                        );\n\n                        for (const canvas of canvases.reverse()) {\n                            context.drawImage(\n                                canvas,\n                                (canvas.parentNode as HTMLElement).offsetLeft,\n                                (canvas.parentNode as HTMLElement).offsetTop,\n                                canvas.width / window.devicePixelRatio,\n                                canvas.height / window.devicePixelRatio\n                            );\n                        }\n\n                        return await new Promise(\n                            (x) => canvas.toBlob((blob) => x(blob)),\n                            // @ts-ignore\n                            \"image/png\" // uhhhh, what is going on here?\n                        );\n                    }\n\n                    async draw(view, end_col, end_row) {\n                        if (this.offsetParent === null) {\n                            this._staged_view = [view, end_col, end_row];\n                            return;\n                        }\n\n                        this._staged_view = undefined;\n                        if (this._settings) {\n                            this._settings.axisMemo = [\n                                [Infinity, -Infinity],\n                                [Infinity, -Infinity],\n                            ];\n                        }\n\n                        await this.update(view, end_col, end_row, true);\n                    }\n\n                    async update(view, end_col, end_row, clear = false) {\n                        if (this.offsetParent === null) {\n                            return;\n                        }\n\n                        const viewer = this\n                            .parentElement as HTMLPerspectiveViewerElement;\n                        let jsonp, metadata;\n                        const leaves_only = chart.plugin.name !== \"Sunburst\";\n                        if (end_col && end_row) {\n                            jsonp = view.to_columns_string({\n                                end_row,\n                                end_col,\n                                leaves_only,\n                            });\n                        } else if (end_col) {\n                            jsonp = view.to_columns_string({\n                                end_col,\n                                leaves_only,\n                            });\n                        } else if (end_row) {\n                            jsonp = view.to_columns_string({\n                                end_row,\n                                leaves_only,\n                            });\n                        } else {\n                            jsonp = view.to_columns_string({ leaves_only });\n                        }\n\n                        metadata = await Promise.all([\n                            viewer.save(),\n                            viewer.getTable().then((table) => table.schema()),\n                            view.expression_schema(false),\n                            view.schema(false),\n                            jsonp,\n                            view.get_config(),\n                        ]);\n                        let [\n                            real_config,\n                            table_schema,\n                            expression_schema,\n                            view_schema,\n                            json_string,\n                            config,\n                        ] = metadata;\n\n                        let json2 = JSON.parse(json_string);\n                        const keys = Object.keys(json2);\n                        let json = {\n                            row(ridx) {\n                                const obj: { __ROW_PATH__?: any[] } = {};\n                                for (const name of keys) {\n                                    obj[name] = json2[name][ridx];\n                                }\n\n                                return obj;\n                            },\n                        };\n\n                        this.config = real_config;\n                        const realValues = this.config.columns;\n\n                        /**\n                         * Retrieve a tree axis column from the table and\n                         * expression schemas, returning a String type or\n                         * `undefined`.\n                         * @param {String} column a column name\n                         */\n                        const get_pivot_column_type = function (column) {\n                            let type = table_schema[column];\n                            if (!type) {\n                                type = expression_schema[column];\n                            }\n                            return type;\n                        };\n\n                        const { columns, group_by, split_by, filter } = config;\n                        const first_col = json2[Object.keys(json2)[0]] || [];\n                        const filtered =\n                            group_by.length > 0\n                                ? first_col.reduce(\n                                      (acc, _, idx) => {\n                                          const col = json.row(idx);\n                                          if (\n                                              col.__ROW_PATH__ &&\n                                              col.__ROW_PATH__.length ==\n                                                  group_by.length\n                                          ) {\n                                              acc.agg_paths.push(\n                                                  acc.aggs.slice()\n                                              );\n                                              acc.rows.push(col);\n                                          } else {\n                                              const len =\n                                                  col.__ROW_PATH__.filter(\n                                                      (x) => x !== undefined\n                                                  ).length;\n                                              acc.aggs[len] = col;\n                                              acc.aggs = acc.aggs.slice(\n                                                  0,\n                                                  len + 1\n                                              );\n                                          }\n                                          return acc;\n                                      },\n                                      { rows: [], aggs: [], agg_paths: [] }\n                                  )\n                                : {\n                                      rows: first_col.map((_, idx) =>\n                                          json.row(idx)\n                                      ),\n                                  };\n\n                        const dataMap = (col, i) =>\n                            !group_by.length\n                                ? { ...col, __ROW_PATH__: [i] }\n                                : col;\n                        const mapped = filtered.rows.map(dataMap);\n\n                        let settings = {\n                            realValues,\n                            crossValues: group_by.map((r) => ({\n                                name: r,\n                                type: get_pivot_column_type(r),\n                            })),\n                            mainValues: columns.map((a) => ({\n                                name: a,\n                                type: view_schema[a],\n                            })),\n                            splitValues: split_by.map((r) => ({\n                                name: r,\n                                type: get_pivot_column_type(r),\n                            })),\n                            filter,\n                            data: mapped,\n                            agg_paths: filtered.agg_paths,\n                            ...this.config.plugin_config,\n                        };\n\n                        this._chart = chart;\n\n                        const handler = {\n                            set: (obj, prop, value) => {\n                                if (!EXCLUDED_SETTINGS.includes(prop)) {\n                                    this._container &&\n                                        this._container.dispatchEvent(\n                                            new Event(\n                                                \"perspective-plugin-update\",\n                                                {\n                                                    bubbles: true,\n                                                    composed: true,\n                                                }\n                                            )\n                                        );\n                                }\n                                obj[prop] = value;\n                                return true;\n                            },\n                        };\n\n                        const axisMemo = [\n                            [Infinity, -Infinity],\n                            [Infinity, -Infinity],\n                        ];\n\n                        this._settings = new Proxy(\n                            {\n                                axisMemo,\n                                ...this._settings,\n                                ...settings,\n                            },\n                            handler\n                        );\n\n                        // If only a right-axis Y axis remains, reset the alt\n                        // axis list to default.\n                        if (\n                            this._settings.splitMainValues &&\n                            this._settings.splitMainValues.length >=\n                                columns.length\n                        ) {\n                            this._settings.splitMainValues = [];\n                        }\n\n                        initialiseStyles(this._container, this._settings);\n\n                        if (clear) {\n                            this._container.innerHTML = \"\";\n                        }\n\n                        this._draw();\n\n                        await new Promise((resolve) =>\n                            requestAnimationFrame(resolve)\n                        );\n                    }\n\n                    async clear() {\n                        if (this._container) {\n                            this._container.innerHTML = \"\";\n                        }\n                    }\n\n                    _draw() {\n                        if (this.offsetParent !== null) {\n                            const containerDiv = d3.select(this._container);\n                            const chartClass = `chart ${name}`;\n                            this._settings.size =\n                                this._container.getBoundingClientRect();\n\n                            if (this._settings.data.length > 0) {\n                                this._chart(\n                                    containerDiv.attr(\"class\", chartClass),\n                                    this._settings\n                                );\n                            } else {\n                                containerDiv.attr(\n                                    \"class\",\n                                    `${chartClass} disabled`\n                                );\n                            }\n                        }\n                    }\n\n                    /**\n                     * TODO we need to `clear()` here unnecessarily due to a bug in the tremap module which\n                     * causes non-cleared redraws duplicate column labels when calculating column name\n                     * resize/repositions - see `treemapLabel.js`.\n                     */\n                    async resize(view) {\n                        if (this.offsetParent !== null) {\n                            if (this._settings?.data !== undefined) {\n                                this._draw();\n                            } else {\n                                const [view, end_col, end_row] =\n                                    this._staged_view;\n                                this._staged_view = undefined;\n                                this.draw(view, end_col, end_row);\n                            }\n                        }\n                    }\n\n                    async restyle(view, _end_col, _end_row) {\n                        let settings = this._settings;\n                        if (settings) {\n                            delete settings[\"colorStyles\"];\n                            delete settings[\"textStyles\"];\n                            if (this.isConnected) {\n                                initialiseStyles(\n                                    this._container,\n                                    this._settings\n                                );\n                                this.resize(view);\n                            }\n                        }\n                    }\n\n                    async delete() {\n                        this._container.innerHTML = \"\";\n                    }\n\n                    getContainer() {\n                        return this._container;\n                    }\n\n                    save() {\n                        const settings = { ...this._settings };\n                        EXCLUDED_SETTINGS.forEach((s) => {\n                            delete settings[s];\n                        });\n                        return settings;\n                    }\n\n                    restore(\n                        settings: Settings,\n                        columns_config: psp_types.ColumnConfigValues\n                    ) {\n                        const new_settings: Partial<Settings> = {};\n                        for (const name of EXCLUDED_SETTINGS) {\n                            if (this._settings?.[name] !== undefined) {\n                                new_settings[name] = this._settings?.[name];\n                            }\n                        }\n                        this._settings = {\n                            ...new_settings,\n                            ...settings,\n                            columns_config,\n                        };\n                    }\n                }\n            );\n\n            customElements\n                .whenDefined(\"perspective-viewer\")\n                .then(() => register_element(plugin_name));\n        }\n    });\n}\n\nif (!Element.prototype.matches) {\n    Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport { register } from \"../plugin/plugin.js\";\nregister(\"OHLC\");\n"],
  "mappings": "6FAYK,QAAQ,UAAU,UACnB,QAAQ,UAAU,QACd,QAAQ,UAAU,mBAClB,QAAQ,UAAU,uBCHrB,QAAQ,UAAU,UACnB,QAAQ,UAAU,QACd,QAAQ,UAAU,mBAClB,QAAQ,UAAU,uBAGrB,QAAQ,UAAU,UACnB,QAAQ,UAAU,QAAU,SAE1BA,EAAgC,CAC9B,IAAIC,EAAK,KAET,EAAG,CACC,GAAIA,EAAG,QAAQD,CAAC,EAAG,OAAOC,EAC1BA,EAAKA,EAAG,eAAiBA,EAAG,UAChC,OAASA,IAAO,MAAQA,EAAG,WAAa,GACxC,OAAO,IACX,GCjBJ,UAAYC,OAAQ,OCApB,UAAYC,OAAQ,OCEb,IAAMC,EAAa,CACtB,KAAM,OACN,QAAS,UACT,KAAM,OACN,OAAQ,QACZ,EAiBaC,GAAYC,GAAiC,CACtD,IAAIC,EAAc,cACdC,EAAe,KACfC,EAAc,KAEZC,EAA6B,IAAgC,CAC/D,IAAMC,EAAcC,GAAU,CAC1B,IAAMC,EAAOL,EACPF,EAASC,GAAa,OAAQ,GAAMC,GAAgB,EAAE,IAAI,EAC1DF,EAASC,GAEf,OAAIA,GAAe,eAAiBM,EAAK,OAAS,EAGvC,GAGJA,EAAK,KAAM,GAAMD,EAAM,SAAS,EAAE,IAAI,CAAC,CAClD,EAEA,OAAIN,EAASC,GAAa,SAAW,EAC1BH,EAAW,KAElBK,GAAeL,EAAW,MAC1BO,EAAW,CAAC,WAAY,MAAM,CAAC,EAExBP,EAAW,KAElBK,GAAeL,EAAW,QAC1BO,EAAW,CAAC,UAAW,OAAO,CAAC,GAK/BF,GAAeL,EAAW,QACnBA,EAAW,OAEfA,EAAW,OACtB,EAEA,OAAAM,EAAQ,YAAc,IAAII,IACjBA,EAAK,QAGVP,EAAcO,EAAK,GACZJ,GAHIH,EAMfG,EAAQ,aAAe,IAAII,IAClBA,EAAK,QAIVN,EAAeM,EAAK,GACbJ,GAJIF,EAOfE,EAAQ,YAAc,IAAII,IACjBA,EAAK,QAGVL,EAAcK,EAAK,GACZJ,GAHID,EAMRC,CACX,ECtGA,IAAAK,GAAA,GAAAC,GAAAD,GAAA,YAAAE,GAAA,kBAAAC,GAAA,UAAAC,KAYA,UAAYC,OAAQ,KCAb,IAAMC,GAAiBC,GAAmC,CAC7D,IAAMC,EAAiBC,GAAO,CAACC,EAAGC,IAC1BD,IAAM,OAAkBC,EACxBA,IAAM,OAAkBD,EACrBD,EAAGC,EAAGC,CAAC,EAElB,OAAOJ,EAAM,OACT,CAACK,EAAGC,IAAM,CACNL,EAAc,KAAK,GAAG,EAAEI,EAAE,GAAIC,EAAE,EAAE,EAClCL,EAAc,KAAK,GAAG,EAAEI,EAAE,GAAIC,EAAE,EAAE,CACtC,EACA,CAAC,OAAW,MAAS,CACzB,CACJ,EAEaC,GAAgBP,GACrB,MAAM,QAAQA,CAAK,EACZA,EAAM,KAAK,GAAQ,EAEnB,CAACA,CAAK,ECnBrB,OAAS,aAAAQ,OAAiB,OAE1B,IAAMC,GAAgB,EAUfC,GAASC,GAAgD,CAC5D,IAAMC,EAAuCC,GAClCF,EAAQE,CAAG,EAGtB,OAAAL,GAAUI,EAAcD,CAAO,EAE/BC,EAAa,UAAY,IAAIE,IACpBA,EAAK,QAMVH,EAAQ,UAAU,GAAGG,CAAI,EAClBF,GANI,KAAK,IAAID,EAAQ,UAAU,EAAGF,EAAa,EASnDG,CACX,EC/BA,OAAS,aAAAG,OAAiB,OAE1B,IAAOC,GAASC,GAAY,CACxB,IAAMC,EAAgBC,GACXF,EAAQE,CAAG,EAGtB,OAAAJ,GAAUG,EAAcD,CAAO,EAE/BC,EAAa,MAAQ,UAAY,CAC7B,MAAO,CAAC,CACZ,EAEOA,CACX,EHRO,IAAME,GAAQ,IAAMC,GAAaC,GAAgB,aAAU,CAAC,CAAC,EAEvDC,GAAS,IAAc,CAChC,IAAIC,EAAa,CAAC,YAAY,EAC1BC,EAAS,aAEPC,EAA4BC,GAAgB,CAC9C,IAAMC,EAAgBC,GAAaF,CAAI,EACvC,OAAOG,EAAgB,CACnB,GAAG,IAAI,IAAIF,EAAc,IAAKG,GAAMA,EAAEP,EAAW,GAAG,CAAC,CACzD,CAAC,CACL,EAEMM,EAAmBC,GAAON,GAAU,WAAaM,EAAE,QAAQ,EAAIA,EAErE,OAAAL,EAAQ,UAAY,IAAIM,IACfA,EAAK,QAGVR,EAAa,CAACQ,EAAK,EAAE,EACdN,GAHIF,EAAW,GAM1BE,EAAQ,WAAa,IAAIM,IAChBA,EAAK,QAGVR,EAAaQ,EAAK,GACXN,GAHIF,EAMfE,EAAQ,OAAS,IAAIM,IACZA,EAAK,QAGVP,EAASO,EAAK,GACPN,GAHID,EAMRC,CACX,EAEaO,GAAiBC,GAAeH,GAAMA,EAAEG,GAAW,KAAK,GAAG,EI5DxE,IAAAC,GAAA,GAAAC,GAAAD,GAAA,eAAAE,GAAA,WAAAC,GAAA,kBAAAC,GAAA,UAAAC,GAAA,uBAAAC,KAYA,UAAYC,OAAQ,KACpB,UAAYC,MAAQ,OCDpB,UAAYC,OAAa,WCElB,IAAMC,GAAiB,IAAuB,CACjD,IAAIC,EAAM,CAAC,EAAG,CAAC,EACXC,EAAmB,UAEjBC,EAAqCC,GAAW,CAClD,OAAQF,OACC,SAAU,CACXE,EAAO,IAAMH,EAAI,GACjBG,EAAO,IAAMH,EAAI,GACjB,KACJ,KACK,UAAW,CACZ,IAAII,EAAQD,EAAO,GAAKA,EAAO,GAC/BA,EAAO,IAAMH,EAAI,GAAKI,EACtBD,EAAO,IAAMH,EAAI,GAAKI,EACtB,KACJ,SAEI,MAAM,IAAI,MAAM,oBAAsBH,CAAO,EAErD,OAAOE,CACX,EAEA,OAAAD,EAAQ,IAAM,YAAaG,EAAkB,CACzC,OAAKA,EAAK,QAIVL,EAAMK,EAAK,GAEJH,GALIF,CAMf,EAEAE,EAAQ,QAAU,YAAaG,EAAsB,CACjD,OAAKA,EAAK,QAIVJ,EAAUI,EAAK,GAERH,GALID,CAMf,EAEOC,CACX,EDpBO,IAAMI,GAAe,UAA0B,CAClD,IAAIC,EAAY,CACZ,SAAUC,EAAG,CACT,OAAOA,CACX,CACJ,EACIC,EAAkC,KAClCC,EAAoB,CAAC,EACrBC,EAAkBC,GAAe,EAE/BC,EAAkC,SACpCC,EACe,CACf,IAAIC,EAAS,IAAI,MAAMD,EAAK,MAAM,EAC9BE,EAA4B,GAC5BC,EAAoB,GACpBC,EAEAC,EAAYZ,EAAU,OAAO,UAAU,EAC3C,GAAI,CACA,QACQa,EACJ,EAAEJ,GAA6BI,EAAQD,EAAU,KAAK,GAAG,MACzDH,EAA4B,GAC9B,CACE,IAAIK,EAAWD,EAAM,MAErB,QAASE,EAAI,EAAGA,EAAIR,EAAK,OAAQQ,IAAK,CAClC,IAAIC,EAAQF,EAASP,EAAKQ,GAAIA,CAAC,EAC3B,MAAM,QAAQC,CAAK,EACnBR,EAAO,KAAK,MAAMA,EAAQS,GAAkBD,CAAK,CAAC,EAElDR,EAAO,KAAKQ,CAAK,CAEzB,CACJ,CACJ,OAASE,EAAP,CACER,EAAoB,GACpBC,EAAiBO,CACrB,QAAE,CACE,GAAI,CACI,CAACT,GAA6BG,EAAU,QACxCA,EAAU,OAAO,CAEzB,QAAE,CACE,GAAIF,EACA,MAAMC,CAEd,CACJ,CAEA,IAAIQ,EAAY,CAAS,OAAIX,CAAM,EAAW,OAAIA,CAAM,CAAC,EAezD,GAbAW,EAAU,GACNA,EAAU,IAAM,KACF,OAAIhB,CAAO,EACX,OACJ,CAACgB,EAAU,EAAE,EAAE,OAAOF,GAAkBd,CAAO,CAAC,CACpD,EACVgB,EAAU,GACNA,EAAU,IAAM,KACF,OAAIhB,CAAO,EACX,OACJ,CAACgB,EAAU,EAAE,EAAE,OAAOF,GAAkBd,CAAO,CAAC,CACpD,EAEND,GAAoB,KAAM,CAC1B,IAAIkB,EAAY,KAAK,IACjB,KAAK,IAAID,EAAU,GAAKjB,CAAgB,EACxC,KAAK,IAAIiB,EAAU,GAAKjB,CAAgB,CAC5C,EACAiB,EAAU,GAAKjB,EAAmBkB,EAClCD,EAAU,GAAKjB,EAAmBkB,CACtC,CAEA,OAAOhB,EAAgBe,CAAS,CACpC,EAEA,OAAAb,EAAS,UAAY,UAAY,CAC7B,OAAK,UAAU,QAGfN,EAAY,UAAU,QAAU,EAAI,OAAY,UAAU,GACnDM,GAHIN,CAIf,EAIAM,EAAS,IAAM,YAAae,EAAkB,CAC1C,OAAKA,EAAK,QAIVjB,EAAgB,IAAIiB,EAAK,EAAE,EAEpBf,GALIF,EAAgB,GAM/B,EAIAE,EAAS,QAAU,YAAae,EAAsB,CAClD,OAAKA,EAAK,QAIVjB,EAAgB,QAAQiB,EAAK,EAAE,EAExBf,GALIF,EAAgB,OAM/B,EAEAE,EAAS,QAAU,YAAae,EAAuB,CACnD,OAAKA,EAAK,QAIVlB,EAAUkB,EAAK,GAERf,GALIH,CAMf,EAEAG,EAAS,iBAAmB,YAAae,EAA+B,CACpE,OAAKA,EAAK,QAIVnB,EAAmBmB,EAAK,GAEjBf,GALIJ,CAMf,EAEAI,EAAS,gBAAkB,YAAae,EAA8B,CAClE,OAAKA,EAAK,QAIVjB,EAAkBiB,EAAK,GAEhBf,GALIF,CAMf,EAEOE,CACX,EAEIW,GAAoB,SAAUK,EAAK,CACnC,GAAI,MAAM,QAAQA,CAAG,EAAG,CACpB,IAAIC,EAAO,MAAMD,EAAI,MAAM,EAC3B,QAASP,EAAI,EAAGA,EAAIO,EAAI,OAAQP,IAC5BQ,EAAKR,GAAKO,EAAIP,GAElB,OAAOQ,CACX,KACI,QAAO,MAAM,KAAKD,CAAG,CAE7B,EEnLA,UAAYE,OAAQ,KAEpB,IAAMC,GAAS,IAEFC,GAA4B,CAACC,EAAaC,IAAgB,CACnE,IAAIC,EAAY,KAAK,KAAK,KAAK,IAAI,KAAK,MAAMD,EAAMD,CAAG,CAAC,CAAC,EAAI,EAE7D,OAAQG,GACG,KAAK,IAAIA,CAAC,GAAKL,GACb,UAAO,KAAK,EAAEK,CAAC,EAClB,OAAO,UAAUA,CAAC,EACf,UAAO,MAAM,EAAEA,CAAC,EAChB,UAAO,KAAKD,IAAY,EAAEC,CAAC,CAE5C,ECZO,SAASC,GAAgBC,EAAuB,CACnD,OAAOA,EAAQ,YAAY,EAAE,IACjC,CAEO,SAASC,GAAkBD,EAAsB,CACpD,OAAOA,EAAQ,QAAQ,kBAAkB,CAC7C,CJOO,IAAME,GAAQ,IAAS,eAAY,EAE7BC,GAAS,IAAc,CAChC,IAAMC,EAAOC,GAAa,EAAE,IAAI,CAAC,EAAG,EAAG,CAAC,EAAE,QAAQ,SAAS,EAEvDC,EAA0B,CAAC,YAAY,EAErCC,EAAgBC,IAClBJ,EAAK,UAAUE,EAAW,IAAKG,GAAOC,GAAM,WAAWA,EAAED,EAAE,CAAC,CAAC,EAEtDE,EAAcC,GAAaJ,CAAI,CAAC,GAGxC,YAAUD,EAASH,CAAI,EAE1B,IAAMS,EAAiBL,GAAS,CAC5B,IAAMM,EAAOR,EAAW,IAAKS,GACzBP,EACK,IAAKE,GAAMA,EAAEK,EAAU,EACvB,KAAK,CAACC,EAAGC,IAAMD,EAAIC,CAAC,EACpB,OAAO,CAACP,EAAGQ,EAAGF,IAAME,IAAM,GAAKR,IAAMM,EAAEE,EAAI,EAAE,EAC7C,OAAO,CAACC,EAAKT,EAAGQ,EAAGE,IAChBF,IAAM,GAAKC,GAAOT,EAAIU,EAAIF,EAAI,GACxBC,EACA,KAAK,IAAIT,EAAIU,EAAIF,EAAI,EAAE,CACjC,CACR,EAEA,OAAO,KAAK,IAAI,GAAGJ,CAAI,CAC3B,EAEMH,EAAiBH,GAAiC,CACpD,GAAIJ,EAAK,QAAQ,GAAK,SAAU,CAC5B,IAAMiB,EAAYR,EAAcL,CAAI,EACpC,OAAOJ,EAAK,IAAI,CAACiB,EAAY,EAAGA,EAAY,CAAC,CAAC,EAAEb,CAAI,CACxD,KACI,QAAOJ,EAAKI,CAAI,CAExB,EAEA,OAAAD,EAAQ,UAAY,IAAIe,IACfA,EAAK,QAGVhB,EAAa,CAACgB,EAAK,EAAE,EACdf,GAHID,EAAW,GAM1BC,EAAQ,WAAa,IAAIe,IAChBA,EAAK,QAGVhB,EAAagB,EAAK,GACXf,GAHID,EAMRC,CACX,EAEagB,GACRR,GACAL,GACGA,EAAEK,GAAW,GAERS,GAAqBC,GAErBC,GAAaC,GAAmC,CACzD,IAAIxB,EAAS,KACTyB,EAAS,aACTC,EAAc,KAEZC,EAAU,CAACC,EAAGvB,IAAS,CACzB,GAAI,CAIA,OAHkBwB,GAAkBD,EAAE,KAAK,CAAC,EACpB,cAAc,kBAAkB,EACrC,cAAc,IAAIvB,QAAW,CAEpD,MAAE,CACE,OAAO,IACX,CACJ,EAGMyB,EAAmBC,GAAS,CAC9B,IAAMC,EAAU,UAAOD,CAAI,EAAE,OAAO,MAAM,EAAE,KAAK,EAChDC,EAAqB,MAAM,SAAW,KAC3C,EAGMC,EAAc,CAACC,EAAMN,IAAM,CAC7B,IAAMO,EAAUD,EAAK,sBAAsB,EAC3CN,EAAE,KAAK,CAACrB,EAAGQ,EAAGqB,IAAU,CACpB,IAAMC,EAAa,UAAOD,EAAMrB,EAAE,EAAE,KAAK,EAAE,sBAAsB,GAG7DU,GAAU,YAAcU,EAAQ,MAAQE,EAAQ,OAGhDZ,GAAU,cACVU,EAAQ,OAASE,EAAQ,SAEzBP,EAAgBM,EAAMrB,EAAE,CAEhC,CAAC,CACL,EAEMuB,EAAW,CAACV,EAAGvB,EAAMkC,IAAW,CAClC,IAAML,EAAOP,EAAQC,EAAGvB,CAAI,EACxB6B,GACAD,EAAYC,EAAMN,CAAC,CAE3B,EAEMY,EAAoB,KACH,CACf,OAAW,aACX,KAAS,WACT,IAAQ,UACR,MAAU,YAEV,SAAAF,CACJ,GAIJ,OAAAE,EAAa,OAAS,IAAIrB,IACjBA,EAAK,QAGVnB,EAASmB,EAAK,GACPqB,GAHIxC,EAMfwC,EAAa,OAAS,IAAIrB,IACjBA,EAAK,QAGVM,EAASN,EAAK,GACPqB,GAHIf,EAMfe,EAAa,YAAc,IAAIrB,IACtBA,EAAK,QAGVO,EAAcP,EAAK,GACZqB,GAHId,EAMRc,CACX,EKjLA,IAAAC,GAAA,GAAAC,GAAAD,GAAA,YAAAE,GAAA,kBAAAC,GAAA,UAAAC,KAYA,UAAYC,OAAQ,KACpB,UAAYC,OAAQ,OAIb,IAAMC,GAAQ,IAAS,aAAU,EAE3BC,GAAS,IAAc,CAChC,IAAMC,EAAU,cAAW,EAEvBC,EAAa,CAAC,YAAY,EAExBC,EAA4BC,IAC9BH,EAAK,UAAUC,EAAW,IAAKG,GAAOC,GAAM,IAAI,KAAKA,EAAED,EAAE,CAAC,CAAC,EAEpDE,EAAcC,GAAaJ,CAAI,CAAC,GAGxC,aAAUD,EAASF,EAAS,WAAQ,UAAW,iBAAiB,CAAC,EAEpE,IAAMQ,EAAiBL,GAAS,CAC5B,IAAMM,EAAOR,EAAW,IAAKS,GACzBP,EACK,IAAKE,GAAM,IAAI,KAAKA,EAAEK,EAAU,EAAE,QAAQ,CAAC,EAC3C,KAAK,CAACC,EAAGC,IAAMD,EAAIC,CAAC,EACpB,OAAO,CAACP,EAAGQ,EAAGF,IAAME,IAAM,GAAKR,IAAMM,EAAEE,EAAI,EAAE,EAC7C,OAAO,CAACC,EAAKT,EAAGQ,EAAGE,IAChBF,IAAM,GAAK,KAAK,IAAIC,CAAG,GAAK,KAAK,IAAIT,EAAIU,EAAIF,EAAI,EAAE,EAC7C,KAAK,IAAIC,CAAG,EACZ,KAAK,IAAIT,EAAIU,EAAIF,EAAI,EAAE,CACjC,CACR,EAEA,OAAO,KAAK,IAAI,GAAGJ,CAAI,CAC3B,EAEMH,EAAiBH,GAAS,CAC5B,IAAMa,EAAY,KAAK,IAAIR,EAAcL,CAAI,CAAC,EAC9C,OAAOH,EAAK,QAAQ,QAAQ,EAAE,IAAI,CAACgB,EAAY,EAAGA,EAAY,CAAC,CAAC,EAAEb,CAAI,CAC1E,EAEA,OAAAD,EAAQ,UAAY,IAAIe,IACfA,EAAK,QAGVhB,EAAa,CAACgB,EAAK,EAAE,EACdf,GAHID,EAAW,GAM1BC,EAAQ,WAAa,IAAIe,IAChBA,EAAK,QAGVhB,EAAagB,EAAK,GACXf,GAHID,EAMRC,CACX,EAEagB,GAAiBR,GAAeL,GAAM,IAAI,KAAKA,EAAEK,GAAW,EAAE,ECxE3E,IAAAS,GAAA,GAAAC,GAAAD,GAAA,eAAAE,GAAA,WAAAC,GAAA,kBAAAC,GAAA,UAAAC,KAYA,UAAYC,OAAQ,KACpB,UAAYC,OAAQ,OCDpB,OAAS,UAAAC,GAAQ,QAAAC,OAAY,KAC7B,OACI,kBAAAC,GACA,qBAAAC,GACA,mBAAAC,GACA,oBAAAC,GACA,YAAAC,GACA,aAAAC,GACA,WAAAC,OACG,OCTP,IAAOC,GAAQ,IAAIC,IAAU,CACzB,IAAMC,EAAO,CAAC,EAERC,EAASC,GAAW,CACtB,QAAWC,KAAO,OAAO,KAAKH,CAAI,EAC9BE,EAAOC,GAAKH,EAAKG,EAAI,EAEzB,OAAOD,CACX,EAEA,QAAWE,KAAQL,EACfE,EAAMG,GAAQ,IAAIC,IACTA,EAAK,QAGVL,EAAKI,GAAQC,EAAK,GACXJ,GAHID,EAAKI,GAOxB,OAAOH,CACX,EDWA,IAAMK,GAAY,CAACC,EAAgBC,EAAUC,IAAqB,CAC9D,IAAIC,EAAgB,EAChBC,EAAmC,EACnCC,EAAYC,GACZ,aACA,QACA,gBACA,aACA,aACJ,EACIC,EAAW,IAAIC,IAAS,CAAC,EAEzBC,EAAS,KAEPC,EAAgBC,GAAS,IAAK,OAAO,EACrCC,EAAqBD,GAAS,OAAQ,QAAQ,EAE9CE,EAAY,CAACC,EAAG,IAClBC,EAAW,EAAI,aAAa,MAAMD,KAAO,aAAaA,MAAM,KAE1DE,EAAiBC,GACnBF,EAAW,EAAIE,EAAI,IAAKC,GAAM,CAACA,EAAE,GAAIA,EAAE,EAAE,CAAC,EAAID,EAE5CF,EAAa,IAAMf,IAAW,QAAUA,IAAW,QAEnDD,EAAiCoB,GAAc,CACjD,GAAI,CAACV,EAAQ,CACTJ,EAAUJ,EAASC,CAAK,EAAE,SAASK,CAAQ,CAAC,EAAEY,CAAS,EACvD,MACJ,CAOAA,EAAU,KAAK,CAACC,EAAMC,EAAOC,IAAU,CACnC,IAAMC,EAAUD,EAAMD,GAEhBG,EAAYC,GAAOF,CAAO,EAE1BG,EAAO1B,IAAW,UAAYA,IAAW,QAAU,EAAI,GAGvD2B,EAAQzB,EAAM,MAAM,EACpB0B,EAAiBZ,EAAc,CACjC,CAACW,EAAM,GAAID,EAAOvB,CAAa,EAC/B,CAACwB,EAAM,GAAI,CAAC,EACZ,CAACA,EAAM,GAAI,CAAC,EACZ,CAACA,EAAM,GAAID,EAAOvB,CAAa,CACnC,CAAC,EAEkBS,EAAmBY,EAAW,CAACJ,CAAI,CAAC,EAElD,KAAK,IAAKS,GAAK,EAAED,CAAc,CAAC,EAChC,KAAK,SAAU,MAAM,EACrB,KAAK,OAAQ,MAAM,EAExB,IAAME,EAAIpB,EAAcc,EAAWf,CAAM,EAEnCsB,EAAeC,GACjB,MAAM,QAAQ5B,CAAa,EAAIA,EAAc4B,GAAK5B,EAChD6B,EAAiBD,GAAM,CACzB,IAAIE,EAAM,EACV,QAASC,EAAI,EAAGA,EAAIH,EAAGG,IACnBD,GAAOH,EAAYI,CAAC,EAExB,OAAOD,CACX,EAEAJ,EAAE,KAAK,YAAa,CAACZ,EAAGc,IACpBnB,EAAU,EAAGa,EAAOO,EAAcD,CAAC,CAAC,CACxC,EAAE,KAAK,CAACV,EAAOU,EAAGI,IAAU,CACxB,IAAMC,EAAeZ,GAAOW,EAAMJ,EAAE,EAC9BM,EAAaC,EAAerC,EAAOoB,CAAK,EAC9BjB,EAAUJ,EAASqC,CAAU,CAAC,EACzC,SAAS,CAACE,EAAGpB,IAASb,EAASiC,EAAGpB,EAAMY,CAAC,CAAC,EAC1C,cAAcD,EAAYC,CAAC,CAAC,EAC5B,WAAYd,GAAMoB,EAAW,KAAKpB,CAAC,EAAI,CAAC,EACrCmB,CAAY,EAEpBA,EAAa,OAAO,aAAa,EAAE,KAAK,aAAc,QAAQ,CAClE,CAAC,EAGDP,EAAE,KAAK,EAAE,KAAK,YAAa,CAACZ,EAAGc,IAC3BnB,EAAU,EAAGa,EAAOO,EAAcD,CAAC,CAAC,CACxC,CACJ,CAAC,CACL,EAEMO,EAAiB,CAACrC,EAAOoB,IAAU,CACrC,SAASmB,EAAYC,EAAO,CACxB,IAAMC,EAASD,EAAM,OACrB,OAAOC,EAAO,OAAO,CAACT,EAAKhB,IAAMgB,EAAMhC,EAAMgB,CAAC,EAAG,CAAC,EAAIyB,EAAO,MACjE,CAEA,OAAAF,EAAY,MAAQ,IACTnB,EAEXmB,EAAY,WAAa,IAAOvB,GACrBA,EAAE,KAEbuB,EAAY,KAAO,IAAMF,EAAerC,EAAOoB,CAAK,EAEpDmB,EAAY,KAAQC,GAAUA,EAAM,OAAO,OAASxC,EAAM,KAAK,EAE/D0C,GAAUH,EAAavC,EAAO2C,GAAQ,QAAS,OAAQ,MAAM,CAAC,EACvDJ,CACX,EAEA,OAAA1C,EAAU,SAAW,IAAIS,IAChBA,EAAK,QAGVJ,EAAgBD,EAAgB,OAAOK,EAAK,EAAE,EACvCT,GAHIK,EAMfL,EAAU,cAAgB,IAAIS,IACrBA,EAAK,QAGVJ,EAAgB,MAAM,QAAQI,EAAK,EAAE,EAAIA,EAAK,GAAK,OAAOA,EAAK,EAAE,EAC1DT,GAHIK,EAMfL,EAAU,cAAgB,IAAIS,IACrBA,EAAK,QAGVL,EAAgB,OAAOK,EAAK,EAAE,EACvBT,GAHII,EAMfJ,EAAU,SAAW,IAAIS,IAChBA,EAAK,QAGVD,EAAWC,EAAK,GACTT,GAHIQ,EAMfR,EAAU,OAAS,IAAIS,IACdA,EAAK,QAGVC,EAASD,EAAK,GACPT,GAHIU,EAMfmC,GAAU7C,EAAWM,CAAS,EAEvBN,CACX,EAEa+C,GAAgB5C,GAAUH,GAAU,MAAOgD,GAAgB7C,CAAK,EAEhE8C,GAAmB9C,GAC5BH,GAAU,SAAUkD,GAAmB/C,CAAK,EAEnCgD,GAAiBhD,GAC1BH,GAAU,OAAQoD,GAAiBjD,CAAK,EAE/BkD,GAAkBlD,GAC3BH,GAAU,QAASsD,GAAkBnD,CAAK,ED7KvC,IAAMoD,GAAQ,IAAMC,GAAgB,aAAU,CAAC,EAAE,QAAQ,EAAG,EAetDC,GAAS,IAAyB,CAC3C,IAAIC,EAAa,CAAC,YAAY,EAC1BC,EAAS,aAEPC,EAA4BC,GAAS,CACvC,IAAMC,EAAgBC,GAAaF,CAAI,EACvC,OAAOG,EAAgB,CACnB,GAAG,MAAM,KAAK,IAAI,IAAIF,EAAc,IAAKG,GAAMA,EAAEP,EAAW,GAAG,CAAC,CAAC,CACrE,CAAC,CACL,EAEMM,EAAmBC,GAAON,GAAU,WAAaM,EAAE,QAAQ,EAAIA,EAErE,OAAAL,EAAQ,UAAY,IAAIM,IACfA,EAAK,QAGVR,EAAa,CAACQ,EAAK,EAAE,EACdN,GAHIF,EAAW,GAM1BE,EAAQ,WAAa,IAAIM,IAChBA,EAAK,QAGVR,EAAaQ,EAAK,GACXN,GAHIF,EAMfE,EAAQ,OAAS,IAAIM,IACZA,EAAK,QAGVP,EAASO,EAAK,GACPN,GAHID,EAMRC,CACX,EAEaO,GACRC,GACAH,GACGA,EAAEG,GAAW,KAAK,GAAG,EAEhBC,GAAaC,GAAkC,CACxD,IAAIX,EAAS,aACTY,EAAc,cACdd,EAAS,KAEPe,EAAoB,IAAqB,CAC3C,IAAMC,EAAaH,EAASC,GAAa,OAAS,EAG5CG,EAAcC,EAAWlB,CAAM,EAC/BmB,EAAkBF,EAAY,IAAIG,CAAkB,EAEpDC,EAAgBL,EAChBG,EAAgB,IAAKG,GAAMA,EAAE,IAAI,EACjCH,EAAgB,GAAG,KACnBI,EAAgBJ,EAAgB,OAAO,CAACK,EAAG,IAAMA,EAAI,EAAE,KAAM,CAAC,EAE9DC,EAAcC,GAAU5B,GAAU,CACpC,IAAM6B,EAAOD,EAAK5B,CAAK,EAEvB,OAAIkB,GACAW,EAAK,OAAOV,CAAW,EAClB,cAAcI,CAAa,EAC3B,cAAcE,CAAa,EAEhCrB,IAAW,cAAcyB,EAAK,YAAY,EAAE,EACzCA,CACX,EAEMC,EAAW,CAACJ,EAAGpB,EAAMyB,IAAU,CACjC,IAAMC,EAAWX,EAAgBU,GAAO,SACpC3B,IAAW,cAAc6B,EAAmBP,EAAGM,CAAQ,EAC3DE,EAAsBR,EAAGM,CAAQ,CACrC,EAEMG,EAAUC,EAAWlB,CAAU,EACrC,MAAO,CACH,OAAQS,EAAWQ,EAAQ,MAAM,EACjC,KAAMR,EAAWQ,EAAQ,IAAI,EAC7B,MAAOR,EAAWQ,EAAQ,KAAK,EAC/B,IAAKR,EAAWQ,EAAQ,GAAG,EAC3B,KAAM,GAAGV,EAAgB,OACzB,SAAAK,CACJ,CACJ,EAWMM,EAAclB,GACZA,EACO,CACH,OAAQmB,GACR,KAAMC,GACN,IAAKC,GACL,MAAOC,EACX,EAEO,CACH,OAAW,qBACX,KAAS,mBACT,IAAQ,kBACR,MAAU,mBACd,EAIFpB,EAAclB,GAAW,CAC3B,IAAMuC,EAAS,CAAC,EAChB,OAAAvC,EAAO,QAASwC,GAAS,EACPA,GAAQA,EAAK,MAAQA,EAAK,MAAM,GAAG,EAAI,CAACA,CAAI,GACpD,QAAQ,CAAChB,EAAGiB,IAAM,CACpB,KAAOF,EAAO,QAAUE,GAAGF,EAAO,KAAK,CAAC,CAAC,EAEzC,IAAMG,EAAQH,EAAOE,GACjBC,EAAM,OAAS,GAAKA,EAAMA,EAAM,OAAS,GAAG,OAASlB,EACrDkB,EAAMA,EAAM,OAAS,GAAG,OAAO,KAAKF,CAAI,EAExCE,EAAM,KAAK,CAAE,KAAMlB,EAAG,OAAQ,CAACgB,CAAI,CAAE,CAAC,CAE9C,CAAC,CACL,CAAC,EACMD,EAAO,QAAQ,CAC1B,EAEMnB,EAAsBsB,GAAU,CAClC,IAAMC,EAAQ9B,EAAS,KAAK,MACtB+B,EAAY,KAAK,IACnB,GAAGF,EAAM,IAAKG,GAAOA,EAAE,KAAOA,EAAE,KAAK,OAAS,CAAE,CACpD,EAEA,OAAI3C,IAAW,aAEPwC,GAASA,EAAM,OAAS,GAAKC,EAAQ,IAC9B,CACH,KAAMC,EAAY,EAAI,GACtB,SAAU,EACd,EAEAF,GACAA,EAAM,QAAUE,EAAY,EAAI,IAAMD,EAAQ,IAEvC,CACH,KAAMC,EAAY,EAAI,GACtB,SAAU,EACd,EAEG,CACH,KAAM,GACN,SAAU,CACd,EAGO,CACH,KAAMA,EAAY,EAAI,GACtB,SAAU,CACd,CAER,EAEMZ,EAAwB,CAACR,EAAGsB,IAAY,CAC1C,IAAMC,EAAsBC,GAAc,CACtC,IAAMC,EAAUD,EAAU,QAAQ,GAAG,IAAM,GAAK,IAAM,IAChDE,EAASF,EACV,UAAUA,EAAU,QAAQ,GAAG,EAAI,EAAGA,EAAU,QAAQ,GAAG,CAAC,EAC5D,MAAMC,CAAO,EACb,IAAKE,GAAM,SAASA,CAAC,CAAC,EAC3B,KAAOD,EAAO,OAAS,GAAGA,EAAO,KAAK,CAAC,EACvC,OAAOA,CACX,EASME,EAAYN,EAFW,CAACO,EAAIC,IAC9BD,EAAG,EAAIA,EAAG,MAAQ,GAAKC,EAAG,EAAIA,EAAG,MANX,CAACD,EAAIC,IAC3BD,EAAG,GAAKC,EAAG,EAAIA,EAAG,OAClBA,EAAG,GAAKD,EAAG,EAAIA,EAAG,OAClBA,EAAG,GAAKC,EAAG,EAAIA,EAAG,QAClBA,EAAG,GAAKD,EAAG,EAAIA,EAAG,OAKhBE,EAAqB,CAACF,EAAIC,IAC5BD,EAAG,GAAKC,EAAG,GACXD,EAAG,EAAIA,EAAG,OAASC,EAAG,EAAIA,EAAG,OAC7BD,EAAG,GAAKC,EAAG,GACXD,EAAG,EAAIA,EAAG,QAAUC,EAAG,EAAIA,EAAG,OAE5BE,EACFtD,GAAU,aAAeuD,EAAmBjC,CAAC,EAAI,KAE/CkC,EAAqB,CAAC,EAC5BlC,EAAE,KAAK,CAAChB,EAAGiC,EAAGkB,IAAU,CACpB,IAAMnB,EAAU,UAAOmB,EAAMlB,EAAE,EAGzBmB,EAAkBb,EAAmBP,EAAK,KAAK,WAAW,CAAC,EAG3DqB,EAAWrB,EAAK,KAAK,EAAE,QAAQ,EAC/BsB,EAAO,CACT,EAAGD,EAAS,EAAID,EAAgB,GAChC,EAAGC,EAAS,EAAID,EAAgB,GAChC,MAAOC,EAAS,MAChB,OAAQA,EAAS,MACrB,EAKME,EAHUL,EAAmB,KAAMM,GAAMZ,EAAUY,EAAGF,CAAI,CAAC,GAK5DN,GAAc,CAACD,EAAmBO,EAAMN,CAAU,EAEvDhB,EAAK,KAAK,aAAcuB,EAAS,SAAW,EAAE,EACzCA,GACDL,EAAmB,KAAKI,CAAI,CAEpC,CAAC,CACL,EAEML,EAAsBjC,GAAM,CAC9B,IAAMyC,EAAYC,GAAkB1C,EAAE,KAAK,CAAC,EAC5C,GAAIyC,IAAc,KACd,OAEJ,IAAME,EAAQF,EAAU,cAAc,kBAAkB,EAClDtC,EAAOwC,EAAM,cAAc,SAAS,EAEpCC,EAAYD,EAAM,sBAAsB,EACxCE,EAAW1C,EAAK,sBAAsB,EAC5C,MAAO,CACH,EAAGyC,EAAU,KAAOC,EAAS,KAC7B,MAAOD,EAAU,MACjB,EAAGA,EAAU,IAAMC,EAAS,IAC5B,OAAQD,EAAU,MACtB,CACJ,EAEME,EAAqBxC,GAClBA,EAGDA,EAAW,GACJ,WAAWA,SAEf,WAAWA,SALP,kBAQTC,EAAqB,CAACP,EAAGM,IAAa,CACxC,IAAMkB,EAAYsB,EAAkBxC,CAAQ,EACtCyC,EAASzC,EAAW,MAAQ,GAClCN,EAAE,KAAK,CAAChB,EAAGiC,EAAGkB,IAAU,CACJ,UAAOA,EAAMlB,EAAE,EACb,OAAO,MAAM,EAE1B,KAAK,YAAaO,CAAS,EAAE,MAAM,cAAeuB,CAAM,CACjE,CAAC,CACL,EAEA,OAAAxD,EAAa,OAAS,IAAIN,IACjBA,EAAK,QAGVP,EAASO,EAAK,GACPM,GAHIb,EAMfa,EAAa,YAAc,IAAIN,IACtBA,EAAK,QAGVK,EAAcL,EAAK,GACZM,GAHID,EAMfC,EAAa,OAAS,IAAIN,IACjBA,EAAK,QAGVT,EAASS,EAAK,GACPM,GAHIf,EAMRe,CACX,EZtQA,IAAMyD,GAAY,CACd,KAAAC,GACA,QAAAC,GACA,KAAAC,GACA,OAAAC,EACJ,EAEaC,EAAeC,GAAoC,CAC5D,IAAIC,EAAqC,KACrCC,EAAsB,aACtBC,EAAiC,cACjCC,EACAC,EAA0B,CAAC,YAAY,EACvCC,EAAe,KACfC,EAAY,KAEVC,EAAiB,CAAC,UAAW,kBAAmB,KAAK,EACrDC,EAAW,CAAC,EAEZC,EAAkCC,GAA6B,CACjE,IAAMC,EAAUC,GAASb,CAAQ,EAC5B,YAAYC,CAAW,EACvB,YAAYE,CAAW,EACvB,aAAaC,CAAY,EAAE,EAE1BU,EAAOpB,GAAUkB,GACjBG,EAAkBD,EAAK,OAAO,EAAa,WAAWT,CAAU,EAEtEG,EAAe,QAASQ,GAAM,CACtBP,EAASO,IAAMD,EAAeC,IAC9BD,EAAeC,GAAGP,EAASO,EAAE,CACrC,CAAC,EACGD,EAAe,QAAQA,EAAe,OAAOb,CAAM,EAEvD,IAAIe,EAASF,EAAeJ,CAAI,EAC5BL,IAAiB,OACjBW,EAASX,EAAaW,CAAM,GAG5BV,GAAa,OAAOU,EAAO,IAAO,WAClCV,EAAU,GAAKU,EAAO,GAAK,KAAK,IAAIA,EAAO,GAAIV,EAAU,EAAE,EAC3DA,EAAU,GAAKU,EAAO,GAAK,KAAK,IAAIA,EAAO,GAAIV,EAAU,EAAE,GAG/D,IAAMW,EAAYJ,EAAK,eAAe,WAAW,EAC3CK,EAAgBL,EAAMG,EAAQN,CAAI,EAClCS,EAAiB,EAEjBC,EACFP,GAAQhB,GACKuB,GAAmBJ,EAAO,GAAIA,EAAO,EAAE,EAC9C,OAEV,MAAO,CACH,MAAOH,EAAK,MAAM,EAClB,OAAAG,EACA,eAAAF,EACA,cAAeD,EAAK,cACpB,UAAW,CACP,OAAQI,EAAU,OAClB,KAAMA,EAAU,KAChB,IAAKA,EAAU,IACf,MAAOA,EAAU,KACrB,EACA,KAAMA,EAAU,KAChB,SAAUA,EAAU,SACpB,MAAOlB,EAASG,GAAa,IAAKmB,GAAMA,EAAE,IAAI,EAAE,KAAK,IAAI,EACzD,mBAAAD,CACJ,CACJ,EAEMF,EAAkB,CAACL,EAAMG,EAAQN,IACnCG,EACK,UAAUd,CAAQ,EAClB,OAAOE,CAAM,EACb,YAAYC,CAAW,EACvB,OAAOc,CAAM,EAAEN,CAAI,EAEtBS,EAAmB,KAAO,CAC5B,OAAW,cACX,KAAS,YACT,IAAQ,WACR,MAAU,aACV,SAAU,IAAM,CAAC,CACrB,GAEA,OAAAV,EAAS,UAAY,IAAIa,IAChBA,EAAK,QAIVhB,EAAYgB,EAAK,GACVb,GAJIH,EAOfG,EAAS,YAAc,IAAIa,IAClBA,EAAK,QAIVtB,EAAcsB,EAAK,GACZb,GAJIT,EAOfS,EAAS,OAAS,IAAIa,IACbA,EAAK,QAIVrB,EAASqB,EAAK,GACPb,GAJIR,EAOfQ,EAAS,YAAc,IAAIa,IAClBA,EAAK,QAIVpB,EAAcoB,EAAK,GACZb,GAJIP,EAOfO,EAAS,aAAe,IAAIa,IACnBA,EAAK,QAIVnB,EAAemB,EAAK,GACbb,GAJIN,EAOfM,EAAS,UAAY,IAAIa,IAChBA,EAAK,QAIVlB,EAAa,CAACkB,EAAK,EAAE,EACdb,GAJIL,EAAW,GAO1BK,EAAS,WAAa,IAAIa,IACjBA,EAAK,QAIVlB,EAAakB,EAAK,GACXb,GAJIL,EAOfK,EAAS,aAAgBc,GAChBA,GAILlB,EAAekB,EACRd,GAJIJ,EAOfE,EAAe,QAAS,GAAM,CAC1BE,EAAS,GAAK,IAAIa,IACTA,EAAK,QAGVd,EAAS,GAAKc,EAAK,GACZb,GAHID,EAAS,EAK5B,CAAC,EAEMC,CACX,EehPA,UAAYe,OAAQ,KACpB,UAAYC,OAAQ,OAEb,IAAMC,EAAkB,CAACC,EAAOC,IACnCC,GAAaF,EAAOC,EAAO,CAACE,EAAGC,IAAMD,EAAE,YAAYC,CAAC,EAAG,EAAK,EACnDC,GAAqB,CAACL,EAAOC,IACtCC,GACIF,EACAC,EACA,CAACE,EAAGC,IACOD,EAAE,eAAeC,CAAC,EAAE,YAAe,kBAAe,CAAC,EAE9D,EACJ,EAEEF,GAAe,CAACF,EAAOC,EAAOK,EAAWC,IAAW,CACtD,IAAIC,EAAe,KACfC,EAAU,KAERC,EACD,kBAAe,CACZ,OAAQV,EAAM,MACd,OAAQC,EAAM,MACd,MAAOD,EAAM,UACb,MAAOC,EAAM,SACjB,CAAC,EACA,QAAQD,EAAM,MAAM,EACpB,OAAOA,EAAM,KAAK,EAClB,YAAYA,EAAM,IAAI,EACtB,UAAUA,EAAM,QAAQ,EACxB,YAAYA,EAAM,kBAAkB,EACpC,QAAQC,EAAM,MAAM,EACpB,OAAOA,EAAM,KAAK,EAClB,WAAWA,EAAM,IAAI,EACrB,UAAUA,EAAM,QAAQ,EACxB,QAAQ,MAAM,EACd,YAAYA,EAAM,kBAAkB,EAErCD,EAAM,UAAUU,EAAM,UAAUV,EAAM,QAAQ,EAC9CC,EAAM,UAAUS,EAAM,UAAUT,EAAM,QAAQ,EAGlDS,EAAM,eAAiBA,EAAM,cAAc,CAAC,EAC5CA,EAAM,eAAiBA,EAAM,cAAc,EAAG,EAC9CA,EAAM,eAAiBA,EAAM,cAAc,CAAC,EAC5CA,EAAM,eAAiBA,EAAM,cAAc,EAAG,EAE9CA,EAAM,aAAe,IAAIC,IAChBA,EAAK,QAGVH,EAAeG,EAAK,GACbD,GAHIF,EAMfE,EAAM,QAAU,IAAIC,IACXA,EAAK,QAGVF,EAAUE,EAAK,GACRD,GAHID,EAcfC,EAAM,SAAW,YAAaC,EAAM,CAChC,OAAIA,EAAK,QAAU,EACXJ,EACO,KAAK,eAAe,EAEpB,KAAK,YAAY,EAGrBD,EAAU,KAAM,GAAGK,CAAI,CAEtC,EAEA,IAAMC,EAAcF,EAAM,SAAS,EACnC,OAAAA,EAAM,SAAS,CAACG,EAAWC,IAAS,CAChC,IAAMC,EAAWF,EAAU,OAAO,oBAAoB,EAChDG,EAAOD,EAAS,OAAO,KAAK,EAAE,KAAK,EACzCC,EAAK,aACD,UACA,OAAOD,EAAS,KAAK,EAAE,eAAeA,EAAS,KAAK,EAAE,cAC1D,EACAC,EAAK,aAAa,sBAAuB,MAAM,EAE/C,QAAWC,IAAQ,CAAC,SAAU,QAAQ,EAClCJ,EACK,OAAO,YAAYI,OAAU,EAC7B,KAAK,EACL,aAAa,sBAAuB,MAAM,EAOnD,GAJAL,EAAYC,EAAWC,CAAI,EAIvBP,EAAQ,CACR,IAAMW,EAAcL,EAAU,OAAO,gBAAgB,EAAE,KAAK,EACtDM,EAAiBN,EAAU,OAAO,mBAAmB,EAAE,KAAK,EAC/D,aAAU,CAACK,EAAaC,CAAc,CAAC,EAAE,MAAM,CACtD,CAEA,GAAI,EAACX,EAEL,IAAIA,EAAa,UAAU,EAAG,CAE1B,IAAMY,EAAUZ,EAAa,QAAQ,EAE/Ba,EACD,YAAS,WAAY,SAAS,EAC9B,IAAKC,GAAMA,CAAC,EACXC,EAAqB,YAAS,IAAK,UAAU,EAAE,IAAKD,GAAMA,CAAC,EAGjET,EAEK,OAAO,KAAK,EACZ,KAAK,QAAS,qBAAqB,EACnC,MAAM,cAAe,CAAC,EACtB,MAAM,kBAAmB,CAAC,EAC1B,MAAM,WAAY,CAAC,EACnB,MAAM,eAAgB,CAAC,EACvB,MAAM,QAASJ,EAAQ,MAAQ,KAAK,EACpC,MAAM,UAAW,MAAM,EACvB,MAAM,cAAe,QAAQ,EAC7B,MAAM,kBAAmB,QAAQ,EACjC,OAAO,MAAM,EACb,KAAK,QAAS,wBAAwB,EACtC,MAAM,YAAa,gBAAgB,EAExC,IAAMe,EAAUf,EAAQ,MAAM,OAAOA,EAAQ,MAAM,EAC7CgB,EAAiBhB,EAAQ,UAAU,MAAMe,CAAO,EAyBtD,GAxBAC,EAAe,WAAWhB,EAAQ,kBAAkB,EAChDA,EAAQ,UAAUgB,EAAe,SAAShB,EAAQ,QAAQ,EAG9DY,EAAeR,EAAW,CAAC,OAAO,CAAC,EAC9B,KAAK,QAAUS,GAAM,UAAUA,QAAQ,EACvC,GAAG,UAAW,SAAUI,EAAOJ,EAAG,CAC/B,GAAM,CAAE,MAAAK,EAAO,OAAAC,CAAO,EAAIF,EAAM,OAC5BJ,IAAM,QACH,UAAOI,EAAM,aAAa,EACxB,OAAO,KAAK,EACZ,KAAK,UAAW,GAAG,CAACC,OAAWA,KAASC,GAAQ,EAChD,KAAK,sBAAuB,MAAM,EAE3CJ,EAAQ,MAAM,CAACI,EAAQ,CAAC,CAAC,CAC7B,CAAC,EACA,GAAG,OAAQ,SAAUF,EAAOJ,EAAG,CACzB,UAAOI,EAAM,aAAa,EACxB,OAAO,KAAK,EACZ,KAAKD,CAAc,CAC5B,CAAC,EAIDlB,EAAQ,CACR,IAAMsB,EAAyBC,GAAc,CACzC,IAAMX,EAAiBT,EAAM,SAAS,EACtCS,EACK,QAAQW,EAAU,KAAK,EAAE,WAAW,IAAI,CAAC,EACzC,OAAO9B,EAAM,KAAK,EAEvB,IAAM+B,EAAU,CAAC9B,EAAM,MAAOuB,CAAO,EACrC,CAACV,EAAMM,CAAO,EAAE,QAAQ,CAACE,EAAGU,IAAM,CAC9Bb,EAAe,OAAOY,EAAQC,EAAE,EAChCb,EAAeG,CAAC,CACpB,CAAC,CACL,EAEAT,EACK,OAAO,uBAAuB,EAC9B,GAAG,OAAQ,SAAUa,EAAOJ,EAAG,CAC5BO,EACO,UAAOH,EAAM,aAAa,EAAE,OAAO,QAAQ,CAClD,CACJ,CAAC,CACT,KAAO,CACH,IAAMO,EAAqB,SAAUH,EAAW,CAC5C,IAAMZ,EAAcR,EAAM,SAAS,EACnCQ,EAAY,OAAOlB,EAAM,KAAK,EAE9B,IAAM+B,EAAU,CAAC9B,EAAM,MAAOuB,CAAO,EACrCD,EAAgBO,EAAW,CAAChB,EAAMM,CAAO,CAAC,EAAE,KACxC,CAACE,EAAGU,EAAGE,IAAU,CACbhB,EAAY,OAAOa,EAAQC,EAAE,EAC1B,UAAOE,EAAMF,EAAE,EAAE,MAAMV,CAAC,EAAE,KAAKJ,CAAW,CACjD,CACJ,CACJ,EAEAL,EACK,OAAO,oBAAoB,EAC3B,GAAG,OAAQ,SAAUa,EAAOJ,EAAG,CAC5BW,EACO,UAAOP,EAAM,aAAa,EAAE,OAAO,KAAK,CAC/C,CACJ,CAAC,CACT,CACJ,CAGAlB,EAAaK,CAAS,EAC1B,CAAC,EAEMH,CACX,ECtNA,UAAYyB,OAAQ,OCApB,OAAS,UAAAC,OAAc,KCEhB,SAASC,EAAmBC,EAAWC,EAAUC,EAAgB,CACpE,IAAIC,EAAUH,EAAU,OAAOC,CAAQ,EACvC,OAAOE,EAAQ,KAAK,EAAI,EAAIA,EAAUD,EAAe,CACzD,CAEO,SAASE,GACZC,EACAC,EACAC,EAAoB,QACtB,CACE,GAAIA,IAAc,SAAWA,IAAc,SACvC,OAAOF,EAAcE,GAAaD,EAAiBC,GAKvD,GAAIA,IAAc,QAAUA,IAAc,MACtC,OAAOF,EAAcE,GAAaD,EAAiBC,GAKvD,KAAM,oDAAoDA,GAC9D,CAEO,SAASC,GACZC,EACAC,EACAC,EACAC,EAAO,EACT,CACE,IAAMC,EAAYJ,IAAS,IAAM,QAAU,SAErCK,EAAsBJ,EAAcD,GACpCM,EAAsBL,EAAcD,GAAQC,EAAcG,GAE1DG,EAAoBL,EAAYF,GAChCQ,EAAoBN,EAAYF,GAAQE,EAAYE,GAEpDK,EACFF,EAAoBJ,EAAOE,GAC3BE,EAAoBJ,EAAOG,EACzBI,EACFF,EAAoBL,EAAOE,GAC3BG,EAAoBL,EAAOG,EACzBK,EACFJ,EAAoBJ,EAAOE,GAC3BG,EAAoBL,EAAOG,EAE/B,OAAOG,GAAoBC,GAAoBC,CACnD;ECpDA,OAAS,UAAAC,OAAc,KCEhB,SAASC,GAAQC,EAAMC,EAAO,CACjC,OAAQD,OACC,WACA,WACD,OAAOC,aAAiB,KAClBA,EACA,IAAI,KAAK,SAASA,CAAK,CAAC,EAAE,eAAe,CAAC,EAAG,CACzC,UAAW,QACX,UAAW,QACf,CAAC,MACN,UACD,OAAO,SAASA,EAAO,EAAE,MACxB,QACD,OAAO,WAAWA,CAAK,EAE/B,OAAOA,CACX,CAEO,SAASC,GAAeC,EAAMC,EAAU,CAC3C,OAAIA,EAAS,YAAY,SAAW,EAAU,CAAC,EAC3CD,EAAK,WAAW,SAAW,EAAU,CAAC,IACrBA,EAAK,WAAW,MAC/BA,EAAK,WAAW,MAAM,GAAG,EACzB,MAAM,QAAQA,EAAK,UAAU,EAC7BA,EAAK,WACL,CAACA,EAAK,UAAU,IAAM,CAACA,EAAK,GAAG,GAClB,IAAI,CAACE,EAAOC,KAAO,CAClC,KAAMF,EAAS,YAAYE,GAAG,KAC9B,MAAOP,GAAQK,EAAS,YAAYE,GAAG,KAAMD,CAAK,CACtD,EAAE,CACN,CAEO,SAASE,GAAeJ,EAAMC,EAAoB,CACrD,GAAIA,EAAS,YAAY,SAAW,EAAG,MAAO,CAAC,EAC/C,IAAII,EAAc,CAACL,EAAK,SAAS,EAEjC,OAAIA,EAAK,IACLK,EAAcL,EAAK,IAAI,MAAM,GAAG,EACzBA,EAAK,WAAW,QACvBK,EAAcL,EAAK,UAAU,MAAM,GAAG,GAGnCC,EAAS,YAAY,IAAI,CAACK,EAAOH,KAAO,CAC3C,KAAMG,EAAM,KACZ,MAAOV,GAAQU,EAAM,KAAMD,EAAYF,EAAE,CAC7C,EAAE,CACN,CAEO,SAASI,GAAcP,EAAMC,EAAU,CAC1C,OAAIA,EAAS,WAAW,OAAS,EACzBD,EAAK,WACEC,EAAS,WAAW,IAAI,CAACO,EAAML,KAAO,CACzC,KAAMK,EAAK,KACX,MAAOZ,GAAQY,EAAK,KAAMR,EAAK,WAAWG,EAAE,CAChD,EAAE,EAECF,EAAS,WAAW,IAAKO,IAAU,CACtC,KAAMA,EAAK,KACX,MAAOZ,GAAQY,EAAK,KAAMR,EAAK,IAAIQ,EAAK,KAAK,CACjD,EAAE,EAEC,CACH,CACI,KAAMP,EAAS,WAAW,GAAG,KAC7B,MAAOL,GACHK,EAAS,WAAW,GAAG,KACvBD,EAAK,YACDA,EAAK,UAAYA,EAAK,WACtBA,EAAK,WACLA,EAAK,UACb,CACJ,CACJ,CACJ,CDvEO,SAASS,GAAaC,EAAYC,EAAMC,EAAoB,CAC/D,IAAMC,EAAgBC,GAAeH,EAAMC,CAAQ,EAC9C,OAAOG,GAAeJ,EAAMC,CAAQ,CAAC,EACrC,OAAOI,GAAcL,EAAMC,CAAQ,CAAC,EACzCK,GAAcP,EAAYG,CAAa,CAC3C,CAEA,SAASI,GAAcP,EAAYQ,EAAQ,CACvCR,EACK,OAAO,iBAAiB,EACxB,UAAU,IAAI,EACd,KAAKQ,CAAM,EACX,KAAK,IAAI,EACT,KAAK,SAAUC,EAAG,CACfC,GAAO,IAAI,EACN,KAAK,GAAGD,EAAE,QAAQ,EAClB,OAAO,GAAG,EACV,KAAKE,GAAaF,EAAE,KAAK,CAAC,CACnC,CAAC,CACT,CAEA,IAAME,GAAgBC,GAClBA,GAAU,KACJ,IACAA,EAAM,eAAe,OAAW,CAC5B,MAAO,UACP,sBAAuB,EACvB,sBAAuB,CAC3B,CAAC,EE9BX,IAAMC,GAAeC,GAAM,CAACA,EAAE,KAAM,KAAMA,EAAE,KAAK,EAEpCC,GAAa,CAACC,EAAMC,EAAMC,IAAa,CAChD,IAAMC,EAAeC,GAAcH,EAAMC,CAAQ,EAAE,IAAKJ,GAAMA,EAAE,IAAI,EAC9DO,EAAeC,GAAeL,EAAMC,CAAQ,EAAE,IAAIL,EAAW,EAC7DU,EAAeC,GAAeP,EAAMC,CAAQ,EAAE,IAAIL,EAAW,EAE7DY,EAASP,EAAS,OAAO,OAAOG,CAAY,EAAE,OAAOE,CAAY,EAEvEP,EAAK,cACD,IAAI,YAAY,oBAAqB,CACjC,QAAS,GACT,SAAU,GACV,OAAQ,CACJ,aAAAG,EACA,OAAQ,CAAE,OAAAM,CAAO,EACjB,IAAKR,EAAK,GACd,CACJ,CAAC,CACL,CACJ,EAEaS,GAAiB,IAAM,CAChC,IAAIR,EAAW,KAETS,EAAUC,GAAc,CAC1B,IAAMZ,EAAOY,EAAU,KAAK,EAC5BA,EAAU,GAAG,QAAS,CAACD,EAAQV,IAC3BF,GAAWC,EAAMC,EAAMC,CAAQ,CACnC,CACJ,EAEA,OAAAS,EAAO,SAAW,IAAIE,IACbA,EAAK,QAGVX,EAAWW,EAAK,GACTF,GAHIT,EAMRS,CACX,EJtBO,IAAMG,GAAU,IAAe,CAClC,IAAIC,EAAa,GACbC,EAAa,KACbC,EAA4B,KAC5BC,EAAW,GAETC,EAAiBC,GAAc,CACjC,IAAMC,EAAOD,EAAU,KAAK,EAE5B,GAAI,CAACC,GAAQ,CAACA,EAAK,YAAa,CAC5BC,GAAYN,CAAU,EACtB,MACJ,CAEA,IAAMO,EAAYC,GAAOC,GAAkBJ,CAAI,CAAC,EAChDL,EAAaU,GAAcH,CAAS,EAEpC,IAAMI,EAAU,SAAUC,EAAQC,EAAM,CACpCC,GAAad,EAAYa,EAAMZ,CAAQ,EACvC,IAAMc,EAAQX,EAAU,MAAM,EACxBY,EAAID,EAAM,QAAQ,IAAI,EAC5BE,GAAYV,EAAU,KAAK,EAAGQ,EAAMC,GAAIhB,EAAYE,CAAQ,EAC5DM,GAAOO,EAAMC,EAAE,EAAE,MAAM,UAAW,KAAK,CAC3C,EAEME,EAAU,SAAUN,EAAQO,EAAO,CACrCb,GAAYN,CAAU,EACtB,IAAMe,EAAQX,EAAU,MAAM,EACxBY,EAAID,EAAM,QAAQ,IAAI,EACxBA,GAAOP,GAAOO,EAAMC,EAAE,EAAE,MAAM,UAAW,GAAG,CACpD,EAEIjB,EACAK,EAAU,KAAK,SAAUS,EAAM,CAC3B,OAAOF,EAAQ,KAAK,KAAM,OAAWE,CAAI,CAC7C,CAAC,GAEDT,EAAU,GAAG,YAAaO,CAAO,EAAE,GAAG,WAAYO,CAAO,EACzDE,GAAe,EAAE,SAASnB,CAAQ,EAAEG,CAAS,EAErD,EAEA,OAAAD,EAAS,WAAa,IAAIkB,IACjBA,EAAK,QAGVtB,EAAasB,EAAK,GACXlB,GAHIJ,EAMfI,EAAS,SAAW,IAAIkB,IACfA,EAAK,QAGVnB,EAAWmB,EAAK,GACTlB,GAHID,EAMfC,EAAS,SAAW,IAAIkB,IACfA,EAAK,QAGVpB,EAAWoB,EAAK,GACTlB,GAHIF,EAMRE,CACX,EAEA,SAASO,GAAcH,EAAW,CAC9B,OAAOe,EAAmBf,EAAW,cAAe,IAChDA,EACK,OAAO,KAAK,EACZ,KAAK,QAAS,SAAS,EACvB,MAAM,UAAW,CAAC,EAClB,MAAM,UAAW,CAAC,EAClB,KAAKgB,EAAe,CAC7B,CACJ,CAEA,SAASN,GAAYO,EAAenB,EAAML,EAAYE,EAAU,CAC5D,IAAMuB,EAAgBD,EAAc,sBAAsB,EACpDE,EAAOrB,EAAK,sBAAsB,EAEpCsB,EAAOD,EAAK,KAAOA,EAAK,MAAQ,EAAID,EAAc,KAClDG,EAAMF,EAAK,IAAMD,EAAc,IAAMD,EAAc,UAEnDtB,IACA0B,EACIF,EAAK,IACLA,EAAK,OAAS,EACdD,EAAc,IACdD,EAAc,WAEtBxB,EACK,MAAM,OAAQ,GAAG2B,KAAQ,EACzB,MAAM,MAAO,GAAGC,KAAO,EAGvB,MAAM,UAAW,EAAG,EAErB1B,IAAU,CAACyB,EAAMC,CAAG,EAAIC,GAAU7B,EAAYyB,CAAa,GAE/DK,GAA4B9B,EAAYyB,EAAeE,EAAMC,EAAK1B,CAAQ,CAC9E,CAEA,SAAS2B,GAAU7B,EAAYyB,EAAe,CAC1C,IAAMM,EAAiB/B,EAAW,KAAK,EAAE,sBAAsB,EAEzDgC,EAAaD,EAAe,MAAQ,EACpCE,EAAUF,EAAe,KAAOC,EAAaP,EAAc,KACjEzB,EAAW,MAAM,OAAQ,GAAGiC,KAAW,EAEvC,IAAMC,EAAYH,EAAe,OAAS,EACpCI,EAASJ,EAAe,IAAMG,EAAYT,EAAc,IAC9D,OAAAzB,EAAW,MAAM,MAAO,GAAGmC,KAAU,EAC9B,CAACF,EAASE,CAAM,CAC3B,CAEA,SAASL,GACL9B,EACAyB,EACAE,EACAC,EACA1B,EAAW,GACb,CACE,IAAM6B,EAAiB/B,EAAW,KAAK,EAAE,sBAAsB,EAE/D,GAAIoC,GAAqBX,EAAeM,CAAc,EAAG,CACrD,IAAMC,EAAaD,EAAe,MAAQN,EAAc,MACxDzB,EAAW,MAAM,OAAQ,GAAG2B,EAAOK,KAAc,CACrD,CAEA,GAAII,GAAqBX,EAAeM,EAAgB,QAAQ,EAAG,CAC/D,IAAMG,EAAYH,EAAe,OAASN,EAAc,OACxDzB,EAAW,MAAM,MAAO,GAAG4B,EAAMM,KAAa,CAClD,CAEA,GAAI,EAAChC,EAEL,IAAIkC,GAAqBX,EAAeM,EAAgB,MAAM,EAAG,CAC7D,IAAMC,EAAaD,EAAe,KAAON,EAAc,KACvDzB,EAAW,MAAM,OAAQ,GAAG2B,EAAOK,KAAc,CACrD,CAEA,GAAII,GAAqBX,EAAeM,EAAgB,KAAK,EAAG,CAC5D,IAAMG,EAAYH,EAAe,IAAMN,EAAc,IACrDzB,EAAW,MAAM,MAAO,GAAG4B,EAAMM,KAAa,CAClD,EACJ,CAEA,SAAS5B,GAAYN,EAAY,CACzBA,GACAA,EAGK,MAAM,UAAW,CAAC,CAE/B,CD/KO,SAASqC,GACZC,EACAC,EACF,CACE,IAAIC,EACAF,EAAS,WAAW,OAAS,EACpB,oBAAoB,gBAAa,CAAC,EAClC,gBAAa,EAE1B,OAAAE,EAASA,EAAO,SAAUC,GAAc,CACpCC,GAAQ,EAAE,SAASJ,CAAQ,EAAEG,CAAS,EACtCA,EAAU,MAAM,OAASE,GAAMJ,EAAMI,EAAE,GAAG,CAAC,CAC/C,CAAC,EAGI,iBAAcC,GAAaJ,CAAM,CAAC,EAClC,WAAYG,GAAMA,EAAE,UAAU,EAC9B,UAAWA,GAAOA,EAAE,UAAYA,EAAE,UAAY,CAAE,EAChD,UAAWA,GAAMA,EAAE,SAAS,CACrC,CAEA,IAAMC,GAAgBC,GAAY,CAC9B,IAAMC,EAAOC,GACFF,EAAQE,CAAG,EAGtB,OAAG,aAAUD,EAAKD,CAAO,EAEzBC,EAAI,UAAY,IAAIE,IACXA,EAAK,QAGVH,EAAQ,UAAU,KAAK,IAAIG,EAAK,GAAI,CAAC,CAAC,EAC/BF,GAHID,EAAQ,UAAU,EAM1BC,CACX,EMzCA,UAAYG,OAAQ,KCAb,SAASC,GAAaC,EAAqB,CAC9C,OAAOA,EAAI,MAAM,GAAG,EAAE,MAAM,EAAG,EAAE,EAAE,KAAK,GAAG,CAC/C,CCMO,SAASC,GACZC,EACAC,EACK,CACL,OAAOD,EAAS,KACX,IAAKE,GACF,OAAO,QAAQA,CAAG,EACb,OAAO,CAAC,CAACC,EAAGC,CAAC,IAAMD,EAAE,MAAM,GAAG,EAAE,GAAG,EAAE,IAAMF,GAAU,CAAC,CAACG,CAAC,EACxD,IAAI,CAAC,CAACC,EAAGD,CAAC,IAAMA,CAAC,CAC1B,EACC,KAAK,CACd,CFdO,SAASE,GACZC,EACuC,CACvC,IAAMC,EACFD,EAAS,MAAQA,EAAS,KAAK,OAAS,EAAIA,EAAS,KAAK,GAAK,CAAC,EAC9DE,EAAS,OAAO,KAAKD,CAAG,EAAE,OAAQE,GAAMA,IAAM,cAAc,EAClE,OAAOC,EAAW,EAAE,SAASJ,CAAQ,EAAE,OAAOE,CAAM,EAAE,CAC1D,CAEO,SAASG,GACZL,EACAM,EACuC,CACvC,IAAMC,EAAOC,GAAkBR,EAAUM,CAAM,EACzCJ,EAAS,CAAC,GAAG,IAAI,IAAIK,CAAI,CAAC,EAAE,KAAK,EACvC,OAAOH,EAAW,EAAE,SAASJ,CAAQ,EAAE,OAAOE,CAAM,EAAE,CAC1D,CAEO,SAASO,GACZT,EACAO,EACuC,CACvC,IAAIL,EAAS,CAAC,GAAG,IAAI,IAAIK,CAAI,CAAC,EAC9B,OAAOH,EAAW,EAAE,SAASJ,CAAQ,EAAE,OAAOE,CAAM,EAAE,CAC1D,CAEO,SAASQ,GACZV,EACuC,CACvC,IAAMC,EAAMD,EAAS,KAAK,IAAM,CAAC,EAC3BW,EAAQ,OAAO,KAAKV,CAAG,EACxB,OAAQE,GAAMA,IAAM,cAAc,EAClC,IAAKA,GAAMS,GAAaT,CAAC,CAAC,EACzBD,EAAS,CAAC,GAAG,IAAI,IAAIS,CAAK,CAAC,EACjC,OAAOP,EAAW,EAAE,SAASJ,CAAQ,EAAE,OAAOE,CAAM,EAAE,CAC1D,CAwBO,SAASE,GAAyB,CACrC,IAAIF,EAAS,KACTW,EAAiC,KACjCb,EAA+B,CAAC,EAChCc,EAAeC,GACfC,GAAYD,EAAGf,EAAS,aAAeA,EAAS,YAAY,OAAO,EAEjEiB,EAAqB,IAA+C,CACtE,IAAMC,EAASlB,EAAS,YAClBmB,EAAWN,GAAiB,CAACK,EAAO,MAAM,EAChD,GAAIC,GAAYjB,EAAO,OAAS,EAAG,CAC/B,IAAMkB,EAAQlB,EAAO,OAAS,EAAIgB,EAAO,OAASC,EAClD,OAAU,gBAAaC,EAAM,IAAIN,CAAW,CAAC,EAAE,OAAOZ,CAAM,CAChE,CACA,OAAO,IACX,EAEA,OAAAe,EAAO,OAAS,IAAII,IACZA,EAAK,SAAW,EACTnB,GAEXA,EAASmB,EAAK,GACPJ,GAGXA,EAAO,cAAgB,IAAII,IAClBA,EAAK,QAGVR,EAAgBQ,EAAK,GACdJ,GAHIJ,EAMfI,EAAO,YAAc,IAAII,IAChBA,EAAK,QAGVP,EAAcO,EAAK,GACZJ,GAHIH,EAMfG,EAAO,SAAW,IAAII,IACbA,EAAK,QAGVrB,EAAWqB,EAAK,GAETJ,GAJIjB,EAORiB,CACX,CAEO,SAASK,GAAeC,EAAO,CAClC,OAAOC,GAAW,CAAC,EAAED,CAAK,CAC9B,CAEO,SAASP,GAAYO,EAAOE,EAAU,GAAK,CAC9C,OAAOD,GAAWC,CAAO,EAAEF,CAAK,CACpC,CAEO,SAASC,GAAWC,EAAS,CAChC,OAAQF,GAAU,CACd,IAAMG,EAAa,SAAMH,CAAK,EAC9B,OAAIG,GAAY,OACZA,EAAQ,QAAUD,GAEfC,EAAU,EACrB,CACJ,CGrIA,OAAS,aAAAC,OAAiB,OAQ1B,IAAMC,GAAiB,CACnB,KAAMC,GACN,QAASA,GACT,KAAMA,GACN,OAAQA,EACZ,EASaA,EAAiBC,GAAsC,CAChE,IAAMC,EAAOC,GAASF,CAAQ,EAC1BG,EAAY,eAEVC,EAAgC,CAACC,EAAGC,IAC/BR,GAAeG,EAAK,GAAGE,CAAS,EAAEE,CAAC,EAG9C,OAAAE,GAAUH,EAAOH,CAAI,EAErBG,EAAM,UAAY,IAAII,IACbA,EAAK,QAIVL,EAAYK,EAAK,GACVJ,GAJID,EAORC,CACX,ECxCO,SAASK,GACZC,EACAC,EACA,CAAE,MAAAC,EAAQ,GAAO,aAAAC,EAAe,EAAM,EAAI,CAAC,EAC7C,CACE,IAAMC,EAAUH,GAAQD,EAAS,KAEjC,OAAIA,EAAS,YAAY,OAAS,EACvBK,GAA6BL,EAAUI,EAAS,CACnD,MAAAF,EACA,aAAAC,CACJ,CAAC,EAEE,CAACC,CAAO,CACnB,CAEA,SAASC,GACLL,EACAC,EACA,CAAE,MAAAC,EAAQ,GAAO,aAAAC,EAAe,EAAM,EACxC,CAIE,IAAMG,EAAc,CAAC,EAErB,OAAAL,EAAK,QAASM,GAAQ,CAElB,IAAMC,EAAa,CAAC,EACdC,EAAQ,CAAC,EAGf,OAAO,KAAKF,CAAG,EACV,OAAQG,GAAQA,IAAQ,cAAc,EACtC,OACIA,GACG,CAACP,GAAiBI,EAAIG,IAAQ,MAAQH,EAAIG,IAAQ,IAC1D,EACC,QAASA,GAAQ,CACd,IAAMC,EAASD,EAAI,MAAM,GAAG,EAEtBE,EAAQD,EAAOA,EAAO,OAAS,GAC/BE,EAAQN,EAAIG,IAAQ,EACpBI,EAAU,GAAGF,IAAQC,GAAS,EAAI,MAAQ,QAE1CE,EAAYJ,EAAO,MAAM,EAAGA,EAAO,OAAS,CAAC,EAAE,KAAK,GAAG,EAIvDK,EAAeP,EAAMM,GAAaN,EAAMM,IAAc,CACxD,aAAcR,EAAI,YACtB,EACMU,EAAYT,EAAWM,IAAY,EAEzCE,EAAY,QAAUD,EAGlBb,GACAc,EAAYJ,GAASK,EAAYJ,EACjCG,EAAY,iBAAiBJ,KAAWK,EACxCT,EAAWM,GAAWE,EAAYJ,IAElCI,EAAYJ,GAASC,EAEzBG,EAAY,IAAMT,CACtB,CAAC,EAGL,OAAO,KAAKE,CAAK,EAAE,QAASM,GAAc,EACtBT,EAAYS,GACxBT,EAAYS,IAAc,CAAC,GACxB,KAAKN,EAAMM,EAAU,CAChC,CAAC,CACL,CAAC,EAEM,OAAO,KAAKT,CAAW,EAAE,IAAKY,GAAM,CACvC,IAAMC,EAASb,EAAYY,GAC3B,OAAAC,EAAO,IAAMD,EACNC,CACX,CAAC,CACL,CC9EO,SAASC,GAAUC,EAAoBC,EAAoB,CAC9D,IAAMC,EAAQ,CAAE,MAAO,EAAM,EACvBC,EAAgBC,GAAqBJ,EAAUC,EAAMC,CAAK,EAAE,IAC7DD,GAASI,GAA0BL,EAAUC,EAAMC,CAAK,CAC7D,EAEA,OAAIF,EAAS,WAAW,OAAS,EACEG,EAAc,OAAO,CAACG,EAAGC,IACpDD,EAAE,OAAOC,CAAC,CACd,EAIGJ,CACX,CAEO,SAASK,GAAkBR,EAAoBC,EAAM,CACxD,IAAMC,EAAQ,CAAE,MAAO,EAAK,EAC5B,OAAOE,GAAqBJ,EAAUC,EAAMC,CAAK,EAAE,IAAKD,GACpDI,GAA0BL,EAAUC,EAAMC,CAAK,CACnD,CACJ,CAEA,SAASO,GAAaT,EAAoBC,EAAM,CAAE,MAAAC,EAAQ,EAAM,EAAG,CAC/D,IAAMQ,EAAUC,EAAcX,CAAQ,EAEtC,OAAQY,GAAc,CAClB,IAAMC,EAAaC,GACfZ,GAAQY,EAAI,iBAAiBF,EAAU,SAAW,EAChDG,EAASd,EAAK,IAAI,CAACa,EAAKE,KAAO,CACjC,WAAYN,EAAQI,EAAKE,CAAC,EAC1B,UAAaF,EAAIF,EAAU,MAAQE,EAAIF,EAAU,MAAQ,KACzD,UAAWC,EAAUC,CAAG,EACxB,IAAKA,EAAI,QACH,GAAGA,EAAI,WAAWF,EAAU,OAC5BA,EAAU,KAChB,IAAKE,EAAI,KAAOA,CACpB,EAAE,EACF,OAAAC,EAAO,IAAMA,EAAO,GAAG,IAChBA,CACX,CACJ,CAEA,SAASV,GACLL,EACAC,EACA,CAAE,MAAAC,EAAQ,EAAM,EAClB,CAEE,IAAMe,EAAWR,GAAaT,EAAUC,EAAM,CAAE,MAAAC,CAAM,CAAC,EAEvD,OAAIF,EAAS,WAAW,OAAS,EACtBA,EAAS,WAAW,IAAIiB,CAAQ,EAEhCA,EAASjB,EAAS,WAAW,EAAE,CAE9C,CC5DA,UAAYkB,OAAQ,KACpB,UAAYC,OAAc,gBCD1B,UAAYC,OAAc,gBAC1B,OAAS,aAAAC,OAAiB;;;ECCnB,SAASC,GAAiBC,EAAW,CACxC,IAAMC,EAAcD,EAAU,OAAO,eAAe,EAC9CE,EAAgBF,EAAU,KAAK,EAAE,sBAAsB,EAE7D,GACI,CAACG,GACGD,EACAD,EAAY,KAAK,EAAE,sBAAsB,CAC7C,EAEA,OAGJ,IAAMG,EAAMJ,EAAU,OAAO,SAAS,EAEtCC,EAAY,UAAU,QAAQ,EAAE,KAAK,CAACI,EAAGC,EAAGC,IAAU,CAClD,IAAMC,EAAOD,EAAMD,GACnB,GAAIH,GAAqBD,EAAeM,EAAK,sBAAsB,CAAC,EAAG,CACnE,IAAMC,EAAkBC,GACpBF,EACAJ,EACAF,CACJ,EACA,MAAO,GAAGG,EAAE,UAAU,EAAGI,EAAkB,CAAC,MAChD,KACI,QAAOJ,CAEf,CAAC,CACL,CAEA,SAASK,GAAwBF,EAAMJ,EAAKF,EAAe,CACvD,IAAMS,EAAWH,EAAK,sBAAsB,EACtCI,EAAcR,EAAI,KAAK,EAAE,eAAe,EAExCS,EAAc,EACpB,OAAAD,EAAY,EAAIV,EAAc,MAAQS,EAAS,KAAOE,EACtDD,EAAY,EAAI,EACTJ,EAAK,qBAAqBI,CAAW,CAChD,CCxCA,UAAYE,OAAQ,KCApB,UAAYC,OAAQ,KAKb,IAAMC,GAAS,GAOf,SAASC,GACZC,EACAC,EACAC,EACe,CACf,IAAMC,EACD,UAAOC,GAAgBJ,CAAS,EAAE,aAAa,CAAC,EAChD,KAAK,EACL,sBAAsB,EAErBK,EAA0BL,EAAU,sBAAsB,EAE1DM,EAAiC,CACnC,IAAKD,EAAc,IAAMH,EAAUJ,GACnC,MAAOO,EAAc,MAAQJ,EAAUH,GACvC,OAAQO,EAAc,OAASH,EAAUJ,GACzC,KAAMO,EAAc,KAAOJ,EAAUH,EACzC,EAEMS,EAAmC,CAAE,EAAGN,EAAS,EAAGC,CAAQ,EAQlE,MAP6D,CACzD,CAAE,KAAM,QAAS,UAAW,GAAI,EAChC,CAAE,KAAM,OAAQ,UAAW,GAAI,EAC/B,CAAE,KAAM,MAAO,UAAW,GAAI,EAC9B,CAAE,KAAM,SAAU,UAAW,GAAI,CACrC,EAEW,QAASM,GAAU,CAC1B,GACIC,GACIN,EACAG,EACAE,EAAM,IACV,EACF,CACE,IAAME,EACFJ,EAAqBE,EAAM,MAAQL,EAAcK,EAAM,MAC3DD,EAAgBC,EAAM,WAClBD,EAAgBC,EAAM,WAAaE,CAC3C,CACJ,CAAC,EAEMH,CACX,CDhDA,IAAMI,GAAyB,sBAExB,SAASC,IAAqB,CACjC,IAAIC,EAAS,GACTC,EAAW,KAETC,EAAaC,GAAY,CAC3B,IAAMC,EAAOD,EAAQ,KAAK,EACpBE,EAASD,EAAK,YAAY,EAAE,KAAK,QAAQ,oBAAoB,EACnEA,EAAK,MAAM,OAAS,OAChBH,EAAS,SACTG,EAAK,MAAM,KAAOH,EAAS,OAAO,KAClCG,EAAK,MAAM,IAAMH,EAAS,OAAO,KAGrC,IAAMK,EACD,QAA2B,EAC3B,GAAG,OAAQ,SAAUC,EAAO,CACzB,IAAMC,EAAUC,GACZ,KACAF,EAAM,GACNA,EAAM,EACV,EAEA,KAAK,MAAM,KAAO,GAAG,KAAK,WAAaC,EAAQ,MAC/C,KAAK,MAAM,IAAM,GAAG,KAAK,UAAYA,EAAQ,MAC7C,IAAME,EAAW,CACb,KAAM,KAAK,MAAM,KACjB,IAAK,KAAK,MAAM,GACpB,EACAT,EAAS,OAAS,CAAE,GAAGA,EAAS,OAAQ,GAAGS,CAAS,EAEpDV,EAASW,GAAiBP,CAAI,EACxBQ,GAAkBR,CAAI,EACtBS,GAAsBT,EAAMJ,CAAM,CAC5C,CAAC,EAELM,EAAK,GAAG,MAAO,SAAUC,EAAO,CACzB,UAAO,MAAM,EAAE,GAAGT,GAAwB,IAAI,EACjDO,GAAQ,cAAc,IAAI,MAAM,2BAA2B,CAAC,CAChE,CAAC,EAEDF,EAAQ,KAAKG,CAAI,CACrB,EAEA,OAAAJ,EAAU,SAAW,IAAIY,IAChBA,EAAK,QAGVb,EAAWa,EAAK,GACTZ,GAHID,EAMRC,CACX,CAEA,SAASW,GAAsBT,EAAMJ,EAAQ,CACzC,OAAIA,IAAW,IAIR,UAAO,MAAM,EAAE,GAAGF,GAAwB,UAAY,CACrD,IAAMU,EAAUC,GAA2BL,EAAM,EAAG,CAAC,EACrDA,EAAK,MAAM,KAAO,GAAGA,EAAK,WAAaI,EAAQ,MAC/CJ,EAAK,MAAM,IAAM,GAAGA,EAAK,UAAYI,EAAQ,KACjD,CAAC,EAEE,EACX,CAEA,SAASI,GAAkBR,EAAM,CAC7B,OAAG,UAAO,MAAM,EAAE,GAAGN,GAAwB,IAAI,EACjDM,EAAK,MAAM,KAAO,OACX,EACX,CAEA,SAASO,GAAiBP,EAAM,CAC5B,IAAMW,EAAWX,EAAK,sBAAsB,EACtCY,EACD,UAAOC,GAAkBb,CAAI,CAAC,EAC9B,KAAK,EACL,sBAAsB,EAErBc,EAAO,EAEb,OACIH,EAAS,MAAQI,GAASD,GAAQF,EAAc,OAChDD,EAAS,IAAMI,GAASD,GAAQF,EAAc,GAEtD,CEhGA,UAAYI,OAAQ,KAGpB,IAAMC,GAAwB,yBACxBC,GAAsB,uBACtBC,GAAoB,qBAEpBC,GAAqB,cAErBC,GAAc,EACdC,GAAc,SAEb,SAASC,IAAqB,CACjC,IAAIC,EAAgB,EAChBC,EAAS,EACTC,EAAW,KACTC,EAAkB,CAAE,OAAQ,IAAK,MAAO,GAAI,EAC5CC,EAAkB,CAAE,OAAQ,KAAM,MAAO,IAAK,EAE9CC,EAAiD,CAAC,EAClDC,EAAmB,CAACC,EAAOC,IAC7BH,EACK,OAAQI,GAAaA,EAAS,QAAUF,CAAK,EAC7C,QAASE,GAAaA,EAAS,QAAQD,CAAS,CAAC,EAEpDE,EAAaC,GAAc,CAC7B,GAAIC,GAAuBD,CAAS,EAChC,OAGJ,IAAME,EAAa,CACf,KAAON,GACHD,EAAiBR,GAAa,CAC1B,WAAYgB,EAASP,CAAK,EAC1B,SAAU,EACd,CAAC,EACL,IAAMA,GACFD,EAAiBR,GAAa,CAC1B,WAAY,GACZ,SAAUiB,GAAQR,CAAK,CAC3B,CAAC,EACL,MAAQA,GACJD,EAAiBR,GAAa,CAC1B,WAAYkB,EAAUT,CAAK,EAC3B,SAAU,EACd,CAAC,EACL,OAASA,GACLD,EAAiBR,GAAa,CAC1B,WAAY,GACZ,SAAUmB,EAAWV,CAAK,CAC9B,CAAC,EACL,QAAUA,GACND,EAAiBR,GAAa,CAC1B,WAAYgB,EAASP,CAAK,EAC1B,SAAUQ,GAAQR,CAAK,CAC3B,CAAC,EACL,SAAWA,GACPD,EAAiBR,GAAa,CAC1B,WAAYkB,EAAUT,CAAK,EAC3B,SAAUQ,GAAQR,CAAK,CAC3B,CAAC,EACL,YAAcA,GACVD,EAAiBR,GAAa,CAC1B,WAAYkB,EAAUT,CAAK,EAC3B,SAAUU,EAAWV,CAAK,CAC9B,CAAC,EACL,WAAaA,GACTD,EAAiBR,GAAa,CAC1B,WAAYgB,EAASP,CAAK,EAC1B,SAAUU,EAAWV,CAAK,CAC9B,CAAC,CACT,EAEMW,EAAgBP,EAAU,KAAK,EACjCT,EAAS,SACTgB,EAAc,MAAM,OAAShB,EAAS,OAAO,OAC7CgB,EAAc,MAAM,MAAQhB,EAAS,OAAO,OAGhD,IAAMiB,EAAyBD,EAAc,sBAAsB,EAC7DE,EACFT,EACK,OAAO,KAAK,EACZ,KAAK,KAAMf,EAAkB,EAC7B,KAAK,QAASuB,EAAc,KAAK,EACjC,KAAK,SAAUA,EAAc,MAAM,EAEtCE,EAAeD,EAAQ,OAAO,GAAG,EAEjCE,EAAcC,GAAMA,IAAM,QAAUA,IAAM,QAC1CC,EAAe,CACjB,KAAM,EACN,IAAKxB,EACL,MAAOmB,EAAc,MAAQnB,EAC7B,OAAQA,CACZ,EACMyB,EAAe,CACjB,KAAMzB,EACN,IAAK,EACL,MAAOA,EACP,OAAQmB,EAAc,OAASnB,CACnC,EACM0B,EAAc,CAAC,OAAQ,MAAO,QAAS,QAAQ,EAC/C,CAACC,EAAYC,EAAWC,EAAaC,CAAY,EACnDJ,EAAY,IAAKK,GACbV,EACK,OAAO,MAAM,EACb,KAAK,KAAM,OAAOU,GAAM,EACxB,KACG,QACAT,EAAWS,CAAI,EACTrC,GACAD,EACV,EACC,KAAK,IAAKgC,EAAaM,EAAK,EAC5B,KAAK,IAAKP,EAAaO,EAAK,EAC5B,KACG,SACAT,EAAWS,CAAI,EACTZ,EAAc,OAASnB,EAAgB,EACvCA,CACV,EACC,KACG,QACAsB,EAAWS,CAAI,EACT/B,EACAmB,EAAc,MAAQnB,EAAgB,CAChD,EACC,KAAK,OAAQsB,EAAWS,CAAI,EAAI,aAAe,WAAW,EAC1D,KAAK,eAAgBlC,EAAW,EAChC,MAAM,UAAWI,CAAM,EACvB,KACG,SACAqB,EAAWS,CAAI,EAAI,YAAc,WACrC,EACC,KAAQ,QAAK,EAAE,GAAG,OAAQlB,EAAWkB,EAAK,CAAC,CACpD,EAEEC,EAAqBC,GAAW,GAAGA,EAAO,KAAKA,EAAO,KACtDC,EAAqB,CACvB,QAAS,OACT,SAAU,OACV,YAAa,OACb,WAAY,MAChB,EACMC,EAAgB,CAClB,CAAC,MAAO,MAAM,EACd,CAAC,MAAO,OAAO,EACf,CAAC,SAAU,OAAO,EAClB,CAAC,SAAU,MAAM,CACrB,EACM,CACFC,EACAC,EACAC,EACAC,CACJ,EAAIJ,EAAc,IAAKF,GACnBZ,EACK,OAAO,MAAM,EACb,KAAK,KAAM,OAAOW,EAAkBC,CAAM,GAAG,EAC7C,KAAK,QAAS,GAAGtC,MAAqBsC,EAAO,MAAMA,EAAO,IAAI,EAC9D,KAAK,SAAUjC,CAAa,EAC5B,KAAK,QAASA,CAAa,EAC3B,KAAK,OAAQ,KAAK,EAClB,KAAK,eAAgBH,EAAW,EAChC,MAAM,UAAWI,CAAM,EACvB,KACG,SACA,GAAGiC,EAAmBF,EAAkBC,CAAM,WAClD,EACC,KACM,QAAK,EAAE,GAAG,OAAQpB,EAAWmB,EAAkBC,CAAM,EAAE,CAC9D,CACR,EAEAO,GAAqB,SAAU,IAAKV,CAAY,EAChDU,GAAqB,QAAS,IAAKX,CAAW,EAC9CY,GAAWrB,CAAO,EAElB,SAASN,EAASP,EAAO,CACrB,IAAMmC,EAASC,EACXC,GAA2BjB,EAAW,KAAK,EAAGpB,EAAM,EAAG,CAAC,EAAE,EAC1Da,EACA,QACA,CAACyB,EAAGC,KAAMD,EAAIC,EAClB,EACA,OAAA5B,EAAc,MAAM,KAAO,GAAGA,EAAc,WAAawB,MACzDxB,EAAc,MAAM,MAAQ,GACxBA,EAAc,YAAcwB,MAEhCK,EAAe,EACRC,EAAyBnB,EAAaa,EAAQ,QAAS,GAAG,CACrE,CAEA,SAAS1B,EAAUT,EAAO,CACtB,IAAMmC,EAAS,CAACC,EACZC,GAA2Bf,EAAY,KAAK,EAAGtB,EAAM,GAAI,CAAC,EAAE,EAC5Da,EACA,QACA,CAACyB,EAAGC,KAAMD,EAAIC,EAClB,EACA,OACIG,EACIP,EACA,IACAb,EACAtB,CACJ,EAEO,IACXW,EAAc,MAAM,MAAQ,GACxBA,EAAc,YAAcwB,MAEhCK,EAAe,EACRC,EAAyBnB,EAAaa,EAAQ,QAAS,GAAG,EACrE,CAEA,SAAS3B,GAAQR,EAAO,CACpB,IAAMmC,EAASC,EACXC,GAA2BhB,EAAU,KAAK,EAAG,EAAGrB,EAAM,CAAC,EAAE,EACzDa,EACA,SACA,CAACyB,EAAGC,KAAMD,EAAIC,EAClB,EACA,OAAA5B,EAAc,MAAM,IAAM,GAAGA,EAAc,UAAYwB,MACvDxB,EAAc,MAAM,OAAS,GACzBA,EAAc,aAAewB,MAEjCK,EAAe,EACRC,EACHlB,EACAY,EACA,SACA,GACJ,CACJ,CAEA,SAASzB,EAAWV,EAAO,CACvB,IAAMmC,EAAS,CAACC,EACZC,GAA2Bd,EAAa,KAAK,EAAG,EAAGvB,EAAM,EAAE,EAAE,EAC7Da,EACA,SACA,CAACyB,EAAGC,KAAMD,EAAIC,EAClB,EACA,OACIG,EACIP,EACA,IACAZ,EACAvB,CACJ,EAEO,IACXW,EAAc,MAAM,OAAS,GACzBA,EAAc,aAAewB,MAEjCK,EAAe,EACRC,EACHlB,EACAY,EACA,SACA,GACJ,EACJ,CAEA,SAASK,GAAiB,CACtB,IAAMG,EAAa,CACf,IAAKhC,EAAc,MAAM,IACzB,KAAMA,EAAc,MAAM,KAC1B,OAAQA,EAAc,MAAM,OAC5B,MAAOA,EAAc,MAAM,KAC/B,EACAhB,EAAS,OAAS,CAAE,GAAGA,EAAS,OAAQ,GAAGgD,CAAW,CAC1D,CAEA,SAASF,EAAyBG,EAAQT,EAAQU,EAAWC,GAAM,CAC/D,OAAAC,GAAiBlC,EAASgC,EAAWV,CAAM,EAC3Ca,GAAyBJ,EAAQE,GAAMX,CAAM,EAC7Cc,GACIpC,EACAsB,EACAU,EACAA,IAAc,SACR1D,GACAD,EACV,EACAgD,GAAWrB,CAAO,EACXsB,GAAU,CACrB,CAEA,SAASD,GAAWrB,EAAS,CACzBgB,EAAc,KAAK,IAAK,CAAC,EACzBC,EACK,KAAK,IAAK,CAAC,EACX,KAAK,IAAKjB,EAAQ,KAAK,OAAO,EAAIpB,CAAa,EACpDsC,EACK,KAAK,IAAKlB,EAAQ,KAAK,QAAQ,EAAIpB,CAAa,EAChD,KAAK,IAAKoB,EAAQ,KAAK,OAAO,EAAIpB,CAAa,EACpDuC,EACK,KAAK,IAAKnB,EAAQ,KAAK,QAAQ,EAAIpB,CAAa,EAChD,KAAK,IAAK,CAAC,CACpB,CAEA,SAASwC,GAAqBY,EAAWC,EAAMI,EAAgB,CAEvD,CAAC,CAACrD,EAAgBgD,IAClBhD,EAAgBgD,GAAajC,EAAciC,KAE3ClC,EAAc,MACVkC,GACA,GAAGhD,EAAgBgD,OACvBJ,EACIS,EACAtC,EAAciC,GAAahD,EAAgBgD,GAC3CA,EACAC,CACJ,EAER,CACJ,EAEA3C,EAAU,GAAK,CAACH,EAAOE,KACnBJ,EAAU,KAAK,CAAE,MAAOE,EAAO,QAASE,CAAS,CAAC,EAC3CC,GAGXA,EAAU,OAAUgD,IAChBzD,EAASyD,EACFhD,GAGXA,EAAU,SAAW,IAAIiD,IAChBA,EAAK,QAGVzD,EAAWyD,EAAK,GACTjD,GAHIR,EAMfQ,EAAU,SAAYgD,IAClBvD,EAAgB,MAAQuD,EAClBtD,EAAgB,QAClBA,EAAgB,MAAQ,KAAK,IACzBD,EAAgB,MAChBC,EAAgB,KACpB,GACGM,GAGXA,EAAU,UAAagD,IACnBvD,EAAgB,OAASuD,EACnBtD,EAAgB,SAClBA,EAAgB,OAAS,KAAK,IAC1BD,EAAgB,OAChBC,EAAgB,MACpB,GACGM,GAGXA,EAAU,YAAegD,IACrB1D,EAAgB0D,EACThD,GAGXA,EAAU,SAAYgD,IAClBtD,EAAgB,MAAQsD,EACxBvD,EAAgB,MAAQ,KAAK,IACzBA,EAAgB,MAChBC,EAAgB,KACpB,EACOM,GAGXA,EAAU,UAAagD,IACnBtD,EAAgB,OAASsD,EACzBvD,EAAgB,OAAS,KAAK,IAC1BA,EAAgB,OAChBC,EAAgB,MACpB,EACOM,GAGX,SAASuC,EACLP,EACAW,EACAF,EACA5C,EACF,CACE,IAAMqD,EAAwB,CAAClB,EAAQW,EAAMF,EAAQ5C,IACjDmC,EAAS,GAAKnC,EAAM8C,GAAQ,OAAOF,EAAO,KAAKE,CAAI,CAAC,EAClDQ,EAA+B,CAACnB,EAAQW,EAAMF,EAAQ5C,IACxDmC,EAAS,GAAKnC,EAAM8C,GAAQ,OAAOF,EAAO,KAAKE,CAAI,CAAC,EACxD,OACIO,EAAsBlB,EAAQW,EAAMF,EAAQ5C,CAAK,GACjDsD,EAA6BnB,EAAQW,EAAMF,EAAQ5C,CAAK,CAEhE,CAEA,SAASoC,EACLD,EACAoB,EACAV,EACAW,EACF,CACE,IAAMC,EAAuBD,EACzB,OAAOD,EAAoB,KAAKV,CAAS,CAAC,EAC1CV,CACJ,EACA,GAAIsB,EAAuB7D,EAAgBiD,GAAY,CACnD,IAAMa,EACF9D,EAAgBiD,GAAaY,EACjC,OAAOD,EAAiBrB,EAAQuB,CAAU,CAC9C,CACA,GACI,CAAC,CAAC7D,EAAgBgD,IAClBY,EAAuB5D,EAAgBgD,GACzC,CACE,IAAMa,EACF7D,EAAgBgD,GAAaY,EACjC,OAAOD,EAAiBrB,EAAQuB,CAAU,CAC9C,CACA,OAAOvB,CACX,CAEA,OAAOhC,CACX,CAGA,IAAM8C,GAA6B,CAC/BpC,EACAsB,EACAU,EACAc,IACC,CAC4B9C,EAAQ,UAAU,IAAI8C,GAAkB,EAChD,KAAK,CAACC,EAAG,EAAGC,IAAU,CACvC,IAAMC,EAAaD,EAAM,GACA,UAAOC,CAAU,EAC5B,KACVjB,EACAiB,EAAW,sBAAsB,EAAEjB,GAAaV,CACpD,CACJ,CAAC,CACL,EAEM9B,GAA0BD,GAC5BA,EAAU,OAAO,IAAIf,IAAoB,EAAE,KAAK,EAAI,EAElD2D,GAA2B,CAACJ,EAAQE,EAAMX,IAC5CS,EAAO,KAAKE,EAAM,OAAOF,EAAO,KAAKE,CAAI,CAAC,EAAIX,CAAM,EAElDY,GAAmB,CAAClC,EAASgC,EAAWV,IAC1CtB,EAAQ,KACJgC,EACAhC,EAAQ,KAAK,EAAE,sBAAsB,EAAEgC,GAAaV,CACxD,EJ/bJ,IAAM4B,GAAsB,GACtBC,GAAmB,GAElBC,GAAQ,CAACC,EAAYC,IAAa,CACrC,IAAMC,EAASF,GAAuB,eAAY,EAE9CG,EAAS,CAAC,EACVC,EAAY,EACZC,EACAC,EACAL,EAAS,QAAUA,EAAS,OAAO,UAC7BA,EAAS,OAAO,UAChB,EACNM,EAAqC,IAAM,CAAC,EAC5CC,EAAYC,GAAmB,EAAE,SAASR,CAAQ,EAClDS,EAEEC,EAAoBC,GAAc,CACpCT,EAASD,EAAO,MAAM,EAAE,OAAO,EAE/BQ,EAAYG,GAAmB,EAC1B,SAASZ,CAAQ,EACjB,UAAUE,EAAO,OAASN,GAAsBC,EAAgB,EAChE,GAAG,SAAU,IAAMgB,EAAOF,CAAS,CAAC,EAEzCF,EAAUE,CAAS,EACnBJ,EAAUI,CAAS,EACnBE,EAAOF,CAAS,CACpB,EAEME,EAAUF,GAAc,CAC1BG,EAAkBH,CAAS,EAC3BI,EAAeJ,CAAS,EACxBK,EAAaL,CAAS,EACtBM,GAAiBN,CAAS,CAC9B,EAEMI,EAAkBJ,GAAc,CAClC,IAAMO,EAAWC,EAAkBR,CAAS,EAC5CO,EAAS,MAAM,UAAWf,GAAa,EAAI,OAAS,OAAO,EAE3De,EAAS,OAAO,YAAY,EAAE,KAAK,GAAGb,EAAY,KAAKF,GAAW,EAElEe,EACK,OAAO,WAAW,EAClB,KAAK,QAASb,IAAc,EAAI,WAAa,EAAE,EAC/C,GAAG,QAAS,IAAM,CACXA,EAAY,IACZe,EAAQf,EAAY,CAAC,EACrBQ,EAAOF,CAAS,EAExB,CAAC,EAELO,EACK,OAAO,aAAa,EACpB,KAAK,QAASb,GAAaF,EAAY,EAAI,WAAa,EAAE,EAC1D,GAAG,QAAS,IAAM,CACXE,EAAYF,EAAY,IACxBiB,EAAQf,EAAY,CAAC,EACrBQ,EAAOF,CAAS,EAExB,CAAC,CACT,EAEMK,EAAgBL,GAAc,CAC5BR,EAAY,GAAGF,EAAO,WAAWoB,EAAW,CAAC,EACjDV,EAAU,OAAO,eAAe,EAAE,OAAO,EAEzC,IAAMW,EAAgBC,EAAiBZ,CAAS,EAChDW,EAAc,KAAKrB,CAAM,EAEzB,IAAMuB,EAAoBb,EACrB,OAAO,eAAe,EACtB,KAAK,EACL,QAAQ,EACbW,EAAc,KACV,SACAE,EAAkB,OAAS3B,EAC/B,EAEAS,EAASK,CAAS,CACtB,EAEMS,EAAWK,GAAU,CACvBpB,EAAYoB,EACZzB,EAAS,OAAS,CAAE,GAAGA,EAAS,OAAQ,UAAAK,CAAU,CACtD,EAEMgB,EAAa,IAAM,CAACK,EAAGC,IACzBA,GAAKvB,EAAWC,GAAasB,EAAIvB,EAAWC,EAAYD,EAEtDU,EAAqBH,GAAc,CACrC,IAAMiB,EAAsBjB,EAAU,KAAK,EAAE,sBAAsB,EAC/DkB,EACA,KAAK,MAAMD,EAAoB,OAAShC,EAAmB,EAAI,EAInEQ,EACIyB,EAAmB3B,EAAO,OACpB2B,EAAmB,EACnBA,EACV1B,EAAY2B,EAAmBD,CAAgB,EAC/CxB,EAAY,KAAK,IAAIA,EAAWF,EAAY,CAAC,CACjD,EAEM2B,EAAsB1B,GACxB,KAAK,KAAKF,EAAO,OAASE,CAAQ,EAEhCe,EAAqBY,GACvBC,EAAmBD,EAAW,mBAAoB,IAC9CA,EACK,OAAO,GAAG,EACV,KAAK,QAAS,iBAAiB,EAC/B,KAAKE,EAAsB,CACpC,EAEEV,EAAoBQ,GACtBC,EAAmBD,EAAW,UAAW,IACrCA,EAAU,OAAO,KAAK,EAAE,KAAK,QAAS,QAAQ,CAClD,EAEJ,OAAArB,EAAiB,SAAW,IAAIwB,IACvBA,EAAK,QAGV5B,EAAW4B,EAAK,GACTxB,GAHIJ,EAMf6B,GAAUzB,EAAkBT,CAAM,EAE3BS,CACX,EDhIA,IAAM0B,GAAqBC,GACvBC,GACa,eAAY,EAAE,MAAM,QAAQ,EAAE,YAAY,CAAC,EACpDD,CACJ,EAEEE,GAAsBF,GACxBC,GACa,gBAAa,EAAE,aAAa,CAAC,EAAE,YAAY,CAAC,EACrDD,CACJ,EAESG,EAAc,IAAMC,GAAgBL,EAAiB,EACrDM,GAAe,IACxBD,GAAgBF,GAAoBI,EAAW,EACtCC,GAAmB,IAC5BH,GAAgBL,GAAmBO,EAAW,EAElD,SAASA,GAAYE,EAAW,CAC5B,GAAI,CAACA,EAAW,OAAO,KAEvB,IAAMC,EAASD,EAAU,OAAO,EAC1BE,EAAQF,EAAU,MAAM,EAAE,IAAK,GAAS,UAAO,EAAE,KAAK,CAAC,EAAE,CAAC,EAEhE,OAAU,gBAAa,EAAE,OAAOC,CAAM,EAAE,MAAMC,CAAK,CACvD,CAeA,SAASN,GACLO,EACAC,EAAgB,OACD,CACf,IAAIZ,EAAoC,CAAC,EACrCa,EAAQ,KACRC,EAAwB,KAEtBC,EAAoCC,GAAc,CACpD,GAAIH,GAASA,EAAM,MAAM,EAAE,OAAS,EAAG,CACnC,IAAMI,EAAeN,EAAsBX,CAAQ,EACnDiB,EACK,MAAMJ,CAAK,EACX,OAAO,UAAU,EACjB,GAAG,YAAa,SAAUK,EAAI,CAE3B,IAAMC,EAAI,KAAK,SACfnB,EAAS,SAAWA,EAAS,UAAY,CAAC,EACtCA,EAAS,SAAS,SAASmB,CAAC,EAC5BnB,EAAS,SAAWA,EAAS,SAAS,OACjCoB,GAAMA,IAAMD,CACjB,EAEAnB,EAAS,SAAS,KAAKmB,CAAC,EAG5BE,GAAgB,IAAI,EAAE,MAAM,CAChC,CAAC,EAELJ,EAAa,OAAQK,GAAY,CAC7B,IAAMC,EAAQ,OAAOD,EAAQ,OAAOA,EAAQ,EAAE,EAAE,MAAM,GAAG,EACzD,OAAOtB,EAAS,WAAW,QAAU,GAAKuB,EAAM,OAAS,EACnDA,EAAM,MAAM,EAAGA,EAAM,OAAS,CAAC,EAAE,KAAK,GAAG,EACzCD,EAAQ,OAAOA,EAAQ,EACjC,CAAC,EAED,IAAME,EAAkBC,EACpBT,EACA,uBACA,IAAMA,EAAU,OAAO,KAAK,CAChC,EAEAC,EAAa,SAAUS,GAAc,CACjC,IAAMC,EAAYC,GACd5B,EAAS,UAAYA,EAAS,SAAS,SAAS4B,CAAI,EAElDC,EAAQH,EACT,OAAO,eAAe,EACtB,KAAK,YAAa,kBAAkB,EACpC,UAAU,QAAQ,EAEvBG,EAAM,QAAQ,SAAUF,CAAQ,EAChCE,EAAM,OAAO,OAAO,EAAE,KAAMV,GAAMA,CAAC,EAE/BL,GACAe,EACK,OAAO,cAAc,EACrB,MAAM,OAASV,GAAOQ,EAASR,CAAC,EAAI,KAAOL,EAAMK,CAAC,CAAE,EACpD,MAAM,SAAWA,GACdQ,EAASR,CAAC,EAAI,KAAOW,GAAehB,EAAMK,CAAC,CAAC,CAChD,CAEZ,CAAC,EAGDK,EACK,KAAK,QAAS,kBAAkB,EAChC,KAAK,qBAAsB,EAAI,EAC/B,MAAM,UAAW,GAAG,EACpB,KAAKP,CAAY,CAC1B,CACJ,EAEA,OAAAF,EAAO,SAAW,IAAIgB,IACdA,EAAK,SAAW,EACT/B,GAEXA,EAAW+B,EAAK,GAEThB,GAGXA,EAAO,MAAQ,IAAIgB,IACVA,EAAK,QAGVlB,EAAQD,EAAgBA,EAAcmB,EAAK,EAAE,EAAIA,EAAK,GAC/ChB,GAHIF,EAMfE,EAAO,MAAQ,IAAIgB,IACVA,EAAK,QAGVjB,EAAQiB,EAAK,GACNhB,GAHID,EAMRC,CACX,CMrJO,SAASiB,EACZC,EACAC,EAA0B,OAC5B,CACE,IAAMC,EAAUD,GAAQD,EAAS,KAEjC,OADYA,EAAS,UAAU,QAAU,GAC5B,EACPE,EAAQ,IAAKC,GAAQ,CACjB,IAAMC,EAAQ,CAAE,GAAGD,CAAI,EACvB,OAAAH,EAAS,SAAS,QAASK,GAAM,CAC7B,OAAOD,EAAMC,EACjB,CAAC,EACMD,CACX,CAAC,EACDF,CACV,CAEO,SAASI,GAAkBN,EAAqC,CACnE,IAAMO,EAAUP,EAAS,KACnBQ,EAAcR,EAAS,UAAU,QAAU,EAC3CS,EAAeT,EAAS,YAAY,OAC1C,OAAOQ,EAAc,EACfC,IAAiB,EACbF,EAAQ,OAAQG,GACL,OAAO,OAAOA,CAAG,EAAE,OACtB,CAACC,EAAKC,IAAQD,GAAO,CAACX,EAAS,SAAS,SAASY,CAAG,EACpD,EACJ,CACH,EACDL,EAAQ,IAAKG,GAAQ,CACjB,IAAMG,EAAU,OAAO,QAAQH,CAAG,EAAE,OAChC,CAAC,CAACI,EAAKC,CAAI,IACP,CAACf,EAAS,SAAS,SAASgB,GAAaF,CAAG,CAAC,CACrD,EACA,OAAO,OAAO,YAAYD,CAAO,CACrC,CAAC,EACLN,CACV,CCxCA,UAAYU,OAAQ,OAGpB,IAAMC,GAAeC,GAAa,CAACC,EAAGC,IAClCD,EACK,MAAM,eAAiBC,GAAU,KAAK,EACtC,MAAM,SAAWA,GAAUC,GAAWD,EAAOF,CAAQ,CAAC,EAE/D,SAASG,GAAWD,EAAOF,EAAU,CACjC,OAAIE,IAAU,EACNF,EACOA,EAAS,WAAW,MAEpB,OAEJA,EACAA,EAAS,YAAY,KAAK,cAE1B,MAEf,CAEA,IAAMI,GAAkBJ,GAAa,CAACK,EAAGH,IAAU,CAC/CG,EAAE,YAAcF,GAAWD,EAAOF,CAAQ,EAC1CK,EAAE,UAAY,CAClB,EAEMC,GAAe,CAACL,EAAGM,IAAMN,EAAE,MAAM,UAAW,MAAM,EAClDO,GAAmBR,GAAa,CAACK,EAAGH,IAAU,CAChDG,EAAE,UAAY,EACdA,EAAE,YAAcF,GAAWD,EAAOF,CAAQ,CAC9C,EAqBOS,EAAQ,CAACC,EAAQV,IAA4B,CAChD,IAAIW,EAAS,OACTC,EAAS,GACTC,EAAS,KACTC,EAAS,KACTC,EAAU,KAEVC,EAAiB,kBAAe,EAChCC,EAAwB,yBAAsB,EAC9CC,EAAWnB,GAAYC,CAAQ,EAC/BmB,EAAYb,GAEVc,EAAyC,YAAaC,EAAM,CAC1DT,IACAI,EAAiB,qBAAkB,EAAE,QAAQD,CAAO,EACpDE,EAAwB,4BAAyB,EACjDC,EAAWd,GAAeJ,CAAQ,EAClCmB,EAAYX,GAAgBR,CAAQ,GAGxC,IAAMsB,EAAQN,EAAY,OAAOH,CAAM,EAAE,OAAOC,CAAM,EAEhDS,EAASZ,IAAW,WAAaQ,EAAYD,EAC7CM,EAASb,IAAW,aAAeQ,EAAYD,EAE/CO,EAAYR,EACb,UAAUM,CAAM,EAChB,UAAUC,CAAM,EAErB,OAAOF,EAAM,OAAO,CAACG,EAAWf,CAAM,CAAC,EAAE,GAAGW,CAAI,CACpD,EAEA,OAAAD,EAAe,OAAS,IAAIC,IACnBA,EAAK,QAGVV,EAASU,EAAK,GACPD,GAHIT,EAMfS,EAAe,OAAS,IAAIC,IACnBA,EAAK,QAGVT,EAASS,EAAK,GACPD,GAHIR,EAMfQ,EAAe,OAAS,IAAIC,IACnBA,EAAK,QAGVR,EAASQ,EAAK,GACPD,GAHIP,EAMfO,EAAe,OAAS,IAAIC,IACnBA,EAAK,QAGVP,EAASO,EAAK,GACPD,GAHIN,EAMfM,EAAe,QAAU,IAAIC,IACpBA,EAAK,QAGVN,EAAUM,EAAK,GACRD,GAHIL,EAMRK,CACX,EC3HA,UAAYM,OAAQ,OAEb,IAAMC,EAAuB,IAAuB,CACvD,IAAMC,EAAkBC,GAAe,EAEjCC,EAAqCC,GAAW,CAClD,IAAIC,EAAMJ,EAAgB,IAAI,EAC1BK,EAAUL,EAAgB,QAAQ,EAElCM,EAAQ,EACZ,OAAQD,OACC,SACD,UAEC,UAAW,CACZC,EAAQH,EAAO,GAAKA,EAAO,GAC3B,KACJ,SAEI,MAAM,IAAI,MAAM,oBAAsBE,CAAO,EAGrD,IAAIE,EAAoBJ,EAAO,GAAKC,EAAI,GAAKE,EACzCE,EAAoBL,EAAO,GAAKC,EAAI,GAAKE,EAI7C,OAAAH,EAAO,GACHA,EAAO,IAAM,GAAKI,EAAoB,EAAI,EAAIA,EAClDJ,EAAO,GACHA,EAAO,IAAM,GAAKK,EAAoB,EAAI,EAAIA,EAC3CL,CACX,EAEA,OAAAD,EAAQ,IAAM,YAAaO,EAAmB,CAC1C,OAAOT,EAAgB,IAAI,CAC/B,EAEAE,EAAQ,QAAU,YAAaO,EAAuB,CAClD,OAAOT,EAAgB,QAAQ,CACnC,EAEG,aAAUE,EAASF,CAAe,EAE9BE,CACX,EC/CA,UAAYQ,OAAQ;;;;EAIpB,IAAOC,EAAQ,IAAM,CACjB,IAAIC,EAAQ,KACRC,EAAW,KACXC,EAAS,KACTC,EAAQ,KACRC,EAAS,KACTC,EAAQ,KACRC,EAAQ,GACRC,EAAS,GACTC,EAAgC,IAAM,CAAC,EAE3C,SAASC,EAAcC,EAAW,CAC9B,IAAMC,EAAgB,QAAQJ,EAAS,SAAW,kBAClD,GAAIL,GAAUE,EAAQ,CAClB,IAAMQ,EAAWT,GAASA,EAAM,OAAO,EAAE,aAAc,KACjDU,EAAU,QAAK,EAAE,GAAG,OAASC,GAAU,CACzC,GAAM,CAAE,UAAAC,CAAU,EAAID,EACtBb,EAAS,KAAO,CACZ,EAAGc,EAAU,EACb,EAAGA,EAAU,EACb,EAAGA,EAAU,CACjB,EAEAC,EAAeD,CAAS,EAExBL,EAAU,KAAKV,CAAK,EAEpB,IAAMiB,EACFF,EAAU,IAAM,GAAKA,EAAU,IAAM,GAAKA,EAAU,IAAM,EAExDG,EAAeC,EAAgBT,CAAS,EAAE,MAC5C,UACAO,EAAS,OAAS,EACtB,EACAC,EACK,OAAO,aAAa,EACpB,GAAG,QAAS,IACTR,EACK,OAAOC,CAAa,EACpB,KAAKE,EAAK,UAAc,eAAY,CAC7C,EAEJ,IAAMO,EAAUF,EACX,OAAO,WAAW,EAClB,MAAM,UAAWN,EAAW,GAAK,MAAM,EACtCS,EAAYH,EACb,OAAO,aAAa,EACpB,MAAM,UAAWN,EAAW,GAAK,MAAM,EACtCU,EAAWJ,EACZ,OAAO,YAAY,EACnB,MAAM,UAAWN,EAAW,GAAK,MAAM,EAC5C,GAAIA,EAAU,CACV,IAAMW,EAAaC,GAAmB,IAAM,CACxC,IAAMC,EAAQ,IAAI,KAAKvB,EAAO,OAAO,EAAE,EAAE,EACnCwB,EAAM,IAAI,KAAKD,CAAK,EAC1BD,EAAeC,EAAOC,CAAG,EAEzB,IAAMC,EAASxB,EAAM,MAAM,EACrByB,GACDD,EAAO,GAAKA,EAAO,KACnBxB,EAAMuB,CAAG,EAAIvB,EAAMsB,CAAK,GACvBI,EAAI,CAAC1B,EAAMsB,CAAK,EAAIG,EACtBE,EAAI,EACR,GAAI1B,EAAQ,CACR,IAAM2B,GACF3B,EAAO,OAAO,EAAE,OAAO,CAAC4B,EAAGC,IAAMD,EAAIC,CAAC,EAAI,EAC9CH,EAAI,CAACzB,EAAM0B,EAAO,EAAIH,EAAIxB,EAAO2B,EAAO,CAC5C,CACArB,EACK,OAAOC,CAAa,EACpB,KACGE,EAAK,UACF,gBAAa,UAAUgB,EAAGC,CAAC,EAAE,MAAMF,CAAC,CAC3C,CACR,EAEAR,EAAQ,GACJ,QACAG,EAAU,CAACE,EAAOC,IACdA,EAAI,QAAQD,EAAM,YAAY,EAAI,CAAC,CACvC,CACJ,EACAJ,EAAU,GACN,QACAE,EAAU,CAACE,EAAOC,IACdA,EAAI,SAASD,EAAM,SAAS,EAAI,CAAC,CACrC,CACJ,EACAH,EAAS,GACL,QACAC,EAAU,CAACE,EAAOC,IACdA,EAAI,SAASD,EAAM,SAAS,EAAI,CAAC,CACrC,CACJ,CACJ,CACJ,CAAC,EAEKS,EAAclC,EAAM,SAAS,EACnCA,EAAM,SAAS,CAACmC,EAAKC,IAAS,CAE1B,GADAF,EAAYC,EAAKC,CAAI,EACjB,CAAC9B,EAAO,CACRA,EAAQ,GAER,IAAM+B,EAAWF,EAAI,OAAOxB,CAAa,EACnC2B,EAAsB/B,EACtB,OAAO,iBACP,EAEN8B,EACK,GAAG,qBAAuBvB,GAAU,CAYjC,GAXIX,GACAA,EAAM,MAAM,CACR,EACAW,EAAM,OAAO,MAAQwB,CACzB,CAAC,EACDjC,GACAA,EAAM,MAAM,CACR,EACAS,EAAM,OAAO,OAASwB,CAC1B,CAAC,EAEDrC,EAAS,KAAM,CACf,IAAMsC,EAAsB,gBACvB,UAAUtC,EAAS,KAAK,EAAGA,EAAS,KAAK,CAAC,EAC1C,MAAMA,EAAS,KAAK,CAAC,EAC1BoC,EAAS,KAAKxB,EAAK,UAAW0B,CAAgB,CAClD,CACJ,CAAC,EACA,KAAK1B,CAAI,CAClB,CACJ,CAAC,CACL,CAEAH,EAAU,KAAKV,CAAK,CACxB,CAEAS,EAAc,MAAQ,IAAI+B,IACjBA,EAAK,QAGVxC,EAAQwC,EAAK,GACN/B,GAHIT,EAMfS,EAAc,SAAW,IAAI+B,IACpBA,EAAK,QAGVvC,EAAWuC,EAAK,GACT/B,GAHIR,EAMfQ,EAAc,OAAS,IAAI+B,IAClBA,EAAK,QAGVtC,EAASuC,EAAcD,EAAK,EAAE,EAC9BrC,EAAQD,EAASA,EAAO,KAAK,EAAI,KAC1BO,GAJIP,EAOfO,EAAc,OAAS,IAAI+B,IAAS,CAChC,GAAI,CAACA,EAAK,OACN,OAAOpC,EAIX,GAFAA,EAASqC,EAAcD,EAAK,EAAE,EAC9BnC,EAAQD,EAASA,EAAO,KAAK,EAAI,KAC7BC,EAAO,CACP,IAAMqC,EAAUrC,EAAM,OAAO,EAC7BA,EAAM,OAAO,CAACqC,EAAQ,GAAIA,EAAQ,EAAE,CAAC,CACzC,CACA,OAAOjC,CACX,EAEAA,EAAc,OAAS,IAAI+B,IAClBA,EAAK,QAGVjC,EAASiC,EAAK,GACP/B,GAHIF,EAMfE,EAAc,SAAW,IAAI+B,IACpBA,EAAK,QAGVhC,EAAWgC,EAAK,GACT/B,GAHID,EAMf,IAAMQ,EAAkBD,GAAc,CAClC,IAAM4B,EAAa,CAAE,GAAG5B,CAAU,EAMlC,GALIb,IACAA,EAAO,OAAOa,EAAU,SAASZ,CAAK,EAAE,OAAO,CAAC,EAChDwC,EAAW,QAAUzC,EAAO,OAAO,GAGnCE,EAAQ,CACR,IAAMwC,EAAc7B,EAAU,SAASV,CAAK,EAAE,OAAO,EACrDD,EAAO,OAAO,CAACwC,EAAY,GAAIA,EAAY,EAAE,CAAC,EAC9CD,EAAW,QAAUvC,EAAO,OAAO,CACvC,CAEAI,EAASmC,CAAU,CACvB,EAEMxB,EAAmB0B,GACrBC,EAAmBD,EAAW,iBAAkB,IAC5CA,EACK,OAAO,KAAK,EACZ,KAAK,QAAS,eAAe,EAC7B,MAAM,UAAW,MAAM,EACvB,KAAKE,EAAQ,CACtB,EAEEN,EAAiBO,GACfA,GAASA,EAAM,KACRA,EAEJ,KAGX,OAAOvC,CACX,EtCpNA,SAASwC,GAASC,EAA0BC,EAAoB,CAC5D,IAAMC,EAAOC,GAAkBF,EAAUG,EAAWH,CAAQ,CAAC,EACvDI,EAAQC,GAAaL,CAAQ,EAE7BM,EAASC,EAAY,EAAE,SAASP,CAAQ,EAAE,MAAMI,CAAK,EAErDI,EAAOC,GAAUT,EAAUI,CAAK,EAAE,OAAO,YAAY,EACrDM,EACD,kBAAe,EACf,QAAQ,CAACT,EAAMU,IAAUV,EAAKU,EAAM,EACpC,OAAOV,EAAK,IAAI,IAAMO,CAAI,CAAC,EAE1BI,EAAQC,EAAYb,CAAQ,EAC7B,YAAY,YAAY,EACxB,UAAU,WAAW,EACrB,UAAUA,EAAS,SAAS,EAAE,EAC9B,YAAYc,EAAW,OAAO,EAC9B,QAAQ,CAAC,CAAC,CAAC,EACX,gBAAgBC,EAAqB,CAAC,EAAEd,CAAI,EAC3Ce,EAAQH,EAAYb,CAAQ,EAC7B,YAAYc,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EACtB,OAAO,UAAU,EAAEb,CAAI,EAEtBgB,EAAQC,EAAgBN,EAAOI,CAAK,EAAE,SACxCG,EAAcT,EAAQV,CAAQ,EAAE,OAAO,YAAY,CACvD,EAEIiB,EAAM,gBACNA,EAAM,cAAc,EAAG,EACvBA,EAAM,cAAc,GAAI,EACxBT,EAAK,MAAM,MAAM,GAErBS,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAMG,EAAYC,EAAc,EAC3B,MAAMJ,CAAK,EACX,SAASjB,CAAQ,EACjB,OAAOgB,EAAM,KAAK,EAGvBjB,EAAU,MAAME,CAAI,EAAE,KAAKmB,CAAS,EACpCrB,EAAU,KAAKO,CAAM,CACzB,CAEAR,GAAS,OAAS,CACd,KAAM,QACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,QAAQ,CACpB,CACJ,EAEA,IAAOwB,GAAQxB,GuCxEf,UAAYyB,OAAQ,OCEpB,IAAOC,GAAQ,CAACC,EAAsBC,IAAyB,CAC3D,GAAI,CAACC,GAAYF,CAAO,GAAK,CAACE,GAAYD,CAAO,EAAG,OAEpD,IAAME,EAASC,GAAYJ,CAAO,EAC5BK,EAASD,GAAYH,CAAO,EAE9BE,EAASE,EACTJ,EAAQ,GAAKK,GAAiBL,EAASE,CAAM,EAE7CH,EAAQ,GAAKM,GAAiBN,EAASK,CAAM,CAErD,EAEMH,GAAeK,GACjBA,EAAO,SAAW,GAClB,CAAC,MAAMA,EAAO,EAAE,GAChB,CAAC,MAAMA,EAAO,EAAE,GAChBA,EAAO,KAAOA,EAAO,GACnBH,GAAeG,IAChB,EAAIA,EAAO,KAAOA,EAAO,GAAKA,EAAO,IACpCD,GAAmB,CAACC,EAAqBC,IAC1CA,EAAQD,EAAO,IAAOC,EAAQ,GCvBnC,UAAYC,OAAQ,OAyBb,IAAMC,GAAkBC,GAAuC,CAClE,IAAIC,EAA0B,CAAC,EAC3BC,EAAM,GACNC,EAEEC,EAAoCC,GAA6B,CACnEA,EAAU,KAAK,EAAE,EAEjB,IAAMC,EACD,YAAS,OAAQ,gBAAgB,EACjC,IAAKC,GAAMA,CAAC,EAEXC,EAAW,CAACN,GAAOD,EAAO,SAAW,EACrCQ,EAAWN,GAASH,EAAS,YAAY,SAAW,EAC1DM,EAAcD,EAAWJ,CAAM,EAC1B,QAAQ,WAAYO,CAAQ,EAC5B,KAAMD,GAAMA,EAAE,IAAI,EAClB,MAAM,QAAUA,GACbE,EAAWC,GAAeP,EAAMI,EAAE,IAAI,CAAC,EAAI,MAC/C,EACC,GAAG,QAAS,CAACI,EAAO,IAAM,CACnBH,IAEAN,EACAF,EAAS,gBAAkBA,EAAS,gBAAgB,OAC/CY,GAAMA,GAAK,EAAE,IAClB,EAEAZ,EAAS,gBAAkB,CAAC,EAAE,IAAI,EAAE,OAChCA,EAAS,iBAAmB,CAAC,CACjC,EAGJW,EAAM,OACD,YAAY,EACZ,KAAK,QAAQ,oBAAoB,GAChC,cAAc,IAAI,MAAM,2BAA2B,CAAC,EAE1DE,EAAYR,CAAS,EACzB,CAAC,CACT,EAEMQ,EAAeR,GAA6B,CAC9C,IAAMS,EAAeC,GAAgBV,EAAU,KAAK,CAAC,EACrDS,EAAa,WAAW,UAAY,GACpCA,EAAa,MAAM,CACvB,EAEA,OAAAV,EAAQ,OAAS,IAAIY,IACZA,EAAK,QAGVf,EAASe,EAAK,GACPZ,GAHIH,EAKfG,EAAQ,IAAM,IAAIY,IACTA,EAAK,QAGVd,EAAMc,EAAK,GACJZ,GAHIF,EAMfE,EAAQ,MAAQ,IAAIY,IACXA,EAAK,QAGVb,EAAQa,EAAK,GACNZ,GAHID,EAMRC,CACX,EC/EO,IAAMa,GAAe,CACxBC,EACAC,EACAC,EAAUC,KACK,CACf,IAAIC,EACAC,EACAC,EAGEC,EAAkBP,EAAS,iBAAmB,CAAC,EAC/CQ,EAAYC,GAAS,CACvB,IAAMC,EAAQD,EAAK,MAAM,GAAG,EAC5B,OAAOF,EAAgB,SAASG,EAAMA,EAAM,OAAS,EAAE,CAC3D,EAEMC,EAAqBX,EAAS,WAAc,KAAMY,GACpDJ,EAASI,EAAE,IAAI,CACnB,EAGAP,EAAOM,EACDT,EAAQD,EAAaY,GAAQ,CAACL,EAASK,CAAG,CAAC,EAC3CZ,EACNK,EAAUK,EAAYT,EAAQD,EAAYO,CAAQ,EAAI,KAGtD,IAAMM,EAAiBC,GAAc,CACjC,GAAIf,EAAS,WAAc,SAAW,EAAG,OAEzC,IAAMgB,EAAahB,EAAS,WAAc,IAAI,CAACiB,EAAGC,KAAO,CACrD,MAAOA,EACP,KAAMD,EAAE,IACZ,EAAE,EACIE,EAAaH,EAAW,OAAQC,GAAM,CAACT,EAASS,EAAE,IAAI,CAAC,EACvDG,EAAYJ,EAAW,OAAQC,GAAMT,EAASS,EAAE,IAAI,CAAC,EAErDI,EAAW,IAAMC,GAAetB,CAAQ,EAAE,MAAMI,CAAK,EAE3DW,EACK,OAAO,qBAAqB,EAC5B,KAAKM,EAAS,EAAE,OAAOF,CAAU,CAAC,EACvCJ,EACK,OAAO,sBAAsB,EAC7B,KAAKM,EAAS,EAAE,OAAOD,CAAS,EAAE,IAAI,EAAI,CAAC,CACpD,EAEA,OAAAN,EAAS,MAAQ,IAAIS,IACZA,EAAK,QAGVnB,EAAQmB,EAAK,GACNT,GAHIV,EAMfU,EAAS,UAAY,IAAeH,EAEpCG,EAAS,KAAO,IAAIS,IACXA,EAAK,QAGVlB,EAAOkB,EAAK,GACLT,GAHIT,EAMfS,EAAS,QAAU,IAAIS,IACdA,EAAK,QAGVjB,EAAUiB,EAAK,GACRT,GAHIR,EAMRQ,CACX,EAEaX,GAAoB,CAACF,EAAYuB,IACnCvB,EAAW,IAAKwB,GAAMA,EAAE,OAAQR,GAAMO,EAAaP,EAAE,GAAG,CAAC,CAAC,EAGxDS,GAAoB,CAACzB,EAAYuB,IACnCvB,EAAW,IAAK0B,GACdH,EAAaG,EAAO,GAAG,EAIrBA,EAFIA,EAAO,IAAKV,GAAM,OAAO,OAAO,CAAC,EAAGA,EAAG,CAAE,UAAW,IAAK,CAAC,CAAC,CAGzE,EAGQW,GAAuB,CAAC3B,EAAYuB,IACtCvB,EAAW,IAAK4B,GAAUH,GAAkBG,EAAOL,CAAY,CAAC,EHzF3E,SAASM,GAAYC,EAA0BC,EAAoB,CAC/D,IAAMC,EAAOC,GAAkBF,EAAUG,EAAWH,CAAQ,CAAC,EACvDI,EAAQC,GAAaL,CAAQ,EAE7BM,EAASC,EAAY,EAAE,SAASP,CAAQ,EAAE,MAAMI,CAAK,EAErDI,EAAOC,GAAUT,EAAUI,CAAK,EAAE,OAAO,UAAU,EACnDM,EACD,kBAAe,EACf,QAAQ,CAACT,EAAMU,IAAUV,EAAKU,EAAM,EACpC,OAAOV,EAAK,IAAI,IAAMO,CAAI,CAAC,EAE1BI,EAAQC,EAAYb,CAAQ,EAC7B,YAAYc,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEb,CAAI,EAC3Bc,EAAeF,EAAYb,CAAQ,EACpC,YAAY,YAAY,EACxB,UAAU,WAAW,EACrB,UAAUA,EAAS,SAAS,EAAE,EAC9B,YAAYc,EAAW,OAAO,EAC9B,OAAO,UAAU,EACjB,QAAQ,CAAC,CAAC,CAAC,EACX,gBAAgBE,EAAqB,CAAC,EAGrCC,EACFjB,EAAS,WAAW,OAAS,EACvBkB,GACAC,GACJC,EAAWC,GAAarB,EAAUC,EAAMgB,CAAa,EAAE,MAAMb,CAAK,EAElEkB,EAASP,EAAaK,EAAS,KAAK,CAAC,EAGrCG,EAAaH,EAAS,UAAU,EAChCV,EACAc,EAAcd,EAAQV,CAAQ,EAAE,OAAO,UAAU,EAEjDyB,EAAQC,EAAgBd,EAAOU,CAAM,EACtC,aAAaF,CAAQ,EACrB,SAASG,CAAU,EAEpBE,EAAM,gBACNA,EAAM,cAAc,EAAG,EACvBA,EAAM,cAAc,GAAI,EACxBjB,EAAK,MAAM,MAAM,GAErBiB,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAME,EAAYC,EAAc,EAC3B,MAAMH,CAAK,EACX,SAASzB,CAAQ,EACjB,OAAOY,EAAM,KAAK,EAEvB,GAAIQ,EAAS,UAAU,EAAG,CAEtB,IAAMS,EAASd,EAAaK,EAAS,QAAQ,CAAC,EAE9CU,GAAmBR,EAAO,OAAQO,EAAO,MAAM,EAC/CJ,EAAM,QAAQH,EAAO,MAAM,EAAE,QAAQO,CAAM,CAC/C,CAGA9B,EAAU,MAAMqB,EAAS,KAAK,CAAC,EAAE,KAAKO,CAAS,EAC/C5B,EAAU,KAAKO,CAAM,CACzB,CACAR,GAAY,OAAS,CACjB,KAAM,QACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,QAAQ,CACpB,CACJ,EAEA,IAAOiC,GAAQjC,GIlGf,UAAYkC,OAAQ,OCApB,UAAYC,OAAQ,OAIb,SAASC,GAAWC,EAAoBC,EAAgB,CAC3D,IAAIC,EAAY,iBAAc,EAExBC,EACFH,EAAS,KAAK,QACbA,EAAS,MAAM,OAAS,EACnB,OAAO,KAAKA,EAAS,KAAK,EAAE,EAAE,QAC7BA,EAAS,aAAa,OAAS,EAAI,EAAI,GACxC,GACJI,EAAe,KAAK,IACtB,EACA,KAAK,IAAI,EAAG,KAAK,MAAMJ,EAAS,KAAK,MAAQG,EAAiB,CAAC,CAAC,CACpE,EAEA,OAAAD,EAASA,EAAO,SAAUG,GAAc,CACpCA,EACK,MAAM,SAAWC,GAAMC,GAAeN,EAAMK,EAAE,IAAMA,EAAE,GAAG,GAAG,CAAC,CAAC,EAC9D,MAAM,eAAgBF,CAAY,CAC3C,CAAC,EAEMF,EAAO,WAAYI,GAAMA,EAAE,UAAU,EAAE,UAAWA,GAAMA,EAAE,SAAS,CAC9E,CCfO,SAASE,GAAUC,EAAoBC,EAA4B,CACtE,IAAMC,EAAUC,EAAcH,CAAQ,EAEtC,OAAOC,EAAK,IAAI,CAACG,EAAKC,IACX,OAAO,KAAKD,CAAG,EACjB,OAAQE,GAAQA,IAAQ,cAAc,EACtC,IAAKA,IAAS,CACX,IAAAA,EACA,WAAYJ,EAAQE,EAAKC,CAAC,EAC1B,UAAWD,EAAIE,GACf,IAAKF,CACT,EAAE,CACT,CACL,CCvBO,IAAMG,GAAgB,SAAUC,EAAG,CACtC,IAAMC,EAAU,CAAC,EACjB,QAAWC,KAAOF,EACd,QAASG,EAAM,EAAGA,EAAMD,EAAI,OAAQC,IAC5BD,EAAIC,GAAK,YAAc,OACvBF,EAAQE,GAAOF,EAAQE,IAAQ,CAAC,EAChCF,EAAQE,GAAK,KAAKD,EAAIC,EAAI,GAItC,OAAOF,CACX,ECXA,UAAYG,OAAQ,OCAb,IAAMC,GAAmB,CAACC,EAAOC,EAASC,EAAY,KAAK,MAAQ,CACtE,IAAMC,EAAqBH,GAChBA,EAAM,OAAO,CAACI,EAAMC,IAAM,CAC7B,IAAMC,EAAYC,EAAiBF,CAAC,EACpC,OAAOC,IACF,CAACF,GACEF,EAAUE,EAAK,MAAOE,EAAU,KAAK,IAAMA,EAAU,OACvDA,EACAF,CACV,EAAG,IAAI,EAELG,EAAoBC,GAAS,CAC/B,GAAI,MAAM,QAAQA,CAAI,EAClB,OAAOL,EAAkBK,CAAI,EAEjC,IAAMC,EAAQR,EAAQO,CAAI,EAC1B,OAAOC,IAAU,KACX,CACI,KAAAD,EACA,MAAAC,CACJ,EACA,IACV,EAEMC,EAAWP,EAAkBH,CAAK,EACxC,OAAOU,EAAWA,EAAS,KAAO,IACtC,ED6BA,IAAOC,EAAQ,IAAiB,CAC5B,IAAMC,EAAOC,GAAQ,EAAE,WAAW,EAAI,EAElCC,EAAyB,KACzBC,EAAyB,KACzBC,EAAwB,KACxBC,EAAO,KACPC,EAAS,GACTC,EAAO,KACPC,EAAa,aACbC,EAAa,YACbC,EAAmB,KACnBC,EAAe,EAEbC,EAAiCC,GAAc,CACjD,IAAMC,EAAgB,QAAQR,EAAS,SAAW,kBAClD,GAAIJ,GAAUC,EAAQ,CAClB,IAAIY,EAAc,KACZC,EAAa,WAAQ,EAAE,GAAG,QAAUC,GAAU,CAChD,IAAMC,EAAUD,EAAM,OAChBE,EAAoBF,EAAM,EAAE,EAC5B,KACNF,EAAcG,EAAU,CAACA,EAAQ,IAAI,EAAI,CAAC,EAC1C,IAAME,EAAYF,EAAUA,EAAQ,MAAQf,EAE5CkB,EAAUR,EAAWE,EAAaK,CAAS,CAC/C,CAAC,EAEDP,EACK,OAAOC,CAAa,EACpB,GAAG,oBAAqB,IAAMO,EAAUR,EAAW,CAAC,CAAC,CAAC,EACtD,GAAG,QAAS,IAAM,CACXE,EAAY,QACZO,GACIT,EAAU,KAAK,EACfE,EAAY,GACZf,EAAK,SAAS,CAClB,CAER,CAAC,EACA,KAAKgB,CAAO,CACrB,CACJ,EAEMK,EAAY,CAACR,EAAWU,EAASH,EAAYjB,IAAW,CAC1D,IAAMqB,EAAOX,EACR,OAAO,wBAAwB,EAC/B,UAAU,kBAAkB,EAC5B,KAAKU,CAAO,EACjBC,EAAK,KAAK,EAAE,OAAO,EAEnBA,EAAK,MAAM,EACN,OAAO,QAAQ,EACf,KAAK,QAAS,WAAW,EACzB,MAAMA,CAAI,EACV,KAAK,IAAMC,GACRpB,EAAOM,EAAe,KAAK,KAAKN,EAAKoB,EAAE,IAAI,CAAC,EAAI,EACpD,EACC,KACG,YACCA,GACG,aAAavB,EAAOuB,EAAEjB,EAAW,KAAKY,EAClCK,EAAEhB,EACN,IACR,EACC,MAAM,SAAU,MAAM,EACtB,MAAM,OAASgB,GAAMrB,GAASqB,EAAE,KAAOC,GAAYtB,EAAMqB,EAAE,GAAG,CAAC,CAAC,EAErEzB,EAAKwB,CAAI,CACb,EAEML,EAAuBQ,GAAQ,CACjC,IAAMC,EAAUC,GACJC,GAEAA,EAAErB,KAAgB,QAClBqB,EAAErB,KAAgB,MAClBqB,EAAEtB,KAAgB,QAClBsB,EAAEtB,KAAgB,KAEX,KAEJ,KAAK,KACR,KAAK,IAAKN,EAAO4B,EAAEtB,EAAW,EAAemB,EAAI,EAAG,CAAC,EACjD,KAAK,IAAIE,EAAMC,EAAErB,EAAW,EAAIkB,EAAI,EAAG,CAAC,CAChD,EAKFI,EAAQH,EAAOzB,CAAM,EACrB6B,EAAQC,GAAiB1B,EAAMwB,EAAO,KAAK,GAAG,EAEpD,GAAIrB,EAAkB,CAElB,IAAMwB,EAAQN,EAAOlB,EAAiB,MAAM,EACtCyB,EAAQF,GACVvB,EAAiB,KACjBwB,EACA,KAAK,GACT,EACA,OAAOH,EAAMC,CAAK,GAAKE,EAAMC,CAAK,EAC5B,CAAE,KAAMH,EAAO,MAAO7B,CAAO,EAC7B,CAAE,KAAMgC,EAAO,MAAOzB,EAAiB,MAAO,CACxD,CACA,MAAO,CAAE,KAAMsB,EAAO,MAAO7B,CAAO,CACxC,EAEA,OAAAS,EAAU,YAAc,IAAIwB,IACnBA,EAAK,QAGVzB,EAAeyB,EAAK,GACbxB,GAHID,EAKfC,EAAU,OAAS,IAAIwB,IACdA,EAAK,QAGVlC,EAASkC,EAAK,GACPxB,GAHIV,EAMfU,EAAU,OAAS,IAAIwB,IACdA,EAAK,QAGVjC,EAASiC,EAAK,GACPxB,GAHIT,EAMfS,EAAU,MAAQ,IAAIwB,IACbA,EAAK,QAGVhC,EAAQgC,EAAK,GACNxB,GAHIR,EAMfQ,EAAU,KAAO,IAAIwB,IACZA,EAAK,QAGV/B,EAAO+B,EAAK,GAAKA,EAAK,GAAG,KAAK,EAAE,MAAM,CAAC,GAAI,GAAI,CAAC,EAAI,KAC7CxB,GAHIP,EAMfO,EAAU,OAAS,IAAIwB,IACdA,EAAK,QAGV9B,EAAS8B,EAAK,GACPxB,GAHIN,EAMfM,EAAU,KAAO,IAAIwB,IACZA,EAAK,QAGV7B,EAAO6B,EAAK,GACLxB,GAHIL,EAMfK,EAAU,WAAa,IAAIwB,IAClBA,EAAK,QAGV5B,EAAa4B,EAAK,GACXxB,GAHIJ,EAMfI,EAAU,WAAa,IAAIwB,IAClBA,EAAK,QAGV3B,EAAa2B,EAAK,GACXxB,GAHIH,EAMfG,EAAU,iBAAmB,IAAIwB,IACxBA,EAAK,QAGV1B,EAAmB0B,EAAK,GACjBxB,GAHIF,EAMfE,EAAU,SAAW,IAAIwB,IAChBA,EAAK,QAGVpC,EAAK,SAASoC,EAAK,EAAE,EACdxB,GAHIZ,EAAK,SAAS,EAM1B,aAAUY,EAAWZ,CAAI,EACrBY,CACX,EJ1OA,SAASyB,GAAUC,EAAWC,EAAoB,CAC9C,IAAMC,EAAOC,GAAUF,EAAUG,EAAWH,CAAQ,CAAC,EAC/CI,EAAQC,GAAaL,CAAQ,EAE7BM,EAASC,EAAY,EAAE,SAASP,CAAQ,EAAE,MAAMI,CAAK,EAErDI,EACD,mBAAgB,EAChB,OAAOC,GAAWT,EAAUI,CAAK,CAAC,EAClC,OAAO,YAAY,EAElBM,EAAkBC,EAAqB,EACxC,IAAI,CAAC,GAAK,EAAG,CAAC,EACd,QAAQ,SAAS,EAGhBC,EAAWC,GAAab,EAAUc,GAAcb,CAAI,CAAC,EAAE,MAAMG,CAAK,EAElEW,EAA4BC,EAAYhB,CAAQ,EACjD,YAAYiB,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEhB,CAAI,EAE3BiB,EAAeF,EAAYhB,CAAQ,EACpC,YAAY,YAAY,EACxB,UAAU,WAAW,EACrB,UAAUY,EAAS,UAAU,EAAI,KAAOZ,EAAS,SAAS,EAAE,EAC5D,OAAO,UAAU,EACjB,gBAAgBU,CAAe,EAE9BS,EAA6BD,EAAaN,EAAS,KAAK,CAAC,EAGzDQ,EAAaR,EAAS,UAAU,EAChCJ,EACAa,EAAcb,EAAQR,CAAQ,EAAE,OAAO,UAAU,EACjDsB,EAAQC,EAAgBR,EAAOI,CAAM,EACtC,aAAaP,CAAQ,EACrB,SAASQ,CAAU,EAExBE,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAME,EAAYC,EAAc,EAC3B,MAAMH,CAAK,EACX,SAAStB,CAAQ,EACjB,OAAOe,EAAM,KAAK,EAEjBW,EAAUC,EAAU,EACrB,SAAS3B,CAAQ,EACjB,OAAOe,EAAM,KAAK,EAClB,OAAOI,EAAO,KAAK,EACnB,MAAMf,CAAK,EACX,KAAKH,CAAI,EAEd,GAAIW,EAAS,UAAU,EAAG,CAEtB,IAAMgB,EAASV,EAAaN,EAAS,QAAQ,CAAC,EAC9CU,EAAM,QAAQM,CAAM,EAGpBF,EAAQ,KAAKd,EAAS,KAAK,CAAC,EAAE,iBAAiB,CAC3C,OAAQgB,EAAO,MACf,KAAMhB,EAAS,QAAQ,CAC3B,CAAC,CACL,CAEA,IAAMiB,EAAkBjB,EAAS,KAAK,EAGtCb,EAAU,MAAM8B,CAAe,EAAE,KAAKL,CAAS,EAC/CzB,EAAU,KAAK2B,CAAO,EACtB3B,EAAU,KAAKO,CAAM,CACzB,CAEAR,GAAU,OAAS,CACf,KAAM,SACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,QAAQ,CACpB,CACJ,EAEA,IAAOgC,GAAQhC,GMvGf,UAAYiC,OAAQ,OCApB,OAAS,qBAAAC,OAAyB,OCAlC,UAAYC,MAAQ,KAEpB,IAAMC,GAAQ,KAAK,KAAK,CAAC,EAEnBC,GAAQ,CACV,KAAM,SAAUC,EAASC,EAAM,CAC3B,IAAMC,EAAI,KAAK,KAAKD,GAAQH,GAAQ,EAAE,EACtCE,EAAQ,OAAO,EAAGE,EAAI,CAAC,EACvBF,EAAQ,OAAO,CAACF,GAAQI,EAAG,CAACA,CAAC,EAC7BF,EAAQ,OAAOF,GAAQI,EAAG,CAACA,CAAC,EAC5BF,EAAQ,UAAU,CACtB,CACJ,EAEaG,GAAU,CAChB,eACA,cACA,gBACA,eACA,aACA,iBACA,WACP,EACaC,GAAa,CACtB,OAAW,eACX,OAAW,eACX,MAAU,cACV,QAAY,gBACZ,KAAS,aACT,SAAa,iBACb,IAAQ,YACR,MAAAL,EACJ,EAEO,SAASM,GAAWC,EAAkB,CACzC,OAAOA,EAAO,OAAS,EACd,eAAa,EAAE,OAAOA,CAAM,EAAE,MAAMH,EAAO,EAC9C,IACV,CD9BA,IAAMI,GAAgB,EAChBC,GAAe,EAad,SAASC,GACZC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAAe,EACjB,CACE,IAAIC,EAASC,GAAkB,EAC1B,WAAYC,GAAMA,EAAE,CAAC,EACrB,UAAWA,GAAMA,EAAE,CAAC,EAEzB,OAAIJ,GACAE,EAAO,KAAMG,GAASL,EAAQK,EAAK,IAAIT,EAAU,CAAC,EAGlDC,GACAK,EAAO,KAAME,GAAM,KAAK,MAAMH,EAAeJ,EAAKO,EAAE,IAAI,CAAC,CAAC,EAG9DF,EAAO,SAAS,CAACI,EAASD,IAAS,CAC/B,IAAME,EAAaT,EAAMO,EAAK,UAAU,EAClCG,EAAUb,EAAS,aAAa,QACtC,GAAII,EAAO,CACP,GAAM,CAAE,KAAAU,CAAK,EAAId,EAAS,WAAW,KAAMe,GAAMA,EAAE,OAASX,CAAK,EAC3DY,EAAQC,GAAQH,EAAMJ,EAAK,IAAIN,EAAM,EAC3C,GAAIY,IAAU,KAAM,CAChBL,EAAQ,UAAYX,EAAS,WAAW,MACxCW,EAAQ,KAAOX,EAAS,WAAW,KACnC,IAAIkB,EAAY,EACZhB,IAOAgB,EAJe,KAAK,KACfZ,EAAeJ,EAAKQ,EAAK,IAAI,EAAK,KAAK,EAC5C,EAEqBZ,IAGzB,IAAMqB,EAAmBD,EAAYrB,GACrCc,EAAQ,SAASK,EAAOG,EAAkB,CAAC,CAC/C,CACJ,CAEAR,EAAQ,YAAcS,GAAeR,CAAU,EAC/CD,EAAQ,UAAYU,GAAYT,EAAYC,CAAO,CACvD,CAAC,EAEMN,CACX,CAEO,SAASe,GACZtB,EACAuB,EACO,CACP,IAAIC,EAAO,CAAC,GAAG,IAAI,IAAIC,GAAkBzB,EAAUuB,CAAM,CAAC,CAAC,EAC3D,OAAOG,GAAWF,CAAI,CAC1B,CAEO,SAASG,GAAqB3B,EAAoB,CACrD,IAAM4B,EACF5B,EAAS,MAAQA,EAAS,KAAK,OAAS,EAAIA,EAAS,KAAK,GAAK,CAAC,EAC9D6B,EAAmB,CAAC,EAC1B,cAAO,KAAKD,CAAG,EAAE,QAASE,GAAQ,CAC9B,GAAIA,IAAQ,eAAgB,CACxB,IAAMC,EAAQC,GAAaF,CAAG,EACzBD,EAAO,SAASE,CAAK,GACtBF,EAAO,KAAKE,CAAK,CAEzB,CACJ,CAAC,EACML,GAAWG,CAAM,CAC5B,CE9FO,SAASI,GAAYC,EAAUC,EAAM,CACxC,IAAMC,EAASF,EAAS,WAAW,OAEnC,OAAOC,EAAK,IAAKE,GAAQ,CACrB,IAAMC,EAAO,OAAO,KAAKD,CAAG,EAAE,OAAQE,GAAQA,IAAQ,cAAc,EAC9DC,EAAM,IAAI,MAAMF,EAAK,OAASF,CAAM,EAC1C,QAAS,EAAI,EAAG,EAAIE,EAAK,OAASF,EAAQ,IACtCI,EAAI,GAAK,CACL,IAAKC,GAAaH,EAAK,EAAIF,EAAO,EAClC,WAAYC,EAAIC,EAAK,EAAIF,IACzB,UAAWC,EAAIC,EAAK,EAAIF,EAAS,IACjC,IAAKC,CACT,EAEJ,OAAOG,CACX,CAAC,CACL,CHFA,SAASE,GAAOC,EAA0BC,EAAoB,CAC1D,IAAMC,EAAOC,GACTC,GAAYH,EAAUI,GAAkBJ,CAAQ,CAAC,CACrD,EAEMK,EAAQC,GAAuBN,CAAQ,EACvCO,EAAUC,GAAqBR,CAAQ,EAEzCS,EAAS,KACTJ,EAAM,OAAO,EAAE,QAAU,IACzBI,EAASC,GAAiB,EACrB,SAASV,CAAQ,EACjB,MAAMO,CAAO,EACb,MAAMF,CAAK,GAGpB,IAAMM,EACD,mBAAgB,EAChB,OAAOC,GAAWZ,EAAUK,CAAK,CAAC,EAClC,OAAO,YAAY,EAElBQ,EAAkBC,EAAqB,EACxC,IAAI,CAAC,GAAK,EAAG,CAAC,EACd,QAAQ,SAAS,EAEhBC,EAAeC,EAAYhB,CAAQ,EACpC,YAAY,YAAY,EACxB,aAAaA,EAAS,WAAW,GAAG,IAAI,EACxC,UAAU,YAAY,EACtB,UAAUA,EAAS,SAAS,EAAE,EAC9B,gBAAgBa,CAAe,EAU9BI,EAReD,EAAYhB,CAAQ,EACpC,YAAY,YAAY,EACxB,aAAaA,EAAS,WAAW,GAAG,IAAI,EACxC,UAAU,WAAW,EACrB,UAAUA,EAAS,SAAS,EAAE,EAC9B,OAAO,UAAU,EACjB,gBAAgBa,CAAe,EAEWZ,CAAI,EAC7CiB,EAA4BH,EAAad,CAAI,EAE7CkB,EAAaC,EAAcT,EAAQX,CAAQ,EAAE,OAAO,UAAU,EAE9DqB,EAAQC,EAAgBJ,EAAOD,CAAK,EACrC,OAAOjB,EAAS,WAAW,GAAG,IAAI,EAClC,OAAOA,EAAS,WAAW,GAAG,IAAI,EAClC,SAASmB,CAAU,EAExBE,EAAM,OAASA,EAAM,MAAM,EAC3BA,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAME,EAAYC,EAAc,EAC3B,MAAMH,CAAK,EACX,SAASrB,CAAQ,EACjB,OAAOkB,EAAM,KAAK,EAClB,OAAOD,EAAM,KAAK,EAEjBQ,EAAUC,EAAU,EACrB,SAAS1B,CAAQ,EACjB,OAAOkB,EAAM,KAAK,EAClB,OAAOD,EAAM,KAAK,EAClB,MAAMZ,CAAK,EACX,KAAKJ,CAAI,EAEdF,EAAU,MAAME,CAAI,EAAE,KAAKsB,CAAS,EACpCxB,EAAU,KAAK0B,CAAO,EAClBhB,GACAV,EAAU,KAAKU,CAAM,CAE7B,CAEAX,GAAO,OAAS,CACZ,KAAM,WACN,SAAU,YACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,SAAU,SAAU,SAAS,CACzC,EACA,WAAY,QAChB,EAEA,IAAO6B,GAAQ7B,GIvGf,UAAY8B,OAAQ,OCApB,UAAYC,OAAQ,OAGb,SAASC,GAAWC,EAAqBC,EAAgB,CAC5D,IAAIC,EAAY,iBAAc,EAE9B,OAAAA,EAASA,EAAO,SAAUC,GAAc,CACpCA,EAAU,MAAM,OAASC,GAAMH,EAAMG,EAAE,GAAG,GAAG,CAAC,EAAE,MAAM,UAAW,EAAG,CACxE,CAAC,EAEMF,EACF,WAAYE,GAAMA,EAAE,UAAU,EAC9B,UAAWA,GAAMA,EAAE,SAAS,EAC5B,UAAWA,GAAMA,EAAE,SAAS,CACrC,CCHO,SAASC,GACZC,EACAC,EACqB,CACrB,IAAMC,EAAUC,EAAcH,CAAQ,EAEtC,OAAOC,EAAK,IAAI,CAACG,EAAKC,IAA2B,CAC7C,IAAMC,EAAa,CAAC,EAEpB,OAAO,OAAO,KAAKF,CAAG,EACjB,OAAQG,GAAQA,IAAQ,cAAc,EACtC,IAAKA,GAAQ,CAEV,IAAMC,EAASD,EAAI,MAAM,GAAG,EAEtBE,EAAQD,EAAOA,EAAO,OAAS,GAC/BE,EAAYJ,EAAWG,IAAU,EACjCE,EAAQD,EAAYN,EAAIG,GAC9B,OAAAD,EAAWG,GAASE,EAEb,CACH,IAAAJ,EACA,WAAYL,EAAQE,EAAKC,CAAC,EAC1B,UAAWM,EACX,UAAWD,EACX,IAAKN,CACT,CACJ,CAAC,CACT,CAAC,CACL,CFtBA,SAASQ,GAAUC,EAA0BC,EAAoB,CAC7D,IAAMC,EAAcC,GAAiBF,EAAUG,EAAWH,CAAQ,CAAC,EAE7DI,EAAQC,GAAaL,CAAQ,EAC7BM,EAASC,EAAY,EAAE,SAASP,CAAQ,EAAE,MAAMI,CAAK,EAErDI,EACD,mBAAgB,EAChB,OAAOC,GAAWT,EAAUI,CAAK,EAAE,OAAO,UAAU,CAAC,EAEpDM,EACD,mBAAgB,EAChB,OAAOC,GAAWX,EAAUI,CAAK,CAAC,EAClC,OAAO,UAAU,EAEhBQ,EAAY,kBAAe,EAAE,OAAO,CAACJ,EAAaE,CAAW,CAAC,EAE9DG,EAA4BC,EAAYd,CAAQ,EACjD,YAAYe,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEd,CAAI,EAC3Be,EAAeF,EAAYd,CAAQ,EACpC,YAAY,YAAY,EACxB,UAAU,WAAW,EACrB,UAAUA,EAAS,SAAS,EAAE,EAC9B,YAAYe,EAAW,OAAO,EAC9B,OAAO,UAAU,EACjB,QAAQ,CAAC,CAAC,CAAC,EACX,gBAAgBE,EAAqB,CAAC,EAGrCC,EAAWC,GAAanB,EAAUC,CAAI,EAAE,MAAMG,CAAK,EAEnDgB,EAA6BJ,EAAaE,EAAS,KAAK,CAAC,EAGzDG,EAAaH,EAAS,UAAU,EAChCN,EACAU,EAAcV,EAAQZ,CAAQ,EAAE,OAAO,UAAU,EAEjDuB,EAAQC,EAAgBX,EAAOO,CAAM,EACtC,aAAaF,CAAQ,EACrB,SAASG,CAAU,EAExBE,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAME,EAAYC,EAAc,EAC3B,MAAMH,CAAK,EACX,SAASvB,CAAQ,EACjB,OAAOa,EAAM,KAAK,EAEjBc,EAAUC,EAAU,EACrB,SAAS5B,CAAQ,EACjB,OAAOa,EAAM,KAAK,EAClB,OAAOO,EAAO,KAAK,EACnB,MAAMhB,CAAK,EACX,KAAKH,CAAI,EAEd,GAAIiB,EAAS,UAAU,EAAG,CAEtB,IAAMW,EAASb,EAAaE,EAAS,QAAQ,CAAC,EAC9CK,EAAM,QAAQM,CAAM,EAGpBF,EAAQ,KAAKT,EAAS,KAAK,CAAC,EAAE,iBAAiB,CAC3C,OAAQW,EAAO,MACf,KAAMX,EAAS,QAAQ,CAC3B,CAAC,CACL,CAGAnB,EAAU,MAAMmB,EAAS,KAAK,CAAC,EAAE,KAAKO,CAAS,EAC/C1B,EAAU,KAAK4B,CAAO,EACtB5B,EAAU,KAAKO,CAAM,CACzB,CACAR,GAAU,OAAS,CACf,KAAM,SACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,QAAQ,CACpB,CACJ,EAEA,IAAOgC,GAAQhC,GGxGf,UAAYiC,OAAQ,OCApB,UAAYC,OAAQ,OAKb,SAASC,GACZC,EACAC,EACAC,EACAC,EACF,CACE,IAAIC,EAAY,kBAAe,EAAE,KAAK,GAAG,EACnCC,EAAUL,EAAS,aAAeA,EAAS,YAAY,QAE7D,OAAIG,GACAC,EAAO,KAAKD,EAAQF,CAAS,CAAC,EAGlCG,EAAO,SAAUE,GAAc,CAC3BA,EACK,MAAM,SAAWC,GACdC,GAAeN,EAAMK,EAAE,YAAcN,CAAS,CAAC,CACnD,EACC,MAAM,OAASM,GACZE,GAAYP,EAAMK,EAAE,YAAcN,CAAS,EAAGI,CAAO,CACzD,CACR,CAAC,EAEMD,EAAO,WAAYG,GAAMA,EAAE,UAAU,EAAE,UAAWA,GAAMA,EAAE,SAAS,CAC9E,CAEO,SAASG,GAAWV,EAAoB,CAC3C,IAAMW,EACFX,EAAS,MAAQA,EAAS,KAAK,OAAS,EAAIA,EAAS,KAAK,GAAK,CAAC,EAC9DY,EAAS,OAAO,KAAKD,CAAG,EAAE,OAAQE,GAAMA,IAAM,cAAc,EAClE,OAAOC,GAAWF,CAAM,CAC5B,CDpBA,SAASG,GAASC,EAA0BC,EAAoB,CAC5D,IAAMC,EAAOC,GAAUF,EAAUG,EAAWH,CAAQ,CAAC,EAC/CI,EAAUC,GAAWL,CAAQ,EAC7BM,EAAQC,GAAaP,CAAQ,EAE7BQ,EAASC,GAAa,EACvB,SAAST,CAAQ,EACjB,MAAMI,CAAO,EACb,MAAME,CAAK,EAEVI,EACD,kBAAe,EACf,QAAQ,CAACT,EAAMU,IAAUV,EAAKU,EAAM,EACpC,OACGV,EAAK,IAAKS,GACNE,GAAoBZ,EAAUU,EAAO,IAAKJ,EAAOF,CAAO,CAC5D,CACJ,EAEES,EAAkBC,EAAqB,EACxC,IAAI,CAAC,IAAM,GAAI,CAAC,EAChB,QAAQ,SAAS,EAEhBC,EAA4BC,EAAYhB,CAAQ,EACjD,YAAYiB,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEhB,CAAI,EAC3BiB,EAAeF,EAAYhB,CAAQ,EACpC,YAAY,YAAY,EACxB,UAAU,WAAW,EACrB,UAAUA,EAAS,SAAS,EAAE,EAC9B,OAAO,UAAU,EACjB,gBAAgBa,CAAe,EAG9BM,EAAWC,GAAapB,EAAUC,CAAI,EAAE,MAAMK,CAAK,EAEnDe,EAA6BH,EAAaC,EAAS,KAAK,CAAC,EAGzDG,EAAaH,EAAS,UAAU,EAChCT,EACAa,EAAcb,EAAQV,CAAQ,EAAE,OAAO,UAAU,EAEjDwB,EAAQC,EAAgBV,EAAOM,CAAM,EACtC,aAAaF,CAAQ,EACrB,SAASG,CAAU,EAExBE,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAME,EAAYC,EAAc,EAC3B,MAAMH,CAAK,EACX,SAASxB,CAAQ,EACjB,OAAOe,EAAM,KAAK,EAEjBa,EAAUC,EAAU,EACrB,SAAS7B,CAAQ,EACjB,OAAOe,EAAM,KAAK,EAClB,OAAOM,EAAO,KAAK,EACnB,MAAMf,CAAK,EACX,KAAKL,CAAI,EAEd,GAAIkB,EAAS,UAAU,EAAG,CAEtB,IAAMW,EAASZ,EAAaC,EAAS,QAAQ,CAAC,EAC9CK,EAAM,QAAQM,CAAM,EAGpBF,EAAQ,KAAKT,EAAS,KAAK,CAAC,EAAE,iBAAiB,CAC3C,OAAQW,EAAO,MACf,KAAMX,EAAS,QAAQ,CAC3B,CAAC,CACL,CAGApB,EAAU,MAAMoB,EAAS,KAAK,CAAC,EAAE,KAAKO,CAAS,EAC/C3B,EAAU,KAAK6B,CAAO,EAClBpB,GACAT,EAAU,KAAKS,CAAM,CAE7B,CAEAV,GAAS,OAAS,CACd,KAAM,YACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,QAAQ,CACpB,CACJ,EAEA,IAAOiC,GAAQjC,GE7Gf,UAAYkC,OAAQ,KCIb,SAASC,GAAUC,EAAoBC,EAAM,CAChD,OAAOC,GAAqBF,EAAUC,EAAM,CAAE,aAAc,EAAK,CAAC,EAAE,IAC/DA,GAASE,GAAeH,EAAUC,CAAI,CAC3C,CACJ,CAEA,SAASE,GAAeH,EAAoBC,EAAM,CAC9C,IAAMG,EAAUC,EAAcL,CAAQ,EAEhCM,EAAeL,EAAK,IAAI,CAACM,EAAKC,KAAO,CACvC,WAAYJ,EAAQG,EAAKC,CAAC,EAC1B,WAAYR,EAAS,WAAW,IAAKS,GAAMF,EAAIE,EAAE,KAAK,EACtD,EAAGF,EAAIP,EAAS,WAAW,GAAG,MAC9B,EAAGO,EAAIP,EAAS,WAAW,GAAG,MAC9B,WAAYA,EAAS,WAAW,GAC1BO,EAAIP,EAAS,WAAW,IACxB,OACN,KAAMA,EAAS,WAAW,GAAKO,EAAIP,EAAS,WAAW,IAAM,OAC7D,IAAKC,EAAK,IACV,IAAKM,CACT,EAAE,EAEF,OAAAD,EAAa,IAAML,EAAK,IACjBK,CACX,CC5BA,UAAYI,OAAQ,KAIb,SAASC,GACZC,EACAC,EACAC,EACAC,EACF,CACE,OAAU,eAAY,EAAE,OAAOC,GAAUH,EAAMC,EAAWC,CAAY,CAAC,CAC3E,CAEO,SAASE,GACZC,EACAL,EACAC,EACAC,EAAe,KACW,CAC1B,IAAII,EAASH,GAAUH,EAAMC,EAAWC,CAAY,EAChDK,EAAWF,EAAS,YAAY,SAAS,KAE7C,GAAIC,EAAO,IAAM,EACbC,EAAWF,EAAS,YAAY,SAAS,iBAClCC,EAAO,IAAM,EACpBC,EAAWF,EAAS,YAAY,SAAS,aACtC,CACH,IAAMG,EAAS,KAAK,IAAI,CAACF,EAAO,GAAIA,EAAO,EAAE,EAC7CA,EAAS,CAAC,CAACE,EAAQA,CAAM,CAC7B,CAEA,IAAMC,EAAeC,GAAkBH,CAAQ,EAC/C,OAAU,mBAAgBE,CAAY,EAAE,OAAOH,CAAM,CACzD,CAEA,IAAMH,GAAY,CAACH,EAAaC,EAAsBC,IAC3CA,GAAgBS,GAAO,EAAE,UAAUV,CAAS,EAAE,IAAI,CAAC,EAAG,CAAC,CAAC,EAAED,CAAI,EAGnEU,GAAqBE,GAAkB,CAGzC,IAAMC,EAAgBD,EACjB,MAAM,CAAC,EACP,IAAI,CAACE,EAAGC,IAAS,eAAYH,EAAcG,GAAG,GAAID,EAAE,EAAE,CAAC,EAC5D,OAAQE,GAAU,CACd,IAAMC,EAAQL,EAAc,UACxB,CAACE,EAAGC,IACAA,EAAIH,EAAc,OAAS,GAC3BI,GAASJ,EAAcG,EAAI,GAAG,IAC9BC,EAAQF,EAAE,EAClB,EACA,GAAIG,IAAU,GACV,OAAID,GAASJ,EAAc,GAAG,GACnBA,EAAc,GAAG,GAErBA,EAAcA,EAAc,OAAS,GAAG,GAGnD,IAAMH,EAAeI,EAAcI,GAC7B,CAACC,CAAM,EAAIN,EAAcK,GACzB,CAACE,CAAM,EAAIP,EAAcK,EAAQ,GAEvC,OAAOR,GAAcO,EAAQE,IAAWC,EAASD,EAAO,CAC5D,CACJ,ECjEA,UAAYE,OAAQ,KACpB,UAAYC,OAAQ,OAIb,SAASC,IAAmB,CAC/B,IAAIC,EAAQ,KAEZ,SAASC,EAAOC,EAAW,CACvB,IAAMC,EAAkBC,EACpBF,EACA,uBACA,IACIA,EACK,OAAO,KAAK,EACZ,KAAK,QAAS,+BAA+B,EAC7C,MAAM,UAAW,GAAG,CACjC,EACM,CAAE,MAAAG,EAAO,OAAAC,CAAO,EAAIH,EACrB,KAAK,EACL,sBAAsB,EAErBI,EAAY,aAAkB,EAAE,OAAO,CAAC,EAAG,CAAC,CAAC,EAAE,MAAM,CAAC,EAAGF,CAAK,CAAC,EAE/DG,EAASR,EAAM,KAAK,EAAE,KAAK,EAAE,OAAO,EACpCS,EACD,gBAAa,EACb,IAAI,CAAC,GAAK,EAAG,CAAC,EACd,QAAQ,SAAS,EAAED,CAAM,EACxB,CAACE,EAAKC,CAAG,EAAIF,EACbG,EAAoB,SAAMF,EAAKC,GAAMA,EAAMD,GAAOJ,CAAM,EAExDO,EAAY,eAAY,EAAE,OAAOJ,CAAY,EAAE,MAAM,CAACH,EAAQ,CAAC,CAAC,EAEhEQ,EACD,iBAAiB,gBAAa,CAAC,EAC/B,OAAOP,CAAM,EACb,OAAOM,CAAM,EACb,WAAW,CAAC,EACZ,UAAU,CAACE,EAAGC,IAAMJ,EAAe,KAAK,IAAI,EAAGI,EAAI,CAAC,EAAE,EACtD,UAAWC,GAAMA,CAAC,EAClB,SAAUC,GAAc,CACrBA,EAAU,UAAU,MAAM,EAAE,MAAM,OAASD,GAAMjB,EAAMiB,CAAC,CAAC,CAC7D,CAAC,EAECE,EACFX,EAAO,GAAK,GAAKA,EAAO,GAAK,EACvB,EACA,KAAK,OAAOA,EAAO,GAAKA,EAAO,IAAM,CAAC,EAC1CY,EAAa,CAAC,GAAGZ,EAAQW,CAAM,EAEjCE,EAAiBC,GAAkBZ,EAAKC,CAAG,EACzCY,EACD,aAAUV,CAAM,EAChB,WAAWO,CAAU,EACrB,cAAc,CAAC,EACf,WAAYH,GAAMI,EAAeJ,CAAC,CAAC,EAElCO,EAAYpB,EAAmBD,EAAiB,MAAO,IACzDA,EAAgB,OAAO,KAAK,CAChC,EACK,MAAM,QAASE,CAAK,EACpB,MAAM,SAAUC,CAAM,EACrBmB,EAAYrB,EAAmBoB,EAAW,IAAK,IACjDA,EAAU,OAAO,GAAG,CACxB,EACK,MAAMZ,CAAc,EACpB,KAAKE,CAAM,EAEVY,EAAW,KAAK,IAAID,EAAU,KAAK,EAAE,QAAQ,EAAE,CAAC,EACtDrB,EAAmBoB,EAAW,eAAgB,IAC1CA,EAAU,OAAO,GAAG,EAAE,KAAK,KAAM,aAAa,CAClD,EACK,KAAK,YAAa,aAAaE,IAAW,EAC1C,MAAMd,CAAc,EACpB,KAAKW,CAAS,EACd,OAAO,SAAS,EAChB,KAAK,aAAc,QAAQ,CACpC,CAEA,OAAAtB,EAAO,MAAQ,IAAI0B,IACVA,EAAK,QAGV3B,EAAQ2B,EAAK,GACN1B,GAHID,EAMRC,CACX,CCpEO,SAAS2B,IAA6C,CACzD,IAAIC,EAAiB,uBAEjBC,EAAiB,KACjBC,EAAa,KACbC,EAAW,KACXC,EAAa,KACbC,EAAQ,KACRC,EAAgB,KAChBC,EAAM,GACNC,EAAU,KAERC,EACFC,GACC,CACD,IAAMC,EAAiBC,EACnBF,EACA,sBACA,IACIA,EACK,OAAO,KAAK,EACZ,KAAK,QAAS,iBAAiB,EAC/B,MAAM,QAAS,eAAeF,GAAW,IAAI,EAC7C,MAAM,SAAU,eAAeA,GAAW,IAAI,EAC9C,MAAM,eAAgBA,GAAW,CAAC,CAC/C,EAEMK,EAAkBD,EACpBD,EACA,sBACA,IAAMA,EAAe,OAAO,KAAK,EAAE,KAAK,QAAS,iBAAiB,CACtE,EAEMG,EAAYH,EAAe,KAAK,EAAE,sBAAsB,EACxDI,EAAkBD,EAAU,OAC5BE,EAAiBF,EAAU,OAAST,EAAQ,GAAK,GAEjDY,EAAU,IACVC,EAAOR,EAAU,MAAM,EAEvBS,EAAO,KAAK,IACd,EACA,KAAK,IAAID,EAAK,OAAQ,KAAK,MAAMF,EAAiBC,CAAO,CAAC,CAC9D,EACMG,EAAO,KAAK,KAAKF,EAAK,OAASC,CAAI,EAEzCb,EAAgB,CACZ,MAAOU,EAAiB,KAAK,IAAIG,EAAM,CAAC,EACxC,OAAQ,KAAK,IACTJ,EACA,KAAK,IACDA,EAAkBK,EAClBJ,EAAiB,KAAK,IAAIG,EAAM,CAAC,CACrC,CACJ,CACJ,EAEIJ,EAAkBK,EAAOd,EAAc,OAAS,MAChDA,EAAc,OAASS,EAAkBK,GAGzCF,EAAK,OAAS,GACdL,EAAgB,MACZ,wBACA,UAAUM,MAAS,IAAMA,KAC7B,EACAN,EAAgB,MACZ,qBACA,UAAUO,MAASd,EAAc,WACrC,IAEAO,EAAgB,MAAM,wBAAyB,iBAAiB,EAChEA,EAAgB,MAAM,qBAAsB,iBAAiB,GAGjEV,EAAWU,EACN,UAAU,OAAOb,aAA0B,EAC3C,KAAKkB,EAAOG,GAAMA,EAAE,KAAK,EAC9BlB,EAAS,KAAK,EAAE,OAAO,EAEvBD,EAAaC,EACR,MAAM,EACN,OAAO,KAAK,EACZ,KAAK,QAAS,GAAGH,aAA0B,EAEhDI,EAAaF,EACR,OAAO,KAAK,EACZ,KAAK,QAAS,iBAAiB,EAC/B,MAAM,aAAc,QAAQ,EAC5B,KAAK,UAAW,cAAc,EAC9B,OAAO,MAAM,EACb,KAAK,QAAS,OAAO,EACrB,MAAM,aAAc,MAAM,EAE3BK,EACAN,EAAiBC,EACZ,OAAO,KAAK,EACZ,OAAO,GAAG,EACV,KAAK,QAASF,CAAc,EAEjCC,EAAiBC,EACZ,OAAO,KAAK,EACZ,KAAK,QAASF,CAAc,CAEzC,EAEA,OAAAS,EAAsB,QAAU,IAAIa,IAC3BA,EAAK,QAGVd,EAAUc,EAAK,GACRb,GAHID,EAKfC,EAAsB,IAAM,IAAIa,IACvBA,EAAK,QAGVf,EAAMe,EAAK,GACJb,GAHIF,EAMfE,EAAsB,eAAiB,IAAIa,IAClCA,EAAK,QAGVtB,EAAiBsB,EAAK,GACfb,GAHIT,EAMfS,EAAsB,eAAiB,IAAMR,EAE7CQ,EAAsB,WAAa,IAAMP,EAEzCO,EAAsB,SAAW,IAAMN,EAEvCM,EAAsB,WAAa,IAAML,EAEzCK,EAAsB,cAAgB,IAAMH,EAErCG,CACX,CCjKA,UAAYc,OAAQ,OAoBpB,SAASC,GAAkB,CAACC,EAAIC,CAAE,EAAG,CAACC,EAAIC,CAAE,EAAG,CAC3C,IAAMC,GAAKD,EAAKF,IAAOC,EAAKF,GACtBK,EAAIF,EAAKC,EAAIF,EACnB,OAAO,SAAUI,EAAW,CACxB,IAAMC,EAAOD,EAAU,KAAK,EACtBE,EAAgB,KAAK,IAAID,EAAK,YAAaA,EAAK,YAAY,EAClE,OAAO,KAAK,IAAIJ,EAAI,KAAK,IAAIF,EAAIG,EAAII,EAAgBH,CAAC,CAAC,CAC3D,CACJ,CAsBe,SAARI,IAAoD,CACvD,IAAIC,EAA4B,KAC5BC,EAAO,KACPC,EAAQ,KACRC,EAAU,KAERC,EAA8CR,GAAc,CAE9D,IAAIS,EAAa,CAAC,CADFL,EAAS,WAAW,GAE9BM,EAAYN,EAAS,WAAW,GAEhCO,EAAOP,EAAS,WAAW,GAC3BQ,GAAkBR,EAAUC,EAAM,MAAM,EAAE,MAAM,CAAC,GAAI,GAAK,CAAC,EAC3D,KAEAQ,EAAQT,EAAS,WAAW,GAE5BU,EAAerB,GACjB,CAAC,IAAK,EAAG,EACT,CAAC,KAAM,CAAC,CACZ,EAAEO,CAAS,EACLe,EACD,qBAAkB,EAClB,QAAQ,CAACV,EAAMW,IAAUX,EAAKW,EAAM,EACpC,OACGX,EAAK,IAAI,IACLY,GACIb,EACAM,EACAC,EACAL,EACAO,EACAN,EACAO,CACJ,CACJ,CACJ,EAEEI,EAAc,IAChBC,EAAYf,CAAQ,EACf,YAAY,YAAY,EACxB,gBAAgBgB,EAAqB,CAAC,EACtC,IAAI,CAAC,GAAK,EAAG,CAAC,EAEjBC,EAAQH,EAAY,EACrB,aAAad,EAAS,WAAW,GAAG,IAAI,EACxC,UAAUA,EAAS,SAAS,EAAE,EAC9B,UAAU,GAAG,EAAEC,CAAI,EAElBiB,EAAQJ,EAAY,EACrB,OAAO,UAAU,EACjB,aAAad,EAAS,WAAW,GAAG,IAAI,EACxC,UAAUA,EAAS,SAAS,EAAE,EAC9B,UAAU,GAAG,EAAEC,CAAI,EAElB,CAACkB,EAAQC,CAAM,EACjBpB,EAAS,YAAY,SAAW,EAC1B,CAACA,EAAS,WAAW,GAAG,KAAMA,EAAS,WAAW,GAAG,IAAI,EACzD,CAAC,GAAI,EAAE,EAEXqB,EAAQC,GAAmBL,EAAOC,CAAK,EACxC,OAAOC,CAAM,EACb,OAAOC,CAAM,EACb,SAASG,EAAcZ,EAAQX,CAAQ,EAAE,OAAO,EAAI,CAAC,EAE1DqB,EAAM,OAASA,EAAM,MAAM,EAC3BA,EAAM,OAASA,EAAM,MAAM,EAI3B,IAAMG,EAAYC,EAAc,EAC3B,MAAMJ,CAAK,EACX,SAASrB,CAAQ,EACjB,OAAOiB,EAAM,KAAK,EAClB,OAAOC,EAAM,KAAK,EAClB,OAAO,EAAI,EAEVQ,EAAUC,EAAU,EACrB,YAAYjB,CAAY,EACxB,SAASV,CAAQ,EACjB,OAAO,EAAI,EACX,OAAOiB,EAAM,KAAgB,EAC7B,WAAW,GAAG,EACd,WAAW,GAAG,EACd,OAAOC,EAAM,KAAgB,EAC7B,MAAO,CAACb,GAAcH,CAAiB,EACvC,KAAKK,CAAI,EACT,KAAKN,CAAI,EAGdL,EAAU,MAAMK,CAAI,EAAE,KAAKuB,CAAS,EACpC5B,EAAU,KAAK8B,CAAO,CAC1B,EAEA,OAAAtB,EAAiB,SAAW,IAAIwB,IACvBA,EAAK,QAGV5B,EAAW4B,EAAK,GACTxB,GAHIJ,EAKfI,EAAiB,KAAO,IAAIwB,IACnBA,EAAK,QAGV3B,EAAO2B,EAAK,GACLxB,GAHIH,EAKfG,EAAiB,MAAQ,IAAIwB,IACpBA,EAAK,QAGV1B,EAAQ0B,EAAK,GACNxB,GAHIF,EAKfE,EAAiB,QAAU,IAAIwB,IACtBA,EAAK,QAGVzB,EAAUyB,EAAK,GACRxB,GAHID,EAMRC,CACX,CLxJA,SAASyB,GAAgBC,EAAoBC,EAAkB,CAC3D,GAAI,CAACA,EACD,OAEJ,IAAMC,EAAYF,EAAS,WAAW,GAChCG,EAAaH,EAAS,WAAW,KAClCI,GAAQA,EAAI,OAASF,CAC1B,GAAG,KACCG,EAAmBJ,EAAQ,OAAO,EAClCK,EAAQL,EAAQ,MAAM,EACtBM,EAAMD,EAAM,OAChB,OAAS,CAACE,EAAGC,CAAC,IAAKJ,EAAO,QAAQ,EAC9BC,EAAME,GAAKF,EAAOE,EAAeD,GAErC,IAAIG,EAAgBV,EAAS,iBAAiBE,IAAa,SACvD,CAAC,EACL,cAAO,QAAQQ,CAAY,EAAE,QAAQ,CAAC,CAACC,EAAKC,CAAK,IAAM,CAGnD,IAAIC,EAAaC,GAAWF,IAAa,gBAErCJ,EAAIH,EAAO,UAAWD,GAAQ,CAC9B,OAAQD,OACC,WACA,WACD,OAAO,IAAI,KAAKC,CAAG,EAAE,QAAQ,IAAM,IAAI,KAAKO,CAAG,EAAE,QAAQ,UAEzD,OAAO,OAAOP,CAAG,IAAM,OAAOO,CAAG,EAE7C,CAAC,EAEDL,EAAME,GAAKK,CACf,CAAC,EACDZ,EAAQ,MAAMK,CAAK,EACZL,CACX,CAEA,SAASc,GAAUC,EAA0BhB,EAAoB,CAC7D,IAAMiB,EAAUjB,EAAS,WAAW,GAChCkB,EAAa,CAAC,CAACD,EACfE,EACAnB,EAAS,WAAW,KAAMoB,GAAMA,EAAE,OAASH,CAAO,GAAG,OAAS,SAE9DI,EAAQ,KACRC,EAAS,KAEPpB,EAAYF,EAAS,WAAW,GAChCuB,EAAOC,GAAqBxB,EAAUE,CAAS,EAE/CD,EAAUF,GAAgBC,EAAUuB,CAAI,EAExCE,EAAOC,GAAU1B,EAAU2B,GAAkB3B,CAAQ,CAAC,EAyB5D,GAvBIkB,GAAcC,EACRjB,GAGEF,EAAS,YAAY,OAAS,EAC9BqB,EAAQO,GAAyB5B,EAAUyB,CAAI,EAE/CJ,EAAQO,GAAyB5B,EAAUyB,EAAK,EAAE,EAEtDH,EAASO,GAAa,EAAE,SAAS7B,CAAQ,EAAE,MAAMC,CAAO,IAExDoB,EAAQS,GAAuB9B,EAAUiB,CAAO,EAChDK,EAASS,EAAY,EAAE,SAAS/B,CAAQ,EAAE,MAAMqB,CAAK,GAElDH,GACPG,EAAQW,GAAiBhC,EAAUyB,EAAM,YAAY,EACrDH,EAASW,GAAiB,EAAE,MAAMZ,CAAK,IAGvCA,EAAQa,EAAW,EAAE,SAASlC,CAAQ,EAAE,OAAO,CAAC,EAAE,CAAC,EAAE,EACrDsB,EAASO,GAAa,EAAE,SAAS7B,CAAQ,EAAE,MAAMC,CAAO,GAGxDD,EAAS,YAAY,SAAW,EAAG,CACnC,IAAImC,EAASC,GAAqB,EAC7B,IAAI,EAAK,EACT,eAAe,YAAY,EAChCD,EAASA,EAAO,QAAQ,OAAO,EAEhBnB,EAAU,OAAO,KAAK,EAAE,KAAK,QAAS,cAAc,EAC5D,OAAO,GAAG,EAAE,KAAKhB,EAAS,WAAW,GAAG,IAAI,EAEpCgB,EAAU,OAAO,KAAK,EAAE,KAAK,QAAS,cAAc,EAE9D,OAAO,GAAG,EACV,KAAKhB,EAAS,WAAW,GAAG,IAAI,EAChC,MAAM,YAAa,gBAAgB,EACnC,MAAM,YAAa,QAAQ,EAEhCgB,EAAYA,EAAU,MAAMS,CAAI,EAChCT,EAAU,KAAKmB,CAAM,EACrB,IAAME,EAAcF,EAAO,eAAe,EACpCG,EAAUH,EAAO,WAAW,EAC5BI,EAAQJ,EAAO,SAAS,EACxBK,EAAUL,EAAO,WAAW,EAC5BM,EAAgBN,EAAO,cAAc,EAE3CK,EAAQ,KAAK,CAACE,EAAGlC,EAAGmC,IAAa,UAAOA,EAAMnC,EAAE,EAAE,KAAKkC,EAAE,GAAG,CAAC,EAC7DJ,EACK,MAAMC,CAAK,EACX,KACG,YACA,aAAaE,EAAc,MAAQ,MAC/BA,EAAc,OAAS,IAE/B,EACC,KAAK,SAAUhB,EAAM,CAClB,IAAMmB,EAAe,UAAO,IAAI,EAChCC,GAAgB,EACX,SAAS7C,CAAQ,EACjB,KAAK,CAACyB,CAAI,CAAC,EACX,MAAMJ,CAAgB,EACtB,QAAQpB,CAAO,EAAE2C,CAAS,CACnC,CAAC,CACT,MACIC,GAAgB,EACX,SAAS7C,CAAQ,EACjB,KAAKyB,CAAI,EACT,MAAMJ,CAAgB,EACtB,QAAQpB,CAAO,EAAEe,CAAS,EAG/BM,GAAQN,EAAU,KAAKM,CAAM,CACrC,CAEAP,GAAU,OAAS,CACf,KAAM,cACN,SAAU,YACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CACH,SACA,SACA,QACA,OACA,SACA,QACA,SACJ,CACJ,EACA,WAAY,QAChB,EAEAA,GAAU,yBAA2B,CAAC+B,EAAYC,IACvCD,IAAS,UAAYC,IAAU,SAE1ChC,GAAU,sBAAwB,CAAC+B,EAAYC,IACvCD,IAAS,UAAYC,IAAU,SACxB,CACH,QAAS,CACL,KAAM,MACN,OAAQ,OAAO,KAAKjC,EAAU,CAClC,CACJ,EAEO,KAIf,IAAOkC,GAAQjC,GM5Lf,UAAYkC,OAAQ,OAIb,SAASC,GACZC,EACAC,EACF,CACE,IAAIC,EAAY,uBAAoB,EAEpC,OAAAA,EAAO,SAAS,CAACC,EAAKC,IAAM,CACxBD,EAAI,UAAYF,EAAMG,EAAE,UAAU,CAGtC,CAAC,EAGI,iBAAcF,CAAM,EACpB,OAAQE,GAAMA,EAAE,UAAU,EAC1B,OAAQA,GAAMA,EAAE,SAAS,EACzB,WAAYA,GAAMA,EAAE,UAAU,EAC9B,iBAAiBH,EAAM,aAAa,CAAC,EACrC,cAAc,CAAG,CAC1B,CClBO,SAASI,GAAYC,EAAoBC,EAAM,CAClD,IAAMC,EAAUC,EAAcH,CAAQ,EAChCI,EAAWC,GAASL,CAAQ,EAC7B,YAAYM,EAAW,MAAM,EAC7B,YAAY,aAAa,EAAE,EAE1BP,EAAc,CAAC,EAErB,OAAAE,EAAK,QAAQ,CAACM,EAAK,IAAM,CACrB,IAAMC,EAAaN,EAAQK,EAAK,CAAC,EACjC,OAAO,KAAKA,CAAG,EACV,OAAQE,GAAQA,IAAQ,cAAc,EACtC,QAASA,GAAQ,CACd,IAAMC,EAAYC,GAAcF,CAAG,EACnCV,EAAY,KAAK,CACb,WAAYS,EACZ,UACIJ,IAAaE,EAAW,KAClB,IAAI,KAAKI,CAAS,EAClBA,EACV,WAAYH,EAAIE,GAChB,IAAKF,CACT,CAAC,CACL,CAAC,CACT,CAAC,EAEMR,CACX,CAEA,SAASY,GAAcF,EAAK,CAGxB,IAAMG,EAASH,EAAI,MAAM,GAAG,EAC5B,OAAAG,EAAO,IAAI,EACJA,EAAO,KAAK,GAAG,CAC1B,CC3BA,SAASC,GAAaC,EAA0BC,EAAoB,CAChE,IAAMC,EAAOC,GAAYF,EAAUG,EAAWH,CAAQ,CAAC,EAEjDI,EAAQC,GAAiBL,EAAUC,EAAM,YAAY,EACrDK,EAASC,GAAcP,EAAUI,CAAK,EAEtCI,EAASC,GAAiB,EAAE,MAAML,CAAK,EAEvCM,EAA4BC,EAAYX,CAAQ,EACjD,YAAYY,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEX,CAAI,EAE3BY,EAA4BF,EAAYX,CAAQ,EACjD,YAAYY,EAAW,MAAM,EAC7B,YAAY,aAAa,EACzB,UAAU,WAAW,EACrB,aAAc,GACK,CAAC,MAAM,EAAE,EAAE,EACR,EAAE,QAAQ,EAAI,CACpC,EACA,OAAO,UAAU,EAAEX,CAAI,EAEtBa,EAAQC,GAAmBL,EAAOG,CAAK,EAAE,SAC3CG,EAAcV,EAAQN,CAAQ,EAAE,OAAO,EAAI,CAC/C,EAEIc,EAAM,gBACNA,EAAM,cAAc,CAAC,EACrBA,EAAM,cAAc,CAAC,EACrBR,EAAO,OAAO,OAAO,GAErBQ,EAAM,gBACNA,EAAM,cAAc,CAAC,EACrBA,EAAM,cAAc,CAAC,EACrBR,EAAO,OAAO,KAAK,GAGvB,IAAMW,EAAYC,EAAc,EAC3B,MAAMJ,CAAK,EACX,SAASd,CAAQ,EACjB,OAAOU,EAAM,KAAK,EAClB,OAAOG,EAAM,KAAK,EAClB,OAAO,EAAI,EAIVM,EAAUC,EAAU,EAErB,SAASpB,CAAQ,EACjB,OAAO,EAAI,EACX,OAAOU,EAAM,KAAK,EAGlB,OAAOG,EAAM,KAAK,EAClB,MAAMT,CAAK,EAEX,KAAKH,CAAI,EAMdF,EAAU,MAAME,CAAI,EAAE,KAAKgB,CAAS,EACpClB,EAAU,KAAKS,CAAM,EACrBT,EAAU,KAAKoB,CAAO,CAC1B,CACArB,GAAa,OAAS,CAClB,KAAM,UACN,SAAU,oBACV,UAAW,IACX,YAAa,IACb,eAAgB,GAChB,QAAS,CACL,MAAO,CAAC,OAAO,CACnB,CACJ,EAEA,IAAOuB,GAAQvB,GC3Ff,OAAS,oBAAAwB,OAAwB,OCAjC,UAAYC,OAAQ,OCmBb,SAASC,GAASC,EAAoBC,EAAuB,CAChE,OAAOC,GAAqBF,EAAUC,EAAM,CAAE,aAAc,EAAK,CAAC,EAAE,IAC/DA,GAASE,GAAaH,EAAUC,CAAI,CACzC,CACJ,CAEA,SAASE,GACLH,EACAC,EACiB,CACjB,IAAMG,EAAUC,EAAcL,CAAQ,EAChCM,EAAeC,GACjBN,EAAKM,EAAIN,EAAK,OAAS,EAAIM,EAAI,EAAIA,GAAGP,EAAS,WAAW,IACxDQ,EAAoBP,EAAK,IAAI,CAACQ,EAAK,IAAM,CAC3C,IAAMC,EAAcV,EAAS,WAAW,GAClCS,EAAIT,EAAS,WAAW,IACxB,OACAW,EAAeX,EAAS,WAAW,GACnCS,EAAIT,EAAS,WAAW,IACxBM,EAAY,CAAC,EAEnB,MAAO,CACH,WAAYF,EAAQK,EAAK,CAAC,EAC1B,WAAYT,EAAS,WAAW,IAAKY,GAAMH,EAAIG,EAAE,KAAK,EACtD,UAAWF,EACX,WAAYC,EACZ,UAAaX,EAAS,WAAW,GAC3BS,EAAIT,EAAS,WAAW,IACxB,KAAK,IAAIU,EAAqBC,CAAoB,EACxD,SAAYX,EAAS,WAAW,GAC1BS,EAAIT,EAAS,WAAW,IACxB,KAAK,IAAIU,EAAqBC,CAAoB,EACxD,IAAKV,EAAK,IACV,IAAKQ,CACT,CACJ,CAAC,EAED,OAAAD,EAAa,IAAMP,EAAK,IACjBO,CACX,CC1DA,UAAYK,OAAQ,OAIpB,IAAMC,GAAQC,GAAMA,EAAE,YAAcA,EAAE,UAE/B,SAASC,GACZC,EACAC,EACAC,EACF,CACE,IAAMC,EAASD,EAAQ,OAAO,EACxBE,EAAYC,EAAW,EACxB,OAAOF,CAAM,EACb,SAASH,CAAQ,EACjB,cAAc,CAACA,EAAS,YAAY,WAAW,CAAC,EAChD,YAAYM,GAAW,EAAG,CAAC,EAAE,EAC5BC,EAAWF,EAAW,EAAE,SAASL,CAAQ,EAAE,OAAOG,CAAM,EAAE,EAE1DK,EAASP,EAAa,EACvB,WAAYH,GAAMA,EAAE,UAAU,EAC9B,UAAWA,GAAMA,EAAE,SAAS,EAC5B,UAAWA,GAAMA,EAAE,SAAS,EAC5B,SAAUA,GAAMA,EAAE,QAAQ,EAC1B,WAAYA,GAAMA,EAAE,UAAU,EAC9B,SAAS,CAACW,EAASX,IAAM,CACtB,IAAMY,EAAQb,GAAKC,CAAC,EAAII,EAAQJ,EAAE,GAAG,EAAIM,EAAUN,EAAE,GAAG,EACxDW,EAAQ,UAAYC,EACpBD,EAAQ,YAAcC,CAC1B,CAAC,EAECC,EACD,oBAAiB,EACjB,UAAWb,GAAMA,EAAE,UAAU,OAAO,EACpC,WAAYA,GAAMA,EAAE,UAAU,EAC9B,SAAS,CAACW,EAASX,IAAM,CACtBW,EAAQ,YAAcF,EAAST,EAAE,GAAG,GAAG,CAC3C,CAAC,EAECc,EACD,oBAAiB,EACjB,UAAWd,GAAMA,EAAE,UAAU,KAAK,EAClC,UAAWA,GAAMA,EAAE,UAAU,KAAK,EAClC,WAAYA,GAAMA,EAAE,UAAU,EAC9B,SAAS,CAACW,EAASX,IAAM,CACtBW,EAAQ,UAAYH,GAAW,GAAI,EAAEC,EAAST,EAAE,GAAG,GAAG,CAAC,CAC3D,CAAC,EAEL,OACK,qBAAkB,EAClB,OAAO,CAACc,EAAqBJ,EAAQG,CAAsB,CAAC,CACrE,CFpCA,SAASE,GAAWC,EAAqB,CACrC,OAAO,SAAUC,EAA0BC,EAAoB,CAC3D,IAAMC,EAAUC,GAASF,EAAUG,GAAkBH,CAAQ,CAAC,EAExDI,EACD,2BAAwB,EACxB,MAAOC,GAAMA,EAAE,SAAS,EACvBC,EAAOL,EAAQ,IAAKM,GAAe,CACrC,IAAMC,EAAgBJ,EAAUG,CAAU,EAC1C,OAAOA,EAAW,IAAI,CAACF,EAAGI,IACtB,OAAO,OAAO,CAAE,UAAWD,EAAcC,EAAG,EAAGJ,CAAC,CACpD,CACJ,CAAC,EAEKK,EAAOT,EACR,IAAKU,GAAMA,EAAE,GAAG,EAChB,OAAOX,EAAS,SAAWA,EAAS,SAAW,CAAC,CAAC,EACjD,KAAK,EAEJY,EAAUC,EAAW,EACtB,OAAOH,CAAI,EACX,SAASV,CAAQ,EACjB,YAAYc,GAAW,CAAC,CAAC,EAAE,EAE1BC,EAASC,EAAY,EACtB,SAAShB,CAAQ,EACjB,MACGU,EAAK,OAAS,EACPE,EACD,IACV,EAEEK,EAASC,GAAiBlB,EAAUF,EAAcc,CAAO,EAEzDO,EACD,qBAAkB,EAClB,QAAQ,CAACb,EAAMc,IAAUd,EAAKc,EAAM,EACpC,OAAOd,EAAK,IAAI,IAAMW,CAAM,CAAC,EAE5BI,EAAkBC,EAAqB,EACxC,IAAI,CAAC,GAAK,EAAG,CAAC,EACd,QAAQ,SAAS,EAEhBC,EAA4BC,EAAYxB,CAAQ,EACjD,YAAY,aAAa,EACzB,UAAU,YAAY,EAAEM,CAAI,EAC3BmB,EAA4BD,EAAYxB,CAAQ,EACjD,YAAY,YAAY,EACxB,WAAW,CAAC,WAAY,WAAW,CAAC,EACpC,UAAUA,EAAS,SAAS,EAAE,EAC9B,OAAO,UAAU,EACjB,gBAAgBqB,CAAe,EAAEf,CAAI,EAEpCoB,EAAQC,GAAmBJ,EAAOE,CAAK,EAAE,SAC3CG,EAAcT,EAAOnB,CAAQ,EAAE,OAAO,UAAU,EAAE,OAAO,EAAI,CACjE,EAEA0B,EAAM,OAASA,EAAM,MAAM,EAE3B,IAAMG,EAAYC,EAAc,EAC3B,MAAMJ,CAAK,EACX,SAAS1B,CAAQ,EACjB,OAAOuB,EAAM,KAAK,EAClB,SAAUQ,GAAS,CAChB,IAAMC,EAAa1B,EAAK,IAAKW,GACzBA,EAAO,OACFZ,GACGA,EAAE,YAAc0B,EAAK,QAAQ,IAC7B1B,EAAE,YAAc0B,EAAK,QAAQ,EACrC,CACJ,EACAL,EAAM,QAAQD,EAAM,eAAeO,CAAU,CAAC,CAClD,CAAC,EACA,OAAO,EAAI,EAEVC,EAAUC,EAAU,EACrB,SAASlC,CAAQ,EACjB,OAAOuB,EAAM,KAAK,EAClB,OAAOE,EAAM,KAAK,EAClB,WAAW,YAAY,EACvB,MAAMb,CAAO,EACb,KAAKN,CAAI,EACT,OAAO,EAAI,EAGhBP,EAAU,MAAMO,CAAI,EAAE,KAAKuB,CAAS,EACpC9B,EAAU,KAAKkC,CAAO,EACtBlC,EAAU,KAAKgB,CAAM,CACzB,CACJ,CAEA,IAAOoB,GAAQtC,GDvGf,IAAMuC,GAAOC,GAAWC,EAAgB,EACxCF,GAAK,OAAS,CACV,KAAM,OACN,SAAU,UACV,UAAW,KACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,OAAQ,QAAS,OAAQ,MAAO,SAAS,CACrD,EACA,WAAY,QAChB,EAEA,IAAOG,GAAQH,GIlBf,OAAS,2BAAAI,OAA+B,OAGxC,IAAIC,GAAcC,GAAWC,EAAuB,EAEpDF,GAAY,OAAS,CACjB,KAAM,cACN,SAAU,UACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,OAAQ,QAAS,OAAQ,MAAO,SAAS,CACrD,EACA,WAAY,QAChB,EAEA,IAAOG,GAAQH,GCnBf,UAAYI,OAAQ,KCIb,SAASC,GAAUC,EAAUC,EAAM,CACtC,GAAID,EAAS,WAAW,OAAS,GAAKA,EAAS,WAAW,KAAO,KAAM,CACnE,IAAME,EAAeF,EAAS,WAAW,GACzC,GACIA,EAAS,WAAW,KAAMG,GAAMA,EAAE,OAASD,CAAY,GAAG,OAC1D,SACF,CACE,IAAME,EAASH,EACV,IAAKI,GAAMA,EAAE,IAAI,EACjB,OAAQF,GAAMA,EAAE,OAAS,CAAC,EAC1B,IAAKA,GAAMG,GAAUH,CAAC,CAAC,EACvB,OAAO,CAAC,EAAGI,IAAM,EAAE,OAAOA,CAAC,CAAC,EACjC,OAAOC,GAAyBR,EAAUI,CAAM,CACpD,KACI,QAAOK,GACHT,EACA,KACA,KACAU,GAAcT,EAAK,IAAKI,GAAMA,EAAE,OAAO,CAAC,CAC5C,CAER,CACJ,CAGA,SAASC,GAAUK,EAAOP,EAAS,CAAC,EAAG,CACnC,OAAAO,EAAM,UAAYA,EAAM,SAAS,OAAS,EACpCA,EAAM,SAAS,QAASC,GACpBR,EAAO,OAAOE,GAAUM,EAAOR,CAAM,CAAC,CAC1C,EACAO,EAAM,KAAK,OAASP,EAAO,KAAKO,EAAM,KAAK,KAAK,EAC/CP,CACX,CCpCA,UAAYS,OAAQ,KAYb,SAASC,GAASC,EAAoB,CACzC,IAAMC,EAAO,CAAC,EACRC,EAAYF,EAAS,WAAW,IAAKG,GACvCA,IAAM,KAAO,KAAOH,EAAS,WAAW,KAAMI,GAAMA,EAAE,OAASD,CAAC,CACpE,EACA,OAAAH,EAAS,KAAK,QAAQ,CAACK,EAAGC,IAAM,CAC5B,IAAMC,EAAS,MAAM,QAAQF,EAAE,YAAY,EACpCA,EAAE,aACH,CAAC,EAEQG,GAAcH,CAAC,EACvB,QAASI,GAAU,CACtB,IAAIC,EACCT,EAAKQ,KACNR,EAAKQ,GAAS,CAAC,GAEnBC,EAAeT,EAAKQ,GACpBF,EAAO,QAAQ,CAACI,EAAOC,IAAM,CACzB,IAAIC,EAAUH,EAAa,KAAMI,GAAMA,EAAE,OAASH,CAAK,EAKvD,GAJKE,IACDA,EAAU,CAAE,KAAMF,EAAO,SAAU,CAAC,CAAE,EACtCD,EAAa,KAAKG,CAAO,GAGzBb,EAAS,WAAW,OAAS,GAC7BA,EAAS,WAAW,KAAO,KAC7B,CACE,IAAMe,EAAUH,IAAML,EAAO,OAAS,EAChCS,EACAC,GADaF,EACAV,EAETL,EAAS,UAAUM,GAAGM,EAAI,IAAMP,EAFpBL,EAAS,WAAW,GAAIS,CAAK,EAM/CO,IAAe,SACfH,EAAQ,MAAQG,EAExB,CACA,GACIhB,EAAS,WAAW,OAAS,GAC7BA,EAAS,WAAW,KAAO,KAC7B,CACEa,EAAQ,QAAU,CAAC,EACnB,QAASD,EAAI,EAAGA,EAAIZ,EAAS,WAAW,OAAQ,EAAEY,EAC9CC,EAAQ,QAAQ,KACZI,GAAaZ,EAAGH,EAAUU,GAAIH,CAAK,CACvC,CAER,CACA,GAAIG,IAAML,EAAO,OAAS,GAEtB,GADAM,EAAQ,KAAON,EAAO,MAAM,EAAE,EAAE,GAC5BP,EAAS,YAAY,SAAW,EAChCa,EAAQ,KAAOI,GACXZ,EACAL,EAAS,WAAW,GACpB,EACJ,UACOO,EAAO,SAAWP,EAAS,YAAY,OAAQ,CACtD,IAAMkB,EAAOD,GACTZ,EACAL,EAAS,WAAW,GACpBS,CACJ,EACAI,EAAQ,KAAOK,EAAO,EAAIA,EAAO,CACrC,EAEJR,EAAeG,EAAQ,QAC3B,CAAC,CACL,CAAC,CACL,CAAC,EAEY,OAAO,QAAQZ,CAAI,EAAE,IAAKkB,GAAQ,CAC3C,IAAMC,EAAiB,CACnB,KAAM,OACN,SAAUD,EAAI,EAClB,EAEME,EAAU,aAAUD,CAAI,EAAE,IAAKf,GAAMA,EAAE,IAAI,EAC3CiB,EACD,aAAoB,EACpB,KAAK,CAAC,EAAI,KAAK,GAAID,EAAK,OAAS,CAAC,CAAC,EAAEA,CAAI,EAK9C,OAACC,EAAkB,KAAMjB,GAAM,CAC3BA,EAAE,QAAUA,EACZA,EAAE,WACEL,EAAS,WAAW,SAAW,GAC9BA,EAAS,WAAW,KAAO,MACxBA,EAAS,WAAW,KAAO,KACzBK,EAAE,MACF,CAACA,EAAE,MAAOA,EAAE,KAAK,KAAK,EACjB,OAAOA,EAAE,KAAK,SAAW,CAAC,CAAC,EAC3B,OAAQF,GAAMA,IAAM,MAAS,EAE5CE,EAAE,WAAaA,EACV,UAAU,EACV,MAAM,EAAG,EAAE,EACX,QAAQ,EACR,IAAKkB,GAAUA,EAAM,KAAK,IAAI,EAEnClB,EAAE,IAAMc,EAAI,GACZd,EAAE,MAAQmB,GACNxB,EAAS,YAAYK,EAAE,MAAQ,EAAI,EAAI,EAAIA,EAAE,MAAQ,IAAI,MACrDL,EAAS,WAAW,GAAG,KAC3BK,EAAE,KAAK,IACX,CACJ,CAAC,EAEM,CACH,MAAOc,EAAI,GACX,KAAMG,EACN,QAASG,GAAWzB,EAAUmB,CAAG,CACrC,CACJ,CAAC,CAGL,CAEO,IAAMF,GAAe,CAACZ,EAAGqB,EAAWjB,IACvCA,EAAM,OAASJ,EAAE,GAAGI,KAASiB,EAAU,QAAUrB,EAAEqB,EAAU,MAEjE,SAASD,GAAWzB,EAAU,CAACS,EAAOkB,CAAI,EAAG,CACzC,GAAI3B,EAAS,WAAW,OAAS,GAAKA,EAAS,WAAW,KAAO,KAAM,CACnE,IAAM4B,EAAM,KAAK,IACb,GAAG5B,EAAS,KAAK,IAAKK,GAClBY,GAAaZ,EAAGL,EAAS,WAAW,GAAIS,CAAK,CACjD,CACJ,EACMoB,EAAM,KAAK,IAAI,GAAGF,EAAK,IAAKtB,GAAMA,EAAE,KAAK,CAAC,EAChD,MAAO,CAACuB,EAAKC,CAAG,CACpB,CACJ,CAEA,SAASrB,GAAcH,EAAG,CACtB,IAAMyB,EAAS,CAAC,EAChB,cAAO,KAAKzB,CAAC,EAAE,QAAS0B,GAAQ,CAC5B,GAAIA,IAAQ,eAAgB,CACxB,IAAMC,EAAaD,EAAI,MAAM,GAAG,EAAE,MAAM,EAAG,EAAE,EAAE,KAAK,GAAG,EAClDD,EAAO,SAASE,CAAU,GAC3BF,EAAO,KAAKE,CAAU,CAE9B,CACJ,CAAC,EACMF,CACX,CC/JA,OAAS,OAAAG,OAAW,KAGb,IAAMC,GAAmCC,GAC5CF,GAAY,EACP,WAAYG,GAAMA,EAAE,EAAE,EACtB,SAAUA,GAAMA,EAAE,EAAE,EACpB,SAAUA,GAAM,KAAK,KAAKA,EAAE,GAAKA,EAAE,IAAM,EAAG,IAAK,CAAC,EAClD,UAAUD,CAAM,EAChB,YAAaC,GAAM,KAAK,IAAI,GAAIA,EAAE,GAAK,GAAKD,CAAM,CAAC,EACnD,YAAaC,GACV,KAAK,KAAKA,EAAE,GAAK,GAAKD,GAASC,EAAE,GAAK,GAAKD,EAAS,CAAC,CACzD,EAEKE,GAAcD,GAAMA,EAAE,IAAM,GAAKA,EAAE,GAAKA,EAAE,GCdvD,OAAS,UAAAE,OAAc,KAEhB,IAAMC,GAAgBC,GACzBA,EAAE,IAAM,GAAKA,EAAE,IAAM,IAAMA,EAAE,GAAKA,EAAE,KAAOA,EAAE,GAAKA,EAAE,IAAM,IAEvD,SAASC,GAAeD,EAAGE,EAAQ,CACtC,IAAMC,GAAOH,EAAE,GAAKA,EAAE,IAAM,EAAK,IAAO,KAAK,GACvCI,GAAMJ,EAAE,GAAK,GAAKA,EAAE,GAAK,IAAM,EAAKE,EAC1C,MAAO,UAAUC,EAAI,iBAAiBC,eAAeD,EAAI,IAAM,EAAI,MACvE,CAEO,SAASE,GAAUL,EAAGM,EAAa,CACtC,IAAIC,EAAc,KAAK,QAAQ,EAAE,MACjC,GAAIA,EAAcD,EAAa,CAC3B,IAAIE,EAAYR,EAAE,MACZS,EAAgBX,GAAO,IAAI,EACjC,KAAOS,EAAcD,GACjBE,EAAYA,EAAU,UAAU,EAAGA,EAAU,OAAS,CAAC,EACvDC,EAAc,KAAK,IAAMD,CAAS,EAClCD,EAAc,KAAK,QAAQ,EAAE,MAEjCE,EAAc,KACV,IACI,GAAGD,EACE,UAAU,EAAGA,EAAU,OAAS,CAAC,EACjC,QAAQ,OAAQ,EAAE,MAC/B,CACJ,CACJ,CC5BA,OAAS,eAAAE,OAAmB,KAIrB,IAAMC,GACT,CAACC,EAAMC,EAAGC,EAAQC,EAAaC,EAAMC,EAAOC,EAAQC,EAAOC,IAC3D,CAACC,EAAGC,IAAmB,CACnBF,EAAS,cAAcD,GAASE,EAAE,KAAK,KACnCA,EAAE,QACFP,EAAO,MAAMO,EAAE,MAAM,EACrBP,EAAO,MAAM,SAAU,SAAS,EAChCC,EAAY,KAAK,WAAWM,EAAE,OAAO,IAErCP,EAAO,MAAMF,CAAI,EACjBE,EAAO,MAAM,SAAU,SAAS,EAChCC,EAAY,KAAK,EAAE,GAEvBH,EAAK,KACAW,GACIA,EAAE,OAAS,CACR,GACI,KAAK,IACD,EACA,KAAK,IAAI,GAAIA,EAAE,GAAKF,EAAE,KAAOA,EAAE,GAAKA,EAAE,GAAG,CAC7C,EACA,EACA,KAAK,GACT,GACI,KAAK,IACD,EACA,KAAK,IAAI,GAAIE,EAAE,GAAKF,EAAE,KAAOA,EAAE,GAAKA,EAAE,GAAG,CAC7C,EACA,EACA,KAAK,GACT,GAAI,KAAK,IAAI,EAAGE,EAAE,GAAKF,EAAE,KAAK,EAC9B,GAAI,KAAK,IAAI,EAAGE,EAAE,GAAKF,EAAE,KAAK,CAClC,CACR,EAEA,IAAMG,EAAIX,EAAE,WAAW,EAAE,SAASS,EAAiB,EAAI,GAAG,EAC1DN,EAAK,WAAWQ,CAAC,EACZ,MAAM,OAASD,GAAM,CAClB,IAAME,EAAIC,GAAYH,EAAE,QAASA,EAAE,MAAM,EACzC,OAAQC,GAAOD,EAAE,QAAUE,EAAED,CAAC,CAClC,CAAC,EACA,OAAO,SAAUD,EAAG,CACjB,MACI,CAAC,KAAK,aAAa,cAAc,GAAKI,GAAWJ,EAAE,MAAM,CAEjE,CAAC,EACA,KAAK,eAAiBA,GAAOI,GAAWJ,EAAE,MAAM,EAAI,EAAI,CAAE,EAC1D,KAAK,cAAgBA,GAClBI,GAAWJ,EAAE,MAAM,EAAI,UAAY,MACvC,EACC,MAAM,iBAAmBA,GACtBI,GAAWJ,EAAE,MAAM,EAAI,UAAY,MACvC,EACC,UAAU,IAAMA,GAAM,IAAMK,GAAQV,CAAM,EAAEK,EAAE,OAAO,CAAC,EAE3DN,EACK,OAAO,SAAUM,EAAG,CACjB,MACI,CAAC,KAAK,aAAa,cAAc,GAAKM,GAAaN,EAAE,MAAM,CAEnE,CAAC,EACA,WAAWC,CAAC,EACZ,KAAK,eAAiBD,GAAM,CAACM,GAAaN,EAAE,MAAM,CAAC,EACnD,UACG,YACCA,GAAM,IAAMO,GAAeP,EAAE,QAASL,CAAM,CACjD,CACR,EC1BG,SAASa,IAAiC,CAC7C,IAAIC,EAA4B,KAC5BC,EAAuB,KACvBC,EAA4B,KAC5BC,EAAwB,KACxBC,EAAS,KAEPC,EAA4CC,GAAoB,CAClE,IAAMC,EAAUD,EACX,UAAU,WAAW,EACrB,KAAKJ,EAAK,YAAY,EAAE,MAAM,CAAC,CAAC,EAC/BM,EAAeD,EAChB,MAAM,EACN,OAAO,GAAG,EACV,KAAK,QAAS,SAAS,EAE5BC,EAAa,OAAO,MAAM,EAC1BA,EACK,OAAO,MAAM,EACb,KAAK,QAAS,SAAS,EACvB,KAAK,KAAM,QAAQ,EACxB,IAAMC,EAAeD,EAAa,MAAMD,CAAO,EAEzCG,EAAOD,EACR,OAAO,MAAM,EACb,KAAK,eAAiBE,GAAOC,GAAWD,EAAE,OAAO,EAAI,EAAI,CAAE,EAC3D,KAAK,cAAgBA,GAClBC,GAAWD,EAAE,OAAO,EAAI,UAAY,MACxC,EACC,MAAM,iBAAmBA,GACtBC,GAAWD,EAAE,OAAO,EAAI,UAAY,MACxC,EACC,KAAK,IAAMA,GAAME,GAAQT,CAAM,EAAEO,EAAE,OAAO,CAAC,EAChDR,GAASO,EAAK,MAAM,OAASC,GAAMR,EAAMQ,EAAE,KAAK,KAAK,CAAC,EAEtD,IAAMG,EAAQL,EACT,OAAO,MAAM,EACb,KAAK,eAAiBE,GAAM,CAACI,GAAaJ,EAAE,OAAO,CAAC,EACpD,KAAK,YAAcA,GAAMK,GAAeL,EAAE,QAASP,CAAM,CAAC,EAC1D,KAAMO,GAAMA,EAAE,KAAK,EACnB,KAAK,SAAUA,EAAG,CACfM,GAAU,KAAK,KAAMN,EAAGP,CAAM,CAClC,CAAC,EAECc,EAAcZ,EAAgB,OAAO,aAAa,EAClDa,EAASb,EACV,OAAO,QAAQ,EACf,KAAK,IAAKF,CAAM,EAChB,MAAMF,CAAI,EAETkB,EAAUC,GACZnB,EACAI,EACAa,EACAD,EACAR,EACAI,EACAV,EACAH,EACAD,CACJ,EAEA,GAAIA,EAAS,cAAe,CACxB,IAAMsB,EAAepB,EAChB,YAAY,EACZ,KAAMS,GAAMA,EAAE,KAAK,OAASX,EAAS,cAAcC,EAAM,EAC9DqB,GAAgBF,EAAQE,EAAc,EAAI,CAC9C,MACItB,EAAS,cAAgB,CAAC,EAE9BmB,EAAO,GAAG,QAAUR,GAAMS,EAAQT,EAAG,EAAK,CAAC,EAC3CD,EAAK,OAAQC,GAAMA,EAAE,QAAQ,EACxB,MAAM,SAAU,SAAS,EACzB,GAAG,QAAUA,GAAMS,EAAQT,EAAG,EAAK,CAAC,CAC7C,EAEA,OAAAN,EAAgB,SAAW,IAAIkB,IACtBA,EAAK,QAGVvB,EAAWuB,EAAK,GACTlB,GAHIL,EAMfK,EAAgB,MAAQ,IAAIkB,IACnBA,EAAK,QAGVtB,EAAQsB,EAAK,GACNlB,GAHIJ,EAMfI,EAAgB,KAAO,IAAIkB,IAClBA,EAAK,QAGVrB,EAAOqB,EAAK,GACLlB,GAHIH,EAMfG,EAAgB,MAAQ,IAAIkB,IACnBA,EAAK,QAGVpB,EAAQoB,EAAK,GACNlB,GAHIF,EAMfE,EAAgB,OAAS,IAAIkB,IACpBA,EAAK,QAGVnB,EAASmB,EAAK,GACPlB,GAHID,EAMRC,CACX,CNrJA,SAASmB,GAASC,EAA0BC,EAAoB,CAC5D,IAAMC,EAAOC,GAASF,CAAQ,EACxBG,EAAQC,GAAUJ,EAAUC,CAAI,EAChCI,EAAeC,GAAqB,EAAE,eAAe,UAAU,EAIrE,GAFAP,EAAU,MAAME,CAAI,EAAE,KAAKI,CAAY,EAEnCF,EAAO,CACP,IAAMI,EAAeP,EAAS,WAAW,GACzC,GACIA,EAAS,WAAW,KAAMQ,GAAMA,EAAE,OAASD,CAAY,GAAG,OAC1D,SACF,CACE,IAAME,EAASC,EAAY,EAAE,SAASV,CAAQ,EAAE,MAAMG,CAAK,EAC3DJ,EAAU,KAAKU,CAAM,CACzB,KAAO,CACH,IAAMA,EAASE,GAAiB,EAAE,MAAMR,CAAK,EAC7CJ,EAAU,KAAKU,CAAM,CACzB,CACJ,CAEA,IAAMG,EAAoBP,EAAa,eAAe,EAChDQ,EAAgBR,EAAa,WAAW,EACxCS,EAAcT,EAAa,SAAS,EACpCU,EAAgBV,EAAa,WAAW,EACxCW,EAAgBX,EAAa,cAAc,EAEjDU,EAAc,KAAK,CAACE,EAAGC,EAAGC,IAAa,UAAOA,EAAMD,EAAE,EAAE,KAAKD,EAAE,KAAK,CAAC,EAErEL,EACK,OAAO,QAAQ,EACf,KAAK,OAAQ,MAAM,EACnB,MAAM,iBAAkB,KAAK,EAElCA,EAAkB,OAAO,MAAM,EAAE,KAAK,QAAS,QAAQ,EACvDC,EACK,MAAMC,CAAW,EACjB,OAAO,KAAK,EACZ,OAAO,YAAY,EACnB,KACG,YACA,aAAaE,EAAc,MAAQ,MAAMA,EAAc,OAAS,IACpE,EACC,KAAK,SAAU,CACZ,MAAAI,EACA,KAAAnB,CACJ,EAGG,CACC,IAAMoB,EAAqB,UAAO,IAAI,EAChCC,EAAsB,KAAK,WAC3B,CAAE,MAAAC,EAAO,OAAAC,CAAO,EAAIF,EAAQ,sBAAsB,EAElDG,GACD,KAAK,IAAIF,EAAOC,CAAM,EAAI,IAC3B,KAAK,IAAI,EAAGxB,EAAS,YAAY,OAAS,CAAC,EAC/C0B,GAAe,EACV,SAAS1B,CAAQ,EACjB,MAAMoB,CAAK,EACX,KAAKnB,CAAI,EACT,MAAME,CAAK,EACX,OAAOsB,CAAM,EAAEJ,CAAe,EAEnCM,GAAQ,EAAE,SAAS3B,CAAQ,EACvBqB,EAAgB,UAAU,WAAW,CACzC,CACJ,CAAC,CACT,CAEAvB,GAAS,OAAS,CACd,KAAM,WACN,SAAU,oBACV,UAAW,KACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,OAAQ,QAAS,SAAS,CACtC,CACJ,EAEA,IAAO8B,GAAQ9B,GOhGf,UAAY+B,OAAQ,KCKb,SAASC,GACZC,EACAC,EACF,CACE,GACID,EAAS,WAAW,OAAS,GAC7BA,EAAS,WAAW,KAAO,MAC3BA,EAAS,WAAW,KAAO,OAE3B,OACJ,IAAME,EAAeF,EAAS,WAAW,GACnCG,EAASF,EACV,OAAQG,GAAMA,EAAE,OAAS,CAAC,EAC1B,IAAKA,GAAMC,GAAUD,CAAC,CAAC,EACvB,OAAO,CAAC,EAAGE,IAAM,EAAE,OAAOA,CAAC,CAAC,EACjC,GACIN,EAAS,WAAW,KAAMI,GAAMA,EAAE,OAASF,CAAY,GAAG,OAC1D,SAEA,OAAOK,GAAyBP,EAAUG,CAAM,EAC7C,CACH,IAAIK,EAAM,KAAK,IAAI,GAAGL,CAAM,EACxBM,EAAM,KAAK,IAAI,GAAGN,CAAM,EAC5B,OAAOO,GAAiBV,EAAU,KAAM,KAAM,CAACQ,EAAKC,CAAG,CAAC,CAC5D,CACJ,CAGA,SAASJ,GAAUM,EAAOR,EAAS,CAAC,EAAG,CACnC,OAAAQ,EAAM,UAAYA,EAAM,SAAS,OAAS,EACpCA,EAAM,SAAS,QAASC,GACpBT,EAAO,OAAOE,GAAUO,EAAOT,CAAM,CAAC,CAC1C,EACAQ,EAAM,KAAK,OAASR,EAAO,KAAKQ,EAAM,KAAK,KAAK,EAC/CR,CACX,CCxCA,OAAS,UAAAU,MAAc,KAGvB,IAAMC,GAAc,EAEPC,GAAkBC,GAC3B,GAAAA,EAAE,QAAUA,EAAE,OAAO,gBAEZC,GAAe,CAACC,EAAOC,EAAcC,IAAgB,CAC9DF,EAAM,UAAU,MAAM,EAAE,KAAK,SAAUF,EAAGK,EAAG,CACzC,IAAMC,EAAOC,GAAgBP,EAAGG,EAAcC,CAAW,EACzD,KAAK,MAAQE,CACjB,CAAC,EAED,IAAME,EAAeC,GAAmBP,CAAK,EAC7CQ,GAAaF,CAAY,EACzBG,GAAsBH,CAAY,CACtC,EAEaI,GAAiBV,GAAU,CACpCA,EAAM,KAAK,CAACF,EAAGK,EAAGH,IAAU,CACVW,EAAOX,EAAMG,EAAE,EAAE,UAAU,MAAM,EAE1C,KAAK,KAAML,EAAE,OAAO,eAAe,EAAE,EACrC,KAAK,KAAMA,EAAE,OAAO,eAAe,EAAE,EACrC,KAAK,QAASA,EAAE,OAAO,eAAe,KAAK,CACpD,CAAC,CACL,EAEaW,GAAyBT,GAAU,CAG5C,IAAMY,EAAQC,GAAqBA,EAAQ,sBAAsB,EAE3DC,EAAW,CAAC,EAClBd,EACK,UAAU,MAAM,EAChB,OACG,CAACe,EAAG,EAAGf,IACHW,EAAOX,EAAM,EAAE,EAAE,KAAK,OAAO,IAAMgB,GAAe,IAC1D,EACC,KAAK,CAACD,EAAG,EAAGf,IAAUc,EAAS,KAAKd,EAAM,EAAE,CAAC,EAElDA,EACK,UAAU,MAAM,EAChB,OACG,CAACe,EAAG,EAAGf,IACHW,EAAOX,EAAM,EAAE,EAAE,KAAK,OAAO,IAAMgB,GAAe,GAC1D,EACC,KAAK,CAACD,EAAG,EAAGf,IAAU,CACnB,IAAMiB,EAAYjB,EAAM,GACxBc,EACK,OACII,GACGC,GACI,IACAP,EAAKM,CAAO,EACZN,EAAKK,CAAS,CAClB,GACAE,GACI,IACAP,EAAKM,CAAO,EACZN,EAAKK,CAAS,EACd,EACJ,CACR,EACC,QAAQ,IACLN,EAAOM,CAAS,EAAE,KACd,KACA,OAAON,EAAOM,CAAS,EAAE,KAAK,IAAI,CAAC,EAAI,EAC3C,CACJ,CACR,CAAC,CACT,EAEaG,GAAmBtB,GAC5Ba,EAAOb,CAAC,EAAE,MAAM,UAAWuB,GAAYV,EAAOb,CAAC,EAAE,KAAK,OAAO,EAAE,EAEtDwB,GAAqBxB,GAAMa,EAAOb,CAAC,EAAE,MAAM,UAAW,IAAI,EAE1DuB,GAAc,CAAE,IAAK,EAAG,IAAK,GAAK,MAAO,CAAE,EAE3Cd,GAAsBP,GAC/BA,EAAM,OACF,CAACe,EAAGZ,EAAGH,IACHW,EAAOX,EAAMG,EAAE,EAAE,UAAU,MAAM,EAAE,KAAK,OAAO,IAC/Ca,GAAe,IACvB,EAESO,GAA4BvB,GACrCA,EAAM,UAAU,MAAM,EAAE,KAAK,CAACe,EAAGZ,EAAGH,IAAUwB,GAAiBxB,EAAMG,EAAE,CAAC,EAEtEK,GAAgBR,GAClBA,EAAM,UAAU,MAAM,EAAE,KAAK,CAACe,EAAGZ,EAAGH,IAAUyB,GAAWzB,EAAMG,EAAE,CAAC,EAEhEsB,GAAc3B,GAAM,CACtB,IAAM4B,EAAaf,EAAOb,CAAC,EACrBc,EAAOd,EAAE,sBAAsB,EACrC4B,EAAW,KAAK,KAAM,EAAId,EAAK,MAAQ,CAAC,EAAE,KAAK,KAAM,EAAIA,EAAK,OAAS,CAAC,CAC5E,EAGMY,GAAoB1B,GAAM,CAE5B,IAAMc,EADSd,EAAE,WACG,WAAW,GAEzB6B,EAAW7B,EAAE,QAAQ,EACrB8B,EAAWhB,EAAK,QAAQ,EAEzBiB,GAAoB/B,EAAG8B,EAAUD,CAAQ,GAC1ChB,EAAOb,CAAC,EAAE,KAAK,QAASa,EAAOb,CAAC,EAAE,KAAK,OAAO,CAAC,CAEvD,EAEM+B,GAAsB,CAAC/B,EAAG8B,EAAUD,IAAa,CACnD,IAAMG,EAAgB,KAAK,IACvBF,EAAS,OAASD,EAAS,OAC3BC,EAAS,MAAQD,EAAS,KAC9B,EAEA,GAAIG,EAAgB,EAAG,CACnB,IAAMC,EAAW,SAASpB,EAAOb,CAAC,EAAE,MAAM,WAAW,CAAC,EAChDkC,EAAc,KAAK,MAAMD,EAAWD,CAAa,EACvD,OAAIC,EAAWnC,IAAeoC,EAAcpC,IACxCe,EAAOb,CAAC,EAAE,MAAM,YAAa,GAAGkC,KAAe,EAC/CP,GAAW3B,CAAC,IAEZa,EAAOb,CAAC,EAAE,MAAM,YAAa,IAAI,EACjCa,EAAOb,CAAC,EAAE,MAAM,UAAW,GAAG,GAE3B,EACX,CACA,MAAO,EACX,EAEMO,GAAkB,CAACP,EAAGG,EAAcC,IAAgB,CACtD,GACI,CAACA,EACI,OAAQ+B,GAAMA,IAAM,EAAE,EACtB,MAAOA,GAAMnC,EAAE,WAAW,SAASmC,CAAC,CAAC,EAE1C,OAAOjB,GAAe,KAC1B,OAAQlB,EAAE,YACDG,EAAe,EAChB,OAAOe,GAAe,UACrBf,EAAe,EAChB,OAAOe,GAAe,YAEtB,OAAOA,GAAe,KAElC,EAEMA,GAAiB,CACnB,KAAM,iDACN,IAAK,uCACL,KAAM,oCACV,EC5JA,UAAYkB,OAAQ,KAEpB,IAAOC,GAAQ,CAACC,EAAeC,IAA8C,CACzE,IAAMC,EACD,WAAQ,EACR,KAAK,CAACF,EAAOC,CAAM,CAAC,EACpB,aAAcE,GAAM,EAAI,GAAKA,EAAE,OAAS,EAAE,EAE/C,OAAAD,EAAc,KAAQ,gBAAa,EAE5BA,CACX,ECXA,UAAYE,OAAQ,KCCpB,OAAS,aAAAC,GAAW,UAAAC,OAAc,KAIlC,IAAMC,GAAyB,CAACC,EAAGC,IAC/BA,EAAY,MAAOC,GAAQF,EAAE,WAAW,SAASE,CAAG,CAAC,EAElD,SAASC,GACZH,EACAC,EACAG,EACAC,EACAC,EACAC,EACF,CAIEC,GACIR,EACAC,EACAG,EACAC,EACAC,CACJ,EACAN,EAAE,SAASK,GAAc,UAAY,GAGrCI,GACIT,EACAO,EAAW,KAAK,EAAE,sBAAsB,EAAE,MAC1CA,EAAW,KAAK,EAAE,sBAAsB,EAAE,OAC1CF,CACJ,EAEAK,GAAuBN,EAAYC,CAAY,CACnD,CAEO,SAASM,GAAsBP,EAAYE,EAAU,CACxDF,EAAW,KAAMJ,GAAM,CACnBA,EAAE,SAAW,CAAC,EACdA,EAAE,SAAS,GAAK,CACZ,GAAIA,EAAE,GACN,GAAIY,GAAUZ,CAAC,EAAIA,EAAE,GACrB,GAAIA,EAAE,GACN,GAAIa,GAAWb,CAAC,EAAIA,EAAE,GACtB,QAAS,GACT,QAAS,CACb,CACJ,CAAC,EACDM,EAAS,SAAS,GAAG,UAAY,GACjCI,GAAuBN,EAAY,CAAC,CACxC,CAEO,IAAMU,GAAe,CAACC,EAAOV,IAAiB,CACjDU,EAAM,KAAK,CAACf,EAAGgB,EAAGD,IAAU,CACxB,IAAME,EAAQC,GAAOH,EAAMC,EAAE,EAAE,UAAU,MAAM,EAC/ChB,EAAE,SAASK,GAAc,eAAiB,CACtC,GAAIY,EAAM,KAAK,IAAI,EACnB,GAAIA,EAAM,KAAK,IAAI,EACnB,MAAOA,EAAM,KAAK,OAAO,EACzB,YAAaA,EAAM,MAAM,WAAW,CACxC,CACJ,CAAC,CACL,EAEA,SAAST,GACLR,EACAC,EACAG,EACAC,EACAC,EACF,CACE,IAAMa,EAAgB,CAClB,EAAGnB,EAAE,GACL,EAAGA,EAAE,GACL,MAAOA,EAAE,GAAKA,EAAE,GAChB,OAAQA,EAAE,GAAKA,EAAE,EACrB,EACMoB,EAAgB,CAClB,MAAOd,EAAS,GAAKA,EAAS,GAC9B,OAAQA,EAAS,GAAKA,EAAS,EACnC,EACMe,EAAsB,CACxB,MAAOD,EAAc,MAAQD,EAAc,MAC3C,OAAQC,EAAc,OAASD,EAAc,MACjD,EAEAf,EAAW,KAAMJ,GAAM,CACnB,IAAMsB,GAAMtB,EAAE,GAAKmB,EAAc,GAAKE,EAAoB,MACpDE,GAAMvB,EAAE,GAAKmB,EAAc,GAAKE,EAAoB,OACpDG,EAAQZ,GAAUZ,CAAC,EAAIqB,EAAoB,MAC3CI,EAASZ,GAAWb,CAAC,EAAIqB,EAAoB,OAC7CK,EACF3B,GAAuBC,EAAGC,CAAW,GACrCD,EAAE,KAAK,OAASC,EAAYI,EAAe,GAE/CL,EAAE,SAASK,GAAgB,CACvB,GAAAiB,EACA,GAAIE,EAAQF,EACZ,GAAAC,EACA,GAAIE,EAASF,EACb,QAAAG,EACA,QAASA,EAAU,EAAI,CAC3B,CACJ,CAAC,EACD1B,EAAE,SAASK,GAAc,UAAY,EACzC,CAEA,SAASI,GACLkB,EACAC,EACAC,EACAxB,EACF,CAME,IAAMyB,EALqBC,GAAcH,EAAeC,CAAc,EAElEG,GAAUL,EAAY,IAAI,EAAE,IAAK3B,GAAMA,EAAE,IAAI,CACjD,EAE4C,YAAY,EAClDiC,EAAcN,EAAY,YAAY,EAE5CG,EAAmB,QAAQ,CAACI,EAAGlB,IAAM,CACjCiB,EAAYjB,GAAG,SAASX,GAAc,GAAKyB,EAAmBd,GAAG,GACjEiB,EAAYjB,GAAG,SAASX,GAAc,GAAKyB,EAAmBd,GAAG,GACjEiB,EAAYjB,GAAG,SAASX,GAAc,GAAKyB,EAAmBd,GAAG,GACjEiB,EAAYjB,GAAG,SAASX,GAAc,GAAKyB,EAAmBd,GAAG,EACrE,CAAC,CACL,CAEA,SAASN,GAAuBN,EAAYC,EAAc,CACtDD,EAAW,UAAU,MAAM,EAAE,KAAK,CAAC8B,EAAGlB,EAAGD,IAAU,CAC/C,IAAMoB,EAAOjB,GAAOH,EAAMC,EAAE,EACtBhB,EAASkB,GAAOH,EAAMC,EAAE,EAAE,MAAM,EAChCoB,EAAUD,EAAK,KAAK,OAAO,EACjCnC,EAAE,SAASK,GAAc,aAAe,CACpC,QAASgC,GAAYD,EACzB,CACJ,CAAC,CACL,CD7HO,SAASE,GACZC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACF,CACE,GAAIL,EAAS,aAAe,EAAG,CAC3B,IAAMM,EAAcH,EAAS,WAC7BI,GACIJ,EACAN,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA,EACAG,EACAF,EACAC,EACA,EACA,EACJ,EAEAL,EAAS,aACJ,MAAM,EAAGA,EAAS,aAAa,MAAM,EACrC,QAASQ,GAAO,CACb,IAAM,EAAIV,EAAW,OAAQW,GAAMA,EAAE,aAAeD,CAAE,EAAE,MAAM,EACxDF,EAAc,EAAE,WACtBI,GACI,EACAJ,EACAR,EACA,EAAE,MACFK,EACAF,CACJ,EACAM,GACI,EACAV,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA,EAAE,MACFG,EACAF,EACAC,EACA,EACA,EACJ,CACJ,CAAC,CACT,CACJ,CAEO,SAASM,GACZF,EACAZ,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACF,CACE,GAAI,CAACI,EAAE,SAAU,OAEbT,EAAS,aAAeS,EAAE,MAC1BT,EAAS,aAAa,KAAKS,EAAE,UAAU,EAEvCT,EAAS,aAAa,IAAI,EAG9BA,EAAS,aAAeS,EAAE,MAE1B,IAAMH,EAAcG,EAAE,YAGlB,CAACA,EAAE,SAAST,EAAS,eACrB,CAACS,EAAE,SAAST,EAAS,cAAc,YAEnCU,GACID,EACAH,EACAR,EACAE,EAAS,aACTG,EACAF,CACJ,EAGJM,GACIE,EACAZ,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAH,EAAS,aACTM,EACAF,EACAC,CACJ,CACJ,CAEA,SAASE,GACLE,EACAZ,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAS,EACAN,EACAF,EACAC,EACAQ,EAAW,IACXC,EAAiB,GACnB,CACE,IAAMC,EAASN,EAAE,OAEXO,EAAId,EACL,WAAW,iBAAiB,EAC5B,SAASW,CAAQ,EACjB,KAAQ,eAAY,EAEzBf,EAAW,KAAMW,GAAOA,EAAE,OAASA,EAAE,SAASG,EAAc,EAEvDK,GAAeR,CAAC,GAAGS,GAAuBpB,EAAYM,CAAW,EAGtEN,EACK,WAAWkB,CAAC,EACZ,MAAM,OAASP,GAAM,CAClB,IAAMU,EAAO,eAAYV,EAAE,QAASA,EAAE,MAAM,EAC5C,OAAQO,GAAOP,EAAE,QAAUU,EAAEH,CAAC,CAClC,CAAC,EACA,WAAW,UAAYP,GAAM,IAAMA,EAAE,QAAQ,OAAO,EACpD,UACG,iBACCA,GAAM,IAAMA,EAAE,OAAO,QAAU,MAAQ,MAC5C,EAEJZ,EACK,WAAWmB,CAAC,EACZ,OAAQP,GAAMA,EAAE,OAAO,OAAO,EAC9B,WAAW,IAAMA,GAAM,IAAM,GAAGA,EAAE,QAAQ,MAAM,EAChD,WAAW,IAAMA,GAAM,IAAM,GAAGA,EAAE,QAAQ,MAAM,EAChD,WAAW,QAAUA,GAAM,IAAM,GAAGA,EAAE,QAAQ,GAAKA,EAAE,QAAQ,MAAM,EACnE,WAAW,SAAWA,GAAM,IAAM,GAAGA,EAAE,QAAQ,GAAKA,EAAE,QAAQ,MAAM,EAEzEV,EACK,WAAWiB,CAAC,EACZ,OAAQP,GAAMA,EAAE,OAAO,OAAO,EAC9B,UAAU,IAAMA,GAAM,IAAMA,EAAE,QAAQ,GAAKW,GAAUX,EAAE,OAAO,EAAI,CAAC,EACnE,UAAU,IAAMA,GAAM,IAAMA,EAAE,QAAQ,GAAKY,GAAWZ,EAAE,OAAO,EAAI,CAAC,EACpE,IAAI,EACJ,MAAM,IAAMa,GAAsBxB,CAAU,CAAC,EAC7C,KAAK,IAAM,CACHmB,GAAeR,CAAC,IACjBc,GAAsBC,CAAiB,EACvCC,GAAyBD,CAAiB,EAC1CE,GAAmB3B,EAAQG,EAAYW,CAAQ,EAC3CC,GAAgBa,GAAa7B,EAAYc,CAAY,EACzDU,GAAsBxB,EAAYM,CAAW,EAErD,CAAC,EACA,MAAOwB,GAAO,CACX,QAAQ,MACJ,sDACAA,CACJ,EACAN,GAAsBxB,EAAYM,CAAW,CACjD,CAAC,EAEAa,GAAeR,CAAC,EAIjBoB,GAAc/B,CAAU,GAHxBC,EAAO,KAAK,CAAC+B,EAAGX,EAAGpB,IAAWgC,GAAgBhC,EAAOoB,EAAE,CAAC,EACxDa,GAAalC,EAAYc,EAAcN,CAAW,GAKtD,IAAMkB,EAAoBS,GAAmBnC,CAAU,EAEnDiB,EACAX,EACK,KAAK,EAAK,EACV,KAAKK,EAAE,KAAK,EACZ,QAAQ,IAAM,CACXE,GACII,EACAlB,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,CAEJ,EACA,IAAM6B,EAASjC,EAAW,KAAK,EAAE,YAAY,EACxC,KAAK,cACVkC,GAAWD,EAAQnB,EAAQV,CAAa,CAC5C,CAAC,EAAE,EAEPD,EAAY,KAAK,EAAI,EAAE,CAE/B,CAEA,eAAesB,GAAmB3B,EAAQG,EAAYW,EAAW,IAAK,CAClE,IAAMG,EAAId,EACL,WAAW,sBAAsB,EACjC,SAASW,CAAQ,EACjB,KAAQ,eAAY,EAEzB,MAAMd,EACD,WAAWiB,CAAC,EACZ,OAAQP,GAAMA,EAAE,OAAO,OAAO,EAC9B,MAAM,OAAQ,CAACA,EAAGU,EAAGpB,IAAW,CAC7B,IAAMqC,EAAQrC,EAAOoB,GACfkB,EAAmB,eACrBC,GAAc7B,CAAC,EACf8B,GAAcH,CAAK,CACvB,EACA,OAAQpB,GAAOP,EAAE,QAAQ,QAAU4B,EAAcrB,CAAC,CACtD,CAAC,EACA,WAAW,UAAYP,GAAM,IAAMA,EAAE,QAAQ,OAAO,EACpD,IAAI,EACJ,MAAOmB,GAAO,QAAQ,MAAM,oCAAqCA,CAAE,CAAC,EACpE,KAAK,IACF7B,EAAO,KAAK,CAAC+B,EAAGX,EAAGpB,IAAWyC,GAAkBzC,EAAOoB,EAAE,CAAC,CAC9D,CACR,CAEA,IAAMmB,GAAiB7B,GAAMA,EAAE,OAAO,aAAa,QAC7C8B,GAAiB9B,GAAMgC,GAAe,UAAOhC,CAAC,EAAE,KAAK,OAAO,GAE5DS,GAAyB,CAACwB,EAAOtC,IAAgB,CACnDA,EAAY,WAAW,EAAI,EAE3BsC,EAAM,KAAK,CAACZ,EAAGX,EAAGuB,IAAU,CACR,UAAOA,EAAMvB,EAAE,EAAE,UAAU,MAAM,EAC5C,MAAM,iBAAkB,MAAM,CACvC,CAAC,CACL,EAEMG,GAAwB,CAACoB,EAAOtC,EAAc,SAAc,CAC1DA,GAAaA,EAAY,WAAW,EAAK,EAE7CsC,EAAM,KAAK,CAACZ,EAAGX,EAAGuB,IAAU,CACR,UAAOA,EAAMvB,EAAE,EAAE,UAAU,MAAM,EAC5C,MAAM,iBAAkB,IAAI,CACrC,CAAC,CACL;EE1RO,SAASwB,GAAeC,EAAW,CACtC,IAAIC,EAAU,KACVC,EAAO,KACPC,EAAO,GACPC,EAAc,GAEZC,EAASC,EAAmBN,EAAW,mBAAoB,IAC7DA,EACK,OAAO,KAAK,EACZ,KAAK,QAAS,iBAAiB,EAC/B,MAAM,UAAWG,EAAO,OAAS,EAAE,EACnC,KAAKI,EAAQ,CACtB,EAEMC,EAAW,IAAM,CACnBH,EACK,MAAM,UAAWF,EAAO,OAAS,EAAE,EACnC,OAAO,cAAc,EACrB,MAAM,iBAAkBC,EAAc,OAAS,IAAI,EACnD,KAAK,UAAKF,GAAM,EAChB,GAAG,QAAS,IAAMD,EAAQ,CAAC,CACpC,EAEA,OAAAO,EAAS,WAAa,IAAIC,IAAS,CAC/B,GAAI,CAACA,EAAK,OACN,OAAOL,EAEXA,EAAcK,EAAK,GAEnB,IAAMC,EAASL,EAAO,OAAO,cAAc,EAC3C,OAAID,EACAM,EAAO,MAAM,iBAAkB,MAAM,EAErCA,EAAO,MAAM,iBAAkB,IAAI,EAGhCF,CACX,EAEAA,EAAS,KAAO,IAAIC,IACXA,EAAK,QAGVN,EAAOM,EAAK,GACLD,GAHIL,EAMfK,EAAS,KAAO,IAAIC,IACXA,EAAK,QAGVP,EAAOO,EAAK,GACLD,GAHIN,EAMfM,EAAS,QAAU,IAAIC,IACdA,EAAK,QAGVR,EAAUQ,EAAK,GACRD,GAHIP,EAMRO,CACX,CCzDO,IAAMG,GAAY,CACrB,KAAM,WACN,OAAQ,aACR,KAAM,UACV,EACaC,GAAaC,GAAMA,EAAE,GAAKA,EAAE,GAC5BC,GAAcD,GAAMA,EAAE,GAAKA,EAAE,GACpCE,GAAa,CAACC,EAAUH,IAAMA,EAAE,QAAUG,EAC1CC,GAAkB,CAACD,EAAUH,IAC/BA,EAAE,QAAU,EACNF,GAAU,KACVI,GAAWC,EAAUH,CAAC,EACtBF,GAAU,KACVA,GAAU,OAEb,SAASO,IAAgB,CAC5B,IAAIC,EAAW,KACXC,EAAgB,KAChBC,EAAO,KACPC,EAAQ,KACRC,EAAa,KACbC,EAAc,KAEZC,EAAkBC,GAAe,CACnCF,EAAcG,GAAeJ,CAAU,EACvCC,EAAY,EAEZ,IAAMR,EAAWK,EAAK,OACjBF,EAAS,eAAcA,EAAS,aAAe,GAC/CA,EAAS,eAAcA,EAAS,aAAe,CAAC,GACrCS,GACZL,EAAW,KAAK,EAAE,sBAAsB,EAAE,MAC1CA,EAAW,KAAK,EAAE,sBAAsB,EAAE,MAC9C,EACQF,CAAI,EAEZ,IAAMQ,EAAQH,EAAW,UAAU,GAAG,EAAE,KAAKL,EAAK,YAAY,CAAC,EACzDS,EAAaD,EAAM,MAAM,EAAE,OAAO,GAAG,EAE3CC,EAAW,OAAO,MAAM,EACxBA,EAAW,OAAO,MAAM,EAGxB,IAAMC,EAAaD,EACd,MAAMD,CAAK,EACX,KAAK,CAACG,EAAGC,IAAMA,EAAE,MAAQD,EAAE,KAAK,EAE/BE,EAAQH,EACT,OAAO,MAAM,EACb,KAAK,QAAUlB,GAAM,YAAYI,GAAgBD,EAAUH,CAAC,GAAG,EAC/D,MAAM,IAAMA,GAAMA,EAAE,EAAE,EACtB,MAAM,IAAMA,GAAMA,EAAE,EAAE,EACtB,MAAM,QAAUA,GAAMD,GAAUC,CAAC,CAAC,EAClC,MAAM,SAAWA,GAAMC,GAAWD,CAAC,CAAC,EAEzCqB,EAAM,MAAM,OAASrB,GACbI,GAAgBD,EAAUH,CAAC,IAAMF,GAAU,KACvCE,EAAE,KAAK,MACAS,EAAMT,EAAE,KAAK,KAAK,EAElBO,EAAc,YAAY,OAG9B,aAEd,EAED,IAAMe,EAASJ,EACV,OAAQlB,GAAMA,EAAE,QAAU,CAAC,EAC3B,OAAO,MAAM,EACb,KAAK,IAAMA,GAAMA,EAAE,GAAKD,GAAUC,CAAC,EAAI,CAAC,EACxC,KAAK,IAAMA,GAAMA,EAAE,GAAKC,GAAWD,CAAC,EAAI,CAAC,EACzC,KAAMA,GAAMA,EAAE,KAAK,EAElBuB,EAAWF,EAAM,OAAQrB,GAAMA,EAAE,WAAW,SAAW,CAAC,EAAE,MAAM,EACtEwB,GAAsBN,EAAYK,CAAQ,EAE1CE,GAAaP,EAAY,EAAG,CAAC,CAAC,EAC9BQ,GAAyBC,GAAmBT,CAAU,CAAC,EACvDU,GAAaV,EAAY,CAAC,EAEtBZ,EAAS,aAAa,SAAW,GACjCA,EAAS,aAAa,KAAKiB,EAAS,UAAU,EAClDF,EACK,OAAQrB,GAAMA,EAAE,QAAQ,EACxB,GAAG,QAAS,CAAC6B,EAAQ7B,IAClB8B,GACI9B,EACAqB,EACAH,EACAI,EACAhB,EACAI,EACAG,EACAU,EACAZ,EACAJ,CACJ,CACJ,EAEJwB,GACIV,EACAH,EACAI,EACAhB,EACAI,EACAG,EACAU,EACAZ,EACAJ,CACJ,CACJ,EAEA,OAAAK,EAAe,SAAW,IAAIoB,IACrBA,EAAK,QAGV1B,EAAW0B,EAAK,GAChBzB,EAAgByB,EAAK,GACdpB,GAJIN,EAOfM,EAAe,KAAO,IAAIoB,IACjBA,EAAK,QAGVxB,EAAOwB,EAAK,GACLpB,GAHIJ,EAMfI,EAAe,MAAQ,IAAIoB,IAClBA,EAAK,QAGVvB,EAAQuB,EAAK,GACNpB,GAHIH,EAMfG,EAAe,UAAY,IAAIoB,IACtBA,EAAK,QAGVtB,EAAasB,EAAK,GACXpB,GAHIF,EAMRE,CACX,CPnJA,SAASqB,GAAQC,EAA0BC,EAAoB,CACtDA,EAAS,WAAUA,EAAS,SAAW,CAAC,GAE7C,IAAMC,EAAOC,GAASF,CAAQ,EACxBG,EAAQC,GACVJ,EACAC,EAAK,IAAKI,GAAMA,EAAE,IAAI,CAC1B,EAEIF,GACA,KAAK,WAAW,UAAU,IAAI,YAAY,EAG9C,IAAMG,EAAcC,GAAqB,EAAE,eAAe,SAAS,EAEnE,GADAR,EAAU,MAAME,CAAI,EAAE,KAAKK,CAAW,EAClCH,EAAO,CACP,IAAMK,EAAeR,EAAS,WAAW,GACzC,GACIA,EAAS,WAAW,KAAMS,GAAMA,EAAE,OAASD,CAAY,GAAG,OAC1D,SACF,CACE,IAAME,EAASC,EAAY,EAAE,SAASX,CAAQ,EAAE,MAAMG,CAAK,EAC3DJ,EAAU,KAAKW,CAAM,CACzB,KAAO,CACH,IAAMA,EAASE,GAAiB,EAAE,MAAMT,CAAK,EAC7CJ,EAAU,KAAKW,CAAM,CACzB,CACJ,CAEA,IAAMG,EAAeP,EAAY,WAAW,EACtCQ,EAAaR,EAAY,SAAS,EACnBA,EAAY,WAAW,EAE/B,KAAK,CAACD,EAAGU,EAAGC,IAAa,UAAOA,EAAMD,EAAE,EAAE,KAAKV,EAAE,KAAK,CAAC,EACpEQ,EACK,MAAMC,CAAU,EAChB,OAAO,KAAK,EACZ,OAAO,WAAW,EAClB,KAAK,SAAU,CAAE,MAAAG,EAAO,KAAAhB,CAAK,EAAmC,CAC7D,IAAMiB,EAAgB,UAAO,IAAI,EAI5BlB,EAAS,SAASiB,KAAQjB,EAAS,SAASiB,GAAS,CAAC,GAE3DE,GAAc,EACT,SAASnB,EAAS,SAASiB,GAAQjB,CAAQ,EAC3C,KAAKC,CAAI,EACT,UACM,UAAU,UAAO,KAAK,UAAU,EAAE,KAAK,EAAE,UAAU,CAC1D,EACC,MAAME,CAAK,EAAEe,CAAU,EAE5BE,GAAQ,EAAE,SAASpB,CAAQ,EAAE,SAAS,EAAI,EACtCkB,EAAW,UAAU,GAAG,CAC5B,CACJ,CAAC,CACT,CAEApB,GAAQ,OAAS,CACb,KAAM,UACN,KAAM,UACN,SAAU,oBACV,UAAW,IACX,YAAa,GACb,eAAgB,GAChB,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,OAAQ,QAAS,SAAS,CACtC,CACJ,EACA,IAAOuB,GAAQvB,GQnEf,IAAMwB,GAAwB,CAC1BC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,GACAC,EACJ,EAEOC,GAAQb,GC9Bf,UAAYc,OAAQ,KACpB,UAAYC,OAAa,kBAGlB,IAAMC,GAAmB,CAC5BC,EACAC,IACC,CACD,GAAI,CAACA,EAAS,YAAa,CACvB,IAAMC,EAAsB,CACxB,OAAQ,CAAC,EACT,SAAU,CAAC,EACX,aAAc,CAAC,EACf,KAAM,CAAC,CACX,EAEMC,EAAWC,GAAcJ,CAAS,EACxCE,EAAO,OAAYC,EAAS,qBAAqB,EACjD,QAASE,EAAI,GAAKA,IAAK,CACnB,IAAMC,EAAM,UAAUD,IAChBE,EAAQJ,EAAS,gBAAgBG,GAAK,EAC5C,GAAI,CAACC,EACD,MAGJL,EAAOI,GAAOC,EACdL,EAAO,OAAO,KAAKK,CAAK,CAC5B,CAEAL,EAAO,QAAUM,GAAoBN,EAAO,MAAM,EAClDA,EAAO,KAAK,cAAgBC,0BAEV,CAAC,OAAQ,WAAY,UAAU,EACvC,QAASM,GAAM,CACrB,IAAMC,EAAWP,EAAS,gBAAgBM,aAAa,EACvDP,EAAO,SAASO,GAAKE,GAAcD,EAAUR,EAAO,OAAO,CAC/D,CAAC,EAEDD,EAAS,YAAcC,CAC3B,CAEA,GAAI,CAACD,EAAS,WAAY,CACtB,IAAMW,EAAM,OAAO,iBAAiBZ,CAAS,EACvCO,EAAQK,EAAI,iBAAiB,OAAO,EACpCC,EAAO,QAAQD,EAAI,iBAAiB,aAAa,IACvDX,EAAS,WAAa,CAAE,MAAAM,EAAO,KAAAM,CAAK,CACxC,CACJ,EAEML,GAAuBD,GACf,SAAMA,CAAK,EAAE,QAGrBO,GAAc,CAACC,EAAOC,IAAY,CACpC,IAAMT,EAAW,SAAM,IAAIQ,GAAO,EAClC,OAAAR,EAAM,QAAUS,EACTT,EAAQ,EACnB,EAEMH,GAAiBJ,GAAc,CACjC,IAAMiB,EAAkB,iBAAiBjB,CAAS,EAClD,OAAQkB,GAAMD,GAAiB,iBAAiBC,CAAC,CACrD,EAEMP,GAAgB,CAACD,EAAUM,IAAY,CACzC,IAAMG,EAAiB,SAAMT,CAAQ,EAAE,GAAG,WAC1C,OAAOS,EACF,IAAI,CAACV,EAAGJ,IAAM,CACXI,EAAE,OAASA,EAAE,OAAO,MAAQ,IAAMJ,GAAKc,EAAO,OAAS,GACvDL,GAAYL,EAAE,MAAOO,CAAO,CAChC,CAAC,EACA,KAAK,CAACI,EAAGC,IAAMD,EAAE,GAAKC,EAAE,EAAE,CACnC,gwVCjEA,UAAYC,OAAQ,KAIpB,IAAMC,GAA0B,CAC5B,QAAS,CACL,KAAM,SACN,MAAO,EACP,MAAO,CAAC,CACZ,EACA,WAAY,QAChB,EAEMC,GAAgB,GAAGC,KAAQC,GAAc,IACzCC,GAAoB,CACtB,cACA,aACA,aACA,cACA,SACA,OACA,OACA,cACA,aACA,YACA,WACA,WACA,gBACJ,EAEA,SAASD,IAAwB,CAC7B,IAAME,EAAe,SAChB,cAAc,MAAM,EACpB,iBAAiB,OAAO,EACvBC,EAAa,CAAC,EACpB,OAAAD,EAAa,QAASE,GAAM,CACpBA,EAAE,UAAU,QAAQ,OAAO,IAAM,IACjCD,EAAW,KAAKC,EAAE,SAAS,CAEnC,CAAC,EACMD,EAAW,KAAK,EAAE,CAC7B,CAEA,eAAeE,GAAiBC,EAAqB,CAGjD,MAF+B,eAAe,IAAI,oBAAoB,EAEzC,eAAeA,CAAW,CAC3D,CAEO,SAASC,MAAYC,EAAwB,CAChD,IAAMC,EAAU,IAAI,IAChBD,EAAa,OAAS,EAChBA,EACAE,GAAO,IAAKC,GAAUA,EAAM,OAAO,IAAI,CACjD,EACAD,GAAO,QAASC,GAAU,CACtB,GAAIF,EAAQ,IAAIE,EAAM,OAAO,IAAI,EAAG,CAChC,IAAMC,EAAOD,EAAM,OAAO,KACrB,YAAY,EACZ,QAAQ,gBAAiB,EAAE,EAC1BL,EAAc,2BAA2BM,IAC/C,eAAe,OACXN,EACA,cAAc,WAAY,CACtB,OACA,UACA,eACA,aACA,WACA,aACA,OAEA,aAAc,CACV,MAAM,EACN,KAAK,OAAS,KACd,KAAK,UAAY,KACjB,KAAK,eAAiB,EAC1B,CAEA,mBAAoB,CACX,KAAK,eACN,KAAK,aAAa,CAAE,KAAM,MAAO,CAAC,EAClC,KAAK,WAAW,UAAY,UAAUR,aACtC,KAAK,WAAW,WAAa,2CAC7B,KAAK,WACD,KAAK,WAAW,cAAc,QAAQ,EAC1C,KAAK,aAAe,GAE5B,CAEA,IAAI,MAAO,CACP,OAAOa,EAAM,OAAO,IACxB,CAEA,IAAI,UAAW,CACX,OAAOA,EAAM,OAAO,QACxB,CAEA,IAAI,aAAc,CACd,OAAOA,EAAM,OAAO,YAAc,QACtC,CAEA,IAAI,oBAAqB,CACrB,OACIA,EAAM,OAAO,SAAS,OACtBd,GAAwB,QAAQ,KAExC,CAEA,IAAI,qBAAsB,CACtB,OACIc,EAAM,OAAO,SAAS,OACtBd,GAAwB,QAAQ,KAExC,CAOA,IAAI,WAAY,CACZ,OAAOc,EAAM,OAAO,WAAa,GACrC,CAEA,IAAI,UAAUE,EAAG,CACbF,EAAM,OAAO,UAAYE,CAC7B,CAEA,IAAI,aAAc,CACd,OAAOF,EAAM,OAAO,aAAe,EACvC,CAEA,IAAI,YAAYE,EAAG,CACfF,EAAM,OAAO,YAAcE,CAC/B,CAEA,yBAAyBC,EAAYC,EAAe,CAChD,OAAOJ,EAAM,0BAA0B,KACnC,KACAG,EACAC,CACJ,CACJ,CAEA,sBAAsBD,EAAYC,EAAe,CAC7C,OAAOJ,EAAM,uBAAuB,KAChC,KACAG,EACAC,CACJ,CACJ,CAEA,MAAM,QAAS,CACX,IAAIC,EAAS,SAAS,cAAc,QAAQ,EACxCC,EACA,KAAK,WAAW,cAAc,YAAY,EAC9CD,EAAO,MAAQC,EAAU,YACzBD,EAAO,OAASC,EAAU,aAE1B,IAAMC,EAAUF,EAAO,WAAW,IAAI,EACtCE,EAAQ,UACJ,OACK,iBAAiB,IAAI,EACrB,iBAAiB,sBAAsB,GAC5C,QACJA,EAAQ,SAAS,EAAG,EAAGF,EAAO,MAAOA,EAAO,MAAM,EAClD,IAAMG,EAAa,OACd,iBAAiB,IAAI,EACrB,iBAAiB,OAAO,EAEvBC,EAAO,MAAM,KACf,KAAK,WAAW,iBACZ,uBACJ,CACJ,EAEA,QAAWC,KAAOD,EAAK,QAAQ,EAAG,CAC9B,IAAIE,EAAM,SAAS,cAAc,KAAK,EAEtC,IAAMC,EAAgB,EACtBD,EAAI,MAAQD,EAAI,cACVA,EAAI,cAAc,YAClBE,EACND,EAAI,OAASD,EAAI,cACXA,EAAI,cAAc,aAClBE,EAIN,IAAMC,EAAUH,EAAI,UAAU,EAAI,EAC7BG,EAAQ,aAAa,SAAS,GAC/BA,EAAQ,aACJ,UACA,OAAOF,EAAI,SAASA,EAAI,QAC5B,EAGJE,EAAQ,aACJ,QACA,4BACJ,EAEA,QAAWC,KAAQD,EAAQ,iBACvB,MACJ,EACIC,EAAK,aAAa,OAAQN,CAAU,EAGxC,IAAIO,EAAM,IAAI,cAAc,EAAE,kBAC1BF,CACJ,EAEAE,EAAMA,EAAI,QAAQ,gBAAiB,EAAE,EAErC,IAAMC,EAAO,IAAI,QAAQ,CAACd,EAAGe,IAAM,CAC/BN,EAAI,OAAST,EACbS,EAAI,QAAUM,CAClB,CAAC,EAED,GAAI,CACAN,EAAI,IAAM,6BAA6B,KACnCI,CACJ,IACA,MAAMC,CACV,MAAE,CACE,IAAMA,EAAO,IAAI,QAAQ,CAACd,EAAGe,IAAM,CAC/BN,EAAI,OAAST,EACbS,EAAI,QAAUM,CAClB,CAAC,EACDN,EAAI,IAAM,2BAA2BI,IACrC,MAAMC,CACV,CAEAT,EAAQ,UACJI,EACCD,EAAI,WAA2B,WAC/BA,EAAI,WAA2B,UAChCC,EAAI,MACJA,EAAI,MACR,CACJ,CAEA,IAAMO,EAAW,MAAM,KACnB,KAAK,WAAW,iBAAiB,QAAQ,CAC7C,EAEA,QAAWb,KAAUa,EAAS,QAAQ,EAClCX,EAAQ,UACJF,EACCA,EAAO,WAA2B,WAClCA,EAAO,WAA2B,UACnCA,EAAO,MAAQ,OAAO,iBACtBA,EAAO,OAAS,OAAO,gBAC3B,EAGJ,OAAO,MAAM,IAAI,QACZH,GAAMG,EAAO,OAAQc,GAASjB,EAAEiB,CAAI,CAAC,EAEtC,WACJ,CACJ,CAEA,MAAM,KAAKC,EAAMC,EAASC,EAAS,CAC/B,GAAI,KAAK,eAAiB,KAAM,CAC5B,KAAK,aAAe,CAACF,EAAMC,EAASC,CAAO,EAC3C,MACJ,CAEA,KAAK,aAAe,OAChB,KAAK,YACL,KAAK,UAAU,SAAW,CACtB,CAAC,IAAU,IAAS,EACpB,CAAC,IAAU,IAAS,CACxB,GAGJ,MAAM,KAAK,OAAOF,EAAMC,EAASC,EAAS,EAAI,CAClD,CAEA,MAAM,OAAOF,EAAMC,EAASC,EAASC,EAAQ,GAAO,CAChD,GAAI,KAAK,eAAiB,KACtB,OAGJ,IAAMC,EAAS,KACV,cACDC,EAAOC,EACLC,EAAc3B,EAAM,OAAO,OAAS,WACtCqB,GAAWC,EACXG,EAAQL,EAAK,kBAAkB,CAC3B,QAAAE,EACA,QAAAD,EACA,YAAAM,CACJ,CAAC,EACMN,EACPI,EAAQL,EAAK,kBAAkB,CAC3B,QAAAC,EACA,YAAAM,CACJ,CAAC,EACML,EACPG,EAAQL,EAAK,kBAAkB,CAC3B,QAAAE,EACA,YAAAK,CACJ,CAAC,EAEDF,EAAQL,EAAK,kBAAkB,CAAE,YAAAO,CAAY,CAAC,EAGlDD,EAAW,MAAM,QAAQ,IAAI,CACzBF,EAAO,KAAK,EACZA,EAAO,SAAS,EAAE,KAAMI,GAAUA,EAAM,OAAO,CAAC,EAChDR,EAAK,kBAAkB,EAAK,EAC5BA,EAAK,OAAO,EAAK,EACjBK,EACAL,EAAK,WAAW,CACpB,CAAC,EACD,GAAI,CACAS,EACAC,EACAC,EACAC,EACAC,EACAC,CACJ,EAAIR,EAEAS,EAAQ,KAAK,MAAMF,CAAW,EAC5BG,EAAO,OAAO,KAAKD,CAAK,EAC1BE,EAAO,CACP,IAAIC,EAAM,CACN,IAAMC,EAAgC,CAAC,EACvC,QAAWtC,MAAQmC,EACfG,EAAItC,IAAQkC,EAAMlC,IAAMqC,GAG5B,OAAOC,CACX,CACJ,EAEA,KAAK,OAASV,EACd,IAAMW,EAAa,KAAK,OAAO,QAQzBC,EAAwB,SAAUC,EAAQ,CAC5C,IAAIvC,EAAO2B,EAAaY,GACxB,OAAKvC,IACDA,EAAO4B,EAAkBW,IAEtBvC,CACX,EAEM,CAAE,QAAAwC,EAAS,SAAAC,EAAU,SAAAC,EAAU,OAAAC,CAAO,EAAIZ,EAC1Ca,EAAYZ,EAAM,OAAO,KAAKA,CAAK,EAAE,KAAO,CAAC,EAC7Ca,EACFJ,EAAS,OAAS,EACZG,EAAU,OACN,CAACE,EAAKC,EAAGC,KAAQ,CACb,IAAMC,GAAMf,EAAK,IAAIc,EAAG,EACxB,GACIC,GAAI,cACJA,GAAI,aAAa,QACbR,EAAS,OAEbK,EAAI,UAAU,KACVA,EAAI,KAAK,MAAM,CACnB,EACAA,EAAI,KAAK,KAAKG,EAAG,MACd,CACH,IAAMC,EACFD,GAAI,aAAa,OACZlD,GAAMA,IAAM,MACjB,EAAE,OACN+C,EAAI,KAAKI,GAAOD,GAChBH,EAAI,KAAOA,EAAI,KAAK,MAChB,EACAI,EAAM,CACV,CACJ,CACA,OAAOJ,CACX,EACA,CAAE,KAAM,CAAC,EAAG,KAAM,CAAC,EAAG,UAAW,CAAC,CAAE,CACxC,EACA,CACI,KAAMF,EAAU,IAAI,CAACG,EAAGC,IACpBd,EAAK,IAAIc,CAAG,CAChB,CACJ,EAEJG,EAAU,CAACF,EAAKG,IACjBX,EAAS,OAEJQ,EADA,CAAE,GAAGA,EAAK,aAAc,CAACG,CAAC,CAAE,EAEhCC,EAASR,EAAS,KAAK,IAAIM,CAAO,EAEpCG,EAAW,CACX,WAAAjB,EACA,YAAaI,EAAS,IAAKc,IAAO,CAC9B,KAAMA,EACN,KAAMjB,EAAsBiB,CAAC,CACjC,EAAE,EACF,WAAYf,EAAQ,IAAKgB,IAAO,CAC5B,KAAMA,EACN,KAAM3B,EAAY2B,EACtB,EAAE,EACF,YAAad,EAAS,IAAKa,IAAO,CAC9B,KAAMA,EACN,KAAMjB,EAAsBiB,CAAC,CACjC,EAAE,EACF,OAAAZ,EACA,KAAMU,EACN,UAAWR,EAAS,UACpB,GAAG,KAAK,OAAO,aACnB,EAEA,KAAK,OAAShD,EAEd,IAAM4D,GAAU,CACZ,IAAK,CAACrB,EAAKsB,EAAMC,MACRxE,GAAkB,SAASuE,CAAI,GAChC,KAAK,YACD,KAAK,WAAW,cACZ,IAAI,MACA,4BACA,CACI,QAAS,GACT,SAAU,EACd,CACJ,CACJ,EAERtB,EAAIsB,GAAQC,GACL,GAEf,EAEMC,EAAW,CACb,CAAC,IAAU,IAAS,EACpB,CAAC,IAAU,IAAS,CACxB,EAEA,KAAK,UAAY,IAAI,MACjB,CACI,SAAAA,EACA,GAAG,KAAK,UACR,GAAGN,CACP,EACAG,EACJ,EAKI,KAAK,UAAU,iBACf,KAAK,UAAU,gBAAgB,QAC3BjB,EAAQ,SAEZ,KAAK,UAAU,gBAAkB,CAAC,GAGtCqB,GAAiB,KAAK,WAAY,KAAK,SAAS,EAE5CzC,IACA,KAAK,WAAW,UAAY,IAGhC,KAAK,MAAM,EAEX,MAAM,IAAI,QAAS0C,GACf,sBAAsBA,CAAO,CACjC,CACJ,CAEA,MAAM,OAAQ,CACN,KAAK,aACL,KAAK,WAAW,UAAY,GAEpC,CAEA,OAAQ,CACJ,GAAI,KAAK,eAAiB,KAAM,CAC5B,IAAMC,EAAkB,UAAO,KAAK,UAAU,EACxCC,EAAa,SAASlE,IAC5B,KAAK,UAAU,KACX,KAAK,WAAW,sBAAsB,EAEtC,KAAK,UAAU,KAAK,OAAS,EAC7B,KAAK,OACDiE,EAAa,KAAK,QAASC,CAAU,EACrC,KAAK,SACT,EAEAD,EAAa,KACT,QACA,GAAGC,YACP,CAER,CACJ,CAOA,MAAM,OAAO/C,EAAM,CACf,GAAI,KAAK,eAAiB,KACtB,GAAI,KAAK,WAAW,OAAS,OACzB,KAAK,MAAM,MACR,CACH,GAAM,CAACA,EAAMC,EAASC,CAAO,EACzB,KAAK,aACT,KAAK,aAAe,OACpB,KAAK,KAAKF,EAAMC,EAASC,CAAO,CACpC,CAER,CAEA,MAAM,QAAQF,EAAMgD,EAAUC,EAAU,CACpC,IAAIZ,EAAW,KAAK,UAChBA,IACA,OAAOA,EAAS,YAChB,OAAOA,EAAS,WACZ,KAAK,cACLO,GACI,KAAK,WACL,KAAK,SACT,EACA,KAAK,OAAO5C,CAAI,GAG5B,CAEA,MAAM,QAAS,CACX,KAAK,WAAW,UAAY,EAChC,CAEA,cAAe,CACX,OAAO,KAAK,UAChB,CAEA,MAAO,CACH,IAAMqC,EAAW,CAAE,GAAG,KAAK,SAAU,EACrC,OAAAnE,GAAkB,QAASG,GAAM,CAC7B,OAAOgE,EAAShE,EACpB,CAAC,EACMgE,CACX,CAEA,QACIA,EACAa,EACF,CACE,IAAMC,EAAkC,CAAC,EACzC,QAAWtE,KAAQX,GACX,KAAK,YAAYW,KAAU,SAC3BsE,EAAatE,GAAQ,KAAK,YAAYA,IAG9C,KAAK,UAAY,CACb,GAAGsE,EACH,GAAGd,EACH,eAAAa,CACJ,CACJ,CACJ,CACJ,EAEA,eACK,YAAY,oBAAoB,EAChC,KAAK,IAAM5E,GAAiBC,CAAW,CAAC,CACjD,CACJ,CAAC,CACL,CAEK,QAAQ,UAAU,UACnB,QAAQ,UAAU,QAAU,QAAQ,UAAU,mBC3kBlD6E,GAAS,MAAM",
  "names": ["s", "el", "fc", "fc", "AXIS_TYPES", "axisType", "settings", "settingName", "settingValue", "excludeType", "getType", "checkTypes", "types", "list", "args", "noAxis_exports", "__export", "domain", "labelFunction", "scale", "d3", "flattenExtent", "array", "withUndefined", "fn", "a", "b", "r", "v", "flattenArray", "rebindAll", "MIN_BANDWIDTH", "minBandwidth_default", "adaptee", "minBandwidth", "arg", "args", "rebindAll", "withoutTicks_default", "adaptee", "withoutTicks", "arg", "scale", "withoutTicks_default", "minBandwidth_default", "domain", "valueNames", "orient", "_domain", "data", "flattenedData", "flattenArray", "transformDomain", "d", "args", "labelFunction", "valueName", "linearAxis_exports", "__export", "component", "domain", "labelFunction", "scale", "tickFormatFunction", "d3", "fc", "d3Array", "defaultPadding", "pad", "padUnit", "padding", "extent", "delta", "args", "extentLinear", "accessors", "d", "symmetricalAbout", "include", "paddingStrategy", "defaultPadding", "instance", "data", "values", "_iteratorNormalCompletion", "_didIteratorError", "_iteratorError", "_iterator", "_step", "accessor", "i", "value", "toConsumableArray", "err", "extent$$1", "halfRange", "args", "arr", "arr2", "d3", "SI_MIN", "getValueFormatterForRange", "min", "max", "precision", "d", "getChartElement", "element", "getChartContainer", "scale", "domain", "base", "extentLinear", "valueNames", "_domain", "data", "v", "d", "getDataExtent", "flattenArray", "getMinimumGap", "gaps", "valueName", "a", "b", "i", "acc", "src", "dataWidth", "args", "labelFunction", "tickFormatFunction", "getValueFormatterForRange", "component", "_settings", "orient", "settingName", "getAxis", "s", "getChartContainer", "shrinkTickLabel", "node", "text", "shrinkTicks", "axis", "axisBox", "nodes", "tickBox", "decorate", "_index", "getComponent", "timeAxis_exports", "__export", "domain", "labelFunction", "scale", "d3", "fc", "scale", "domain", "base", "valueNames", "_domain", "data", "v", "d", "getDataExtent", "flattenArray", "getMinimumGap", "gaps", "valueName", "a", "b", "i", "acc", "src", "dataWidth", "args", "labelFunction", "ordinalAxis_exports", "__export", "component", "domain", "labelFunction", "scale", "d3", "fc", "select", "line", "axisOrdinalTop", "axisOrdinalBottom", "axisOrdinalLeft", "axisOrdinalRight", "dataJoin", "rebindAll", "exclude", "store_default", "names", "data", "store", "target", "key", "name", "args", "multiAxis", "orient", "baseAxis", "scale", "tickSizeOuter", "tickSizeInner", "axisStore", "store_default", "decorate", "args", "groups", "groupDataJoin", "dataJoin", "domainPathDataJoin", "translate", "x", "isVertical", "pathTranspose", "arr", "d", "selection", "data", "index", "group", "element", "container", "select", "sign", "range", "domainPathData", "line", "g", "getAxisSize", "i", "getAxisOffset", "sum", "n", "nodes", "groupElement", "groupScale", "scaleFromGroup", "s", "customScale", "value", "values", "rebindAll", "exclude", "multiAxisTop", "axisOrdinalTop", "multiAxisBottom", "axisOrdinalBottom", "multiAxisLeft", "axisOrdinalLeft", "multiAxisRight", "axisOrdinalRight", "scale", "minBandwidth_default", "domain", "valueNames", "orient", "_domain", "data", "flattenedData", "flattenArray", "transformDomain", "d", "args", "labelFunction", "valueName", "component", "settings", "settingName", "getComponent", "multiLevel", "levelGroups", "axisGroups", "groupTickLayout", "getGroupTickLayout", "tickSizeInner", "l", "tickSizeOuter", "s", "createAxis", "base", "axis", "decorate", "index", "rotation", "applyLabelRotation", "hideOverlappingLabels", "axisSet", "getAxisSet", "multiAxisBottom", "multiAxisLeft", "multiAxisTop", "multiAxisRight", "groups", "tick", "i", "group", "width", "maxLength", "g", "rotated", "getTransformCoords", "transform", "splitOn", "coords", "c", "isOverlap", "r1", "r2", "rectangleContained", "boundsRect", "getXAxisBoundsRect", "previousRectangles", "nodes", "transformCoords", "tickRect", "rect", "hidden", "r", "container", "getChartContainer", "chart", "chartRect", "axisRect", "getLabelTransform", "anchor", "axisTypes", "noAxis_exports", "ordinalAxis_exports", "timeAxis_exports", "linearAxis_exports", "axisFactory", "settings", "excludeType", "orient", "settingName", "settingValue", "valueNames", "modifyDomain", "memoValue", "optionalParams", "optional", "_factory", "data", "useType", "axisType", "axis", "domainFunction", "p", "domain", "component", "createComponent", "defaultComponent", "tickFormatFunction", "v", "args", "nextModifyDomain", "d3", "fc", "chartSvgFactory", "xAxis", "yAxis", "chartFactory", "x", "y", "chartCanvasFactory", "cartesian", "canvas", "axisSplitter", "altAxis", "chart", "args", "oldDecorate", "container", "data", "plotArea", "node", "axis", "svgPlotArea", "canvasPlotArea", "altData", "y2AxisDataJoin", "d", "ySeriesDataJoin", "y2Scale", "yAxisComponent", "event", "width", "height", "drawMultiCanvasSeries", "selection", "yScales", "i", "drawMultiSvgSeries", "nodes", "fc", "select", "getOrCreateElement", "container", "selector", "createCallback", "element", "isElementOverflowing", "containerRect", "innerElementRect", "direction", "isElementOverlapping", "axis", "immovableRect", "elementRect", "fuzz", "dimension", "immovableInnerPoint", "immovableOuterPoint", "elementInnerPoint", "elementOuterPoint", "innerPointInside", "outerPointInside", "pointsEitherSide", "select", "toValue", "type", "value", "getGroupValues", "data", "settings", "cross", "i", "getSplitValues", "splitValues", "split", "getDataValues", "main", "generateHtml", "tooltipDiv", "data", "settings", "tooltipValues", "getGroupValues", "getSplitValues", "getDataValues", "addDataValues", "values", "d", "select", "formatNumber", "value", "mapToFilter", "d", "raiseEvent", "node", "data", "settings", "column_names", "getDataValues", "groupFilters", "getGroupValues", "splitFilters", "getSplitValues", "filter", "selectionEvent", "_event", "selection", "args", "tooltip", "alwaysShow", "tooltipDiv", "settings", "centered", "_tooltip", "selection", "node", "hideTooltip", "container", "select", "getChartContainer", "getTooltipDiv", "showTip", "_event", "data", "generateHtml", "nodes", "i", "showTooltip", "hideTip", "_data", "selectionEvent", "args", "getOrCreateElement", "tooltip_default", "containerNode", "containerRect", "rect", "left", "top", "centerTip", "shiftIfOverflowingChartArea", "tooltipDivRect", "leftAdjust", "newLeft", "topAdjust", "newTop", "isElementOverflowing", "barSeries", "settings", "color", "series", "selection", "tooltip", "d", "minBandwidth", "adaptee", "min", "arg", "args", "d3", "groupFromKey", "key", "getValuesByColumn", "settings", "column", "row", "k", "v", "_", "seriesColors", "settings", "col", "domain", "k", "colorScale", "seriesColorsFromColumn", "column", "data", "getValuesByColumn", "seriesColorsFromDistinct", "seriesColorsFromGroups", "inner", "groupFromKey", "defaultColors", "mapFunction", "d", "withOpacity", "colors", "styles", "defaults", "range", "args", "withoutOpacity", "color", "setOpacity", "opacity", "decoded", "rebindAll", "labelFunctions", "labelFunction", "settings", "base", "axisType", "valueName", "label", "d", "_i", "rebindAll", "args", "splitIntoMultiSeries", "settings", "data", "stack", "excludeEmpty", "useData", "splitByValuesIntoMultiSeries", "multiSeries", "col", "baseValues", "split", "key", "labels", "label", "value", "baseKey", "splitName", "splitValues", "baseValue", "k", "series", "groupData", "settings", "data", "stack", "groupedSeries", "splitIntoMultiSeries", "groupPointDataByMainValue", "a", "b", "groupAndStackData", "seriesDataFn", "labelfn", "labelFunction", "mainValue", "baseValue", "col", "series", "i", "seriesFn", "d3", "d3Legend", "d3Legend", "rebindAll", "cropCellContents", "legendDiv", "legendCells", "legendDivRect", "isElementOverflowing", "svg", "d", "i", "nodes", "cell", "cutoffCharIndex", "getCutoffCharacterIndex", "cellRect", "cutoffCoord", "fuzzyFactor", "d3", "d3", "margin", "enforceContainerBoundaries", "innerNode", "offsetX", "offsetY", "chartNodeRect", "getChartElement", "innerNodeRect", "draggedInnerNodeRect", "adjustedOffsets", "bound", "isElementOverflowing", "adjustment", "resizeForDraggingEvent", "draggableComponent", "pinned", "settings", "draggable", "element", "node", "viewer", "drag", "event", "offsets", "enforceContainerBoundaries", "position", "isNodeInTopRight", "pinNodeToTopRight", "unpinNodeFromTopRight", "args", "nodeRect", "containerRect", "getChartContainer", "fuzz", "margin", "d3", "horizontalHandleClass", "verticalHandleClass", "cornerHandleClass", "handlesContainerId", "fillOpacity", "resizeEvent", "resizableComponent", "handleWidthPx", "zIndex", "settings", "minDimensionsPx", "maxDimensionsPx", "callbacks", "executeCallbacks", "event", "direction", "callback", "resizable", "container", "handlesContainerExists", "dragHelper", "dragLeft", "dragTop", "dragRight", "dragBottom", "containerNode", "containerRect", "handles", "handlesGroup", "isVertical", "d", "xCoordHelper", "yCoordHelper", "edgeHandles", "leftHandle", "topHandle", "rightHandle", "bottomHandle", "edge", "concatCornerEdges", "corner", "cornerCursorHelper", "cornerHandles", "topLeftHandle", "topRightHandle", "bottomRightHandle", "bottomLeftHandle", "enforceMaxDimensions", "pinCorners", "offset", "enforceDistToParallelBarConstraints", "enforceContainerBoundaries", "x", "y", "updateSettings", "resizeAndRelocateHandles", "pointerFallenBehindAbsoluteCoordinates", "dimensions", "handle", "dimension", "axis", "extendHandlesBox", "pinHandleToHandleBoxEdge", "extendPerpendicularHandles", "relativeHandle", "input", "args", "becauseCrossedMinSize", "becauseExitedCoordinateSpace", "dragHandleContainer", "operatorFunction", "anticipatedDimension", "difference", "orientationClass", "_", "nodes", "handleNode", "averageCellHeightPx", "controlsHeightPx", "scrollableLegend_default", "fromLegend", "settings", "legend", "domain", "pageCount", "pageSize", "pageIndex", "decorate", "draggable", "draggableComponent", "resizable", "scrollableLegend", "selection", "resizableComponent", "render", "calculatePageSize", "renderControls", "renderLegend", "cropCellContents", "controls", "getLegendControls", "setPage", "cellFilter", "legendElement", "getLegendElement", "cellContainerSize", "index", "_", "i", "legendContainerRect", "proposedPageSize", "calculatePageCount", "container", "getOrCreateElement", "legend_controls_default", "args", "rebindAll", "scrollColorLegend", "settings", "scrollableLegend_default", "scrollSymbolLegend", "colorLegend", "legendComponent", "symbolLegend", "symbolScale", "colorGroupLegend", "fromScale", "domain", "range", "scrollLegendComponent", "scaleModifier", "scale", "color", "legend", "container", "scrollLegend", "_d", "d", "k", "getChartElement", "options", "parts", "legendSelection", "getOrCreateElement", "selection", "isHidden", "data", "cells", "withoutOpacity", "args", "filterData", "settings", "data", "useData", "col", "clone", "k", "filterDataByGroup", "newData", "hideKeysLen", "splitValsLen", "row", "res", "val", "entries", "key", "_val", "groupFromKey", "fc", "mainGridSvg", "settings", "x", "xTick", "axis_color", "mainGridCanvas", "c", "crossGridSvg", "_", "crossGridCanvas", "gridlines_default", "series", "orient", "canvas", "xScale", "yScale", "context", "seriesMulti", "annotationGridline", "mainGrid", "crossGrid", "_withGridLines", "args", "multi", "xStyle", "yStyle", "gridlines", "fc", "hardLimitZeroPadding", "_defaultPadding", "defaultPadding", "padding", "extent", "pad", "padUnit", "delta", "paddedLowerExtent", "paddedUpperExtent", "_args", "d3", "zoomableChart_default", "chart", "settings", "xScale", "xCopy", "yScale", "yCopy", "bound", "canvas", "onChange", "zoomableChart", "selection", "chartPlotArea", "dateAxis", "zoom", "event", "transform", "applyTransform", "noZoom", "zoomControls", "getZoomControls", "oneYear", "sixMonths", "oneMonth", "dateClick", "endCalculation", "start", "end", "xRange", "k", "x", "y", "yMiddle", "a", "b", "oldDecorate", "sel", "data", "plotArea", "device_pixel_factor", "initialTransform", "args", "zoomableScale", "yDomain", "changeArgs", "yZoomDomain", "container", "getOrCreateElement", "zoom_controls_default", "scale", "barChart", "container", "settings", "data", "groupAndStackData", "filterData", "color", "seriesColors", "legend", "colorLegend", "bars", "barSeries", "series", "index", "xAxis", "axisFactory", "AXIS_TYPES", "hardLimitZeroPadding", "yAxis", "chart", "chartSvgFactory", "gridlines_default", "zoomChart", "zoomableChart_default", "bar_default", "fc", "domainMatchOrigins_default", "domain1", "domain2", "isMatchable", "ratio1", "originRatio", "ratio2", "adjustLowerBound", "domain", "ratio", "fc", "splitterLabels", "settings", "labels", "alt", "color", "_render", "selection", "labelDataJoin", "d", "disabled", "coloured", "withoutOpacity", "event", "v", "redrawChart", "chartElement", "getChartElement", "args", "axisSplitter", "settings", "sourceData", "splitFn", "dataSplitFunction", "color", "data", "altData", "splitMainValues", "altValue", "name", "split", "haveSplit", "m", "key", "splitter", "selection", "labelsInfo", "v", "i", "mainLabels", "altLabels", "labeller", "splitterLabels", "args", "isIncludedFn", "d", "dataBlankFunction", "series", "groupedBlankFunction", "group", "columnChart", "container", "settings", "data", "groupAndStackData", "filterData", "color", "seriesColors", "legend", "colorLegend", "bars", "barSeries", "series", "index", "xAxis", "axisFactory", "AXIS_TYPES", "yAxisFactory", "hardLimitZeroPadding", "blankFunction", "groupedBlankFunction", "dataBlankFunction", "splitter", "axisSplitter", "yAxis1", "plotSeries", "gridlines_default", "chart", "chartSvgFactory", "zoomChart", "zoomableChart_default", "yAxis2", "domainMatchOrigins_default", "column_default", "fc", "fc", "lineSeries", "settings", "color", "series", "estimated_size", "stroke_width", "selection", "d", "withoutOpacity", "splitData", "settings", "data", "labelfn", "labelFunction", "col", "i", "key", "transposeData", "x", "columns", "row", "col", "fc", "findBestFromData", "array", "valueFn", "compareFn", "findBestFromArray", "best", "v", "thisValue", "findBestFromItem", "item", "value", "bestItem", "nearbyTip_default", "base", "tooltip", "xScale", "yScale", "color", "size", "canvas", "data", "xValueName", "yValueName", "altDataWithScale", "scale_factor", "nearbyTip", "selection", "chartPlotArea", "tooltipData", "pointer", "event", "closest", "getClosestDataPoint", "useYScale", "renderTip", "raiseEvent", "tipData", "tips", "d", "withOpacity", "pos", "distFn", "scale", "v", "dist1", "best1", "findBestFromData", "dist2", "best2", "args", "lineChart", "container", "settings", "data", "splitData", "filterData", "color", "seriesColors", "legend", "colorLegend", "series", "lineSeries", "paddingStrategy", "hardLimitZeroPadding", "splitter", "axisSplitter", "transposeData", "xAxis", "axisFactory", "AXIS_TYPES", "yAxisFactory", "yAxis1", "plotSeries", "gridlines_default", "chart", "chartSvgFactory", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "yAxis2", "transposed_data", "line_default", "fc", "seriesCanvasPoint", "d3", "sqrt3", "nabla", "context", "size", "y", "symbols", "symbolsObj", "fromDomain", "domain", "LABEL_PADDING", "LABEL_COSINE", "pointSeriesCanvas", "settings", "symbolKey", "size", "color", "label", "symbols", "scale_factor", "series", "seriesCanvasPoint", "d", "data", "context", "colorValue", "opacity", "type", "x", "value", "toValue", "magnitude", "mag_with_padding", "withoutOpacity", "withOpacity", "symbolTypeFromColumn", "column", "rows", "getValuesByColumn", "fromDomain", "symbolTypeFromGroups", "col", "domain", "key", "group", "groupFromKey", "xySplitData", "settings", "data", "n_cols", "col", "cols", "key", "row", "groupFromKey", "xyLine", "container", "settings", "data", "transposeData", "xySplitData", "filterDataByGroup", "color", "seriesColorsFromGroups", "symbols", "symbolTypeFromGroups", "legend", "colorGroupLegend", "series", "lineSeries", "paddingStrategy", "hardLimitZeroPadding", "xAxisFactory", "axisFactory", "yAxis", "xAxis", "plotSeries", "gridlines_default", "chart", "chartSvgFactory", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "xy_line_default", "fc", "fc", "areaSeries", "_settings", "color", "series", "selection", "d", "splitAndBaseData", "settings", "data", "labelfn", "labelFunction", "col", "i", "baseValues", "key", "labels", "label", "baseValue", "value", "areaChart", "container", "settings", "data", "splitAndBaseData", "filterData", "color", "seriesColors", "legend", "colorLegend", "area_series", "areaSeries", "line_series", "lineSeries", "series", "xAxis", "axisFactory", "AXIS_TYPES", "yAxisFactory", "hardLimitZeroPadding", "splitter", "axisSplitter", "yAxis1", "plotSeries", "gridlines_default", "chart", "chartSvgFactory", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "yAxis2", "area_default", "fc", "fc", "categoryPointSeries", "settings", "seriesKey", "color", "symbols", "series", "opacity", "selection", "d", "withoutOpacity", "withOpacity", "symbolType", "col", "domain", "k", "fromDomain", "yScatter", "container", "settings", "data", "groupData", "filterData", "symbols", "symbolType", "color", "seriesColors", "legend", "symbolLegend", "series", "index", "categoryPointSeries", "paddingStrategy", "hardLimitZeroPadding", "xAxis", "axisFactory", "AXIS_TYPES", "yAxisFactory", "splitter", "axisSplitter", "yAxis1", "plotSeries", "gridlines_default", "chart", "chartSvgFactory", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "yAxis2", "y_scatter_default", "d3", "pointData", "settings", "data", "splitIntoMultiSeries", "seriesToPoints", "labelfn", "labelFunction", "mappedSeries", "col", "i", "v", "d3", "seriesLinearRange", "_settings", "data", "valueName", "customExtent", "getExtent", "seriesColorRange", "settings", "extent", "gradient", "maxVal", "interpolator", "multiInterpolator", "domain", "gradientPairs", "interpolators", "p", "i", "value", "index", "value1", "value2", "d3", "fc", "colorRangeLegend", "scale", "legend", "container", "legendSelection", "getOrCreateElement", "width", "height", "xScale", "domain", "paddedDomain", "min", "max", "expandedDomain", "yScale", "svgBar", "_", "i", "d", "selection", "middle", "tickValues", "valueformatter", "getValueFormatterForRange", "axisLabel", "legendSvg", "legendBar", "barWidth", "args", "gridLayoutMultiChart", "elementsPrefix", "chartContainer", "chartEnter", "chartDiv", "chartTitle", "color", "containerSize", "svg", "padding", "_gridLayoutMultiChart", "container", "outerContainer", "getOrCreateElement", "scrollContainer", "innerRect", "containerHeight", "containerWidth", "minSize", "data", "cols", "rows", "d", "args", "fc", "interpolate_scale", "x1", "y1", "x2", "y2", "m", "b", "container", "node", "shortest_axis", "xyScatterSeries", "settings", "data", "color", "symbols", "_xyScatterSeries", "hasColorBy", "symbolCol", "size", "seriesLinearRange", "label", "scale_factor", "series", "index", "pointSeriesCanvas", "axisDefault", "axisFactory", "hardLimitZeroPadding", "xAxis", "yAxis", "xLabel", "yLabel", "chart", "chartCanvasFactory", "gridlines_default", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "args", "overrideSymbols", "settings", "symbols", "symbolCol", "columnType", "val", "domain", "range", "len", "i", "_", "maybeSymbols", "key", "value", "symbolType", "symbolsObj", "xyScatter", "container", "colorBy", "hasColorBy", "isColoredByString", "x", "color", "legend", "temp", "symbolTypeFromColumn", "data", "pointData", "filterDataByGroup", "seriesColorsFromDistinct", "symbolLegend", "seriesColorsFromColumn", "colorLegend", "seriesColorRange", "colorRangeLegend", "colorScale", "xyGrid", "gridLayoutMultiChart", "xyContainer", "xyEnter", "xyDiv", "xyTitle", "containerSize", "d", "nodes", "xyElement", "xyScatterSeries", "type", "group", "xy_scatter_default", "fc", "heatmapSeries", "_settings", "color", "series", "ctx", "d", "heatmapData", "settings", "data", "labelfn", "labelFunction", "mainType", "axisType", "AXIS_TYPES", "col", "crossValue", "key", "mainValue", "getMainValues", "labels", "heatmapChart", "container", "settings", "data", "heatmapData", "filterData", "color", "seriesColorRange", "series", "heatmapSeries", "legend", "colorRangeLegend", "xAxis", "axisFactory", "AXIS_TYPES", "yAxis", "chart", "chartCanvasFactory", "gridlines_default", "zoomChart", "zoomableChart_default", "toolTip", "nearbyTip_default", "heatmap_default", "seriesCanvasOhlc", "fc", "ohlcData", "settings", "data", "splitIntoMultiSeries", "seriesToOHLC", "labelfn", "labelFunction", "getNextOpen", "i", "mappedSeries", "col", "openValue", "closeValue", "v", "fc", "isUp", "d", "ohlcCandleSeries", "settings", "seriesCanvas", "upColor", "domain", "downColor", "colorScale", "setOpacity", "avgColor", "series", "context", "color", "bollingerAverageSeries", "bollingerAreaSeries", "ohlcCandle", "seriesCanvas", "container", "settings", "srcData", "ohlcData", "filterDataByGroup", "bollinger", "d", "data", "seriesData", "bollingerData", "i", "keys", "k", "upColor", "colorScale", "setOpacity", "legend", "colorLegend", "series", "ohlcCandleSeries", "multi", "index", "paddingStrategy", "hardLimitZeroPadding", "xAxis", "axisFactory", "yAxis", "chart", "chartCanvasFactory", "gridlines_default", "zoomChart", "zoomableChart_default", "zoom", "zoomedData", "toolTip", "nearbyTip_default", "ohlcCandle_default", "ohlc", "ohlcCandle_default", "seriesCanvasOhlc", "ohlc_default", "seriesCanvasCandlestick", "candlestick", "ohlcCandle_default", "seriesCanvasCandlestick", "candlestick_default", "d3", "treeColor", "settings", "data", "color_column", "x", "colors", "d", "getColors", "b", "seriesColorsFromDistinct", "seriesColorRange", "flattenExtent", "nodes", "child", "d3", "treeData", "settings", "sets", "real_aggs", "x", "y", "d", "j", "groups", "getSplitNames", "split", "currentLevel", "group", "i", "element", "e", "is_leaf", "colorValue", "getDataValue", "size", "set", "tree", "root", "chartData", "cross", "toValue", "getExtents", "aggregate", "data", "min", "max", "splits", "key", "splitValue", "arc", "drawArc", "radius", "d", "arcVisible", "select", "labelVisible", "d", "labelTransform", "radius", "x", "y", "cropLabel", "targetWidth", "actualWidth", "labelText", "textSelection", "interpolate", "clickHandler", "data", "g", "parent", "parentTitle", "path", "label", "radius", "split", "settings", "p", "skipTransition", "d", "t", "i", "interpolate", "arcVisible", "drawArc", "labelVisible", "labelTransform", "sunburstSeries", "settings", "split", "data", "color", "radius", "_sunburstSeries", "sunburstElement", "segment", "segmentEnter", "segmentMerge", "path", "d", "arcVisible", "drawArc", "label", "labelVisible", "labelTransform", "cropLabel", "parentTitle", "parent", "onClick", "clickHandler", "currentLevel", "args", "sunburst", "container", "settings", "data", "treeData", "color", "treeColor", "sunburstGrid", "gridLayoutMultiChart", "color_column", "x", "legend", "colorLegend", "colorRangeLegend", "sunburstContainer", "sunburstEnter", "sunburstDiv", "sunburstTitle", "containerSize", "d", "i", "nodes", "split", "sunburstElement", "svgNode", "width", "height", "radius", "sunburstSeries", "tooltip", "sunburst_default", "d3", "treeColor", "settings", "data", "color_column", "colors", "x", "getColors", "b", "seriesColorsFromDistinct", "min", "max", "seriesColorRange", "nodes", "child", "select", "minTextSize", "labelMapExists", "d", "toggleLabels", "nodes", "treemapLevel", "crossValues", "i", "help", "textLevelHelper", "visibleNodes", "selectVisibleNodes", "centerLabels", "preventTextCollisions", "restoreLabels", "select", "rect", "element", "topNodes", "_", "textVisibility", "lowerNode", "topNode", "isElementOverlapping", "lockTextOpacity", "textOpacity", "unlockTextOpacity", "adjustLabelsThatOverflow", "shrinkOrHideText", "centerText", "nodeSelect", "textRect", "rectRect", "needsToShrinkOrHide", "resize_factor", "fontSize", "newFontSize", "x", "d3", "treemapLayout_default", "width", "height", "treemapLayout", "d", "d3", "hierarchy", "select", "includesAllCrossValues", "d", "crossValues", "val", "calculateSubTreeMap", "nodesMerge", "treemapLevel", "rootNode", "treemapDiv", "approximateAttributesForAllNodes", "recalculateVisibleSubTreeCoordinates", "calculateTextOpacities", "calculateRootLevelMap", "calcWidth", "calcHeight", "saveLabelMap", "nodes", "i", "label", "select", "oldDimensions", "newDimensions", "dimensionMultiplier", "x0", "y0", "width", "height", "visible", "subTreeRoot", "treeRootWidth", "treeRootHeight", "dummiedDescendants", "treemapLayout_default", "hierarchy", "descendants", "_", "text", "textVis", "textOpacity", "returnToLevel", "rects", "nodesMerge", "labels", "settings", "treemapDiv", "treemapSvg", "rootNode", "parentCtrls", "root_settings", "crossValues", "executeTransition", "cv", "d", "calculateSubTreeMap", "changeLevel", "treemapLevel", "duration", "recordLabelMap", "parent", "t", "labelMapExists", "preventUserInteraction", "i", "calcWidth", "calcHeight", "enableUserInteraction", "preventTextCollisions", "visibleLabelNodes", "adjustLabelsThatOverflow", "fadeTextTransition", "saveLabelMap", "ex", "restoreLabels", "_", "lockTextOpacity", "toggleLabels", "selectVisibleNodes", "viewer", "raiseEvent", "label", "interpolation", "lockedOpacity", "targetOpacity", "unlockTextOpacity", "textOpacity", "nodes", "parentControls", "container", "onClick", "text", "hide", "deactivated", "parent", "getOrCreateElement", "parent_controls_default", "controls", "args", "button", "nodeLevel", "calcWidth", "d", "calcHeight", "isLeafNode", "maxDepth", "nodeLevelHelper", "treemapSeries", "settings", "root_settings", "data", "color", "treemapDiv", "parentCtrls", "_treemapSeries", "treemapSvg", "parentControls", "treemapLayout_default", "nodes", "nodesEnter", "nodesMerge", "a", "b", "rects", "labels", "rootNode", "calculateRootLevelMap", "toggleLabels", "adjustLabelsThatOverflow", "selectVisibleNodes", "saveLabelMap", "_event", "changeLevel", "returnToLevel", "args", "treemap", "container", "settings", "data", "treeData", "color", "treeColor", "d", "treemapGrid", "gridLayoutMultiChart", "color_column", "x", "legend", "colorLegend", "colorRangeLegend", "treemapEnter", "treemapDiv", "i", "nodes", "split", "treemapSvg", "treemapSeries", "tooltip", "treemap_default", "chartClasses", "bar_default", "column_default", "line_default", "xy_line_default", "area_default", "y_scatter_default", "xy_scatter_default", "ohlc_default", "candlestick_default", "treemap_default", "sunburst_default", "heatmap_default", "charts_default", "d3", "gparser", "initialiseStyles", "container", "settings", "styles", "computed", "computedStyle", "i", "key", "color", "getOpacityFromColor", "g", "gradient", "parseGradient", "css", "font", "stepAsColor", "value", "opacity", "containerStyles", "d", "parsed", "a", "b", "d3", "DEFAULT_PLUGIN_SETTINGS", "styleWithD3FC", "perspective_viewer_d3fc_default", "getD3FCStyles", "EXCLUDED_SETTINGS", "headerStyles", "d3fcStyles", "s", "register_element", "plugin_name", "register", "plugin_names", "plugins", "charts_default", "chart", "name", "x", "type", "group", "canvas", "container", "context", "text_color", "svgs", "svg", "img", "defaultOffset", "new_svg", "text", "xml", "done", "y", "canvases", "blob", "view", "end_col", "end_row", "clear", "viewer", "jsonp", "metadata", "leaves_only", "table", "real_config", "table_schema", "expression_schema", "view_schema", "json_string", "config", "json2", "keys", "json", "ridx", "obj", "realValues", "get_pivot_column_type", "column", "columns", "group_by", "split_by", "filter", "first_col", "filtered", "acc", "_", "idx", "col", "len", "dataMap", "i", "mapped", "settings", "r", "a", "handler", "prop", "value", "axisMemo", "initialiseStyles", "resolve", "containerDiv", "chartClass", "_end_col", "_end_row", "columns_config", "new_settings", "register"]
}
