var T=new WeakMap,et=!0,ft=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,lt=ft?5e6:1e7;var Y=0,I=0,at=performance.now();function _t(){let c=performance.now(),t=c-at,e=Y,i=I*1e3/t,s=1e3/e,o=I;return Y=0,I=0,at=c,{avg:e,real_fps:i,virtual_fps:s,num_frames:o,elapsed:t}}function rt(c){Y=(Y*I+c)/(I+1),I+=1}var j=(c,...t)=>c.map((e,i)=>[e,t[i]]).flat().filter(e=>!!e).join(""),mt=()=>{let c,t=new Promise(e=>{c=e});return t.resolve=c,t},D=new Map;async function nt(c){return await new Promise(requestAnimationFrame),await D.get(c)}async function q(c,t){if(D.has(c)&&(await D.get(c),D.has(c))){await D.get(c);return}D.set(c,mt());try{return await t()}finally{let e=D.get(c);D.delete(c),e.resolve()}}var ht=":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}";var ct=":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}";var U=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});let t="<slot></slot>";this.shadowRoot.innerHTML=j`
            <style>
                ${ht}
            </style>
            <style>
                ${ct}
            </style>
            <div class="rt-virtual-panel"></div>
            <div class="rt-scroll-table-clip">
                ${t}
            </div>
        `;let[,e,i,s]=this.shadowRoot.children;this._sub_cell_style=e,this._table_clip=s,this._virtual_panel=i,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(t,e){let{start_row:i,end_row:s}=this._calculate_row_range(t),{start_col:o,end_col:l}=this._calculate_column_range(e);return this._nrows=t,{start_col:o,end_col:l,start_row:i,end_row:s}}_calculate_row_range(t){let{height:e}=this._container_size,i=this._column_sizes.row_height||19,s=this._view_cache.config.column_pivots.length,o=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),l=Math.max(Math.ceil(this.scrollTop),0)/o,_=e/i-s,f=Math.max(0,Math.ceil((t||0)-_))*l,n=Math.max(0,Math.min(f+_,t));return{start_row:f,end_row:n}}_calc_start_column(){let t=this._view_cache.config.row_pivots.length,e=0,i=0,s=0;for(;i<this.scrollLeft;){let o=this._column_sizes.indices[e+t];s=this.scrollLeft-i,e+=1,i+=o!==void 0?o:60}return e+=s/(this._column_sizes.indices[e+t-1]||60),Math.max(0,e-1)}_calculate_column_range(t){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let e=this._calc_start_column(),i=this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)),s=e+i+1;return{start_col:e,end_col:s}}}_max_scroll_column(t){let e=0;if(this._view_cache.config.row_pivots.length>0)for(let o of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))e+=o;let i=this._view_cache.config.row_pivots.length,s=t;for(;e<this._container_size.width&&s>=0;)s--,e+=this._column_sizes.indices[s+i]||60;return Math.min(t-1,s+1)}_validate_viewport({start_col:t,end_col:e,start_row:i,end_row:s}){i=Math.floor(i),s=Math.ceil(s),t=Math.floor(t),e=Math.ceil(e);let o=this._start_col!==t,l=this._start_row!==i||this._end_row!==s||this._end_col!==e;return this._start_col=t,this._end_col=e,this._start_row=i,this._end_row=s,{invalid_column:o,invalid_row:l}}_calc_scrollable_column_width(t){let e=this._view_cache.config.row_pivots.length,i=this._max_scroll_column(t),s=e,o=0;for(;s<i+e;)o+=this._column_sizes.indices[s]||60,s++;return o}_update_virtual_panel_width(t,e){if(t)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((i,s)=>i+s,0)+"px";else{let i=this._calc_scrollable_column_width(e);if(i!==0){let s=this._container_size.width+i+2;this._virtual_panel.style.width=s+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(t){let{row_height:e=19}=this._column_sizes,i=this._view_cache.config.column_pivots.length*e,s;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")s=t*e+i;else{let o=this.clientHeight/(this._table_clip.offsetHeight-i);s=Math.min(lt,t*e*o)}this._virtual_panel.style.height=`${s}px`}async draw(t={}){return typeof t.throttle<"u"&&!t.throttle?await dt.call(this,t):await q(this,()=>dt.call(this,t))}async _draw_flush(){await nt(this)}update_sub_cell_offset(t){let e=this._column_sizes.row_height*(t.start_row%1)||0,i=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(t.start_col)]*(t.start_col%1)||0,s=this._sub_cell_style.sheet?.cssRules[0].style;s&&(s.setProperty("--regular-table--clip-x",`${i}px`),s.setProperty("--regular-table--clip-y",`${e}px`),s.setProperty("--regular-table--transform-x",`-${i}px`),s.setProperty("--regular-table--transform-y",`-${e}px`))}};async function dt(c){let t=et&&performance.now(),{invalid_viewport:e=!0,preserve_width:i=!1}=c,{num_columns:s,num_rows:o,row_height:l}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(o),i||this._update_virtual_panel_width(e,s);let _=this._calculate_viewport(o,s),{invalid_row:a,invalid_column:d}=this._validate_viewport(_);if(this._invalid_schema||a||d||e){let f=[],n=!0;for await(let r of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,i,_,s)){r!==void 0&&(f=f.concat(r)),n&&(this.update_sub_cell_offset(_),n=!1),this._is_styling=!0;let w=this._style_callbacks;for(let b of w)await b({detail:this});if(this._is_styling=!1,!this._invalidated&&r!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(f,l),this.table_model.header.reset_header_cache(),i||this._update_virtual_panel_width(this._invalid_schema||d,s),this._invalid_schema=!1}else this.update_sub_cell_offset(_);et&&rt(performance.now()-t)}var gt=!1,K=class extends U{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}async _on_scroll(t){t.stopPropagation(),await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this)),gt&&(this.addEventListener("touchmove",this._on_touchmove.bind(this)),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!0}))}_on_mousewheel(t){if(!window.safari)return;let{clientWidth:e,clientHeight:i,scrollTop:s,scrollLeft:o}=this;t.preventDefault(),t.returnValue=!1;let l=Math.max(1,this._virtual_panel.offsetHeight-i),_=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.max(0,Math.min(l,s+t.deltaY)),this.scrollLeft=Math.max(0,Math.min(_,o+t.deltaX)),this._on_scroll(t)}_on_touchmove(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1;let{clientWidth:e,clientHeight:i}=this,s=Math.max(1,this._virtual_panel.offsetHeight-i),o=Math.max(1,this._virtual_panel.offsetWidth-e);this.scrollTop=Math.min(s,this._memo_scroll_top+(this._memo_touch_startY-t.touches[0].pageY)),this.scrollLeft=Math.min(o,this._memo_scroll_left+(this._memo_touch_startX-t.touches[0].pageX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].pageY,this._memo_touch_startX=t.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(t){let e=t.target;for(;e.tagName!=="TD"&&e.tagName!=="TH";)if(e=e.parentElement,!this.contains(e))return;let i=t.target.classList.contains("rt-column-resize"),s=T.get(e);if(i){t.stopImmediatePropagation(),e.style.minWidth="",e.style.maxWidth="",t.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[s.size_key]=void 0,this._column_sizes.auto[s.size_key]=void 0,this._column_sizes.indices[s.size_key]=void 0);for(let o of t.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let l of t.shiftKey?o:[o[s._virtual_x]])l&&(l.style.minWidth="",l.style.maxWidth="",l.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(t){if(t.button!==0)return;let e=t.target;for(;e.tagName!=="TD"&&e.tagName!=="TH";)if(e=e.parentElement,!this.contains(e))return;let i=t.target.classList.contains("rt-column-resize"),s=T.get(e);i&&(this._on_resize_column(t,e,s),t.stopImmediatePropagation())}async _on_click_or_dblclick(t){let e=performance.now();this._last_clicked_time&&e-this._last_clicked_time<500?(this._last_clicked_time=e,await this._on_dblclick(t)):(this._last_clicked_time=e,await this._on_click(t))}_on_resize_column(t,e,i){let{_virtual_x:s,size_key:o}=i,l=t.pageX,_=s+e.colSpan-1,a=this.table_model.header.get_column_header(_),d=this._column_sizes.indices[o],f=r=>q(this,async()=>await this._on_resize_column_move(r,a,l,d,o,_)),n=()=>{document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",n);let r=this._column_sizes.override[o],w=this._column_sizes.indices[o]!==r;this._column_sizes.indices[o]=r,w&&this.draw()};document.addEventListener("mousemove",f),document.addEventListener("mouseup",n)}async _on_resize_column_move(t,e,i,s,o,l){await new Promise(requestAnimationFrame);let _=t.pageX-i,a=Math.max(1,s+_);if(this._column_sizes.override[o]=a,_<0)await this.draw({preserve_width:!0,throttle:!1});else{e.style.minWidth=a+"px",e.style.maxWidth=a+"px";let d=this._column_sizes.auto[o];for(let f of this.table_model.body.cells){let n=f[l];n&&(n.style.maxWidth=n.style.minWidth=a+"px",n.classList.toggle("rt-cell-clip",d>a))}}}};var it=class{constructor(t){this._name=t,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}},O=class{constructor(t,e,i){this._column_sizes=t,this._container=e,this._span_factory=new it("span"),this.table=i,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(t,e){T.set(t,e)}_get_or_create_metadata(t){if(t===void 0)return{};if(T.has(t))return T.get(t);{let e={};return T.set(t,e),e}}_replace_cell(t,e){let{tr:i,row_container:s}=this._get_row(t),o=s[e];return o&&(i.removeChild(o),s.splice(e,1,void 0)),o}_fetch_cell(t,e){if(!(t<0||e<0))return this.cells[t]?.[e]}_get_row(t){let e=this.rows[t];e||(e=this.rows[t]=document.createElement("tr"),this.table.appendChild(e));let i=this.cells[t];return i||(i=this.cells[t]=[]),{tr:e,row_container:i}}_get_cell(t="TD",e,i){let{tr:s,row_container:o}=this._get_row(e),l=o[i];if(l||(i<o.length?(l=o[i]=document.createElement(t),s.insertBefore(l,o.slice(i+1).find(_=>_))):(l=o[i]=document.createElement(t),s.appendChild(l))),l.tagName!==t){let _=document.createElement(t);s.replaceChild(_,l),this.cells[e].splice(i,1,_),l=_}return l}_clean_columns(t){for(let e=0;e<this.rows.length;e++){let i=this.rows[e],s=this.cells[e];this.cells[e]=s.slice(0,t[e]||t);let o=this.cells[e].filter(l=>l!==void 0).length;for(;i.children[o];)i.removeChild(i.children[o])}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}};var J=class extends O{constructor(...t){super(...t),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(t,e,i){let s=this._get_cell("TH",e,t[e]||0);if(t[e]+=1,s.removeAttribute("colspan"),s.style.minWidth="0",s.textContent="",i instanceof HTMLElement)s.appendChild(i);else{let l=this._span_factory.get("span");l.textContent=i,s.appendChild(l)}let o=this._span_factory.get("span");return o.className="rt-column-resize",s.appendChild(o),s}_draw_group(t,e,i){let s=this._get_or_create_metadata(i);return s.column_header=t,s.value=e,s.value=e,s}_draw_th(t,e,i,s,o){let l=this._get_or_create_metadata(i);if(l.column_header=t,l.value=e,l.size_key=o.length?o[0]:o,!(o.length>1)){let _=this._column_sizes.override[l.size_key],a=this._column_sizes.auto[l.size_key];_?(i.classList.toggle("rt-cell-clip",a>_),i.style.minWidth=_+"px",i.style.maxWidth=_+"px"):a?(i.classList.remove("rt-cell-clip"),i.style.maxWidth="",i.style.minWidth=a+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return l}get_column_header(t){return this._get_cell("TH",this.num_rows()-1,t)}draw(t,e,i,s,o,l,_,a,d){let f=e?.length;if(f===0)return;let n,r,w,b;a=typeof a>"u"?f-1:a;for(let u=0;u<f;u++){if(w=e[u]?e[u]:"",this._offset_cache[u]=this._offset_cache[u]||0,u<a)d&&this._group_header_cache?.[u]?.[0]?.value===w?(n=this._group_header_cache[u][1],this._group_header_cache[u][2]+=1,i===1&&(this._group_header_cache[u][0].row_header_x=o),n.setAttribute("colspan",this._group_header_cache[u][2])):(n=this._draw_group_th(this._offset_cache,u,w),r=this._draw_group(e,w,n),this._group_header_cache[u]=[r,n,1]);else{n=this._draw_group_th(this._offset_cache,u,w),r=this._draw_th(t||e,w,n,s,o),typeof b>"u"&&(b={th:n,metadata:r});for(let[A]of this._group_header_cache)A.size_key=r.size_key;n.removeAttribute("colspan")}this._get_row(u).tr.classList.toggle("rt-autosize",u===a),n.classList.toggle("rt-group-corner",s===void 0),r&&(r.x=typeof s>"u"?s:Math.floor(s),r.column_header_y=u,r.x0=Math.floor(l),r._virtual_x=_,i===1&&(r.row_header_x=o))}return this._clean_rows(this._offset_cache.length),b=b||{th:n,metadata:r},b}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}};var Q=class extends O{_draw_td(t,e,i,s,{column_name:o},{ridx_offset:l},_){let a=this._get_cell(t,e,s),d=this._get_or_create_metadata(a);d.y=e+Math.floor(l),d.size_key=_,t==="TD"&&(d.column_header=o);let f=this._column_sizes.override[d.size_key];if(f){let n=this._column_sizes.auto[d.size_key];a.classList.toggle("rt-cell-clip",n>f),a.style.minWidth=f+"px",a.style.maxWidth=f+"px"}else a.classList.remove("rt-cell-clip"),a.style.minWidth="",a.style.maxWidth="";return d.value!==i&&(i instanceof HTMLElement?(a.textContent="",a.appendChild(i)):a.textContent=i),d.value=i,{td:a,metadata:d}}draw(t,e,i,s=!1,o,l,_,a){let{cidx:d,column_data:f,row_headers:n,column_data_listener_metadata:r}=e,{row_height:w}=i,b,u=[],A=[],m=0,E=[];for(let g=0;g<(s?i.row_headers_length:1);g++){m=0;for(let x of f){let Z=n?.[m],h;if(s){let S=x[g],p=this._fetch_cell(m-(u[g]||1),d+g),z=this._get_or_create_metadata(p),y=this._fetch_cell(m,d+g-(E[m]||1)),C=this._get_or_create_metadata(y);a&&y&&(C.value===S||S===void 0)&&!y.hasAttribute("rowspan")?(E[m]=E[m]?E[m]+1:2,y.setAttribute("colspan",E[m]),this._replace_cell(m,d+g)):a&&p&&z.value===S&&!p.hasAttribute("colspan")?(u[g]=u[g]?u[g]+1:2,p.setAttribute("rowspan",u[g]),this._replace_cell(m,d+g)):(h=this._draw_td("TH",m,S,d+g,e,i,g),h.td.style.display="",h.td.removeAttribute("rowspan"),h.td.removeAttribute("colspan"),h.metadata.row_header=x,h.metadata.row_header_x=g,h.metadata.y0=Math.floor(i.ridx_offset),h.metadata.y1=Math.ceil(i.y1),h.metadata._virtual_x=g,typeof l<"u"&&(h.metadata.x0=Math.floor(l)),u[g]=1,E[m]=1,A[g]=h)}else h=this._draw_td("TD",m,x,d,e,i,_),r&&(h.metadata.user=r[m]),h.metadata.x=typeof o>"u"?o:Math.floor(o),h.metadata.x1=Math.ceil(i.x1),h.metadata.row_header=Z||[],h.metadata.y0=Math.floor(i.ridx_offset),h.metadata.y1=Math.ceil(i.y1),h.metadata.dx=Math.floor(o-l),h.metadata.dy=h.metadata.y-Math.floor(h.metadata.y0),h.metadata._virtual_x=d,typeof l<"u"&&(h.metadata.x0=Math.floor(l)),A[0]=h;if(m++,b=h?h.metadata:b,w=w||h?.td.offsetHeight,m*w>t)break}}return this._clean_rows(m),{tds:A,ridx:m,metadata:b,row_height:w}}clean({ridx:t,cidx:e}){this._clean_rows(t),this._clean_columns(e)}};var V=class{constructor(t,e,i){this.clear(i);let[s]=i.children,[o,l]=s.children;this.table=s,this._column_sizes=e,this.header=new J(e,t,o),this.body=new Q(e,t,l),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(t){t.innerHTML=j`
            <table cellspacing="0">
                <thead></thead>
                <tbody></tbody>
            </table>
        `}autosize_cells(t,e){for(;t.length>0;){let[i,s]=t.pop(),o=i.getBoundingClientRect();this._column_sizes.row_height=e||Math.max(10,Math.min(this._column_sizes.row_height||o.height,o.height)),this._column_sizes.indices[s.size_key]=o.width;let l=this._column_sizes.override[s.size_key]!==void 0;o.width&&!l&&(this._column_sizes.auto[s.size_key]=o.width),i.style.minWidth==="0px"&&(i.style.minWidth=`${o.width}px`)}}async*draw(t,e,i,s,o,l){let{width:_,height:a}=t,{view:d,config:f}=e,{data:n,row_headers:r,column_headers:w,metadata:b,column_header_merge_depth:u,merge_headers:A="both"}=await d(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row)),m=A==="both"||A==="row",E=A==="both"||A==="column",{start_row:g=0,start_col:x=0,end_col:Z=0,end_row:h=0}=o;r&&(this._row_headers_length=r.reduce((v,$)=>Math.max(v,$.length),0),r=r.map(v=>(v.length=this._row_headers_length,v))),e.config.column_pivots=Array.from(Array(w?.[0]?.length||0).keys()),e.config.row_pivots=Array.from(Array(r?.[0]?.length||0).keys());let S=this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(o.start_col)]||0,p={viewport_width:0,selected_id:i,ridx_offset:g,sub_cell_offset:S,x0:x,x1:Z,y1:h,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},z,y=0,C=[],F=!0;if(r?.length>0){let v=f.row_pivots.join(","),$={column_name:v,cidx:0,column_data:r,row_headers:r,first_col:F},N=y+Math.floor(x);z=this.body.draw(a,$,{...p,x0:0},!0,void 0,void 0,N,m);let X=[];for(let M=0;M<e.config.row_pivots.length;M++){let W=this.header.draw(v,Array(e.config.column_pivots.length).fill(""),1,void 0,M,x,M,u,E);W&&X.push(W)}if(F=!1,p.viewport_width+=X.reduce((M,{th:W},R)=>M+(this._column_sizes.indices[R]||W.offsetWidth),0),p.row_height=p.row_height||z.row_height,y=r[0].length,!s)for(let M=0;M<e.config.row_pivots.length;M++){let{td:W,metadata:R}=z.tds[M]||{},{th:B,metadata:G}=X[M]||{};(W||B)&&C.push([B||W,G||R])}}try{let v=0,$=l-o.start_col;for(;v<$;){if(!n[v]){let H=Math.max(o.end_col,0);o.start_col=H;let P=0,tt=0;for(;this._column_sizes.indices.length>y+x+P+1&&tt+p.viewport_width<_;)P++,tt+=this._column_sizes.indices[y+x+P];if(tt+p.viewport_width<_){let k=Math.min(l,H+5);o.end_col=Math.max(1,Math.min(l,k))}else o.end_col=Math.max(1,Math.min(l,H+P));let ut=d(Math.floor(o.start_col),Math.floor(o.start_row),Math.ceil(o.end_col),Math.ceil(o.end_row));yield void 0;let L=await ut;if(typeof L.column_header_merge_depth<"u"&&(u=L.column_header_merge_depth),typeof L.merge_headers<"u"&&(A=L.merge_headers),L.data.length===0){yield C;return}o.end_col=o.start_col+L.data.length;for(let k=0;k<L.data.length;k++)n[v+k]=L.data[k],L.metadata&&(b[v+k]=L.metadata[k]),w&&(w[v+k]=L.column_headers?.[k])}let N=w?.[v]||"",X=n[v],M=b?.[v],W={column_name:N,cidx:y,column_data:X,column_data_listener_metadata:M,row_headers:r,first_col:F},R=v+x,B=y+Math.floor(x),G=this.header.draw(void 0,N,void 0,R,B,x,y,u,E);if(z=this.body.draw(a,W,p,!1,R,x,B,m),F=!1,!s)for(let{td:H,metadata:P}of z.tds)C.push([G?.th||H,G?.metadata||P]);let ot=this._column_sizes.indices[y+Math.floor(x)];if(ot?p.viewport_width+=ot:p.viewport_width+=G?.th?.offsetWidth||z.tds.reduce((H,P)=>H+P.td?.offsetWidth,0),p.row_height=p.row_height||z.row_height,y++,v++,p.viewport_width-p.sub_cell_offset>_){this.body.clean({ridx:z?.ridx||0,cidx:y}),this.header.clean(),yield C,p.viewport_width=0;for(let[H]of C)p.viewport_width+=H.offsetWidth;if(p.viewport_width-p.sub_cell_offset>_)return}}this.body.clean({ridx:z?.ridx||0,cidx:y}),this.header.clean(),yield C}finally{this.body.clean({ridx:z?.ridx||0,cidx:y}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}};var vt=["both","horizontal","vertical","none"],st=class extends K{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new V(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let t=0;t<this.table_model.header.num_columns();t++){let e=this.table_model.header.get_column_header(t);e.style.minWidth="",e.style.maxWidth=""}}clear(){this.table_model=new V(this._table_clip,this._column_sizes,this)}addStyleListener(t){this._style_callbacks=this._style_callbacks.concat(t);let e=!0;return()=>{if(!e)return;e=!1;let s=this._style_callbacks=this._style_callbacks.slice(),o=s.indexOf(t);s.splice(o,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(t){if(!(typeof t>"u")){if(t instanceof HTMLElement)return T.get(t);if(t.row_header_x>=0){if(t.row_header_x<this._view_cache.config.row_pivots.length){let e=this.table_model.body._fetch_cell(t.y,t.row_header_x);return this.getMeta(e)}}else if(t.column_header_y>=0){if(t.column_header_y<this._view_cache.config.column_pivots.length){let e=this.table_model.body._fetch_cell(t.column_header_y,t.y);return this.getMeta(e)}}else return this.getMeta(this.table_model.body._fetch_cell(t.dy,t.dx+this.table_model._row_headers_length))}}getDrawFPS(){return _t()}async scrollToCell(t,e){if(!this._view_cache){console.warn("data listener not configured");return}let i=this._column_sizes.row_height||19,s=this._view_cache.config.column_pivots.length*i,l=(this._table_clip.offsetHeight-s)%i,_=(this._virtual_panel.offsetHeight-l)/this._nrows;this.scrollTop=Math.ceil(_*e);let a=0;for(;t>0;)t--,a+=this._column_sizes.indices[t+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(a),await new Promise(requestAnimationFrame),await this._draw_flush()}setDataListener(t,{virtual_mode:e="both"}={}){let i={},s={row_pivots:[],column_pivots:[]};console.assert(vt.indexOf(e)>-1,`Unknown virtual_mode ${e};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=e,this._invalid_schema=!0,this._view_cache={view:t,config:s,schema:i},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",st);
//# sourceMappingURL=regular-table.js.map
