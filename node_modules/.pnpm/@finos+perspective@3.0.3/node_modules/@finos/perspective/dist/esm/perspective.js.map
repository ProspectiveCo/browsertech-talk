{
  "version": 3,
  "sources": ["../../src/ts/browser.ts", "../../src/ts/perspective.ts"],
  "sourcesContent": ["// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\n// @ts-ignore\nimport perspective_wasm from \"../../dist/pkg/web/perspective-server.wasm\";\n\n// @ts-ignore\nimport perspective_wasm_worker from \"../../src/ts/perspective-server.worker.js\";\n\nimport type * as psp from \"../../dist/pkg/perspective-js.d.ts\";\n\nfunction invert_promise<T>(): [(t: T) => void, Promise<T>] {\n    let sender;\n    let receiver: Promise<T> = new Promise((x) => {\n        sender = x;\n    });\n\n    return [sender as unknown as (t: T) => void, receiver];\n}\n\nasync function _init(ws: Worker, wasm: ArrayBuffer) {\n    const [sender, receiver] = invert_promise();\n    ws.addEventListener(\"message\", function listener(resp) {\n        ws.removeEventListener(\"message\", listener);\n        sender(null);\n    });\n\n    ws.postMessage({ cmd: \"init\", args: [wasm] }, { transfer: [wasm] });\n    await receiver;\n}\n\n/**\n * Create a new client connected exclusively to a new Web Worker instance of\n * the Perspective engine.\n * @param module\n * @returns\n */\nexport async function worker(module: Promise<typeof psp>) {\n    const [wasm, webworker]: [ArrayBuffer, Worker] = await Promise.all([\n        perspective_wasm().then((x: Response | ArrayBuffer) => {\n            if (x instanceof Response) {\n                return x.arrayBuffer();\n            } else {\n                return x.slice(0);\n            }\n        }),\n        perspective_wasm_worker(),\n    ]);\n\n    const { Client } = await module;\n    const client = new Client(\n        (proto: Uint8Array) => {\n            const f = proto.slice().buffer;\n            webworker.postMessage(f, { transfer: [f] });\n        },\n        () => {\n            console.debug(\"Closing WebWorker\");\n            webworker.terminate();\n        }\n    );\n\n    await _init(webworker, wasm);\n    webworker.addEventListener(\"message\", (json: MessageEvent<Uint8Array>) => {\n        client.handle_response(json.data);\n    });\n\n    await client.init();\n    return client;\n}\n\n/**\n * Create a new client connected via WebSocket to a server implemnting the\n * Perspective Protocol.\n * @param module\n * @param url\n * @returns\n */\nexport async function websocket(\n    module: Promise<typeof psp>,\n    url: string | URL\n) {\n    const { Client } = await module;\n    const ws = new WebSocket(url);\n    let [sender, receiver] = invert_promise();\n    ws.onopen = sender;\n    ws.binaryType = \"arraybuffer\";\n    await receiver;\n    const client = new Client(\n        (proto: Uint8Array) => {\n            const buffer = proto.slice().buffer;\n            ws.send(buffer);\n        },\n        () => {\n            console.debug(\"Closing WebSocket\");\n            ws.close();\n        }\n    );\n\n    ws.onmessage = (msg) => {\n        client.handle_response(msg.data);\n    };\n\n    await client.init();\n    return client;\n}\n\nexport default { websocket, worker };\n", "// \u250F\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n// \u2503 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588       \u2588      \u2588      \u2588      \u2588      \u2588 \u2588\u2584  \u2580\u2588\u2588\u2588 \u2588       \u2503\n// \u2503 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2588  \u2580\u2580\u2580\u2580\u2580\u2588\u2580\u2580\u2580\u2580\u2580 \u2588 \u2580\u2580\u2580\u2580\u2580\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2584  \u2580\u2588 \u2588 \u2580\u2580\u2580\u2580\u2580 \u2503\n// \u2503 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2580\u2580\u2580\u2580 \u2588\u2580\u2588\u2588\u2580\u2580 \u2584\u2584\u2584\u2584\u2584 \u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2584\u2584\u2584\u2584\u2584\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2584   \u2588 \u2584\u2584\u2584\u2584\u2584 \u2503\n// \u2503 \u2588      \u2588\u2588\u2588\u2588\u2588\u2588 \u2588  \u2580\u2588\u2584       \u2588 \u2588\u2588\u2588\u2588\u2588\u2588      \u2588      \u2588\u2588\u2588\u258C\u2590\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2584 \u2588       \u2503\n// \u2523\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u252B\n// \u2503 Copyright (c) 2017, the Perspective Authors.                              \u2503\n// \u2503 \u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C\u254C \u2503\n// \u2503 This file is part of the Perspective library, distributed under the terms \u2503\n// \u2503 of the [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0). \u2503\n// \u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251B\n\nimport * as api from \"./browser.ts\";\nexport type * from \"../../dist/pkg/perspective-js.d.ts\";\nexport type * from \"./ts-rs/ViewConfigUpdate.d.ts\";\n\nimport type * as psp from \"../../dist/pkg/perspective-js.d.ts\";\n\ntype WasmElement = {\n    __wasm_module__: Promise<typeof psp>;\n};\n\nexport async function compile_perspective() {\n    let elem = customElements.get(\n        \"perspective-viewer\"\n    ) as unknown as WasmElement;\n    if (!elem) {\n        console.warn(\"No `<perspective-viewer>` Custom Element found, waiting\");\n        await customElements.whenDefined(\"perspective-viewer\");\n        elem = customElements.get(\n            \"perspective-viewer\"\n        ) as unknown as WasmElement;\n    }\n\n    return elem.__wasm_module__;\n}\n\nexport async function websocket(url: string | URL) {\n    const wasm_module = compile_perspective();\n    return await api.websocket(wasm_module, url);\n}\n\nexport async function worker() {\n    const wasm_module = compile_perspective();\n    return await api.worker.call(undefined, wasm_module);\n}\n\nexport default { websocket, worker };\n"],
  "mappings": "AAaA,OAAOA,MAAsB,6CAG7B,OAAOC,MAA6B,4CAIpC,SAASC,GAAkD,CACvD,IAAIC,EACAC,EAAuB,IAAI,QAASC,GAAM,CAC1CF,EAASE,CACb,CAAC,EAED,MAAO,CAACF,EAAqCC,CAAQ,CACzD,CAEA,eAAeE,EAAMC,EAAYC,EAAmB,CAChD,GAAM,CAACL,EAAQC,CAAQ,EAAIF,EAAe,EAC1CK,EAAG,iBAAiB,UAAW,SAASE,EAASC,EAAM,CACnDH,EAAG,oBAAoB,UAAWE,CAAQ,EAC1CN,EAAO,IAAI,CACf,CAAC,EAEDI,EAAG,YAAY,CAAE,IAAK,OAAQ,KAAM,CAACC,CAAI,CAAE,EAAG,CAAE,SAAU,CAACA,CAAI,CAAE,CAAC,EAClE,MAAMJ,CACV,CAQA,eAAsBO,EAAOC,EAA6B,CACtD,GAAM,CAACJ,EAAMK,CAAS,EAA2B,MAAM,QAAQ,IAAI,CAC/Db,EAAiB,EAAE,KAAMK,GACjBA,aAAa,SACNA,EAAE,YAAY,EAEdA,EAAE,MAAM,CAAC,CAEvB,EACDJ,EAAwB,CAC5B,CAAC,EAEK,CAAE,OAAAa,CAAO,EAAI,MAAMF,EACnBG,EAAS,IAAID,EACdE,GAAsB,CACnB,IAAMC,EAAID,EAAM,MAAM,EAAE,OACxBH,EAAU,YAAYI,EAAG,CAAE,SAAU,CAACA,CAAC,CAAE,CAAC,CAC9C,EACA,IAAM,CACF,QAAQ,MAAM,mBAAmB,EACjCJ,EAAU,UAAU,CACxB,CACJ,EAEA,aAAMP,EAAMO,EAAWL,CAAI,EAC3BK,EAAU,iBAAiB,UAAYK,GAAmC,CACtEH,EAAO,gBAAgBG,EAAK,IAAI,CACpC,CAAC,EAED,MAAMH,EAAO,KAAK,EACXA,CACX,CASA,eAAsBI,EAClBP,EACAQ,EACF,CACE,GAAM,CAAE,OAAAN,CAAO,EAAI,MAAMF,EACnBL,EAAK,IAAI,UAAUa,CAAG,EACxB,CAACjB,EAAQC,CAAQ,EAAIF,EAAe,EACxCK,EAAG,OAASJ,EACZI,EAAG,WAAa,cAChB,MAAMH,EACN,IAAMW,EAAS,IAAID,EACdE,GAAsB,CACnB,IAAMK,EAASL,EAAM,MAAM,EAAE,OAC7BT,EAAG,KAAKc,CAAM,CAClB,EACA,IAAM,CACF,QAAQ,MAAM,mBAAmB,EACjCd,EAAG,MAAM,CACb,CACJ,EAEA,OAAAA,EAAG,UAAae,GAAQ,CACpBP,EAAO,gBAAgBO,EAAI,IAAI,CACnC,EAEA,MAAMP,EAAO,KAAK,EACXA,CACX,CC3FA,eAAsBQ,GAAsB,CACxC,IAAIC,EAAO,eAAe,IACtB,oBACJ,EACA,OAAKA,IACD,QAAQ,KAAK,yDAAyD,EACtE,MAAM,eAAe,YAAY,oBAAoB,EACrDA,EAAO,eAAe,IAClB,oBACJ,GAGGA,EAAK,eAChB,CAEA,eAAsBC,EAAUC,EAAmB,CAC/C,IAAMC,EAAcJ,EAAoB,EACxC,OAAO,MAAUE,EAAUE,EAAaD,CAAG,CAC/C,CAEA,eAAsBE,GAAS,CAC3B,IAAMD,EAAcJ,EAAoB,EACxC,OAAO,MAAUK,EAAO,KAAK,OAAWD,CAAW,CACvD,CAEA,IAAOE,EAAQ,CAAE,UAAAJ,EAAW,OAAAG,CAAO",
  "names": ["perspective_wasm", "perspective_wasm_worker", "invert_promise", "sender", "receiver", "x", "_init", "ws", "wasm", "listener", "resp", "worker", "module", "webworker", "Client", "client", "proto", "f", "json", "websocket", "url", "buffer", "msg", "compile_perspective", "elem", "websocket", "url", "wasm_module", "worker", "perspective_default"]
}
